(function(){var method;var noop=function(){};var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"];var length=methods.length;var console=window.console=window.console||{};while(length--){method=methods[length];if(!console[method]){console[method]=noop}}})();function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}}String.prototype.trunc=String.prototype.trunc||function(n){return this.length>n?this.substr(0,n-1)+"&hellip;":this};String.prototype.isJSON=String.prototype.isJSON||function(){try{JSON.parse(this)}catch(e){return false}return true};String.prototype.getExt=String.prototype.getExt||function(){var re=/(?:\.([^.]+))?$/;return re.exec(this)[1]};String.prototype.slugify=String.prototype.slugify||function(){var text=this.replace(/[^-a-zA-Z0-9\s_]+/gi,"");text=text.replace(/-/gi,"_");text=text.replace(/\s/gi,"-");return text};String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ucwords=String.prototype.ucwords||function(){str=this.toLowerCase();return str.replace(/(^([a-zA-Z\p{M}]))|([ -][a-zA-Z\p{M}])/g,function(s){return s.toUpperCase()})};String.prototype.toSnakeCase=function(){return this.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()})};String.prototype.decodeHTML=function(){var map={gt:">"};return this.replace(/&(#(?:x[0-9a-f]+|\d+)|[a-z]+);?/gi,function($0,$1){if($1[0]==="#"){return String.fromCharCode($1[1].toLowerCase()==="x"?parseInt($1.substr(2),16):parseInt($1.substr(1),10))}else{return map.hasOwnProperty($1)?map[$1]:$0}})};var guid=function(sep){sep=typeof sep=="undefined"?"-":sep;var S4=function(){return Math.floor(Math.random()*65536).toString(16)};return S4()+S4()+sep+S4()+sep+S4()+sep+S4()+sep+S4()+S4()+S4()};Array.prototype.indexOf=Array.prototype.indexOf||function(obj){for(var i=0;i<this.length;i++){if(this[i]==obj){return i}}return-1};Array.prototype.contains=Array.prototype.contains||function(needle){for(i in this){if(this[i]==needle)return true}return false};Array.prototype.clean=Array.prototype.clean||function(deleteValue){for(var i=0;i<this.length;i++){if(this[i]==deleteValue){this.splice(i,1);i--}}return this};if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(predicate){if(this==null){throw new TypeError('"this" is null or not defined')}var o=Object(this);var len=o.length>>>0;if(typeof predicate!=="function"){throw new TypeError("predicate must be a function")}var thisArg=arguments[1];var k=0;while(k<len){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o)){return kValue}k++}return undefined}})}var ObservableArray=function(items){var _self=this,_array=[],_handlers={itemadded:[],itemremoved:[],itemset:[]};function defineIndexProperty(index){if(!(index in _self)){Object.defineProperty(_self,index,{configurable:true,enumerable:true,get:function(){return _array[index]},set:function(v){_array[index]=v;raiseEvent({type:"itemset",index:index,item:v})}})}}function raiseEvent(event){_handlers[event.type].forEach(function(h){h.call(_self,event)})}Object.defineProperty(_self,"addEventListener",{configurable:false,enumerable:false,writable:false,value:function(eventName,handler){eventName=(""+eventName).toLowerCase();if(!(eventName in _handlers))throw new Error("Invalid event name.");if(typeof handler!=="function")throw new Error("Invalid handler.");_handlers[eventName].push(handler)}});Object.defineProperty(_self,"removeEventListener",{configurable:false,enumerable:false,writable:false,value:function(eventName,handler){eventName=(""+eventName).toLowerCase();if(!(eventName in _handlers))throw new Error("Invalid event name.");if(typeof handler!=="function")throw new Error("Invalid handler.");var h=_handlers[eventName];var ln=h.length;while(--ln>=0){if(h[ln]===handler){h.splice(ln,1)}}}});Object.defineProperty(_self,"push",{configurable:false,enumerable:false,writable:false,value:function(){var index;for(var i=0,ln=arguments.length;i<ln;i++){index=_array.length;_array.push(arguments[i]);defineIndexProperty(index);raiseEvent({type:"itemadded",index:index,item:arguments[i]})}return _array.length}});Object.defineProperty(_self,"pop",{configurable:false,enumerable:false,writable:false,value:function(){if(_array.length>-1){var index=_array.length-1,item=_array.pop();delete _self[index];raiseEvent({type:"itemremoved",index:index,item:item});return item}}});Object.defineProperty(_self,"unshift",{configurable:false,enumerable:false,writable:false,value:function(){for(var i=0,ln=arguments.length;i<ln;i++){_array.splice(i,0,arguments[i]);defineIndexProperty(_array.length-1);raiseEvent({type:"itemadded",index:i,item:arguments[i]})}for(;i<_array.length;i++){raiseEvent({type:"itemset",index:i,item:_array[i]})}return _array.length}});Object.defineProperty(_self,"shift",{configurable:false,enumerable:false,writable:false,value:function(){if(_array.length>-1){var item=_array.shift();_array.length===0&&delete _self[index];raiseEvent({type:"itemremoved",index:0,item:item});return item}}});Object.defineProperty(_self,"splice",{configurable:false,enumerable:false,writable:false,value:function(index,howMany){var removed=[],item;index=!~index?_array.length-index:index;howMany=(howMany==null?_array.length-index:howMany)||0;while(howMany--){item=_array.splice(index,1)[0];removed.push(item);delete _self[_array.length];raiseEvent({type:"itemremoved",index:index+removed.length-1,item:item})}for(var i=2,ln=arguments.length;i<ln;i++){_array.splice(index,0,arguments[i]);defineIndexProperty(_array.length-1);raiseEvent({type:"itemadded",index:i,item:arguments[i]});index++}return removed}});Object.defineProperty(_self,"length",{configurable:false,enumerable:false,get:function(){return _array.length},set:function(value){var n=Number(value);if(n%1===0&&n>=0){if(n<_array.length){_self.splice(n)}else if(n>_array.length){_self.push.apply(_self,new Array(n-_array.length))}}else{throw new RangeError("Invalid array length")}return value}});Object.getOwnPropertyNames(Array.prototype).forEach(function(name){if(!(name in _self)){Object.defineProperty(_self,name,{configurable:false,enumerable:false,writable:false,value:Array.prototype[name]})}});if(items instanceof Array){_self.push.apply(_self,items)}};function runInSequence(functions,timing,debug){var _debug=typeof debug==="undefined"?false:debug;var _timing=timing,_functions=functions,_counter=1,_logs={success:[],error:[]},_sequenceId;var _runSequence=function(){_functions.map(function(func){if(typeof func!=="function"||typeof func==="undefined"){var currentError=_functions.splice(_functions.indexOf(func),1);_logs.error.push(currentError)}});if(_debug){console.info("Executable items");console.log(_functions);console.info("Non-executable items");console.log(_logs.error)}_functions[0].apply(this,arguments);_logs.success.push(_functions[0]);_sequenceId=setInterval(_sequence,timing)};var _sequence=function(){if(typeof _functions[_counter]==="function"){_functions[_counter].apply(this,arguments);_logs.success.push(_functions[_counter])}_counter++;if(_counter>=_functions.length){return _logs;_stopSequence()}};var _stopSequence=function(){clearInterval(_sequenceId)};_runSequence();return _logs}var getStringParts=function(str,spliter){return str.split(spliter)};Object.size=function(obj){var size=0,key;for(key in obj){if(obj.hasOwnProperty(key)){size++}}return size};function unless(exp,func){if(typeof func==="function"&&!exp){func.apply(this,arguments)}return!exp}var SubPub=function(id){var context=typeof id==="undefined"?document:id;var topics={};var hOP=topics.hasOwnProperty;return{subscribe:function(topic,listener){if(!hOP.call(topics,topic))topics[topic]=[];var index=topics[topic].push(listener)-1;return{remove:function(){delete topics[topic][index]}}},publish:function(topic,info){if(!hOP.call(topics,topic))return;topics[topic].forEach(function(item){item(info!=undefined?info:{})})}}};var AspectRatio={getScaled:function(currentW,currentH,newSize,property){return property==="width"?currentH/currentW*newSize:currentW/currentH*newSize}};function delay(ms){var start=+new Date;while(+new Date-start<ms);}window.addEventListener("beforeunload",function(e){window.dataLayer.push({event:"beforeunload"});var $html=document.querySelector("html"),nofade="no-fade",fade="u-fade-out";if($html.classList){var highlightChart=document.querySelector(".highcharts-button-symbol");if(highlightChart){return}if(!$html.classList.contains(nofade)&&!$html.classList.contains("special-report-no-fade")){$html.classList.add(fade)}$html.classList.remove(nofade)}else{if($html.className.indexOf(nofade)<0){$html.className+=" "+fade}$html.className.replace(nofade,"")}delay(150)},false);var parseUri=function(str){var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||"";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2});return uri};parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};window.lzw_encode=function(s){var data=(s+"").split(""),phrase=data[0],code=256,dict={},out=[],currChar;for(var i=1;i<data.length;i++){currChar=data[i];if(dict[phrase+currChar]!=null){phrase+=currChar}else{out.push(phrase.length>1?dict[phrase]:phrase.charCodeAt(0));dict[phrase+currChar]=code;code++;phrase=currChar}}out.push(phrase.length>1?dict[phrase]:phrase.charCodeAt(0));for(var i=0;i<out.length;i++){out[i]=String.fromCharCode(out[i])}return out.join("")};RegExp.escape=function(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};(function($){$("document").ready(function(){if($(".s-copy").length>0){$(".s-copy li").each(function(i,elem){$(elem).contents().wrapAll("<div class='s-list'></div>")})}if($(".s-main").length>0){$(".s-visual-article__body *, .c-page-hero__teaser *, .c-global-overview *, .s-key-figures__description *, .s-parallax-background__intro *, .c-news-listing__description *").each(function(){weight=$(this).css("font-weight");$(this).attr("style","");$(this).css("font-weight",weight)});$(".s-visual-article__body a, .s-copy a, .c-page-hero__teaser a, .s-component a, .s-key-figures__description a, .s-parallax-background__intro a").each(function(){if($(this).attr("href")===""||$(this).attr("href")===undefined){var keeping=$(this).contents();$(keeping).insertAfter($(this));$(this).remove()}});$('.s-visual-article__body a:not([href*="javascript"]):not([href^="#"])').each(function(){$(this).attr("target","_blank")});if($(".s-visual-article__body iframe").length>0){$(".s-visual-article__body iframe").each(function(){var src=$(this).attr("src");var arr=src.split("/");if($.inArray("www.youtube.com",arr)!==-1){var newSrc=src+"?autoplay=1&mute=1&loop=1";$(this).attr("src",newSrc)}})}$('a[href^="#"]').click(function(e){e.preventDefault();$("html, body").animate({scrollTop:$($.attr(this,"href")).offset().top-80},500)});if($(".o-image").length>0){$(".o-image").each(function(){var lazyImg=$(this).find("img");if(!lazyImg.hasClass("lazyload")&&!lazyImg.hasClass("lazyloaded")){lazyImg.addClass("lazyload")}})}}if($(".flashpoint-back").length>0){$(".flashpoint-back").click(function(e){e.preventDefault();window.parent.location=window.parent.location})}})})(jQuery);(function($){$("document").ready(function(){if($(".search-total").length>0){var total=$(".search-page").attr("data-total");var title=$(".search-page").attr("data-search");if(title!==undefined&&title!==""){$(".search-total").html(total+" search results for <strong>"+title+"<strong>")}}})})(jQuery);var objectFitImages=function(){"use strict";var e="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var t=/(object-fit|object-position)\s*:\s*([^;$"'\s]+)/g;var r="object-fit"in document.createElement("i").style;var n=false;function i(e){var r=getComputedStyle(e).fontFamily;var n;var i={};while((n=t.exec(r))!==null){i[n[1]]=n[2]}return i}function c(t,r,n){n=n||i(t);if(n["object-fit"]==="fill"){return}r=r||t.currentSrc||t.src;t.style.backgroundImage="url("+r+")";t.style.backgroundPosition=n["object-position"]||"center";t.style.backgroundSize=n["object-fit"].replace("scale-down","contain");t.style.backgroundRepeat="no-repeat";if(t.srcset){t.srcset=""}if(!t[e]){t.src=e;o(t)}t[e]=r}function o(t){var r={get:function(){return t[e]},set:function(e){return c(t,e)}};Object.defineProperty(t,"src",r);Object.defineProperty(t,"currentSrc",{get:r.get})}function a(e){window.addEventListener("resize",u.bind(null,e))}function f(e){if(e.target.tagName==="IMG"){u(e.target)}}function u(e,t){if(r){return false}t=t||{};if(!n&&!e){document.body.addEventListener("load",f,true);n=true;if(t.watchMQ){a("img")}}e=e||"img";if(typeof e==="string"){e=document.querySelectorAll("img")}else if(!e.length){e=[e]}var o;for(var u=0;u<e.length;u++){o=i(e[u]);if(o["object-fit"]){c(e[u],null,o)}}if(!n&&t.watchMQ){a(e)}}return u}();if(!window["YT"]){var YT={loading:0,loaded:0}}if(!window["YTConfig"]){var YTConfig={host:"http://www.youtube.com"}}if(!YT.loading){YT.loading=1;(function(){var l=[];YT.ready=function(f){if(YT.loaded){f()}else{l.push(f)}};window.onYTReady=function(){YT.loaded=1;for(var i=0;i<l.length;i++){try{l[i]()}catch(e){}}};YT.setConfig=function(c){for(var k in c){if(c.hasOwnProperty(k)){YTConfig[k]=c[k]}}};var a=document.createElement("script");a.type="text/javascript";a.id="www-widgetapi-script";a.src="https:"+"//s.ytimg.com/yts/jsbin/www-widgetapi-vfl0mFVOk/www-widgetapi.js";a.async=true;var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})()}var SC=SC||{};SC.Widget=function(n){function t(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return n[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var e={};return t.m=n,t.c=e,t.p="",t(0)}([function(n,t,e){function r(n){return!!(""===n||n&&n.charCodeAt&&n.substr)}function o(n){return!!(n&&n.constructor&&n.call&&n.apply)}function i(n){return!(!n||1!==n.nodeType||"IFRAME"!==n.nodeName.toUpperCase())}function a(n){var t,e=!1;for(t in b)if(b.hasOwnProperty(t)&&b[t]===n){e=!0;break}return e}function s(n){var t,e,r;for(t=0,e=I.length;t<e&&(r=n(I[t]),r!==!1);t++);}function u(n){var t,e,r,o="";for("//"===n.substr(0,2)&&(n=window.location.protocol+n),r=n.split("/"),t=0,e=r.length;t<e&&t<3;t++)o+=r[t],t<2&&(o+="/");return o}function c(n){return n.contentWindow?n.contentWindow:n.contentDocument&&"parentWindow"in n.contentDocument?n.contentDocument.parentWindow:null}function l(n){var t,e=[];for(t in n)n.hasOwnProperty(t)&&e.push(n[t]);return e}function d(n,t,e){e.callbacks[n]=e.callbacks[n]||[],e.callbacks[n].push(t)}function E(n,t){var e,r=!0;return t.callbacks[n]=[],s(function(t){if(e=t.callbacks[n]||[],e.length)return r=!1,!1}),r}function f(n,t,e){var r,o,i=c(e);return!!i.postMessage&&(r=e.getAttribute("src").split("?")[0],o=JSON.stringify({method:n,value:t}),"//"===r.substr(0,2)&&(r=window.location.protocol+r),r=r.replace(/http:\/\/(w|wt).soundcloud.com/,"https://$1.soundcloud.com"),void i.postMessage(o,r))}function p(n){var t;return s(function(e){if(e.instance===n)return t=e,!1}),t}function h(n){var t;return s(function(e){if(c(e.element)===n)return t=e,!1}),t}function v(n,t){return function(e){var r=o(e),i=p(this),a=!r&&t?e:null,s=r&&!t?e:null;return s&&d(n,s,i),f(n,a,i.element),this}}function S(n,t,e){var r,o,i;for(r=0,o=t.length;r<o;r++)i=t[r],n[i]=v(i,e)}function R(n,t,e){return n+"?url="+t+"&"+g(e)}function g(n){var t,e,r=[];for(t in n)n.hasOwnProperty(t)&&(e=n[t],r.push(t+"="+("start_track"===t?parseInt(e,10):e?"true":"false")));return r.join("&")}function m(n,t,e){var r,o,i=n.callbacks[t]||[];for(r=0,o=i.length;r<o;r++)i[r].apply(n.instance,e);(a(t)||t===L.READY)&&(n.callbacks[t]=[])}function w(n){var t,e,r,o,i;try{e=JSON.parse(n.data)}catch(a){return!1}return t=h(n.source),r=e.method,o=e.value,(!t||A(n.origin)===A(t.domain))&&(t?(r===L.READY&&(t.isReady=!0,m(t,C),E(C,t)),r!==L.PLAY||t.playEventFired||(t.playEventFired=!0),r!==L.PLAY_PROGRESS||t.playEventFired||(t.playEventFired=!0,m(t,L.PLAY,[o])),i=[],void 0!==o&&i.push(o),void m(t,r,i)):(r===L.READY&&T.push(n.source),!1))}function A(n){return n.replace(Y,"")}var _,y,O,D=e(1),b=e(2),P=e(3),L=D.api,N=D.bridge,T=[],I=[],C="__LATE_BINDING__",k="http://wt.soundcloud.dev:9200/",Y=/^http(?:s?)/;window.addEventListener?window.addEventListener("message",w,!1):window.attachEvent("onmessage",w),n.exports=O=function(n,t,e){if(r(n)&&(n=document.getElementById(n)),!i(n))throw new Error("SC.Widget function should be given either iframe element or a string specifying id attribute of iframe element.");t&&(e=e||{},n.src=R(k,t,e));var o,a,s=h(c(n));return s&&s.instance?s.instance:(o=T.indexOf(c(n))>-1,a=new _(n),I.push(new y(a,n,o)),a)},O.Events=L,window.SC=window.SC||{},window.SC.Widget=O,y=function(n,t,e){this.instance=n,this.element=t,this.domain=u(t.getAttribute("src")),this.isReady=!!e,this.callbacks={}},_=function(){},_.prototype={constructor:_,load:function(n,t){if(n){t=t||{};var e=this,r=p(this),o=r.element,i=o.src,a=i.substr(0,i.indexOf("?"));r.isReady=!1,r.playEventFired=!1,o.onload=function(){e.bind(L.READY,function(){var n,e=r.callbacks;for(n in e)e.hasOwnProperty(n)&&n!==L.READY&&f(N.ADD_LISTENER,n,r.element);t.callback&&t.callback()})},o.src=R(a,n,t)}},bind:function(n,t){var e=this,r=p(this);return r&&r.element&&(n===L.READY&&r.isReady?setTimeout(t,1):r.isReady?(d(n,t,r),f(N.ADD_LISTENER,n,r.element)):d(C,function(){e.bind(n,t)},r)),this},unbind:function(n){var t,e=p(this);e&&e.element&&(t=E(n,e),n!==L.READY&&t&&f(N.REMOVE_LISTENER,n,e.element))}},S(_.prototype,l(b)),S(_.prototype,l(P),!0)},function(n,t){t.api={LOAD_PROGRESS:"loadProgress",PLAY_PROGRESS:"playProgress",PLAY:"play",PAUSE:"pause",FINISH:"finish",SEEK:"seek",READY:"ready",OPEN_SHARE_PANEL:"sharePanelOpened",CLICK_DOWNLOAD:"downloadClicked",CLICK_BUY:"buyClicked",ERROR:"error"},t.bridge={REMOVE_LISTENER:"removeEventListener",ADD_LISTENER:"addEventListener"}},function(n,t){n.exports={GET_VOLUME:"getVolume",GET_DURATION:"getDuration",GET_POSITION:"getPosition",GET_SOUNDS:"getSounds",GET_CURRENT_SOUND:"getCurrentSound",GET_CURRENT_SOUND_INDEX:"getCurrentSoundIndex",IS_PAUSED:"isPaused"}},function(n,t){n.exports={PLAY:"play",PAUSE:"pause",TOGGLE:"toggle",SEEK_TO:"seekTo",SET_VOLUME:"setVolume",NEXT:"next",PREV:"prev",SKIP:"skip"}}]);!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(t){var r,i,n,o=arguments.length,s=window[t],a=arguments,u=a[1];if(2>o)throw Error("Minimum 2 arguments must be given");if(e.isArray(u)){i={};for(var f in u){r=u[f];try{i[r]=JSON.parse(s.getItem(r))}catch(c){i[r]=s.getItem(r)}}return i}if(2!=o){try{i=JSON.parse(s.getItem(u))}catch(c){throw new ReferenceError(u+" is not defined in this storage")}for(var f=2;o-1>f;f++)if(i=i[a[f]],void 0===i)throw new ReferenceError([].slice.call(a,1,f+1).join(".")+" is not defined in this storage");if(e.isArray(a[f])){n=i,i={};for(var m in a[f])i[a[f][m]]=n[a[f][m]];return i}return i[a[f]]}try{return JSON.parse(s.getItem(u))}catch(c){return s.getItem(u)}}function r(t){var r,i,n=arguments.length,o=window[t],s=arguments,a=s[1],u=s[2],f={};if(2>n||!e.isPlainObject(a)&&3>n)throw Error("Minimum 3 arguments must be given or second parameter must be an object");if(e.isPlainObject(a)){for(var c in a)r=a[c],e.isPlainObject(r)?o.setItem(c,JSON.stringify(r)):o.setItem(c,r);return a}if(3==n)return"object"==typeof u?o.setItem(a,JSON.stringify(u)):o.setItem(a,u),u;try{i=o.getItem(a),null!=i&&(f=JSON.parse(i))}catch(m){}i=f;for(var c=2;n-2>c;c++)r=s[c],i[r]&&e.isPlainObject(i[r])||(i[r]={}),i=i[r];return i[s[c]]=s[c+1],o.setItem(a,JSON.stringify(f)),f}function i(t){var r,i,n=arguments.length,o=window[t],s=arguments,a=s[1];if(2>n)throw Error("Minimum 2 arguments must be given");if(e.isArray(a)){for(var u in a)o.removeItem(a[u]);return!0}if(2==n)return o.removeItem(a),!0;try{r=i=JSON.parse(o.getItem(a))}catch(f){throw new ReferenceError(a+" is not defined in this storage")}for(var u=2;n-1>u;u++)if(i=i[s[u]],void 0===i)throw new ReferenceError([].slice.call(s,1,u).join(".")+" is not defined in this storage");if(e.isArray(s[u]))for(var c in s[u])delete i[s[u][c]];else delete i[s[u]];return o.setItem(a,JSON.stringify(r)),!0}function n(t,r){var n=a(t);for(var o in n)i(t,n[o]);if(r)for(var o in e.namespaceStorages)u(o)}function o(r){var i=arguments.length,n=arguments,s=(window[r],n[1]);if(1==i)return 0==a(r).length;if(e.isArray(s)){for(var u=0;u<s.length;u++)if(!o(r,s[u]))return!1;return!0}try{var f=t.apply(this,arguments);e.isArray(n[i-1])||(f={totest:f});for(var u in f)if(!(e.isPlainObject(f[u])&&e.isEmptyObject(f[u])||e.isArray(f[u])&&!f[u].length)&&f[u])return!1;return!0}catch(c){return!0}}function s(r){var i=arguments.length,n=arguments,o=(window[r],n[1]);if(2>i)throw Error("Minimum 2 arguments must be given");if(e.isArray(o)){for(var a=0;a<o.length;a++)if(!s(r,o[a]))return!1;return!0}try{var u=t.apply(this,arguments);e.isArray(n[i-1])||(u={totest:u});for(var a in u)if(void 0===u[a]||null===u[a])return!1;return!0}catch(f){return!1}}function a(r){var i=arguments.length,n=window[r],o=arguments,s=(o[1],[]),a={};if(a=i>1?t.apply(this,o):n,a._cookie)for(var u in e.cookie())""!=u&&s.push(u.replace(a._prefix,""));else for(var f in a)s.push(f);return s}function u(t){if(!t||"string"!=typeof t)throw Error("First parameter must be a string");g?(window.localStorage.getItem(t)||window.localStorage.setItem(t,"{}"),window.sessionStorage.getItem(t)||window.sessionStorage.setItem(t,"{}")):(window.localCookieStorage.getItem(t)||window.localCookieStorage.setItem(t,"{}"),window.sessionCookieStorage.getItem(t)||window.sessionCookieStorage.setItem(t,"{}"));var r={localStorage:e.extend({},e.localStorage,{_ns:t}),sessionStorage:e.extend({},e.sessionStorage,{_ns:t})};return e.cookie&&(window.cookieStorage.getItem(t)||window.cookieStorage.setItem(t,"{}"),r.cookieStorage=e.extend({},e.cookieStorage,{_ns:t})),e.namespaceStorages[t]=r,r}function f(e){if(!window[e])return!1;var t="jsapi";try{return window[e].setItem(t,t),window[e].removeItem(t),!0}catch(r){return!1}}var c="ls_",m="ss_",g=f("localStorage"),h={_type:"",_ns:"",_callMethod:function(e,t){var r=[this._type],t=Array.prototype.slice.call(t),i=t[0];return this._ns&&r.push(this._ns),"string"==typeof i&&-1!==i.indexOf(".")&&(t.shift(),[].unshift.apply(t,i.split("."))),[].push.apply(r,t),e.apply(this,r)},get:function(){return this._callMethod(t,arguments)},set:function(){var t=arguments.length,i=arguments,n=i[0];if(1>t||!e.isPlainObject(n)&&2>t)throw Error("Minimum 2 arguments must be given or first parameter must be an object");if(e.isPlainObject(n)&&this._ns){for(var o in n)r(this._type,this._ns,o,n[o]);return n}var s=this._callMethod(r,i);return this._ns?s[n.split(".")[0]]:s},remove:function(){if(arguments.length<1)throw Error("Minimum 1 argument must be given");return this._callMethod(i,arguments)},removeAll:function(e){return this._ns?(r(this._type,this._ns,{}),!0):n(this._type,e)},isEmpty:function(){return this._callMethod(o,arguments)},isSet:function(){if(arguments.length<1)throw Error("Minimum 1 argument must be given");return this._callMethod(s,arguments)},keys:function(){return this._callMethod(a,arguments)}};if(e.cookie){window.name||(window.name=Math.floor(1e8*Math.random()));var l={_cookie:!0,_prefix:"",_expires:null,_path:null,_domain:null,setItem:function(t,r){e.cookie(this._prefix+t,r,{expires:this._expires,path:this._path,domain:this._domain})},getItem:function(t){return e.cookie(this._prefix+t)},removeItem:function(t){return e.removeCookie(this._prefix+t)},clear:function(){for(var t in e.cookie())""!=t&&(!this._prefix&&-1===t.indexOf(c)&&-1===t.indexOf(m)||this._prefix&&0===t.indexOf(this._prefix))&&e.removeCookie(t)},setExpires:function(e){return this._expires=e,this},setPath:function(e){return this._path=e,this},setDomain:function(e){return this._domain=e,this},setConf:function(e){return e.path&&(this._path=e.path),e.domain&&(this._domain=e.domain),e.expires&&(this._expires=e.expires),this},setDefaultConf:function(){this._path=this._domain=this._expires=null}};g||(window.localCookieStorage=e.extend({},l,{_prefix:c,_expires:3650}),window.sessionCookieStorage=e.extend({},l,{_prefix:m+window.name+"_"})),window.cookieStorage=e.extend({},l),e.cookieStorage=e.extend({},h,{_type:"cookieStorage",setExpires:function(e){return window.cookieStorage.setExpires(e),this},setPath:function(e){return window.cookieStorage.setPath(e),this},setDomain:function(e){return window.cookieStorage.setDomain(e),this},setConf:function(e){return window.cookieStorage.setConf(e),this},setDefaultConf:function(){return window.cookieStorage.setDefaultConf(),this}})}e.initNamespaceStorage=function(e){return u(e)},g?(e.localStorage=e.extend({},h,{_type:"localStorage"}),e.sessionStorage=e.extend({},h,{_type:"sessionStorage"})):(e.localStorage=e.extend({},h,{_type:"localCookieStorage"}),e.sessionStorage=e.extend({},h,{_type:"sessionCookieStorage"})),e.namespaceStorages={},e.removeAllStorages=function(t){e.localStorage.removeAll(t),e.sessionStorage.removeAll(t),e.cookieStorage&&e.cookieStorage.removeAll(t),t||(e.namespaceStorages={})}});!function(){var $,Annotator,Delegator,LinkParser,Range,Util,base64Decode,base64UrlDecode,createDateFromISO8601,findChild,fn,functions,g,getNodeName,getNodePosition,gettext,parseToken,simpleXPathJQuery,simpleXPathPure,_Annotator,_gettext,_i,_j,_len,_len1,_ref,_ref1,_ref2,_ref3,_ref4,_t,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};simpleXPathJQuery=function(relativeRoot){var jq;jq=this.map(function(){var elem,idx,path,tagName;path="";elem=this;while((elem!=null?elem.nodeType:void 0)===Node.ELEMENT_NODE&&elem!==relativeRoot){tagName=elem.tagName.replace(":","\\:");idx=$(elem.parentNode).children(tagName).index(elem)+1;idx="["+idx+"]";path="/"+elem.tagName.toLowerCase()+idx+path;elem=elem.parentNode}return path});return jq.get()};simpleXPathPure=function(relativeRoot){var getPathSegment,getPathTo,jq,rootNode;getPathSegment=function(node){var name,pos;name=getNodeName(node);pos=getNodePosition(node);return""+name+"["+pos+"]"};rootNode=relativeRoot;getPathTo=function(node){var xpath;xpath="";while(node!==rootNode){if(node==null){throw new Error("Called getPathTo on a node which was not a descendant of @rootNode. "+rootNode)}xpath=getPathSegment(node)+"/"+xpath;node=node.parentNode}xpath="/"+xpath;xpath=xpath.replace(/\/$/,"");return xpath};jq=this.map(function(){var path;path=getPathTo(this);return path});return jq.get()};findChild=function(node,type,index){var child,children,found,name,_i,_len;if(!node.hasChildNodes()){throw new Error("XPath error: node has no children!")}children=node.childNodes;found=0;for(_i=0,_len=children.length;_i<_len;_i++){child=children[_i];name=getNodeName(child);if(name===type){found+=1;if(found===index){return child}}}throw new Error("XPath error: wanted child not found.")};getNodeName=function(node){var nodeName;nodeName=node.nodeName.toLowerCase();switch(nodeName){case"#text":return"text()";case"#comment":return"comment()";case"#cdata-section":return"cdata-section()";default:return nodeName}};getNodePosition=function(node){var pos,tmp;pos=0;tmp=node;while(tmp){if(tmp.nodeName===node.nodeName){pos++}tmp=tmp.previousSibling}return pos};gettext=null;if(typeof Gettext!=="undefined"&&Gettext!==null){_gettext=new Gettext({domain:"annotator"});gettext=function(msgid){return _gettext.gettext(msgid)}}else{gettext=function(msgid){return msgid}}_t=function(msgid){return gettext(msgid)};if(!(typeof jQuery!=="undefined"&&jQuery!==null?(_ref=jQuery.fn)!=null?_ref.jquery:void 0:void 0)){console.error(_t("Annotator requires jQuery: have you included lib/vendor/jquery.js?"))}if(!(JSON&&JSON.parse&&JSON.stringify)){console.error(_t("Annotator requires a JSON implementation: have you included lib/vendor/json2.js?"))}$=jQuery;Util={};Util.flatten=function(array){var flatten;flatten=function(ary){var el,flat,_i,_len;flat=[];for(_i=0,_len=ary.length;_i<_len;_i++){el=ary[_i];flat=flat.concat(el&&$.isArray(el)?flatten(el):el)}return flat};return flatten(array)};Util.contains=function(parent,child){var node;node=child;while(node!=null){if(node===parent){return true}node=node.parentNode}return false};Util.getTextNodes=function(jq){var getTextNodes;getTextNodes=function(node){var nodes;if(node&&node.nodeType!==Node.TEXT_NODE){nodes=[];if(node.nodeType!==Node.COMMENT_NODE){node=node.lastChild;while(node){nodes.push(getTextNodes(node));node=node.previousSibling}}return nodes.reverse()}else{return node}};return jq.map(function(){return Util.flatten(getTextNodes(this))})};Util.getLastTextNodeUpTo=function(n){var result;switch(n.nodeType){case Node.TEXT_NODE:return n;case Node.ELEMENT_NODE:if(n.lastChild!=null){result=Util.getLastTextNodeUpTo(n.lastChild);if(result!=null){return result}}break}n=n.previousSibling;if(n!=null){return Util.getLastTextNodeUpTo(n)}else{return null}};Util.getFirstTextNodeNotBefore=function(n){var result;switch(n.nodeType){case Node.TEXT_NODE:return n;case Node.ELEMENT_NODE:if(n.firstChild!=null){result=Util.getFirstTextNodeNotBefore(n.firstChild);if(result!=null){return result}}break}n=n.nextSibling;if(n!=null){return Util.getFirstTextNodeNotBefore(n)}else{return null}};Util.readRangeViaSelection=function(range){var sel;sel=Util.getGlobal().getSelection();sel.removeAllRanges();sel.addRange(range.toRange());return sel.toString()};Util.xpathFromNode=function(el,relativeRoot){var exception,result;try{result=simpleXPathJQuery.call(el,relativeRoot)}catch(_error){exception=_error;result=simpleXPathPure.call(el,relativeRoot)}return result};Util.nodeFromXPath=function(xp,root){var idx,name,node,step,steps,_i,_len,_ref1;steps=xp.substring(1).split("/");node=root;for(_i=0,_len=steps.length;_i<_len;_i++){step=steps[_i];_ref1=step.split("["),name=_ref1[0],idx=_ref1[1];idx=idx!=null?parseInt((idx!=null?idx.split("]"):void 0)[0]):1;node=findChild(node,name.toLowerCase(),idx)}return node};Util.escape=function(html){return html.replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};Util.uuid=function(){var counter;counter=0;return function(){return counter++}}();Util.getGlobal=function(){return function(){return this}()};Util.maxZIndex=function($elements){var all,el;all=function(){var _i,_len,_results;_results=[];for(_i=0,_len=$elements.length;_i<_len;_i++){el=$elements[_i];if($(el).css("position")==="static"){_results.push(-1)}else{_results.push(parseFloat($(el).css("z-index"))||-1)}}return _results}();return Math.max.apply(Math,all)};Util.mousePosition=function(e,offsetEl){var offset,_ref1;if((_ref1=$(offsetEl).css("position"))!=="absolute"&&_ref1!=="fixed"&&_ref1!=="relative"){offsetEl=$(offsetEl).offsetParent()[0]}offset=$(offsetEl).offset();return{top:e.pageY-offset.top,left:e.pageX-offset.left}};Util.preventEventDefault=function(event){return event!=null?typeof event.preventDefault==="function"?event.preventDefault():void 0:void 0};functions=["log","debug","info","warn","exception","assert","dir","dirxml","trace","group","groupEnd","groupCollapsed","time","timeEnd","profile","profileEnd","count","clear","table","error","notifyFirebug","firebug","userObjects"];if(typeof console!=="undefined"&&console!==null){if(console.group==null){console.group=function(name){return console.log("GROUP: ",name)}}if(console.groupCollapsed==null){console.groupCollapsed=console.group}for(_i=0,_len=functions.length;_i<_len;_i++){fn=functions[_i];if(console[fn]==null){console[fn]=function(){return console.log(_t("Not implemented:")+(" console."+name))}}}}else{this.console={};for(_j=0,_len1=functions.length;_j<_len1;_j++){fn=functions[_j];this.console[fn]=function(){}}this.console["error"]=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return alert("ERROR: "+args.join(", "))};this.console["warn"]=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return alert("WARNING: "+args.join(", "))}}Delegator=function(){Delegator.prototype.events={};Delegator.prototype.options={};Delegator.prototype.element=null;function Delegator(element,options){this.options=$.extend(true,{},this.options,options);this.element=$(element);this._closures={};this.on=this.subscribe;this.addEvents()}Delegator.prototype.destroy=function(){return this.removeEvents()};Delegator.prototype.addEvents=function(){var event,_k,_len2,_ref1,_results;_ref1=Delegator._parseEvents(this.events);_results=[];for(_k=0,_len2=_ref1.length;_k<_len2;_k++){event=_ref1[_k];_results.push(this._addEvent(event.selector,event.event,event.functionName))}return _results};Delegator.prototype.removeEvents=function(){var event,_k,_len2,_ref1,_results;_ref1=Delegator._parseEvents(this.events);_results=[];for(_k=0,_len2=_ref1.length;_k<_len2;_k++){event=_ref1[_k];_results.push(this._removeEvent(event.selector,event.event,event.functionName))}return _results};Delegator.prototype._addEvent=function(selector,event,functionName){var closure,_this=this;closure=function(){return _this[functionName].apply(_this,arguments)};if(selector===""&&Delegator._isCustomEvent(event)){this.subscribe(event,closure)}else{this.element.delegate(selector,event,closure)}this._closures[""+selector+"/"+event+"/"+functionName]=closure;return this};Delegator.prototype._removeEvent=function(selector,event,functionName){var closure;closure=this._closures[""+selector+"/"+event+"/"+functionName];if(selector===""&&Delegator._isCustomEvent(event)){this.unsubscribe(event,closure)}else{this.element.undelegate(selector,event,closure)}delete this._closures[""+selector+"/"+event+"/"+functionName];return this};Delegator.prototype.publish=function(){this.element.triggerHandler.apply(this.element,arguments);return this};Delegator.prototype.subscribe=function(event,callback){var closure;closure=function(){return callback.apply(this,[].slice.call(arguments,1))};closure.guid=callback.guid=$.guid+=1;this.element.bind(event,closure);return this};Delegator.prototype.unsubscribe=function(){this.element.unbind.apply(this.element,arguments);return this};return Delegator}();Delegator._parseEvents=function(eventsObj){var event,events,functionName,sel,selector,_k,_ref1;events=[];for(sel in eventsObj){functionName=eventsObj[sel];_ref1=sel.split(" "),selector=2<=_ref1.length?__slice.call(_ref1,0,_k=_ref1.length-1):(_k=0,[]),event=_ref1[_k++];events.push({selector:selector.join(" "),event:event,functionName:functionName})}return events};Delegator.natives=function(){var key,specials,val;specials=function(){var _ref1,_results;_ref1=jQuery.event.special;_results=[];for(key in _ref1){if(!__hasProp.call(_ref1,key))continue;val=_ref1[key];_results.push(key)}return _results}();return"blur focus focusin focusout load resize scroll unload click dblclick\nmousedown mouseup mousemove mouseover mouseout mouseenter mouseleave\nchange select submit keydown keypress keyup error".split(/[^a-z]+/).concat(specials)}();Delegator._isCustomEvent=function(event){event=event.split(".")[0];return $.inArray(event,Delegator.natives)===-1};Range={};Range.sniff=function(r){if(r.commonAncestorContainer!=null){return new Range.BrowserRange(r)}else if(typeof r.start==="string"){return new Range.SerializedRange(r)}else if(r.start&&typeof r.start==="object"){return new Range.NormalizedRange(r)}else{console.error(_t("Could not sniff range type"));return false}};Range.nodeFromXPath=function(xpath,root){var customResolver,evaluateXPath,namespace,node,segment;if(root==null){root=document}evaluateXPath=function(xp,nsResolver){var exception;if(nsResolver==null){nsResolver=null}try{return document.evaluate("."+xp,root,nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(_error){exception=_error;return Util.nodeFromXPath(xp,root)}};if(!$.isXMLDoc(document.documentElement)){return evaluateXPath(xpath)}else{customResolver=document.createNSResolver(document.ownerDocument===null?document.documentElement:document.ownerDocument.documentElement);node=evaluateXPath(xpath,customResolver);if(!node){xpath=function(){var _k,_len2,_ref1,_results;_ref1=xpath.split("/");_results=[];for(_k=0,_len2=_ref1.length;_k<_len2;_k++){segment=_ref1[_k];if(segment&&segment.indexOf(":")===-1){_results.push(segment.replace(/^([a-z]+)/,"xhtml:$1"))}else{_results.push(segment)}}return _results}().join("/");namespace=document.lookupNamespaceURI(null);customResolver=function(ns){if(ns==="xhtml"){return namespace}else{return document.documentElement.getAttribute("xmlns:"+ns)}};node=evaluateXPath(xpath,customResolver)}return node}};Range.RangeError=function(_super){__extends(RangeError,_super);function RangeError(type,message,parent){this.type=type;this.message=message;this.parent=parent!=null?parent:null;RangeError.__super__.constructor.call(this,this.message)}return RangeError}(Error);Range.BrowserRange=function(){function BrowserRange(obj){this.commonAncestorContainer=obj.commonAncestorContainer;this.startContainer=obj.startContainer;this.startOffset=obj.startOffset;this.endContainer=obj.endContainer;this.endOffset=obj.endOffset}BrowserRange.prototype.normalize=function(root){var n,node,nr,r;if(this.tainted){console.error(_t("You may only call normalize() once on a BrowserRange!"));return false}else{this.tainted=true}r={};if(this.startContainer.nodeType===Node.ELEMENT_NODE){r.start=Util.getFirstTextNodeNotBefore(this.startContainer.childNodes[this.startOffset]);r.startOffset=0}else{r.start=this.startContainer;r.startOffset=this.startOffset}if(this.endContainer.nodeType===Node.ELEMENT_NODE){node=this.endContainer.childNodes[this.endOffset];if(node!=null){n=node;while(n!=null&&n.nodeType!==Node.TEXT_NODE){n=n.firstChild}if(n!=null){r.end=n;r.endOffset=0}}if(r.end==null){node=this.endContainer.childNodes[this.endOffset-1];r.end=Util.getLastTextNodeUpTo(node);r.endOffset=r.end.nodeValue.length}}else{r.end=this.endContainer;r.endOffset=this.endOffset}nr={};if(r.startOffset>0){if(r.start.nodeValue.length>r.startOffset){nr.start=r.start.splitText(r.startOffset)}else{nr.start=r.start.nextSibling}}else{nr.start=r.start}if(r.start===r.end){if(nr.start.nodeValue.length>r.endOffset-r.startOffset){nr.start.splitText(r.endOffset-r.startOffset)}nr.end=nr.start}else{if(r.end.nodeValue.length>r.endOffset){r.end.splitText(r.endOffset)}nr.end=r.end}nr.commonAncestor=this.commonAncestorContainer;while(nr.commonAncestor.nodeType!==Node.ELEMENT_NODE){nr.commonAncestor=nr.commonAncestor.parentNode}return new Range.NormalizedRange(nr)};BrowserRange.prototype.serialize=function(root,ignoreSelector){return this.normalize(root).serialize(root,ignoreSelector)};return BrowserRange}();Range.NormalizedRange=function(){function NormalizedRange(obj){this.commonAncestor=obj.commonAncestor;this.start=obj.start;this.end=obj.end}NormalizedRange.prototype.normalize=function(root){return this};NormalizedRange.prototype.limit=function(bounds){var nodes,parent,startParents,_k,_len2,_ref1;nodes=$.grep(this.textNodes(),function(node){return node.parentNode===bounds||$.contains(bounds,node.parentNode)});if(!nodes.length){return null}this.start=nodes[0];this.end=nodes[nodes.length-1];startParents=$(this.start).parents();_ref1=$(this.end).parents();for(_k=0,_len2=_ref1.length;_k<_len2;_k++){parent=_ref1[_k];if(startParents.index(parent)!==-1){this.commonAncestor=parent;break}}return this};NormalizedRange.prototype.serialize=function(root,ignoreSelector){var end,serialization,start;serialization=function(node,isEnd){var n,nodes,offset,origParent,textNodes,xpath,_k,_len2;if(ignoreSelector){origParent=$(node).parents(":not("+ignoreSelector+")").eq(0)}else{origParent=$(node).parent()}xpath=Util.xpathFromNode(origParent,root)[0];textNodes=Util.getTextNodes(origParent);nodes=textNodes.slice(0,textNodes.index(node));offset=0;for(_k=0,_len2=nodes.length;_k<_len2;_k++){n=nodes[_k];offset+=n.nodeValue.length}if(isEnd){return[xpath,offset+node.nodeValue.length]}else{return[xpath,offset]}};start=serialization(this.start);end=serialization(this.end,true);return new Range.SerializedRange({start:start[0],end:end[0],startOffset:start[1],endOffset:end[1]})};NormalizedRange.prototype.text=function(){var node;return function(){var _k,_len2,_ref1,_results;_ref1=this.textNodes();_results=[];for(_k=0,_len2=_ref1.length;_k<_len2;_k++){node=_ref1[_k];_results.push(node.nodeValue)}return _results}.call(this).join("")};NormalizedRange.prototype.textNodes=function(){var end,start,textNodes,_ref1;textNodes=Util.getTextNodes($(this.commonAncestor));_ref1=[textNodes.index(this.start),textNodes.index(this.end)],start=_ref1[0],end=_ref1[1];return $.makeArray(textNodes.slice(start,+end+1||9e9))};NormalizedRange.prototype.toRange=function(){var range;range=document.createRange();range.setStartBefore(this.start);range.setEndAfter(this.end);return range};return NormalizedRange}();Range.SerializedRange=function(){function SerializedRange(obj){this.start=obj.start;this.startOffset=obj.startOffset;this.end=obj.end;this.endOffset=obj.endOffset}SerializedRange.prototype.normalize=function(root){var contains,e,length,node,p,range,targetOffset,tn,_k,_l,_len2,_len3,_ref1,_ref2;range={};_ref1=["start","end"];for(_k=0,_len2=_ref1.length;_k<_len2;_k++){p=_ref1[_k];try{node=Range.nodeFromXPath(this[p],root)}catch(_error){e=_error;throw new Range.RangeError(p,"Error while finding "+p+" node: "+this[p]+": "+e,e)}if(!node){throw new Range.RangeError(p,"Couldn't find "+p+" node: "+this[p])}length=0;targetOffset=this[p+"Offset"];if(p==="end"){targetOffset--}_ref2=Util.getTextNodes($(node));for(_l=0,_len3=_ref2.length;_l<_len3;_l++){tn=_ref2[_l];if(length+tn.nodeValue.length>targetOffset){range[p+"Container"]=tn;range[p+"Offset"]=this[p+"Offset"]-length;break}else{length+=tn.nodeValue.length}}if(range[p+"Offset"]==null){throw new Range.RangeError(""+p+"offset","Couldn't find offset "+this[p+"Offset"]+" in element "+this[p])}}contains=document.compareDocumentPosition==null?function(a,b){return a.contains(b)}:function(a,b){return a.compareDocumentPosition(b)&16};$(range.startContainer).parents().each(function(){if(contains(this,range.endContainer)){range.commonAncestorContainer=this;return false}});return new Range.BrowserRange(range).normalize(root)};SerializedRange.prototype.serialize=function(root,ignoreSelector){return this.normalize(root).serialize(root,ignoreSelector)};SerializedRange.prototype.toObject=function(){return{start:this.start,startOffset:this.startOffset,end:this.end,endOffset:this.endOffset}};return SerializedRange}();_Annotator=this.Annotator;Annotator=function(_super){__extends(Annotator,_super);Annotator.prototype.events={".js-ann-adder .js-ann-save-highlight click":"onHighlightClick",".js-ann-adder .js-ann-add click":"onAdderClick",".js-ann-adder .js-ann-add mousedown":"onAdderMousedown",".annotator-hl click":"onHighlightMouseover",".annotator-hl mouseout":"startViewerHideTimer",".js-ann-adder .js-ann-twitter click":"onTwitterClick",".js-ann-adder .js-ann-email click":"onEmailClick"};Annotator.prototype.html={adder:$("#ann-adder").html(),wrapper:'<div class="annotator-wrapper"></div>'};Annotator.prototype.options={readOnly:false};Annotator.prototype.plugins={};Annotator.prototype.editor=null;Annotator.prototype.viewer=null;Annotator.prototype.selectedRanges=null;Annotator.prototype.mouseIsDown=false;Annotator.prototype.ignoreMouseup=false;Annotator.prototype.viewerHideTimer=null;function Annotator(element,options){this.onDeleteAnnotation=__bind(this.onDeleteAnnotation,this);this.onEditAnnotation=__bind(this.onEditAnnotation,this);this.onHighlightClick=__bind(this.onHighlightClick,this);this.onAdderClick=__bind(this.onAdderClick,this);this.onAdderMousedown=__bind(this.onAdderMousedown,this);this.onHighlightMouseover=__bind(this.onHighlightMouseover,this);this.checkForEndSelection=__bind(this.checkForEndSelection,this);this.checkForStartSelection=__bind(this.checkForStartSelection,this);this.clearViewerHideTimer=__bind(this.clearViewerHideTimer,this);this.startViewerHideTimer=__bind(this.startViewerHideTimer,this);this.showViewer=__bind(this.showViewer,this);this.onEditorSubmit=__bind(this.onEditorSubmit,this);this.onEditorHide=__bind(this.onEditorHide,this);this.showEditor=__bind(this.showEditor,this);this.onTwitterClick=__bind(this.onTwitterClick,this);this.onEmailClick=__bind(this.onEmailClick,this);Annotator.__super__.constructor.apply(this,arguments);this.plugins={};if(!Annotator.supported()){return this}if(!this.options.readOnly){this._setupDocumentEvents()}this._setupWrapper()._setupViewer()._setupEditor();this._setupDynamicStyle();this.adder=$(this.html.adder).appendTo(this.wrapper).hide();Annotator._instances.push(this)}Annotator.prototype._setupWrapper=function(){this.wrapper=$(this.html.wrapper);this.element.find("script:not([type='text/x-handlebars-template'])").remove();this.element.wrapInner(this.wrapper);this.wrapper=this.element.find(".annotator-wrapper");return this};Annotator.prototype._setupViewer=function(){var _this=this;this.viewer=new Annotator.Viewer({readOnly:this.options.readOnly});this.viewer.hide().on("edit",this.onEditAnnotation).on("delete",this.onDeleteAnnotation).addField({load:function(field,annotation){if(annotation.text){$(field).html(Util.escape(annotation.text))}else{$(field).html("<i>"+_t("No Comment")+"</i>")}return _this.publish("annotationViewerTextField",[field,annotation])}}).element.appendTo(this.wrapper).bind({mouseover:this.clearViewerHideTimer,mouseout:this.startViewerHideTimer});window.annViewer=this.viewer;return this};Annotator.prototype._setupEditor=function(){this.editor=new Annotator.Editor;this.editor.hide().on("hide",this.onEditorHide).on("save",this.onEditorSubmit).addField({type:"textarea",label:_t("Comments")+"â€¦",load:function(field,annotation){return $(field).find("textarea").val(annotation.text||"")},submit:function(field,annotation){return annotation.text=$(field).find("textarea").val()}});this.editor.element.appendTo(this.wrapper);window.annEditor=this.editor;return this};Annotator.prototype._setupDocumentEvents=function(){$(document).bind({mouseup:this.checkForEndSelection,mousedown:this.checkForStartSelection});return this};Annotator.prototype._setupDynamicStyle=function(){var max,sel,style,x;style=$("#annotator-dynamic-style");if(!style.length){style=$('<style id="annotator-dynamic-style"></style>').appendTo(document.head)}sel="*"+function(){var _k,_len2,_ref1,_results;_ref1=["adder","outer","notice","filter"];_results=[];for(_k=0,_len2=_ref1.length;_k<_len2;_k++){x=_ref1[_k];_results.push(":not(.annotator-"+x+")")}return _results}().join("");max=Util.maxZIndex($(document.body).find(sel));max=Math.max(max,1e3);style.text([".annotator-adder, .annotator-outer, .annotator-notice {","  z-index: "+(max+20)+";","}",".annotator-filter {","  z-index: "+(max+10)+";","}"].join("\n"));return this};Annotator.prototype.destroy=function(){var idx,name,plugin,_base,_ref1;Annotator.__super__.destroy.apply(this,arguments);$(document).unbind({mouseup:this.checkForEndSelection,mousedown:this.checkForStartSelection});$("#annotator-dynamic-style").remove();this.adder.remove();this.viewer.destroy();this.editor.destroy();this.wrapper.find(".annotator-hl").each(function(){$(this).contents().insertBefore(this);return $(this).remove()});this.wrapper.contents().insertBefore(this.wrapper);this.wrapper.remove();this.element.data("annotator",null);_ref1=this.plugins;for(name in _ref1){plugin=_ref1[name];if(typeof(_base=this.plugins[name]).destroy==="function"){_base.destroy()}}idx=Annotator._instances.indexOf(this);if(idx!==-1){return Annotator._instances.splice(idx,1)}};Annotator.prototype.getSelectedRanges=function(){var browserRange,i,normedRange,r,ranges,rangesToIgnore,selection,_k,_len2;selection=Util.getGlobal().getSelection();ranges=[];rangesToIgnore=[];if(!selection.isCollapsed){ranges=function(){var _k,_ref1,_results;_results=[];for(i=_k=0,_ref1=selection.rangeCount;0<=_ref1?_k<_ref1:_k>_ref1;i=0<=_ref1?++_k:--_k){r=selection.getRangeAt(i);browserRange=new Range.BrowserRange(r);normedRange=browserRange.normalize().limit(this.wrapper[0]);if(normedRange===null){rangesToIgnore.push(r)}_results.push(normedRange)}return _results}.call(this);selection.removeAllRanges()}for(_k=0,_len2=rangesToIgnore.length;_k<_len2;_k++){r=rangesToIgnore[_k];selection.addRange(r)}return $.grep(ranges,function(range){if(range){selection.addRange(range.toRange())}return range})};Annotator.prototype.createAnnotation=function(){var annotation;annotation={};this.publish("beforeAnnotationCreated",[annotation]);return annotation};Annotator.prototype.setupAnnotation=function(annotation){var e,normed,normedRanges,r,root,_k,_l,_len2,_len3,_ref1;root=this.wrapper[0];annotation.ranges||(annotation.ranges=this.selectedRanges);normedRanges=[];_ref1=annotation.ranges;for(_k=0,_len2=_ref1.length;_k<_len2;_k++){r=_ref1[_k];try{normedRanges.push(Range.sniff(r).normalize(root))}catch(_error){e=_error;if(e instanceof Range.RangeError){this.publish("rangeNormalizeFail",[annotation,r,e])}else{throw e}}}annotation.quote=[];annotation.ranges=[];annotation.highlights=[];for(_l=0,_len3=normedRanges.length;_l<_len3;_l++){normed=normedRanges[_l];annotation.quote.push($.trim(normed.text()));annotation.ranges.push(normed.serialize(this.wrapper[0],".annotator-hl"));$.merge(annotation.highlights,this.highlightRange(normed))}annotation.quote=annotation.quote.join(" / ");$(annotation.highlights).data("annotation",annotation);$(annotation.highlights).attr("data-annotation-id",annotation.id);this.addIcon(annotation);this.filterAnnotation($(annotation.highlights),annotation);return annotation};Annotator.prototype.filterAnnotation=function($elem,annotation){if(!annotation.id){return}var articleId=$elem.parents(".s-article").data("id"),ls=JSON.parse(window.localStorage.getItem("icg")),hl=ls.highlights[articleId],_this=this;if(!$(hl).filter(function(i,n){return n.id===annotation.id}).length){var child,h,_k,_len2,_ref1;if(annotation.highlights!=null){_ref1=annotation.highlights;_this.addIcon(annotation,"remove");for(_k=0,_len2=_ref1.length;_k<_len2;_k++){h=_ref1[_k];if(!(h.parentNode!=null)){continue}child=h.childNodes[0];$(h).replaceWith(h.childNodes)}}}};Annotator.prototype.updateAnnotation=function(annotation){this.publish("beforeAnnotationUpdated",[annotation]);$(annotation.highlights).attr("data-annotation-id",annotation.id);this.publish("annotationUpdated",[annotation]);return annotation};Annotator.prototype.deleteAnnotation=function(annotation){var child,h,_k,_len2,_ref1;if(annotation.highlights!=null){this.addIcon(annotation,"remove");_ref1=annotation.highlights;for(_k=0,_len2=_ref1.length;_k<_len2;_k++){h=_ref1[_k];if(!(h.parentNode!=null)){continue}child=h.childNodes[0];$(h).replaceWith(h.childNodes)}}this.publish("annotationDeleted",[annotation]);return annotation};Annotator.prototype.loadAnnotations=function(annotations){var clone,loader,_this=this;if(annotations==null){annotations=[]}loader=function(annList){var n,now,_k,_len2;if(annList==null){annList=[]}now=annList.splice(0,10);for(_k=0,_len2=now.length;_k<_len2;_k++){n=now[_k];_this.setupAnnotation(n)}if(annList.length>0){return setTimeout(function(){return loader(annList)},10)}else{return _this.publish("annotationsLoaded",[clone])}};clone=annotations.slice();loader(annotations);return this};Annotator.prototype.dumpAnnotations=function(){if(this.plugins["Store"]){return this.plugins["Store"].dumpAnnotations()}else{console.warn(_t("Can't dump annotations without Store plugin."));return false}};Annotator.prototype.highlightRange=function(normedRange,cssClass){var hl,node,white,_k,_len2,_ref1,_results;if(cssClass==null){cssClass="annotator-hl"}white=/^\s*$/;hl=$("<span class='"+cssClass+"'></span>");_ref1=normedRange.textNodes();_results=[];for(_k=0,_len2=_ref1.length;_k<_len2;_k++){node=_ref1[_k];if(!white.test(node.nodeValue)){_results.push($(node).wrapAll(hl).parent().show()[0])}}return _results};Annotator.prototype.highlightRanges=function(normedRanges,cssClass){var highlights,r,_k,_len2;if(cssClass==null){cssClass="annotator-hl"}highlights=[];for(_k=0,_len2=normedRanges.length;_k<_len2;_k++){r=normedRanges[_k];$.merge(highlights,this.highlightRange(r,cssClass))}return highlights};Annotator.prototype.addPlugin=function(name,options){var klass,_base;if(this.plugins[name]){console.error(_t("You cannot have more than one instance of any plugin."))}else{klass=Annotator.Plugin[name];if(typeof klass==="function"){this.plugins[name]=new klass(this.element[0],options);this.plugins[name].annotator=this;if(typeof(_base=this.plugins[name]).pluginInit==="function"){_base.pluginInit()}}else{console.error(_t("Could not load ")+name+_t(" plugin. Have you included the appropriate <script> tag?"))}}return this};Annotator.prototype.showEditor=function(annotation,location){this.editor.element.css(location);this.editor.load(annotation);this.publish("annotationEditorShown",[this.editor,annotation]);return this};Annotator.prototype.onEditorHide=function(){this.publish("annotationEditorHidden",[this.editor]);return this.ignoreMouseup=false};Annotator.prototype.onEditorSubmit=function(annotation){return this.publish("annotationEditorSubmit",[this.editor,annotation])};Annotator.prototype.showViewer=function(annotations,location){this.viewer.element.css(location);this.viewer.load(annotations);return this.publish("annotationViewerShown",[this.viewer,annotations])};Annotator.prototype.startViewerHideTimer=function(){if(!this.viewerHideTimer){return this.viewerHideTimer=setTimeout(this.viewer.hide,250)}};Annotator.prototype.clearViewerHideTimer=function(){clearTimeout(this.viewerHideTimer);return this.viewerHideTimer=false};Annotator.prototype.checkForStartSelection=function(event){if(!(event&&this.isAnnotator(event.target))){this.startViewerHideTimer()}return this.mouseIsDown=true};Annotator.prototype.checkForEndSelection=function(event){var container,range,_k,_len2,_ref1;this.mouseIsDown=false;if(this.ignoreMouseup){return}this.selectedRanges=this.getSelectedRanges();_ref1=this.selectedRanges;for(_k=0,_len2=_ref1.length;_k<_len2;_k++){range=_ref1[_k];container=range.commonAncestor;if(this.isAnnotator(container)){return}}if(event&&this.selectedRanges.length){return this.adder.css(Util.mousePosition(event,this.wrapper[0])).show();_this.publish("annotationEndHightlight")}else{return this.adder.hide()}};Annotator.prototype.isAnnotator=function(element){return!!$(element).parents().addBack().filter("[class^=annotator-]").not("[class=annotator-hl]").not(this.wrapper).length};Annotator.prototype.onHighlightMouseover=function(event){var annotations;this.clearViewerHideTimer();if(this.mouseIsDown){return false}if(this.viewer.isShown()){this.viewer.hide()}annotations=$(event.target).parents(".annotator-hl").addBack().map(function(){return $(this).data("annotation")}).toArray();return this.showViewer(annotations,Util.mousePosition(event,this.wrapper[0]))};Annotator.prototype.onAdderMousedown=function(event){if(event!=null){event.preventDefault()}return this.ignoreMouseup=true};Annotator.prototype.onTwitterClick=function(event){if(event!=null){event.preventDefault()}var selectionObject=Util.getGlobal().getSelection(),twitterHref="https://twitter.com/intent/tweet?via=crisisgroup&",windowOptions="scrollbars=yes,resizable=yes,toolbar=no,location=yes",href="url="+selectionObject.anchorNode.baseURI+"&",text="text="+selectionObject.toString(),width=550,height=420,winHeight=screen.height,winWidth=screen.width,_this=this;var left=Math.round(winWidth/2-width/2);var top=0;if(winHeight>height){top=Math.round(winHeight/2-height/2)}_this.adder.hide();window.open(twitterHref+href+text,"twitterIntent",windowOptions+",width="+width+",height="+height+",left="+left+",top="+top);event.blur()};Annotator.prototype.onEmailClick=function(event){if(event!=null){event.preventDefault()}var selectionObject=Util.getGlobal().getSelection(),_html=document.querySelector("html"),_url=selectionObject.anchorNode.baseURI,_article=$('.s-article[data-url="'+_url+'"]');_subject=$.trim($(".c-page-hero__title",_article).text()),_this=this,_body=encodeURI('"'+selectionObject.toString()+'"'+"\n\n("+_url+")");_this.adder.hide();_html.className+=" no-fade";document.location.href="mailto:?subject="+_subject+"&body="+_body};Annotator.prototype.onHighlightClick=function(event){var annotation,cancel,cleanup,position,save,_this=this;if(event!=null){event.preventDefault()}this.adder.hide();annotation=this.setupAnnotation(this.createAnnotation());$(annotation.highlights).addClass("annotator-hl-temporary");save=function(){cleanup();$(annotation.highlights).removeClass("annotator-hl-temporary");return _this.publish("annotationCreated",[annotation])};cancel=function(){cleanup();return _this.deleteAnnotation(annotation)};cleanup=function(){_this.unsubscribe("annotationEditorHidden",cancel);return _this.unsubscribe("annotationEditorSubmit",save)};this.subscribe("annotationEditorHidden",cancel);this.subscribe("annotationEditorSubmit",save);this.editor.load(annotation);return this.editor.submit(event)};Annotator.prototype.onAdderClick=function(event){var annotation,cancel,cleanup,position,save,_this=this;if(event!=null){event.preventDefault()}position=this.adder.position();this.adder.hide();annotation=this.setupAnnotation(this.createAnnotation());$(annotation.highlights).addClass("annotator-hl-temporary");save=function(){cleanup();$(annotation.highlights).removeClass("annotator-hl-temporary");_this.addIcon(annotation);return _this.publish("annotationCreated",[annotation])};cancel=function(){cleanup();return _this.deleteAnnotation(annotation)};cleanup=function(){_this.unsubscribe("annotationEditorHidden",cancel);return _this.unsubscribe("annotationEditorSubmit",save)};this.subscribe("annotationEditorHidden",cancel);this.subscribe("annotationEditorSubmit",save);return this.showEditor(annotation,position)};Annotator.prototype.onEditAnnotation=function(annotation){var cleanup,offset,update,_this=this;offset=this.viewer.element.position();update=function(){cleanup();_this.addIcon(annotation);return _this.updateAnnotation(annotation)};cleanup=function(){_this.unsubscribe("annotationEditorHidden",cleanup);return _this.unsubscribe("annotationEditorSubmit",update)};this.subscribe("annotationEditorHidden",cleanup);this.subscribe("annotationEditorSubmit",update);this.viewer.hide();return this.showEditor(annotation,offset)};Annotator.prototype.onDeleteAnnotation=function(annotation){this.viewer.hide();this.addIcon(annotation,"remove");return this.deleteAnnotation(annotation)};Annotator.prototype.addIcon=function(annotation,option){var icon='<span class="o-icon has-ann-comment"><svg><use xlink:href="#annotate"></use></svg></span>';if(option=="remove"||annotation.hasOwnProperty("text")&&!annotation.text.length){return $(annotation.highlights).last().next(".has-ann-comment").remove()}return annotation.hasOwnProperty("text")&&annotation.text.length&&!$(annotation.highlights).last().next(".has-ann-comment").length&&$(icon).insertAfter($(annotation.highlights).last())};this.deleteAnn=function(annotation){this.viewer.hide();return this.deleteAnnotation(annotation)};return Annotator}(Delegator);Annotator.Plugin=function(_super){__extends(Plugin,_super);function Plugin(element,options){Plugin.__super__.constructor.apply(this,arguments)}Plugin.prototype.pluginInit=function(){};return Plugin}(Delegator);g=Util.getGlobal();if(((_ref1=g.document)!=null?_ref1.evaluate:void 0)==null){$.getScript("http://assets.annotateit.org/vendor/xpath.min.js")}if(g.getSelection==null){$.getScript("http://assets.annotateit.org/vendor/ierange.min.js")}if(g.JSON==null){$.getScript("http://assets.annotateit.org/vendor/json2.min.js")}if(g.Node==null){g.Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}Annotator.$=$;Annotator.Delegator=Delegator;Annotator.Range=Range;Annotator.Util=Util;Annotator._instances=[];Annotator._t=_t;Annotator.supported=function(){return function(){return!!this.getSelection}()};Annotator.noConflict=function(){Util.getGlobal().Annotator=_Annotator;return this};$.fn.annotator=function(options){var args;args=Array.prototype.slice.call(arguments,1);return this.each(function(){var instance;instance=$.data(this,"annotator");if(options==="destroy"){$.removeData(this,"annotator");return instance!=null?instance.destroy(args):void 0}else if(instance){return options&&instance[options].apply(instance,args)}else{instance=new Annotator(this,options);window.ann=instance;return $.data(this,"annotator",instance)}})};this.Annotator=Annotator;Annotator.Widget=function(_super){__extends(Widget,_super);Widget.prototype.classes={hide:"annotator-hide",invert:{x:"annotator-invert-x",y:"annotator-invert-y"}};function Widget(element,options){Widget.__super__.constructor.apply(this,arguments);this.classes=$.extend({},Annotator.Widget.prototype.classes,this.classes)}Widget.prototype.destroy=function(){this.removeEvents();return this.element.remove()};Widget.prototype.checkOrientation=function(){var current,offset,viewport,widget,window;this.resetOrientation();window=$(Annotator.Util.getGlobal());widget=this.element.children(":first");offset=widget.offset();viewport={top:window.scrollTop(),right:window.width()+window.scrollLeft()};current={top:offset.top,right:offset.left+widget.width()};if(current.top-viewport.top<0){this.invertY()}if(current.right-viewport.right>0){this.invertX()}return this};Widget.prototype.resetOrientation=function(){this.element.removeClass(this.classes.invert.x).removeClass(this.classes.invert.y);return this};Widget.prototype.invertX=function(){this.element.addClass(this.classes.invert.x);return this};Widget.prototype.invertY=function(){this.element.addClass(this.classes.invert.y);return this};Widget.prototype.isInvertedY=function(){return this.element.hasClass(this.classes.invert.y)};Widget.prototype.isInvertedX=function(){return this.element.hasClass(this.classes.invert.x)};return Widget}(Delegator);Annotator.Editor=function(_super){__extends(Editor,_super);Editor.prototype.events={"form submit":"submit",".js-editor-save click":"submit",".js-editor-cancel click":"hide",".js-editor-email click":"email",".js-editor-delete click":"delete",".js-editor-cancel mouseover":"onCancelButtonMouseover","textarea keydown":"processKeypress"};Editor.prototype.classes={hide:"annotator-hide",focus:"annotator-focus"};Editor.prototype.html=$("#ann-editor").html();Editor.prototype.options={};function Editor(options){this.onCancelButtonMouseover=__bind(this.onCancelButtonMouseover,this);this.email=__bind(this.email,this);this.processKeypress=__bind(this.processKeypress,this);this.submit=__bind(this.submit,this);this.load=__bind(this.load,this);this.hide=__bind(this.hide,this);this.show=__bind(this.show,this);this.delete=__bind(this.delete,this);Editor.__super__.constructor.call(this,$(this.html)[0],options);this.fields=[];this.annotation={}}Editor.prototype.show=function(event){Annotator.Util.preventEventDefault(event);this.element.removeClass(this.classes.hide);this.element.find(".annotator-save").addClass(this.classes.focus);this.checkOrientation();this.element.find(":input:first").focus();this.setupDraggables();return this.publish("show")};Editor.prototype.hide=function(event){Annotator.Util.preventEventDefault(event);if(typeof this==="object"){this.element.addClass(this.classes.hide);return this.publish("hide")}else{document.querySelector(".js-ann-editor").classList.add("annotator-hide")}};Editor.prototype.load=function(annotation){var field,_k,_len2,_ref2;this.annotation=annotation;this.publish("load",[this.annotation]);_ref2=this.fields;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){field=_ref2[_k];field.load(field.element,this.annotation)}return this.show()};Editor.prototype.submit=function(event){var field,_k,_len2,_ref2,_element=this.element[0];Annotator.Util.preventEventDefault(event);_ref2=this.fields;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){field=_ref2[_k];field.submit(field.element,this.annotation)}_element.querySelector(".js-editor-save").innerHTML="Saved";setTimeout(function(){_element.querySelector(".js-editor-save").innerHTML="Save"},1e3);this.publish("save",[this.annotation]);return this.hide()};Editor.prototype.stickySubmit=function(event){var field,_k,_len2,_ref2,_element=this.element[0];Annotator.Util.preventEventDefault(event);_ref2=this.fields;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){field=_ref2[_k];field.submit(field.element,this.annotation)}_element.querySelector(".js-editor-save").innerHTML="Saved";setTimeout(function(){_element.querySelector(".js-editor-save").innerHTML="Save"},1e3);this.publish("save",[this.annotation]);return this};Editor.prototype.delete=function(event){event.preventDefault();window.annEditor.hide();window.ann.deleteAnnotation(this.annotation);return this.publish("delete",[this.annotation])};Editor.prototype.addField=function(options){var element,field,input;field=$.extend({id:"annotator-field-"+Annotator.Util.uuid(),type:"input",label:"",load:function(){},submit:function(){}},options);input=null;element=$('<li class="annotator-item" />');field.element=element[0];switch(field.type){case"textarea":input=$("<textarea />");break;case"input":case"checkbox":input=$("<input />");break;case"select":input=$("<select />")}element.append(input);input.attr({id:field.id,placeholder:field.label});if(field.type==="checkbox"){input[0].type="checkbox";element.addClass("annotator-checkbox");element.append($("<label />",{for:field.id,html:field.label}))}this.element.find("form ul:first").append(element);this.fields.push(field);return field.element};Editor.prototype.checkOrientation=function(){var controls,list;Editor.__super__.checkOrientation.apply(this,arguments);list=this.element.find("form ul");controls=this.element.find(".js-ann-controls");if(this.element.hasClass(this.classes.invert.y)){controls.insertBefore(list)}else if(controls.is(":first-child")){controls.insertAfter(list)}return this};Editor.prototype.email=function(event){if(event!=null){event.preventDefault()}var _html=document.querySelector("html"),_article=$(this.annotation.highlights).parents(".s-article"),_url=_article.data("url"),_subject=$.trim($(".c-page-hero__title",_article).text()),_element=this.element[0],_this=this,_body=encodeURI('"'+this.annotation.quote+'"'+"\n\n"+this.element[0].querySelector("textarea").value+"\n\n("+_url+")");_element.querySelector(".js-tooltip").classList.remove("is-show");_html.className+=" no-fade";document.location.href="mailto:?subject="+_subject+"&body="+_body;this.publish("save",[this.annotation]);this.stickySubmit()};Editor.prototype.processKeypress=function(event){if(event.keyCode===27){return this.hide()}else if(event.keyCode===13&&!event.shiftKey){return this.submit()}};Editor.prototype.onCancelButtonMouseover=function(){return this.element.find("."+this.classes.focus).removeClass(this.classes.focus)};Editor.prototype.setupDraggables=function(){var classes,controls,cornerItem,editor,mousedown,onMousedown,onMousemove,onMouseup,resize,textarea,throttle,_this=this;this.element.find(".annotator-resize").remove();if(this.element.hasClass(this.classes.invert.y)){cornerItem=this.element.find(".annotator-item:last")}else{cornerItem=this.element.find(".annotator-item:first")}if(cornerItem){$('<span class="annotator-resize"></span>').appendTo(cornerItem)}mousedown=null;classes=this.classes;editor=this.element;textarea=null;resize=editor.find(".annotator-resize");controls=editor.find(".js-ann-controls");throttle=false;onMousedown=function(event){if(event.target===this){mousedown={element:this,top:event.pageY,left:event.pageX};textarea=editor.find("textarea:first");$(window).bind({"mouseup.annotator-editor-resize":onMouseup,"mousemove.annotator-editor-resize":onMousemove});return event.preventDefault()}};onMouseup=function(){mousedown=null;return $(window).unbind(".annotator-editor-resize")};onMousemove=function(event){var diff,directionX,directionY,height,width;if(mousedown&&throttle===false){diff={top:event.pageY-mousedown.top,left:event.pageX-mousedown.left};if(mousedown.element===resize[0]){height=textarea.outerHeight();width=textarea.outerWidth();directionX=editor.hasClass(classes.invert.x)?-1:1;directionY=editor.hasClass(classes.invert.y)?1:-1;textarea.height(height+diff.top*directionY);textarea.width(width+diff.left*directionX);if(textarea.outerHeight()!==height){mousedown.top=event.pageY}if(textarea.outerWidth()!==width){mousedown.left=event.pageX}}else if(mousedown.element===controls[0]){editor.css({top:parseInt(editor.css("top"),10)+diff.top,left:parseInt(editor.css("left"),10)+diff.left});mousedown.top=event.pageY;mousedown.left=event.pageX}throttle=true;return setTimeout(function(){return throttle=false},1e3/60)}};resize.bind("mousedown",onMousedown);return controls.bind("mousedown",onMousedown)};return Editor}(Annotator.Widget);Annotator.Viewer=function(_super){__extends(Viewer,_super);Viewer.prototype.events={".js-ann-edit click":"onEditClick",".js-ann-delete click":"onDeleteClick"};Viewer.prototype.classes={hide:"annotator-hide",showControls:"annotator-visible"};Viewer.prototype.html={element:$("#ann-viewer").html(),item:$("#ann-viewer-item").html()};Viewer.prototype.options={readOnly:false};function Viewer(options){this.onDeleteClick=__bind(this.onDeleteClick,this);this.onEditClick=__bind(this.onEditClick,this);this.load=__bind(this.load,this);this.hide=__bind(this.hide,this);this.show=__bind(this.show,this);Viewer.__super__.constructor.call(this,$(this.html.element)[0],options);this.item=$(this.html.item)[0];this.fields=[];this.annotations=[]}Viewer.prototype.show=function(event){var controls,_this=this;Annotator.Util.preventEventDefault(event);controls=this.element.find(".annotator-controls").addClass(this.classes.showControls);setTimeout(function(){return controls.removeClass(_this.classes.showControls)},500);this.element.removeClass(this.classes.hide);return this.checkOrientation().publish("show")};Viewer.prototype.isShown=function(){return!this.element.hasClass(this.classes.hide)};Viewer.prototype.hide=function(event){Annotator.Util.preventEventDefault(event);this.element.addClass(this.classes.hide);return this.publish("hide")};Viewer.prototype.load=function(annotations){var annotation,controller,controls,del,edit,element,field,item,link,links,list,_k,_l,_len2,_len3,_ref2,_ref3;this.annotations=annotations||[];list=this.element.empty();_ref2=this.annotations;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){annotation=_ref2[_k];item=$(this.item).clone().appendTo(list).data("annotation",annotation);controls=item.find(".annotator-controls");link=controls.find(".annotator-link");edit=controls.find(".annotator-edit");del=controls.find(".annotator-delete");links=new LinkParser(annotation.links||[]).get("alternate",{type:"text/html"});if(links.length===0||links[0].href==null){link.remove()}else{link.attr("href",links[0].href)}if(this.options.readOnly){edit.remove();del.remove()}else{controller={showEdit:function(){return edit.removeAttr("disabled")},hideEdit:function(){return edit.attr("disabled","disabled")},showDelete:function(){return del.removeAttr("disabled")},hideDelete:function(){return del.attr("disabled","disabled")}}}_ref3=this.fields;for(_l=0,_len3=_ref3.length;_l<_len3;_l++){field=_ref3[_l];field.load(element,annotation,controller)}}this.publish("load",[this.annotations]);return this.show()};Viewer.prototype.addField=function(options){var field;field=$.extend({load:function(){}},options);field.element=$("<div />")[0];this.fields.push(field);field.element;return this};Viewer.prototype.onEditClick=function(event){return this.onButtonClick(event,"edit")};Viewer.prototype.onDeleteClick=function(event){window.annEditor.hide();return this.onButtonClick(event,"delete")};Viewer.prototype.onButtonClick=function(event,type){var item;item=$(event.target).parents(".js-ann-viewer-item");return this.publish(type,[item.data("annotation")])};return Viewer}(Annotator.Widget);LinkParser=function(){function LinkParser(data){this.data=data}LinkParser.prototype.get=function(rel,cond){var d,k,keys,match,v,_k,_len2,_ref2,_results;if(cond==null){cond={}}cond=$.extend({},cond,{rel:rel});keys=function(){var _results;_results=[];for(k in cond){if(!__hasProp.call(cond,k))continue;v=cond[k];_results.push(k)}return _results}();_ref2=this.data;_results=[];for(_k=0,_len2=_ref2.length;_k<_len2;_k++){d=_ref2[_k];match=keys.reduce(function(m,k){return m&&d[k]===cond[k]},true);if(match){_results.push(d)}else{continue}}return _results};return LinkParser}();Annotator=Annotator||{};Annotator.Notification=function(_super){__extends(Notification,_super);Notification.prototype.events={click:"hide"};Notification.prototype.options={html:"<div class='annotator-notice'></div>",classes:{show:"annotator-notice-show",info:"annotator-notice-info",success:"annotator-notice-success",error:"annotator-notice-error"}};function Notification(options){this.hide=__bind(this.hide,this);this.show=__bind(this.show,this);Notification.__super__.constructor.call(this,$(this.options.html).appendTo(document.body)[0],options)}Notification.prototype.show=function(message,status){if(status==null){status=Annotator.Notification.INFO}this.currentStatus=status;$(this.element).addClass(this.options.classes.show).addClass(this.options.classes[this.currentStatus]).html(Util.escape(message||""));setTimeout(this.hide,5e3);return this};Notification.prototype.hide=function(){if(this.currentStatus==null){this.currentStatus=Annotator.Notification.INFO}$(this.element).removeClass(this.options.classes.show).removeClass(this.options.classes[this.currentStatus]);return this};return Notification}(Delegator);Annotator.Notification.INFO="info";Annotator.Notification.SUCCESS="success";Annotator.Notification.ERROR="error";$(function(){var notification;notification=new Annotator.Notification;Annotator.showNotification=notification.show;return Annotator.hideNotification=notification.hide});Annotator.Plugin.Unsupported=function(_super){__extends(Unsupported,_super);function Unsupported(){_ref2=Unsupported.__super__.constructor.apply(this,arguments);return _ref2}Unsupported.prototype.options={message:Annotator._t("Sorry your current browser does not support the Annotator")};Unsupported.prototype.pluginInit=function(){var _this=this;if(!Annotator.supported()){return $(function(){Annotator.showNotification(_this.options.message);if(window.XMLHttpRequest===void 0&&ActiveXObject!==void 0){return $("html").addClass("ie6")}})}};return Unsupported}(Annotator.Plugin);createDateFromISO8601=function(string){var d,date,offset,regexp,time,_ref3;regexp="([0-9]{4})(-([0-9]{2})(-([0-9]{2})"+"(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?"+"(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";d=string.match(new RegExp(regexp));offset=0;date=new Date(d[1],0,1);if(d[3]){date.setMonth(d[3]-1)}if(d[5]){date.setDate(d[5])}if(d[7]){date.setHours(d[7])}if(d[8]){date.setMinutes(d[8])}if(d[10]){date.setSeconds(d[10])}if(d[12]){date.setMilliseconds(Number("0."+d[12])*1e3)}if(d[14]){offset=Number(d[16])*60+Number(d[17]);offset*=(_ref3=d[15]==="-")!=null?_ref3:{1:-1}}offset-=date.getTimezoneOffset();time=Number(date)+offset*60*1e3;date.setTime(Number(time));return date};base64Decode=function(data){var ac,b64,bits,dec,h1,h2,h3,h4,i,o1,o2,o3,tmp_arr;if(typeof atob!=="undefined"&&atob!==null){return atob(data)}else{b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i=0;ac=0;dec="";tmp_arr=[];if(!data){return data}data+="";while(i<data.length){h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&255;o2=bits>>8&255;o3=bits&255;if(h3===64){tmp_arr[ac++]=String.fromCharCode(o1)}else if(h4===64){tmp_arr[ac++]=String.fromCharCode(o1,o2)}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3)}}return tmp_arr.join("")}};base64UrlDecode=function(data){var i,m,_k,_ref3;m=data.length%4;if(m!==0){for(i=_k=0,_ref3=4-m;0<=_ref3?_k<_ref3:_k>_ref3;i=0<=_ref3?++_k:--_k){data+="="}}data=data.replace(/-/g,"+");data=data.replace(/_/g,"/");return base64Decode(data)};parseToken=function(token){var head,payload,sig,_ref3;_ref3=token.split("."),head=_ref3[0],payload=_ref3[1],sig=_ref3[2];return JSON.parse(base64UrlDecode(payload))};Annotator.Plugin.Auth=function(_super){__extends(Auth,_super);Auth.prototype.options={token:null,tokenUrl:"/auth/token",autoFetch:true};function Auth(element,options){Auth.__super__.constructor.apply(this,arguments);this.waitingForToken=[];if(this.options.token){this.setToken(this.options.token)}else{this.requestToken()}}Auth.prototype.requestToken=function(){var _this=this;this.requestInProgress=true;return $.ajax({url:this.options.tokenUrl,dataType:"text",xhrFields:{withCredentials:true}}).done(function(data,status,xhr){return _this.setToken(data)}).fail(function(xhr,status,err){var msg;msg=Annotator._t("Couldn't get auth token:");console.error(""+msg+" "+err,xhr);return Annotator.showNotification(""+msg+" "+xhr.responseText,Annotator.Notification.ERROR)}).always(function(){return _this.requestInProgress=false})};Auth.prototype.setToken=function(token){var _results,_this=this;this.token=token;this._unsafeToken=parseToken(token);if(this.haveValidToken()){if(this.options.autoFetch){this.refreshTimeout=setTimeout(function(){return _this.requestToken()},(this.timeToExpiry()-2)*1e3)}this.updateHeaders();_results=[];while(this.waitingForToken.length>0){_results.push(this.waitingForToken.pop()(this._unsafeToken))}return _results}else{console.warn(Annotator._t("Didn't get a valid token."));if(this.options.autoFetch){console.warn(Annotator._t("Getting a new token in 10s."));return setTimeout(function(){return _this.requestToken()},10*1e3)}}};Auth.prototype.haveValidToken=function(){var allFields;allFields=this._unsafeToken&&this._unsafeToken.issuedAt&&this._unsafeToken.ttl&&this._unsafeToken.consumerKey;if(allFields&&this.timeToExpiry()>0){return true}else{return false}};Auth.prototype.timeToExpiry=function(){var expiry,issue,now,timeToExpiry;now=(new Date).getTime()/1e3;issue=createDateFromISO8601(this._unsafeToken.issuedAt).getTime()/1e3;expiry=issue+this._unsafeToken.ttl;timeToExpiry=expiry-now;if(timeToExpiry>0){return timeToExpiry}else{return 0}};Auth.prototype.updateHeaders=function(){var current;current=this.element.data("annotator:headers");return this.element.data("annotator:headers",$.extend(current,{"x-annotator-auth-token":this.token}))};Auth.prototype.withToken=function(callback){if(callback==null){return}if(this.haveValidToken()){return callback(this._unsafeToken)}else{this.waitingForToken.push(callback);if(!this.requestInProgress){return this.requestToken()}}};return Auth}(Annotator.Plugin);Annotator.Plugin.Store=function(_super){__extends(Store,_super);Store.prototype.events={annotationCreated:"annotationCreated",annotationDeleted:"annotationDeleted",annotationUpdated:"annotationUpdated"};Store.prototype.options={annotationData:{},emulateHTTP:false,loadFromSearch:false,prefix:"/store",urls:{create:"/annotations",read:"/annotations/:id",update:"/annotations/:id",destroy:"/annotations/:id",search:"/search"}};function Store(element,options){this._onError=__bind(this._onError,this);this._onLoadAnnotationsFromSearch=__bind(this._onLoadAnnotationsFromSearch,this);this._onLoadAnnotations=__bind(this._onLoadAnnotations,this);this._getAnnotations=__bind(this._getAnnotations,this);Store.__super__.constructor.apply(this,arguments);this.annotations=[]}Store.prototype.pluginInit=function(){if(!Annotator.supported()){return}if(this.annotator.plugins.Auth){return this.annotator.plugins.Auth.withToken(this._getAnnotations)}else{return this._getAnnotations()}};Store.prototype._getAnnotations=function(){if(this.options.loadFromSearch){return this.loadAnnotationsFromSearch(this.options.loadFromSearch)}else{return this.loadAnnotations()}};Store.prototype.annotationCreated=function(annotation){var _this=this;if(__indexOf.call(this.annotations,annotation)<0){this.registerAnnotation(annotation);return this._apiRequest("create",annotation,function(data){if(data.id==null){console.warn(Annotator._t("Warning: No ID returned from server for annotation "),annotation)}return _this.updateAnnotation(annotation,data)})}else{return this.updateAnnotation(annotation,{})}};Store.prototype.annotationUpdated=function(annotation){var _this=this;if(__indexOf.call(this.annotations,annotation)>=0){return this._apiRequest("update",annotation,function(data){return _this.updateAnnotation(annotation,data)})}};Store.prototype.annotationDeleted=function(annotation){var _this=this;if(__indexOf.call(this.annotations,annotation)>=0){return this._apiRequest("destroy",annotation,function(){return _this.unregisterAnnotation(annotation)})}};Store.prototype.registerAnnotation=function(annotation){return this.annotations.push(annotation)};Store.prototype.unregisterAnnotation=function(annotation){return this.annotations.splice(this.annotations.indexOf(annotation),1)};Store.prototype.updateAnnotation=function(annotation,data){if(__indexOf.call(this.annotations,annotation)<0){console.error(Annotator._t("Trying to update unregistered annotation!"))}else{$.extend(annotation,data)}return $(annotation.highlights).data("annotation",annotation)};Store.prototype.loadAnnotations=function(){return this._apiRequest("read",null,this._onLoadAnnotations)};Store.prototype._onLoadAnnotations=function(data){var a,annotation,annotationMap,newData,_k,_l,_len2,_len3,_ref3;if(data==null){data=[]}annotationMap={};_ref3=this.annotations;for(_k=0,_len2=_ref3.length;_k<_len2;_k++){a=_ref3[_k];annotationMap[a.id]=a}newData=[];for(_l=0,_len3=data.length;_l<_len3;_l++){a=data[_l];if(annotationMap[a.id]){annotation=annotationMap[a.id];this.updateAnnotation(annotation,a)}else{newData.push(a)}}this.annotations=this.annotations.concat(newData);return this.annotator.loadAnnotations(newData.slice())};Store.prototype.loadAnnotationsFromSearch=function(searchOptions){return this._apiRequest("search",searchOptions,this._onLoadAnnotationsFromSearch)};Store.prototype._onLoadAnnotationsFromSearch=function(data){if(data==null){data={}}return this._onLoadAnnotations(data.rows||[])};Store.prototype.dumpAnnotations=function(){var ann,_k,_len2,_ref3,_results;_ref3=this.annotations;_results=[];for(_k=0,_len2=_ref3.length;_k<_len2;_k++){ann=_ref3[_k];_results.push(JSON.parse(this._dataFor(ann)))}return _results};Store.prototype._apiRequest=function(action,obj,onSuccess){var id,options,request,url;id=obj&&obj.id;url=this._urlFor(action,id);options=this._apiRequestOptions(action,obj,onSuccess);request=$.ajax(url,options);request._id=id;request._action=action;return request};Store.prototype._apiRequestOptions=function(action,obj,onSuccess){var data,method,opts;method=this._methodFor(action);opts={type:method,headers:this.element.data("annotator:headers"),dataType:"json",success:onSuccess||function(){},error:this._onError};if(this.options.emulateHTTP&&(method==="PUT"||method==="DELETE")){opts.headers=$.extend(opts.headers,{"X-HTTP-Method-Override":method});opts.type="POST"}if(action==="search"){opts=$.extend(opts,{data:obj});return opts}data=obj&&this._dataFor(obj);if(this.options.emulateJSON){opts.data={json:data};if(this.options.emulateHTTP){opts.data._method=method}return opts}opts=$.extend(opts,{data:data,contentType:"application/json; charset=utf-8"});return opts};Store.prototype._urlFor=function(action,id){var url;url=this.options.prefix!=null?this.options.prefix:"";url+=this.options.urls[action];url=url.replace(/\/:id/,id!=null?"/"+id:"");url=url.replace(/:id/,id!=null?id:"");return url};Store.prototype._methodFor=function(action){var table;table={create:"POST",read:"GET",update:"PUT",destroy:"DELETE",search:"GET"};return table[action]};Store.prototype._dataFor=function(annotation){var data,highlights;highlights=annotation.highlights;delete annotation.highlights;$.extend(annotation,this.options.annotationData);data=JSON.stringify(annotation);if(highlights){annotation.highlights=highlights}return data};Store.prototype._onError=function(xhr){var action,message;action=xhr._action;message=Annotator._t("Sorry we could not ")+action+Annotator._t(" this annotation");if(xhr._action==="search"){message=Annotator._t("Sorry we could not search the store for annotations")}else if(xhr._action==="read"&&!xhr._id){message=Annotator._t("Sorry we could not ")+action+Annotator._t(" the annotations from the store")}switch(xhr.status){case 401:message=Annotator._t("Sorry you are not allowed to ")+action+Annotator._t(" this annotation");break;case 404:message=Annotator._t("Sorry we could not connect to the annotations store");break;case 500:message=Annotator._t("Sorry something went wrong with the annotation store")}Annotator.showNotification(message,Annotator.Notification.ERROR);return console.error(Annotator._t("API request failed:")+(" '"+xhr.status+"'"))};return Store}(Annotator.Plugin);Annotator.Plugin.Permissions=function(_super){__extends(Permissions,_super);Permissions.prototype.events={beforeAnnotationCreated:"addFieldsToAnnotation"};Permissions.prototype.options={showViewPermissionsCheckbox:true,showEditPermissionsCheckbox:true,userId:function(user){return user},userString:function(user){return user},userAuthorize:function(action,annotation,user){var token,tokens,_k,_len2;if(annotation.permissions){tokens=annotation.permissions[action]||[];if(tokens.length===0){return true}for(_k=0,_len2=tokens.length;_k<_len2;_k++){token=tokens[_k];if(this.userId(user)===token){return true}}return false}else if(annotation.user){if(user){return this.userId(user)===this.userId(annotation.user)}else{return false}}return true},user:"",permissions:{read:[],update:[],delete:[],admin:[]}};function Permissions(element,options){this._setAuthFromToken=__bind(this._setAuthFromToken,this);this.updateViewer=__bind(this.updateViewer,this);this.updateAnnotationPermissions=__bind(this.updateAnnotationPermissions,this);this.updatePermissionsField=__bind(this.updatePermissionsField,this);this.addFieldsToAnnotation=__bind(this.addFieldsToAnnotation,this);Permissions.__super__.constructor.apply(this,arguments);if(this.options.user){this.setUser(this.options.user);delete this.options.user}}Permissions.prototype.pluginInit=function(){var createCallback,self,_this=this;if(!Annotator.supported()){return}self=this;createCallback=function(method,type){return function(field,annotation){return self[method].call(self,type,field,annotation)}};if(!this.user&&this.annotator.plugins.Auth){this.annotator.plugins.Auth.withToken(this._setAuthFromToken)}if(this.options.showViewPermissionsCheckbox===true){this.annotator.editor.addField({type:"checkbox",label:Annotator._t("Allow anyone to <strong>view</strong> this annotation"),load:createCallback("updatePermissionsField","read"),submit:createCallback("updateAnnotationPermissions","read")})}if(this.options.showEditPermissionsCheckbox===true){this.annotator.editor.addField({type:"checkbox",label:Annotator._t("Allow anyone to <strong>edit</strong> this annotation"),load:createCallback("updatePermissionsField","update"),submit:createCallback("updateAnnotationPermissions","update")})}this.annotator.viewer.addField({load:this.updateViewer});if(this.annotator.plugins.Filter){return this.annotator.plugins.Filter.addFilter({label:Annotator._t("User"),property:"user",isFiltered:function(input,user){var keyword,_k,_len2,_ref3;user=_this.options.userString(user);if(!(input&&user)){return false}_ref3=input.split(/\s*/);for(_k=0,_len2=_ref3.length;_k<_len2;_k++){keyword=_ref3[_k];if(user.indexOf(keyword)===-1){return false}}return true}})}};Permissions.prototype.setUser=function(user){return this.user=user};Permissions.prototype.addFieldsToAnnotation=function(annotation){if(annotation){annotation.permissions=$.extend(true,{},this.options.permissions);if(this.user){return annotation.user=this.user}}};Permissions.prototype.authorize=function(action,annotation,user){if(user===void 0){user=this.user}if(this.options.userAuthorize){return this.options.userAuthorize.call(this.options,action,annotation,user)}else{return true}};Permissions.prototype.updatePermissionsField=function(action,field,annotation){var input;field=$(field).show();input=field.find("input").removeAttr("disabled");if(!this.authorize("admin",annotation)){field.hide()}if(this.authorize(action,annotation||{},null)){return input.attr("checked","checked")}else{return input.removeAttr("checked")}};Permissions.prototype.updateAnnotationPermissions=function(type,field,annotation){var dataKey;if(!annotation.permissions){annotation.permissions=$.extend(true,{},this.options.permissions)}dataKey=type+"-permissions";if($(field).find("input").is(":checked")){return annotation.permissions[type]=[]}else{return annotation.permissions[type]=[this.options.userId(this.user)]}};Permissions.prototype.updateViewer=function(field,annotation,controls){var user,username;field=$(field);username=this.options.userString(annotation.user);if(annotation.user&&username&&typeof username==="string"){user=Annotator.Util.escape(this.options.userString(annotation.user));field.html(user).addClass("annotator-user")}else{field.remove()}if(controls){if(!this.authorize("update",annotation)){controls.hideEdit()}if(!this.authorize("delete",annotation)){return controls.hideDelete()}}};Permissions.prototype._setAuthFromToken=function(token){return this.setUser(token.userId)};return Permissions}(Annotator.Plugin);Annotator.Plugin.AnnotateItPermissions=function(_super){__extends(AnnotateItPermissions,_super);function AnnotateItPermissions(){this._setAuthFromToken=__bind(this._setAuthFromToken,this);this.updateAnnotationPermissions=__bind(this.updateAnnotationPermissions,this);this.updatePermissionsField=__bind(this.updatePermissionsField,this);this.addFieldsToAnnotation=__bind(this.addFieldsToAnnotation,this);_ref3=AnnotateItPermissions.__super__.constructor.apply(this,arguments);return _ref3}AnnotateItPermissions.prototype.options={showViewPermissionsCheckbox:true,showEditPermissionsCheckbox:true,groups:{world:"group:__world__",authenticated:"group:__authenticated__",consumer:"group:__consumer__"},userId:function(user){return user.userId},userString:function(user){return user.userId},userAuthorize:function(action,annotation,user){var action_field,permissions,_ref4,_ref5,_ref6,_ref7;permissions=annotation.permissions||{};action_field=permissions[action]||[];if(_ref4=this.groups.world,__indexOf.call(action_field,_ref4)>=0){return true}else if(user!=null&&user.userId!=null&&user.consumerKey!=null){if(user.userId===annotation.user&&user.consumerKey===annotation.consumer){return true}else if(_ref5=this.groups.authenticated,__indexOf.call(action_field,_ref5)>=0){return true}else if(user.consumerKey===annotation.consumer&&(_ref6=this.groups.consumer,__indexOf.call(action_field,_ref6)>=0)){return true}else if(user.consumerKey===annotation.consumer&&(_ref7=user.userId,__indexOf.call(action_field,_ref7)>=0)){return true}else if(user.consumerKey===annotation.consumer&&user.admin){return true}else{return false}}else{return false}},permissions:{read:["group:__world__"],update:[],delete:[],admin:[]}};AnnotateItPermissions.prototype.addFieldsToAnnotation=function(annotation){if(annotation){annotation.permissions=this.options.permissions;if(this.user){annotation.user=this.user.userId;return annotation.consumer=this.user.consumerKey}}};AnnotateItPermissions.prototype.updatePermissionsField=function(action,field,annotation){var input;field=$(field).show();input=field.find("input").removeAttr("disabled");if(!this.authorize("admin",annotation)){field.hide()}if(this.user&&this.authorize(action,annotation||{},{userId:"__nonexistentuser__",consumerKey:this.user.consumerKey})){return input.attr("checked","checked")}else{return input.removeAttr("checked")}};AnnotateItPermissions.prototype.updateAnnotationPermissions=function(type,field,annotation){var dataKey;if(!annotation.permissions){annotation.permissions=this.options.permissions}dataKey=type+"-permissions";if($(field).find("input").is(":checked")){return annotation.permissions[type]=[type==="read"?this.options.groups.world:this.options.groups.consumer]}else{return annotation.permissions[type]=[]}};AnnotateItPermissions.prototype._setAuthFromToken=function(token){return this.setUser(token)};return AnnotateItPermissions}(Annotator.Plugin.Permissions);Annotator.Plugin.Filter=function(_super){__extends(Filter,_super);Filter.prototype.events={".annotator-filter-property input focus":"_onFilterFocus",".annotator-filter-property input blur":"_onFilterBlur",".annotator-filter-property input keyup":"_onFilterKeyup",".annotator-filter-previous click":"_onPreviousClick",".annotator-filter-next click":"_onNextClick",".annotator-filter-clear click":"_onClearClick"};Filter.prototype.classes={active:"annotator-filter-active",hl:{hide:"annotator-hl-filtered",active:"annotator-hl-active"}};Filter.prototype.html={element:'<div class="annotator-filter">\n  <strong>'+Annotator._t("Navigate:")+'</strong>\n<span class="annotator-filter-navigation">\n  <button class="annotator-filter-previous">'+Annotator._t("Previous")+'</button>\n<button class="annotator-filter-next">'+Annotator._t("Next")+"</button>\n</span>\n<strong>"+Annotator._t("Filter by:")+"</strong>\n</div>",filter:'<span class="annotator-filter-property">\n  <label></label>\n  <input/>\n  <button class="annotator-filter-clear">'+Annotator._t("Clear")+"</button>\n</span>"};Filter.prototype.options={appendTo:"body",filters:[],addAnnotationFilter:true,isFiltered:function(input,property){var keyword,_k,_len2,_ref4;if(!(input&&property)){return false}_ref4=input.split(/\s+/);for(_k=0,_len2=_ref4.length;_k<_len2;_k++){keyword=_ref4[_k];if(property.indexOf(keyword)===-1){return false}}return true}};function Filter(element,options){this._onPreviousClick=__bind(this._onPreviousClick,this);this._onNextClick=__bind(this._onNextClick,this);this._onFilterKeyup=__bind(this._onFilterKeyup,this);this._onFilterBlur=__bind(this._onFilterBlur,this);this._onFilterFocus=__bind(this._onFilterFocus,this);this.updateHighlights=__bind(this.updateHighlights,this);var _base;element=$(this.html.element).appendTo((options!=null?options.appendTo:void 0)||this.options.appendTo);Filter.__super__.constructor.call(this,element,options);(_base=this.options).filters||(_base.filters=[]);this.filter=$(this.html.filter);this.filters=[];this.current=0}Filter.prototype.pluginInit=function(){var filter,_k,_len2,_ref4;_ref4=this.options.filters;for(_k=0,_len2=_ref4.length;_k<_len2;_k++){filter=_ref4[_k];this.addFilter(filter)}this.updateHighlights();this._setupListeners()._insertSpacer();if(this.options.addAnnotationFilter===true){return this.addFilter({label:Annotator._t("Annotation"),property:"text"})}};Filter.prototype.destroy=function(){var currentMargin,html;Filter.__super__.destroy.apply(this,arguments);html=$("html");currentMargin=parseInt(html.css("padding-top"),10)||0;html.css("padding-top",currentMargin-this.element.outerHeight());return this.element.remove()};Filter.prototype._insertSpacer=function(){var currentMargin,html;html=$("html");currentMargin=parseInt(html.css("padding-top"),10)||0;html.css("padding-top",currentMargin+this.element.outerHeight());return this};Filter.prototype._setupListeners=function(){var event,events,_k,_len2;events=["annotationsLoaded","annotationCreated","annotationUpdated","annotationDeleted"];for(_k=0,_len2=events.length;_k<_len2;_k++){event=events[_k];this.annotator.subscribe(event,this.updateHighlights)}return this};Filter.prototype.addFilter=function(options){var f,filter;filter=$.extend({label:"",property:"",isFiltered:this.options.isFiltered},options);if(!function(){var _k,_len2,_ref4,_results;_ref4=this.filters;_results=[];for(_k=0,_len2=_ref4.length;_k<_len2;_k++){f=_ref4[_k];if(f.property===filter.property){_results.push(f)}}return _results}.call(this).length){filter.id="annotator-filter-"+filter.property;filter.annotations=[];filter.element=this.filter.clone().appendTo(this.element);filter.element.find("label").html(filter.label).attr("for",filter.id);filter.element.find("input").attr({id:filter.id,placeholder:Annotator._t("Filter by ")+filter.label+"â€¦"});filter.element.find("button").hide();filter.element.data("filter",filter);this.filters.push(filter)}return this};Filter.prototype.updateFilter=function(filter){var annotation,annotations,input,property,_k,_len2,_ref4;filter.annotations=[];this.updateHighlights();this.resetHighlights();input=$.trim(filter.element.find("input").val());if(input){annotations=this.highlights.map(function(){return $(this).data("annotation")});_ref4=$.makeArray(annotations);for(_k=0,_len2=_ref4.length;_k<_len2;_k++){annotation=_ref4[_k];property=annotation[filter.property];if(filter.isFiltered(input,property)){filter.annotations.push(annotation)}}return this.filterHighlights()}};Filter.prototype.updateHighlights=function(){this.highlights=this.annotator.element.find(".annotator-hl:visible");return this.filtered=this.highlights.not(this.classes.hl.hide)};Filter.prototype.filterHighlights=function(){var activeFilters,annotation,annotations,filtered,highlights,index,uniques,_k,_len2,_ref4;activeFilters=$.grep(this.filters,function(filter){return!!filter.annotations.length});filtered=((_ref4=activeFilters[0])!=null?_ref4.annotations:void 0)||[];if(activeFilters.length>1){annotations=[];$.each(activeFilters,function(){return $.merge(annotations,this.annotations)});uniques=[];filtered=[];$.each(annotations,function(){if($.inArray(this,uniques)===-1){return uniques.push(this)}else{return filtered.push(this)}})}highlights=this.highlights;for(index=_k=0,_len2=filtered.length;_k<_len2;index=++_k){annotation=filtered[index];highlights=highlights.not(annotation.highlights)}highlights.addClass(this.classes.hl.hide);this.filtered=this.highlights.not(this.classes.hl.hide);return this};Filter.prototype.resetHighlights=function(){this.highlights.removeClass(this.classes.hl.hide);this.filtered=this.highlights;return this};Filter.prototype._onFilterFocus=function(event){var input;input=$(event.target);input.parent().addClass(this.classes.active);return input.next("button").show()};Filter.prototype._onFilterBlur=function(event){var input;if(!event.target.value){input=$(event.target);input.parent().removeClass(this.classes.active);return input.next("button").hide()}};Filter.prototype._onFilterKeyup=function(event){var filter;filter=$(event.target).parent().data("filter");if(filter){return this.updateFilter(filter)}};Filter.prototype._findNextHighlight=function(previous){var active,annotation,current,index,next,offset,operator,resetOffset;if(!this.highlights.length){return this}offset=previous?0:-1;resetOffset=previous?-1:0;operator=previous?"lt":"gt";active=this.highlights.not("."+this.classes.hl.hide);current=active.filter("."+this.classes.hl.active);if(!current.length){current=active.eq(offset)}annotation=current.data("annotation");index=active.index(current[0]);next=active.filter(":"+operator+"("+index+")").not(annotation.highlights).eq(resetOffset);if(!next.length){next=active.eq(resetOffset)}return this._scrollToHighlight(next.data("annotation").highlights)};Filter.prototype._onNextClick=function(event){return this._findNextHighlight()};Filter.prototype._onPreviousClick=function(event){return this._findNextHighlight(true)};Filter.prototype._scrollToHighlight=function(highlight){highlight=$(highlight);this.highlights.removeClass(this.classes.hl.active);highlight.addClass(this.classes.hl.active);return $("html, body").animate({scrollTop:highlight.offset().top-(this.element.height()+20)},150)};Filter.prototype._onClearClick=function(event){return $(event.target).prev("input").val("").keyup().blur()};return Filter}(Annotator.Plugin);Annotator.Plugin.Markdown=function(_super){__extends(Markdown,_super);Markdown.prototype.events={annotationViewerTextField:"updateTextField"};function Markdown(element,options){this.updateTextField=__bind(this.updateTextField,this);if((typeof Showdown!=="undefined"&&Showdown!==null?Showdown.converter:void 0)!=null){Markdown.__super__.constructor.apply(this,arguments);this.converter=new Showdown.converter}else{console.error(Annotator._t("To use the Markdown plugin, you must include Showdown into the page first."))}}Markdown.prototype.updateTextField=function(field,annotation){var text;text=Annotator.Util.escape(annotation.text||"");return $(field).html(this.convert(text))};Markdown.prototype.convert=function(text){return this.converter.makeHtml(text)};return Markdown}(Annotator.Plugin);Annotator.Plugin.Tags=function(_super){__extends(Tags,_super);function Tags(){this.setAnnotationTags=__bind(this.setAnnotationTags,this);this.updateField=__bind(this.updateField,this);_ref4=Tags.__super__.constructor.apply(this,arguments);return _ref4}Tags.prototype.options={parseTags:function(string){var tags;string=$.trim(string);tags=[];if(string){tags=string.split(/\s+/)}return tags},stringifyTags:function(array){return array.join(" ")}};Tags.prototype.field=null;Tags.prototype.input=null;Tags.prototype.pluginInit=function(){if(!Annotator.supported()){return}this.field=this.annotator.editor.addField({label:Annotator._t("Add some tags here")+"â€¦",load:this.updateField,submit:this.setAnnotationTags});this.annotator.viewer.addField({load:this.updateViewer});if(this.annotator.plugins.Filter){this.annotator.plugins.Filter.addFilter({label:Annotator._t("Tag"),property:"tags",isFiltered:Annotator.Plugin.Tags.filterCallback})}return this.input=$(this.field).find(":input")};Tags.prototype.parseTags=function(string){return this.options.parseTags(string)};Tags.prototype.stringifyTags=function(array){return this.options.stringifyTags(array)};Tags.prototype.updateField=function(field,annotation){var value;value="";if(annotation.tags){value=this.stringifyTags(annotation.tags)}return this.input.val(value)};Tags.prototype.setAnnotationTags=function(field,annotation){return annotation.tags=this.parseTags(this.input.val())};Tags.prototype.updateViewer=function(field,annotation){field=$(field);if(annotation.tags&&$.isArray(annotation.tags)&&annotation.tags.length){return field.addClass("annotator-tags").html(function(){var string;return string=$.map(annotation.tags,function(tag){return'<span class="annotator-tag">'+Annotator.Util.escape(tag)+"</span>"}).join(" ")})}else{return field.remove()}};return Tags}(Annotator.Plugin);Annotator.Plugin.Tags.filterCallback=function(input,tags){var keyword,keywords,matches,tag,_k,_l,_len2,_len3;if(tags==null){tags=[]}matches=0;keywords=[];if(input){keywords=input.split(/\s+/g);for(_k=0,_len2=keywords.length;_k<_len2;_k++){keyword=keywords[_k];if(tags.length){for(_l=0,_len3=tags.length;_l<_len3;_l++){tag=tags[_l];if(tag.indexOf(keyword)!==-1){matches+=1}}}}}return matches===keywords.length};Annotator.prototype.setupPlugins=function(config,options){var name,opts,pluginConfig,plugins,uri,win,_k,_len2,_results;if(config==null){config={}}if(options==null){options={}}win=Annotator.Util.getGlobal();plugins=["Unsupported","Auth","Tags","Filter","Store","AnnotateItPermissions"];if(win.Showdown){plugins.push("Markdown")}uri=win.location.href.split(/#|\?/).shift()||"";pluginConfig={Tags:{},Filter:{filters:[{label:Annotator._t("User"),property:"user"},{label:Annotator._t("Tags"),property:"tags"}]},Auth:{tokenUrl:config.tokenUrl||"http://annotateit.org/api/token"},Store:{prefix:config.storeUrl||"http://annotateit.org/api",annotationData:{uri:uri},loadFromSearch:{uri:uri}}};for(name in options){if(!__hasProp.call(options,name))continue;opts=options[name];if(__indexOf.call(plugins,name)<0){plugins.push(name)}}$.extend(true,pluginConfig,options);_results=[];for(_k=0,_len2=plugins.length;_k<_len2;_k++){name=plugins[_k];if(!(name in pluginConfig)||pluginConfig[name]){_results.push(this.addPlugin(name,pluginConfig[name]))}else{_results.push(void 0)}}return _results}}.call(this);(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=Object.prototype.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};Annotator.Plugin.Offline=a=function(a){function g(){this._onOffline=c(this._onOffline,this),this._onOnline=c(this._onOnline,this);var a,e,f;g.__super__.constructor.apply(this,arguments),this.store=new g.Store,this.cache={},f={online:"online",offline:"offline",beforeAnnotationLoaded:"setAnnotationData",beforeAnnotationCreated:"setAnnotationData"};for(a in f){if(!d.call(f,a))continue;e=f[a],typeof this.options[e]=="function"&&this.on(a,b.proxy(this.options,e))}}var b,f;return e(g,a),f=Annotator._t,b=Annotator.$,g.ANNOTATION_PREFIX="annotation.",g.uuid=function(){return(""+Math.random()+(new Date).getTime()).slice(2)},g.prototype.events={annotationCreated:"_onAnnotationCreated",annotationUpdated:"_onAnnotationUpdated",annotationDeleted:"_onAnnotationDeleted"},g.prototype.options={getUniqueKey:function(a){return a.id||(a.id=g.uuid()),a.id},shouldLoadAnnotation:function(a){return!0}},g.prototype.pluginInit=function(){if(!Annotator.supported())return;return this.loadAnnotationsFromStore(),this.isOnline()?this.online():this.offline(),b(window).bind({online:this._onOnline,offline:this._onOffline})},g.prototype.annotations=function(){return this.cache},g.prototype.online=function(){return this.publish("online",[this]),this},g.prototype.offline=function(){return this.publish("offline",[this]),this},g.prototype.isOnline=function(){return window.navigator.onLine},g.prototype.loadAnnotationsFromStore=function(){var a,b,c,d,e;c=[],b=this.store.all(g.ANNOTATION_PREFIX);for(d=0,e=b.length;d<e;d++){a=b[d];if(!this.options.shouldLoadAnnotation(a))continue;this.publish("beforeAnnotationLoaded",[a,this]),this.publish("annotationLoaded",[a,this]),this.cache[this.keyForAnnotation(a)]=a,c.push(a)}return c.length&&this.annotator.loadAnnotations(c),this},g.prototype.addAnnotation=function(a,b){var c;return b==null&&(b={}),c=this.cache[this.options.getUniqueKey(a)],!c&&this.options.shouldLoadAnnotation(a)?this.annotator.setupAnnotation(a,b.silent):this.updateStoredAnnotation(a),this},g.prototype.removeAnnotation=function(a){return this.options.shouldLoadAnnotation(a)?this.annotator.deleteAnnotation(a):this.removeStoredAnnotation(a),this},g.prototype.updateStoredAnnotation=function(a){var c,d,e,f;return c=this.keyForAnnotation(a),d=this.keyForStore(a),e=this.cache[c],e?b.extend(e,a):e=this.cache[c]=a,f=b.extend({},e),delete f.highlights,this.store.set(d,f),this},g.prototype.removeStoredAnnotation=function(a){var b,c;return b=this.keyForAnnotation(a),c=this.keyForStore(a),this.store.remove(c),delete this.cache[b],this},g.prototype.keyForAnnotation=function(a){return this.options.getUniqueKey.call(this,a,this)},g.prototype.keyForStore=function(a){return g.ANNOTATION_PREFIX+this.keyForAnnotation(a)},g.prototype._onOnline=function(a){return this.online()},g.prototype._onOffline=function(a){return this.offline()},g.prototype._onAnnotationCreated=function(a){return this.updateStoredAnnotation(a)},g.prototype._onAnnotationUpdated=function(a){return this.updateStoredAnnotation(a)},g.prototype._onAnnotationDeleted=function(a){return this.removeStoredAnnotation(a)},g}(Annotator.Plugin),Annotator.Plugin.Offline.Store=b=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return e(b,a),b.KEY_PREFIX="annotator.offline/",b.CACHE_DELIMITER="--cache--",b.localStorage=window.localStorage,b.isSupported=function(){try{return"localStorage"in window&&window.localStorage!==null}catch(a){return!1}},b.now=function(){return(new Date).getTime()},b.prototype.all=function(a){var c,d,e,f;a==null&&(a=""),f=[],d=this.prefixed(a);for(c in localStorage){if(c.indexOf(d)!==0)continue;e=this.get(c.slice(b.KEY_PREFIX.length)),f.push(e)}return f},b.prototype.get=function(a){var c;return c=b.localStorage.getItem(this.prefixed(a)),c&&(c=this.checkCache(c),c||this.remove(a)),JSON.parse(c)},b.prototype.set=function(a,c,d){c=JSON.stringify(c),d&&(c=b.now()+d+b.CACHE_DELIMITER+c);try{b.localStorage.setItem(this.prefixed(a),c)}catch(e){this.publish("error",[e,this])}return this},b.prototype.remove=function(a){return b.localStorage.removeItem(this.prefixed(a)),this},b.prototype.clear=function(){var a,c;c=b.localStorage;for(a in c)a.indexOf(b.KEY_PREFIX)===0&&c.removeItem(a);return this},b.prototype.prefixed=function(a){return b.KEY_PREFIX+a},b.prototype.checkCache=function(a){var c;return a.indexOf(b.CACHE_DELIMITER)>-1&&(c=a.split(b.CACHE_DELIMITER),a=b.now()>c.shift()?null:c.join(b.CACHE_DELIMITER)),a},b}(Annotator.Delegator)}).call(this);!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(e,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),n(t),t}:n(jQuery)}(function(t){var e,n,s,p,r,o,h,f,g,m,y,v,i,a,_,s=((u=t&&t.fn&&t.fn.select2&&t.fn.select2.amd?t.fn.select2.amd:u)&&u.requirejs||(u?n=u:u={},g={},m={},y={},v={},i=Object.prototype.hasOwnProperty,a=[].slice,_=/\.js$/,h=function(e,t){var n,s,i=c(e),r=i[0],t=t[1];return e=i[1],r&&(n=x(r=l(r,t))),r?e=n&&n.normalize?n.normalize(e,(s=t,function(e){return l(e,s)})):l(e,t):(r=(i=c(e=l(e,t)))[0],e=i[1],r&&(n=x(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:n}},f={require:function(e){return w(e)},exports:function(e){var t=g[e];return void 0!==t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:(t=e,function(){return y&&y.config&&y.config[t]||{}})};var t}},r=function(e,t,n,s){var i,r,o,a,l,c=[],u=typeof n,d=A(s=s||e);if("undefined"==u||"function"==u){for(t=!t.length&&n.length?["require","exports","module"]:t,a=0;a<t.length;a+=1)if("require"===(r=(o=h(t[a],d)).f))c[a]=f.require(e);else if("exports"===r)c[a]=f.exports(e),l=!0;else if("module"===r)i=c[a]=f.module(e);else if(b(g,r)||b(m,r)||b(v,r))c[a]=x(r);else{if(!o.p)throw new Error(e+" missing "+r);o.p.load(o.n,w(s,!0),function(t){return function(e){g[t]=e}}(r),{}),c[a]=g[r]}u=n?n.apply(g[e],c):void 0,e&&(i&&i.exports!==p&&i.exports!==g[e]?g[e]=i.exports:u===p&&l||(g[e]=u))}else e&&(g[e]=n)},e=n=o=function(e,t,n,s,i){if("string"==typeof e)return f[e]?f[e](t):x(h(e,A(t)).f);if(!e.splice){if((y=e).deps&&o(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=p}return t=t||function(){},"function"==typeof n&&(n=s,s=i),s?r(p,e,t,n):setTimeout(function(){r(p,e,t,n)},4),o},o.config=function(e){return o(e)},e._defined=g,(s=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),b(g,e)||b(m,e)||(m[e]=[e,t,n])}).amd={jQuery:!0},u.requirejs=e,u.require=n,u.define=s),u.define("almond",function(){}),u.define("jquery",[],function(){var e=t||$;return null==e&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),e}),u.define("select2/utils",["jquery"],function(r){var s={};function c(e){var t,n=e.prototype,s=[];for(t in n)"function"==typeof n[t]&&"constructor"!==t&&s.push(t);return s}s.Extend=function(e,t){var n,s={}.hasOwnProperty;function i(){this.constructor=e}for(n in t)s.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},s.Decorate=function(s,i){var e=c(i),t=c(s);function r(){var e=Array.prototype.unshift,t=i.prototype.constructor.length,n=s.prototype.constructor;0<t&&(e.call(arguments,s.prototype.constructor),n=i.prototype.constructor),n.apply(this,arguments)}i.displayName=s.displayName,r.prototype=new function(){this.constructor=r};for(var n=0;n<t.length;n++){var o=t[n];r.prototype[o]=s.prototype[o]}for(var a=0;a<e.length;a++){var l=e[a];r.prototype[l]=function(e){var t=function(){};e in r.prototype&&(t=r.prototype[e]);var n=i.prototype[e];return function(){return Array.prototype.unshift.call(arguments,t),n.apply(this,arguments)}}(l)}return r};function e(){this.listeners={}}e.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},e.prototype.trigger=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);this.listeners=this.listeners||{},0===(n=null==n?[]:n).length&&n.push({}),(n[0]._type=e)in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},e.prototype.invoke=function(e,t){for(var n=0,s=e.length;n<s;n++)e[n].apply(this,t)},s.Observable=e,s.generateChars=function(e){for(var t="",n=0;n<e;n++)t+=Math.floor(36*Math.random()).toString(36);return t},s.bind=function(e,t){return function(){e.apply(t,arguments)}},s._convertData=function(e){for(var t in e){var n=t.split("-"),s=e;if(1!==n.length){for(var i=0;i<n.length;i++){var r=n[i];(r=r.substring(0,1).toLowerCase()+r.substring(1))in s||(s[r]={}),i==n.length-1&&(s[r]=e[t]),s=s[r]}delete e[t]}}return e},s.hasScroll=function(e,t){var n=r(t),s=t.style.overflowX,i=t.style.overflowY;return(s!==i||"hidden"!==i&&"visible"!==i)&&("scroll"===s||"scroll"===i||(n.innerHeight()<t.scrollHeight||n.innerWidth()<t.scrollWidth))},s.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof e?e:String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})},s.__cache={};var n=0;return s.GetUniqueElementId=function(e){var t=e.getAttribute("data-select2-id");return null!=t||(t=e.id?"select2-data-"+e.id:"select2-data-"+(++n).toString()+"-"+s.generateChars(4),e.setAttribute("data-select2-id",t)),t},s.StoreData=function(e,t,n){e=s.GetUniqueElementId(e);s.__cache[e]||(s.__cache[e]={}),s.__cache[e][t]=n},s.GetData=function(e,t){var n=s.GetUniqueElementId(e);return t?s.__cache[n]&&null!=s.__cache[n][t]?s.__cache[n][t]:r(e).data(t):s.__cache[n]},s.RemoveData=function(e){var t=s.GetUniqueElementId(e);null!=s.__cache[t]&&delete s.__cache[t],e.removeAttribute("data-select2-id")},s.copyNonInternalCssClasses=function(e,t){var n=(n=e.getAttribute("class").trim().split(/\s+/)).filter(function(e){return 0===e.indexOf("select2-")}),t=(t=t.getAttribute("class").trim().split(/\s+/)).filter(function(e){return 0!==e.indexOf("select2-")}),t=n.concat(t);e.setAttribute("class",t.join(" "))},s}),u.define("select2/results",["jquery","./utils"],function(d,p){function s(e,t,n){this.$element=e,this.data=n,this.options=t,s.__super__.constructor.call(this)}return p.Extend(s,p.Observable),s.prototype.render=function(){var e=d('<ul class="select2-results__options" role="listbox"></ul>');return this.options.get("multiple")&&e.attr("aria-multiselectable","true"),this.$results=e},s.prototype.clear=function(){this.$results.empty()},s.prototype.displayMessage=function(e){var t=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var n=d('<li role="alert" aria-live="assertive" class="select2-results__option"></li>'),s=this.options.get("translations").get(e.message);n.append(t(s(e.args))),n[0].className+=" select2-results__message",this.$results.append(n)},s.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},s.prototype.append=function(e){this.hideLoading();var t=[];if(null!=e.results&&0!==e.results.length){e.results=this.sort(e.results);for(var n=0;n<e.results.length;n++){var s=e.results[n],s=this.option(s);t.push(s)}this.$results.append(t)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},s.prototype.position=function(e,t){t.find(".select2-results").append(e)},s.prototype.sort=function(e){return this.options.get("sorter")(e)},s.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option--selectable"),t=e.filter(".select2-results__option--selected");(0<t.length?t:e).first().trigger("mouseenter"),this.ensureHighlightVisible()},s.prototype.setClasses=function(){var t=this;this.data.current(function(e){var s=e.map(function(e){return e.id.toString()});t.$results.find(".select2-results__option--selectable").each(function(){var e=d(this),t=p.GetData(this,"data"),n=""+t.id;null!=t.element&&t.element.selected||null==t.element&&-1<s.indexOf(n)?(this.classList.add("select2-results__option--selected"),e.attr("aria-selected","true")):(this.classList.remove("select2-results__option--selected"),e.attr("aria-selected","false"))})})},s.prototype.showLoading=function(e){this.hideLoading();e={disabled:!0,loading:!0,text:this.options.get("translations").get("searching")(e)},e=this.option(e);e.className+=" loading-results",this.$results.prepend(e)},s.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},s.prototype.option=function(e){var t=document.createElement("li");t.classList.add("select2-results__option"),t.classList.add("select2-results__option--selectable");var n,s={role:"option"},i=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;for(n in(null!=e.element&&i.call(e.element,":disabled")||null==e.element&&e.disabled)&&(s["aria-disabled"]="true",t.classList.remove("select2-results__option--selectable"),t.classList.add("select2-results__option--disabled")),null==e.id&&t.classList.remove("select2-results__option--selectable"),null!=e._resultId&&(t.id=e._resultId),e.title&&(t.title=e.title),e.children&&(s.role="group",s["aria-label"]=e.text,t.classList.remove("select2-results__option--selectable"),t.classList.add("select2-results__option--group")),s){var r=s[n];t.setAttribute(n,r)}if(e.children){var o=d(t),a=document.createElement("strong");a.className="select2-results__group",this.template(e,a);for(var l=[],c=0;c<e.children.length;c++){var u=e.children[c],u=this.option(u);l.push(u)}i=d("<ul></ul>",{class:"select2-results__options select2-results__options--nested",role:"none"});i.append(l),o.append(a),o.append(i)}else this.template(e,t);return p.StoreData(t,"data",e),t},s.prototype.bind=function(t,e){var i=this,n=t.id+"-results";this.$results.attr("id",n),t.on("results:all",function(e){i.clear(),i.append(e.data),t.isOpen()&&(i.setClasses(),i.highlightFirstItem())}),t.on("results:append",function(e){i.append(e.data),t.isOpen()&&i.setClasses()}),t.on("query",function(e){i.hideMessages(),i.showLoading(e)}),t.on("select",function(){t.isOpen()&&(i.setClasses(),i.options.get("scrollAfterSelect")&&i.highlightFirstItem())}),t.on("unselect",function(){t.isOpen()&&(i.setClasses(),i.options.get("scrollAfterSelect")&&i.highlightFirstItem())}),t.on("open",function(){i.$results.attr("aria-expanded","true"),i.$results.attr("aria-hidden","false"),i.setClasses(),i.ensureHighlightVisible()}),t.on("close",function(){i.$results.attr("aria-expanded","false"),i.$results.attr("aria-hidden","true"),i.$results.removeAttr("aria-activedescendant")}),t.on("results:toggle",function(){var e=i.getHighlightedResults();0!==e.length&&e.trigger("mouseup")}),t.on("results:select",function(){var e,t=i.getHighlightedResults();0!==t.length&&(e=p.GetData(t[0],"data"),t.hasClass("select2-results__option--selected")?i.trigger("close",{}):i.trigger("select",{data:e}))}),t.on("results:previous",function(){var e,t=i.getHighlightedResults(),n=i.$results.find(".select2-results__option--selectable"),s=n.index(t);s<=0||(e=s-1,0===t.length&&(e=0),(s=n.eq(e)).trigger("mouseenter"),t=i.$results.offset().top,n=s.offset().top,s=i.$results.scrollTop()+(n-t),0===e?i.$results.scrollTop(0):n-t<0&&i.$results.scrollTop(s))}),t.on("results:next",function(){var e,t=i.getHighlightedResults(),n=i.$results.find(".select2-results__option--selectable"),s=n.index(t)+1;s>=n.length||((e=n.eq(s)).trigger("mouseenter"),t=i.$results.offset().top+i.$results.outerHeight(!1),n=e.offset().top+e.outerHeight(!1),e=i.$results.scrollTop()+n-t,0===s?i.$results.scrollTop(0):t<n&&i.$results.scrollTop(e))}),t.on("results:focus",function(e){e.element[0].classList.add("select2-results__option--highlighted"),e.element[0].setAttribute("aria-selected","true")}),t.on("results:message",function(e){i.displayMessage(e)}),d.fn.mousewheel&&this.$results.on("mousewheel",function(e){var t=i.$results.scrollTop(),n=i.$results.get(0).scrollHeight-t+e.deltaY,t=0<e.deltaY&&t-e.deltaY<=0,n=e.deltaY<0&&n<=i.$results.height();t?(i.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):n&&(i.$results.scrollTop(i.$results.get(0).scrollHeight-i.$results.height()),e.preventDefault(),e.stopPropagation())}),this.$results.on("mouseup",".select2-results__option--selectable",function(e){var t=d(this),n=p.GetData(this,"data");t.hasClass("select2-results__option--selected")?i.options.get("multiple")?i.trigger("unselect",{originalEvent:e,data:n}):i.trigger("close",{}):i.trigger("select",{originalEvent:e,data:n})}),this.$results.on("mouseenter",".select2-results__option--selectable",function(e){var t=p.GetData(this,"data");i.getHighlightedResults().removeClass("select2-results__option--highlighted").attr("aria-selected","false"),i.trigger("results:focus",{data:t,element:d(this)})})},s.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},s.prototype.destroy=function(){this.$results.remove()},s.prototype.ensureHighlightVisible=function(){var e,t,n,s,i=this.getHighlightedResults();0!==i.length&&(e=this.$results.find(".select2-results__option--selectable").index(i),s=this.$results.offset().top,t=i.offset().top,n=this.$results.scrollTop()+(t-s),s=t-s,n-=2*i.outerHeight(!1),e<=2?this.$results.scrollTop(0):(s>this.$results.outerHeight()||s<0)&&this.$results.scrollTop(n))},s.prototype.template=function(e,t){var n=this.options.get("templateResult"),s=this.options.get("escapeMarkup"),e=n(e,t);null==e?t.style.display="none":"string"==typeof e?t.innerHTML=s(e):d(t).append(e)},s}),u.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),u.define("select2/selection/base",["jquery","../utils","../keys"],function(n,s,i){function r(e,t){this.$element=e,this.options=t,r.__super__.constructor.call(this)}return s.Extend(r,s.Observable),r.prototype.render=function(){var e=n('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=s.GetData(this.$element[0],"old-tabindex")?this._tabindex=s.GetData(this.$element[0],"old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),e.attr("title",this.$element.attr("title")),e.attr("tabindex",this._tabindex),e.attr("aria-disabled","false"),this.$selection=e},r.prototype.bind=function(e,t){var n=this,s=e.id+"-results";this.container=e,this.$selection.on("focus",function(e){n.trigger("focus",e)}),this.$selection.on("blur",function(e){n._handleBlur(e)}),this.$selection.on("keydown",function(e){n.trigger("keypress",e),e.which===i.SPACE&&e.preventDefault()}),e.on("results:focus",function(e){n.$selection.attr("aria-activedescendant",e.data._resultId)}),e.on("selection:update",function(e){n.update(e.data)}),e.on("open",function(){n.$selection.attr("aria-expanded","true"),n.$selection.attr("aria-owns",s),n._attachCloseHandler(e)}),e.on("close",function(){n.$selection.attr("aria-expanded","false"),n.$selection.removeAttr("aria-activedescendant"),n.$selection.removeAttr("aria-owns"),n.$selection.trigger("focus"),n._detachCloseHandler(e)}),e.on("enable",function(){n.$selection.attr("tabindex",n._tabindex),n.$selection.attr("aria-disabled","false")}),e.on("disable",function(){n.$selection.attr("tabindex","-1"),n.$selection.attr("aria-disabled","true")})},r.prototype._handleBlur=function(e){var t=this;window.setTimeout(function(){document.activeElement==t.$selection[0]||n.contains(t.$selection[0],document.activeElement)||t.trigger("blur",e)},1)},r.prototype._attachCloseHandler=function(e){n(document.body).on("mousedown.select2."+e.id,function(e){var t=n(e.target).closest(".select2");n(".select2.select2-container--open").each(function(){this!=t[0]&&s.GetData(this,"element").select2("close")})})},r.prototype._detachCloseHandler=function(e){n(document.body).off("mousedown.select2."+e.id)},r.prototype.position=function(e,t){t.find(".selection").append(e)},r.prototype.destroy=function(){this._detachCloseHandler(this.container)},r.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},r.prototype.isEnabled=function(){return!this.isDisabled()},r.prototype.isDisabled=function(){return this.options.get("disabled")},r}),u.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(e,t,n,s){function i(){i.__super__.constructor.apply(this,arguments)}return n.Extend(i,t),i.prototype.render=function(){var e=i.__super__.render.call(this);return e[0].classList.add("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},i.prototype.bind=function(t,e){var n=this;i.__super__.bind.apply(this,arguments);var s=t.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",s).attr("role","textbox").attr("aria-readonly","true"),this.$selection.attr("aria-labelledby",s),this.$selection.attr("aria-controls",s),this.$selection.on("mousedown",function(e){1===e.which&&n.trigger("toggle",{originalEvent:e})}),this.$selection.on("focus",function(e){}),this.$selection.on("blur",function(e){}),t.on("focus",function(e){t.isOpen()||n.$selection.trigger("focus")})},i.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},i.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},i.prototype.selectionContainer=function(){return e("<span></span>")},i.prototype.update=function(e){var t,n;0!==e.length?(n=e[0],t=this.$selection.find(".select2-selection__rendered"),e=this.display(n,t),t.empty().append(e),(n=n.title||n.text)?t.attr("title",n):t.removeAttr("title")):this.clear()},i}),u.define("select2/selection/multiple",["jquery","./base","../utils"],function(i,e,c){function r(e,t){r.__super__.constructor.apply(this,arguments)}return c.Extend(r,e),r.prototype.render=function(){var e=r.__super__.render.call(this);return e[0].classList.add("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},r.prototype.bind=function(e,t){var n=this;r.__super__.bind.apply(this,arguments);var s=e.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",s),this.$selection.on("click",function(e){n.trigger("toggle",{originalEvent:e})}),this.$selection.on("click",".select2-selection__choice__remove",function(e){var t;n.isDisabled()||(t=i(this).parent(),t=c.GetData(t[0],"data"),n.trigger("unselect",{originalEvent:e,data:t}))}),this.$selection.on("keydown",".select2-selection__choice__remove",function(e){n.isDisabled()||e.stopPropagation()})},r.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},r.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},r.prototype.selectionContainer=function(){return i('<li class="select2-selection__choice"><button type="button" class="select2-selection__choice__remove" tabindex="-1"><span aria-hidden="true">&times;</span></button><span class="select2-selection__choice__display"></span></li>')},r.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],n=this.$selection.find(".select2-selection__rendered").attr("id")+"-choice-",s=0;s<e.length;s++){var i=e[s],r=this.selectionContainer(),o=this.display(i,r),a=n+c.generateChars(4)+"-";i.id?a+=i.id:a+=c.generateChars(4),r.find(".select2-selection__choice__display").append(o).attr("id",a);var l=i.title||i.text;l&&r.attr("title",l);o=this.options.get("translations").get("removeItem"),l=r.find(".select2-selection__choice__remove");l.attr("title",o()),l.attr("aria-label",o()),l.attr("aria-describedby",a),c.StoreData(r[0],"data",i),t.push(r)}this.$selection.find(".select2-selection__rendered").append(t)}},r}),u.define("select2/selection/placeholder",[],function(){function e(e,t,n){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n)}return e.prototype.normalizePlaceholder=function(e,t){return t="string"==typeof t?{id:"",text:t}:t},e.prototype.createPlaceholder=function(e,t){var n=this.selectionContainer();n.html(this.display(t)),n[0].classList.add("select2-selection__placeholder"),n[0].classList.remove("select2-selection__choice");t=t.title||t.text||n.text();return this.$selection.find(".select2-selection__rendered").attr("title",t),n},e.prototype.update=function(e,t){var n=1==t.length&&t[0].id!=this.placeholder.id;if(1<t.length||n)return e.call(this,t);this.clear();t=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(t)},e}),u.define("select2/selection/allowClear",["jquery","../keys","../utils"],function(i,s,a){function e(){}return e.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(e){s._handleClear(e)}),t.on("keypress",function(e){s._handleKeyboardClear(e,t)})},e.prototype._handleClear=function(e,t){if(!this.isDisabled()){var n=this.$selection.find(".select2-selection__clear");if(0!==n.length){t.stopPropagation();var s=a.GetData(n[0],"data"),i=this.$element.val();this.$element.val(this.placeholder.id);var r={data:s};if(this.trigger("clear",r),r.prevented)this.$element.val(i);else{for(var o=0;o<s.length;o++)if(r={data:s[o]},this.trigger("unselect",r),r.prevented)return void this.$element.val(i);this.$element.trigger("input").trigger("change"),this.trigger("toggle",{})}}}},e.prototype._handleKeyboardClear=function(e,t,n){n.isOpen()||t.which!=s.DELETE&&t.which!=s.BACKSPACE||this._handleClear(t)},e.prototype.update=function(e,t){var n,s;e.call(this,t),this.$selection.find(".select2-selection__clear").remove(),this.$selection[0].classList.remove("select2-selection--clearable"),0<this.$selection.find(".select2-selection__placeholder").length||0===t.length||(n=this.$selection.find(".select2-selection__rendered").attr("id"),s=this.options.get("translations").get("removeAllItems"),(e=i('<button type="button" class="select2-selection__clear" tabindex="-1"><span aria-hidden="true">&times;</span></button>')).attr("title",s()),e.attr("aria-label",s()),e.attr("aria-describedby",n),a.StoreData(e[0],"data",t),this.$selection.prepend(e),this.$selection[0].classList.add("select2-selection--clearable"))},e}),u.define("select2/selection/search",["jquery","../utils","../keys"],function(s,a,l){function e(e,t,n){e.call(this,t,n)}return e.prototype.render=function(e){var t=this.options.get("translations").get("search"),n=s('<span class="select2-search select2-search--inline"><textarea class="select2-search__field" type="search" tabindex="-1" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" ></textarea></span>');this.$searchContainer=n,this.$search=n.find("textarea"),this.$search.prop("autocomplete",this.options.get("autocomplete")),this.$search.attr("aria-label",t());e=e.call(this);return this._transferTabIndex(),e.append(this.$searchContainer),e},e.prototype.bind=function(e,t,n){var s=this,i=t.id+"-results",r=t.id+"-container";e.call(this,t,n),s.$search.attr("aria-describedby",r),t.on("open",function(){s.$search.attr("aria-controls",i),s.$search.trigger("focus")}),t.on("close",function(){s.$search.val(""),s.resizeSearch(),s.$search.removeAttr("aria-controls"),s.$search.removeAttr("aria-activedescendant"),s.$search.trigger("focus")}),t.on("enable",function(){s.$search.prop("disabled",!1),s._transferTabIndex()}),t.on("disable",function(){s.$search.prop("disabled",!0)}),t.on("focus",function(e){s.$search.trigger("focus")}),t.on("results:focus",function(e){e.data._resultId?s.$search.attr("aria-activedescendant",e.data._resultId):s.$search.removeAttr("aria-activedescendant")}),this.$selection.on("focusin",".select2-search--inline",function(e){s.trigger("focus",e)}),this.$selection.on("focusout",".select2-search--inline",function(e){s._handleBlur(e)}),this.$selection.on("keydown",".select2-search--inline",function(e){var t;e.stopPropagation(),s.trigger("keypress",e),s._keyUpPrevented=e.isDefaultPrevented(),e.which!==l.BACKSPACE||""!==s.$search.val()||0<(t=s.$selection.find(".select2-selection__choice").last()).length&&(t=a.GetData(t[0],"data"),s.searchRemoveChoice(t),e.preventDefault())}),this.$selection.on("click",".select2-search--inline",function(e){s.$search.val()&&e.stopPropagation()});var t=document.documentMode,o=t&&t<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(e){o?s.$selection.off("input.search input.searchcheck"):s.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(e){var t;o&&"input"===e.type?s.$selection.off("input.search input.searchcheck"):(t=e.which)!=l.SHIFT&&t!=l.CTRL&&t!=l.ALT&&t!=l.TAB&&s.handleSearch(e)})},e.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},e.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},e.prototype.update=function(e,t){var n=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),e.call(this,t),this.resizeSearch(),n&&this.$search.trigger("focus")},e.prototype.handleSearch=function(){var e;this.resizeSearch(),this._keyUpPrevented||(e=this.$search.val(),this.trigger("query",{term:e})),this._keyUpPrevented=!1},e.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},e.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="100%";""===this.$search.attr("placeholder")&&(e=.75*(this.$search.val().length+1)+"em"),this.$search.css("width",e)},e}),u.define("select2/selection/selectionCss",["../utils"],function(n){function e(){}return e.prototype.render=function(e){var t=e.call(this),e=this.options.get("selectionCssClass")||"";return-1!==e.indexOf(":all:")&&(e=e.replace(":all:",""),n.copyNonInternalCssClasses(t[0],this.$element[0])),t.addClass(e),t},e}),u.define("select2/selection/eventRelay",["jquery"],function(o){function e(){}return e.prototype.bind=function(e,t,n){var s=this,i=["open","opening","close","closing","select","selecting","unselect","unselecting","clear","clearing"],r=["opening","closing","selecting","unselecting","clearing"];e.call(this,t,n),t.on("*",function(e,t){var n;-1!==i.indexOf(e)&&(t=t||{},n=o.Event("select2:"+e,{params:t}),s.$element.trigger(n),-1!==r.indexOf(e)&&(t.prevented=n.isDefaultPrevented()))})},e}),u.define("select2/translation",["jquery","require"],function(t,n){function s(e){this.dict=e||{}}return s.prototype.all=function(){return this.dict},s.prototype.get=function(e){return this.dict[e]},s.prototype.extend=function(e){this.dict=t.extend({},e.all(),this.dict)},s._cache={},s.loadPath=function(e){var t;return e in s._cache||(t=n(e),s._cache[e]=t),new s(s._cache[e])},s}),u.define("select2/diacritics",[],function(){return{"â’¶":"A","ï¼¡":"A","Ã€":"A","Ã":"A","Ã‚":"A","áº¦":"A","áº¤":"A","áºª":"A","áº¨":"A","Ãƒ":"A","Ä€":"A","Ä‚":"A","áº°":"A","áº®":"A","áº´":"A","áº²":"A","È¦":"A","Ç ":"A","Ã„":"A","Çž":"A","áº¢":"A","Ã…":"A","Çº":"A","Ç":"A","È€":"A","È‚":"A","áº ":"A","áº¬":"A","áº¶":"A","á¸€":"A","Ä„":"A","Èº":"A","â±¯":"A","êœ²":"AA","Ã†":"AE","Ç¼":"AE","Ç¢":"AE","êœ´":"AO","êœ¶":"AU","êœ¸":"AV","êœº":"AV","êœ¼":"AY","â’·":"B","ï¼¢":"B","á¸‚":"B","á¸„":"B","á¸†":"B","Éƒ":"B","Æ‚":"B","Æ":"B","â’¸":"C","ï¼£":"C","Ä†":"C","Äˆ":"C","ÄŠ":"C","ÄŒ":"C","Ã‡":"C","á¸ˆ":"C","Æ‡":"C","È»":"C","êœ¾":"C","â’¹":"D","ï¼¤":"D","á¸Š":"D","ÄŽ":"D","á¸Œ":"D","á¸":"D","á¸’":"D","á¸Ž":"D","Ä":"D","Æ‹":"D","ÆŠ":"D","Æ‰":"D","ê¹":"D","Ç±":"DZ","Ç„":"DZ","Ç²":"Dz","Ç…":"Dz","â’º":"E","ï¼¥":"E","Ãˆ":"E","Ã‰":"E","ÃŠ":"E","á»€":"E","áº¾":"E","á»„":"E","á»‚":"E","áº¼":"E","Ä’":"E","á¸”":"E","á¸–":"E","Ä”":"E","Ä–":"E","Ã‹":"E","áºº":"E","Äš":"E","È„":"E","È†":"E","áº¸":"E","á»†":"E","È¨":"E","á¸œ":"E","Ä˜":"E","á¸˜":"E","á¸š":"E","Æ":"E","ÆŽ":"E","â’»":"F","ï¼¦":"F","á¸ž":"F","Æ‘":"F","ê»":"F","â’¼":"G","ï¼§":"G","Ç´":"G","Äœ":"G","á¸ ":"G","Äž":"G","Ä ":"G","Ç¦":"G","Ä¢":"G","Ç¤":"G","Æ“":"G","êž ":"G","ê½":"G","ê¾":"G","â’½":"H","ï¼¨":"H","Ä¤":"H","á¸¢":"H","á¸¦":"H","Èž":"H","á¸¤":"H","á¸¨":"H","á¸ª":"H","Ä¦":"H","â±§":"H","â±µ":"H","êž":"H","â’¾":"I","ï¼©":"I","ÃŒ":"I","Ã":"I","ÃŽ":"I","Ä¨":"I","Äª":"I","Ä¬":"I","Ä°":"I","Ã":"I","á¸®":"I","á»ˆ":"I","Ç":"I","Èˆ":"I","ÈŠ":"I","á»Š":"I","Ä®":"I","á¸¬":"I","Æ—":"I","â’¿":"J","ï¼ª":"J","Ä´":"J","Éˆ":"J","â“€":"K","ï¼«":"K","á¸°":"K","Ç¨":"K","á¸²":"K","Ä¶":"K","á¸´":"K","Æ˜":"K","â±©":"K","ê€":"K","ê‚":"K","ê„":"K","êž¢":"K","â“":"L","ï¼¬":"L","Ä¿":"L","Ä¹":"L","Ä½":"L","á¸¶":"L","á¸¸":"L","Ä»":"L","á¸¼":"L","á¸º":"L","Å":"L","È½":"L","â±¢":"L","â± ":"L","êˆ":"L","ê†":"L","êž€":"L","Ç‡":"LJ","Çˆ":"Lj","â“‚":"M","ï¼­":"M","á¸¾":"M","á¹€":"M","á¹‚":"M","â±®":"M","Æœ":"M","â“ƒ":"N","ï¼®":"N","Ç¸":"N","Åƒ":"N","Ã‘":"N","á¹„":"N","Å‡":"N","á¹†":"N","Å…":"N","á¹Š":"N","á¹ˆ":"N","È ":"N","Æ":"N","êž":"N","êž¤":"N","ÇŠ":"NJ","Ç‹":"Nj","â“„":"O","ï¼¯":"O","Ã’":"O","Ã“":"O","Ã”":"O","á»’":"O","á»":"O","á»–":"O","á»”":"O","Ã•":"O","á¹Œ":"O","È¬":"O","á¹Ž":"O","ÅŒ":"O","á¹":"O","á¹’":"O","ÅŽ":"O","È®":"O","È°":"O","Ã–":"O","Èª":"O","á»Ž":"O","Å":"O","Ç‘":"O","ÈŒ":"O","ÈŽ":"O","Æ ":"O","á»œ":"O","á»š":"O","á» ":"O","á»ž":"O","á»¢":"O","á»Œ":"O","á»˜":"O","Çª":"O","Ç¬":"O","Ã˜":"O","Ç¾":"O","Æ†":"O","ÆŸ":"O","êŠ":"O","êŒ":"O","Å’":"OE","Æ¢":"OI","êŽ":"OO","È¢":"OU","â“…":"P","ï¼°":"P","á¹”":"P","á¹–":"P","Æ¤":"P","â±£":"P","ê":"P","ê’":"P","ê”":"P","â“†":"Q","ï¼±":"Q","ê–":"Q","ê˜":"Q","ÉŠ":"Q","â“‡":"R","ï¼²":"R","Å”":"R","á¹˜":"R","Å˜":"R","È":"R","È’":"R","á¹š":"R","á¹œ":"R","Å–":"R","á¹ž":"R","ÉŒ":"R","â±¤":"R","êš":"R","êž¦":"R","êž‚":"R","â“ˆ":"S","ï¼³":"S","áºž":"S","Åš":"S","á¹¤":"S","Åœ":"S","á¹ ":"S","Å ":"S","á¹¦":"S","á¹¢":"S","á¹¨":"S","È˜":"S","Åž":"S","â±¾":"S","êž¨":"S","êž„":"S","â“‰":"T","ï¼´":"T","á¹ª":"T","Å¤":"T","á¹¬":"T","Èš":"T","Å¢":"T","á¹°":"T","á¹®":"T","Å¦":"T","Æ¬":"T","Æ®":"T","È¾":"T","êž†":"T","êœ¨":"TZ","â“Š":"U","ï¼µ":"U","Ã™":"U","Ãš":"U","Ã›":"U","Å¨":"U","á¹¸":"U","Åª":"U","á¹º":"U","Å¬":"U","Ãœ":"U","Ç›":"U","Ç—":"U","Ç•":"U","Ç™":"U","á»¦":"U","Å®":"U","Å°":"U","Ç“":"U","È”":"U","È–":"U","Æ¯":"U","á»ª":"U","á»¨":"U","á»®":"U","á»¬":"U","á»°":"U","á»¤":"U","á¹²":"U","Å²":"U","á¹¶":"U","á¹´":"U","É„":"U","â“‹":"V","ï¼¶":"V","á¹¼":"V","á¹¾":"V","Æ²":"V","êž":"V","É…":"V","ê ":"VY","â“Œ":"W","ï¼·":"W","áº€":"W","áº‚":"W","Å´":"W","áº†":"W","áº„":"W","áºˆ":"W","â±²":"W","â“":"X","ï¼¸":"X","áºŠ":"X","áºŒ":"X","â“Ž":"Y","ï¼¹":"Y","á»²":"Y","Ã":"Y","Å¶":"Y","á»¸":"Y","È²":"Y","áºŽ":"Y","Å¸":"Y","á»¶":"Y","á»´":"Y","Æ³":"Y","ÉŽ":"Y","á»¾":"Y","â“":"Z","ï¼º":"Z","Å¹":"Z","áº":"Z","Å»":"Z","Å½":"Z","áº’":"Z","áº”":"Z","Æµ":"Z","È¤":"Z","â±¿":"Z","â±«":"Z","ê¢":"Z","â“":"a","ï½":"a","áºš":"a","Ã ":"a","Ã¡":"a","Ã¢":"a","áº§":"a","áº¥":"a","áº«":"a","áº©":"a","Ã£":"a","Ä":"a","Äƒ":"a","áº±":"a","áº¯":"a","áºµ":"a","áº³":"a","È§":"a","Ç¡":"a","Ã¤":"a","ÇŸ":"a","áº£":"a","Ã¥":"a","Ç»":"a","ÇŽ":"a","È":"a","Èƒ":"a","áº¡":"a","áº­":"a","áº·":"a","á¸":"a","Ä…":"a","â±¥":"a","É":"a","êœ³":"aa","Ã¦":"ae","Ç½":"ae","Ç£":"ae","êœµ":"ao","êœ·":"au","êœ¹":"av","êœ»":"av","êœ½":"ay","â“‘":"b","ï½‚":"b","á¸ƒ":"b","á¸…":"b","á¸‡":"b","Æ€":"b","Æƒ":"b","É“":"b","â“’":"c","ï½ƒ":"c","Ä‡":"c","Ä‰":"c","Ä‹":"c","Ä":"c","Ã§":"c","á¸‰":"c","Æˆ":"c","È¼":"c","êœ¿":"c","â†„":"c","â““":"d","ï½„":"d","á¸‹":"d","Ä":"d","á¸":"d","á¸‘":"d","á¸“":"d","á¸":"d","Ä‘":"d","ÆŒ":"d","É–":"d","É—":"d","êº":"d","Ç³":"dz","Ç†":"dz","â“”":"e","ï½…":"e","Ã¨":"e","Ã©":"e","Ãª":"e","á»":"e","áº¿":"e","á»…":"e","á»ƒ":"e","áº½":"e","Ä“":"e","á¸•":"e","á¸—":"e","Ä•":"e","Ä—":"e","Ã«":"e","áº»":"e","Ä›":"e","È…":"e","È‡":"e","áº¹":"e","á»‡":"e","È©":"e","á¸":"e","Ä™":"e","á¸™":"e","á¸›":"e","É‡":"e","É›":"e","Ç":"e","â“•":"f","ï½†":"f","á¸Ÿ":"f","Æ’":"f","ê¼":"f","â“–":"g","ï½‡":"g","Çµ":"g","Ä":"g","á¸¡":"g","ÄŸ":"g","Ä¡":"g","Ç§":"g","Ä£":"g","Ç¥":"g","É ":"g","êž¡":"g","áµ¹":"g","ê¿":"g","â“—":"h","ï½ˆ":"h","Ä¥":"h","á¸£":"h","á¸§":"h","ÈŸ":"h","á¸¥":"h","á¸©":"h","á¸«":"h","áº–":"h","Ä§":"h","â±¨":"h","â±¶":"h","É¥":"h","Æ•":"hv","â“˜":"i","ï½‰":"i","Ã¬":"i","Ã­":"i","Ã®":"i","Ä©":"i","Ä«":"i","Ä­":"i","Ã¯":"i","á¸¯":"i","á»‰":"i","Ç":"i","È‰":"i","È‹":"i","á»‹":"i","Ä¯":"i","á¸­":"i","É¨":"i","Ä±":"i","â“™":"j","ï½Š":"j","Äµ":"j","Ç°":"j","É‰":"j","â“š":"k","ï½‹":"k","á¸±":"k","Ç©":"k","á¸³":"k","Ä·":"k","á¸µ":"k","Æ™":"k","â±ª":"k","ê":"k","êƒ":"k","ê…":"k","êž£":"k","â“›":"l","ï½Œ":"l","Å€":"l","Äº":"l","Ä¾":"l","á¸·":"l","á¸¹":"l","Ä¼":"l","á¸½":"l","á¸»":"l","Å¿":"l","Å‚":"l","Æš":"l","É«":"l","â±¡":"l","ê‰":"l","êž":"l","ê‡":"l","Ç‰":"lj","â“œ":"m","ï½":"m","á¸¿":"m","á¹":"m","á¹ƒ":"m","É±":"m","É¯":"m","â“":"n","ï½Ž":"n","Ç¹":"n","Å„":"n","Ã±":"n","á¹…":"n","Åˆ":"n","á¹‡":"n","Å†":"n","á¹‹":"n","á¹‰":"n","Æž":"n","É²":"n","Å‰":"n","êž‘":"n","êž¥":"n","ÇŒ":"nj","â“ž":"o","ï½":"o","Ã²":"o","Ã³":"o","Ã´":"o","á»“":"o","á»‘":"o","á»—":"o","á»•":"o","Ãµ":"o","á¹":"o","È­":"o","á¹":"o","Å":"o","á¹‘":"o","á¹“":"o","Å":"o","È¯":"o","È±":"o","Ã¶":"o","È«":"o","á»":"o","Å‘":"o","Ç’":"o","È":"o","È":"o","Æ¡":"o","á»":"o","á»›":"o","á»¡":"o","á»Ÿ":"o","á»£":"o","á»":"o","á»™":"o","Ç«":"o","Ç­":"o","Ã¸":"o","Ç¿":"o","É”":"o","ê‹":"o","ê":"o","Éµ":"o","Å“":"oe","Æ£":"oi","È£":"ou","ê":"oo","â“Ÿ":"p","ï½":"p","á¹•":"p","á¹—":"p","Æ¥":"p","áµ½":"p","ê‘":"p","ê“":"p","ê•":"p","â“ ":"q","ï½‘":"q","É‹":"q","ê—":"q","ê™":"q","â“¡":"r","ï½’":"r","Å•":"r","á¹™":"r","Å™":"r","È‘":"r","È“":"r","á¹›":"r","á¹":"r","Å—":"r","á¹Ÿ":"r","É":"r","É½":"r","ê›":"r","êž§":"r","êžƒ":"r","â“¢":"s","ï½“":"s","ÃŸ":"s","Å›":"s","á¹¥":"s","Å":"s","á¹¡":"s","Å¡":"s","á¹§":"s","á¹£":"s","á¹©":"s","È™":"s","ÅŸ":"s","È¿":"s","êž©":"s","êž…":"s","áº›":"s","â“£":"t","ï½”":"t","á¹«":"t","áº—":"t","Å¥":"t","á¹­":"t","È›":"t","Å£":"t","á¹±":"t","á¹¯":"t","Å§":"t","Æ­":"t","Êˆ":"t","â±¦":"t","êž‡":"t","êœ©":"tz","â“¤":"u","ï½•":"u","Ã¹":"u","Ãº":"u","Ã»":"u","Å©":"u","á¹¹":"u","Å«":"u","á¹»":"u","Å­":"u","Ã¼":"u","Çœ":"u","Ç˜":"u","Ç–":"u","Çš":"u","á»§":"u","Å¯":"u","Å±":"u","Ç”":"u","È•":"u","È—":"u","Æ°":"u","á»«":"u","á»©":"u","á»¯":"u","á»­":"u","á»±":"u","á»¥":"u","á¹³":"u","Å³":"u","á¹·":"u","á¹µ":"u","Ê‰":"u","â“¥":"v","ï½–":"v","á¹½":"v","á¹¿":"v","Ê‹":"v","êŸ":"v","ÊŒ":"v","ê¡":"vy","â“¦":"w","ï½—":"w","áº":"w","áºƒ":"w","Åµ":"w","áº‡":"w","áº…":"w","áº˜":"w","áº‰":"w","â±³":"w","â“§":"x","ï½˜":"x","áº‹":"x","áº":"x","â“¨":"y","ï½™":"y","á»³":"y","Ã½":"y","Å·":"y","á»¹":"y","È³":"y","áº":"y","Ã¿":"y","á»·":"y","áº™":"y","á»µ":"y","Æ´":"y","É":"y","á»¿":"y","â“©":"z","ï½š":"z","Åº":"z","áº‘":"z","Å¼":"z","Å¾":"z","áº“":"z","áº•":"z","Æ¶":"z","È¥":"z","É€":"z","â±¬":"z","ê£":"z","Î†":"Î‘","Îˆ":"Î•","Î‰":"Î—","ÎŠ":"Î™","Îª":"Î™","ÎŒ":"ÎŸ","ÎŽ":"Î¥","Î«":"Î¥","Î":"Î©","Î¬":"Î±","Î­":"Îµ","Î®":"Î·","Î¯":"Î¹","ÏŠ":"Î¹","Î":"Î¹","ÏŒ":"Î¿","Ï":"Ï…","Ï‹":"Ï…","Î°":"Ï…","ÏŽ":"Ï‰","Ï‚":"Ïƒ","â€™":"'"}}),u.define("select2/data/base",["../utils"],function(n){function s(e,t){s.__super__.constructor.call(this)}return n.Extend(s,n.Observable),s.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},s.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},s.prototype.bind=function(e,t){},s.prototype.destroy=function(){},s.prototype.generateResultId=function(e,t){e=e.id+"-result-";return e+=n.generateChars(4),null!=t.id?e+="-"+t.id.toString():e+="-"+n.generateChars(4),e},s}),u.define("select2/data/select",["./base","../utils","jquery"],function(e,a,l){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return a.Extend(n,e),n.prototype.current=function(e){var t=this;e(Array.prototype.map.call(this.$element[0].querySelectorAll(":checked"),function(e){return t.item(l(e))}))},n.prototype.select=function(i){var e,r=this;if(i.selected=!0,null!=i.element&&"option"===i.element.tagName.toLowerCase())return i.element.selected=!0,void this.$element.trigger("input").trigger("change");this.$element.prop("multiple")?this.current(function(e){var t=[];(i=[i]).push.apply(i,e);for(var n=0;n<i.length;n++){var s=i[n].id;-1===t.indexOf(s)&&t.push(s)}r.$element.val(t),r.$element.trigger("input").trigger("change")}):(e=i.id,this.$element.val(e),this.$element.trigger("input").trigger("change"))},n.prototype.unselect=function(i){var r=this;if(this.$element.prop("multiple")){if(i.selected=!1,null!=i.element&&"option"===i.element.tagName.toLowerCase())return i.element.selected=!1,void this.$element.trigger("input").trigger("change");this.current(function(e){for(var t=[],n=0;n<e.length;n++){var s=e[n].id;s!==i.id&&-1===t.indexOf(s)&&t.push(s)}r.$element.val(t),r.$element.trigger("input").trigger("change")})}},n.prototype.bind=function(e,t){var n=this;(this.container=e).on("select",function(e){n.select(e.data)}),e.on("unselect",function(e){n.unselect(e.data)})},n.prototype.destroy=function(){this.$element.find("*").each(function(){a.RemoveData(this)})},n.prototype.query=function(t,e){var n=[],s=this;this.$element.children().each(function(){var e;"option"!==this.tagName.toLowerCase()&&"optgroup"!==this.tagName.toLowerCase()||(e=l(this),e=s.item(e),null!==(e=s.matches(t,e))&&n.push(e))}),e({results:n})},n.prototype.addOptions=function(e){this.$element.append(e)},n.prototype.option=function(e){var t;e.children?(t=document.createElement("optgroup")).label=e.text:void 0!==(t=document.createElement("option")).textContent?t.textContent=e.text:t.innerText=e.text,void 0!==e.id&&(t.value=e.id),e.disabled&&(t.disabled=!0),e.selected&&(t.selected=!0),e.title&&(t.title=e.title);e=this._normalizeItem(e);return e.element=t,a.StoreData(t,"data",e),l(t)},n.prototype.item=function(e){var t={};if(null!=(t=a.GetData(e[0],"data")))return t;var n=e[0];if("option"===n.tagName.toLowerCase())t={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if("optgroup"===n.tagName.toLowerCase()){t={text:e.prop("label"),children:[],title:e.prop("title")};for(var s=e.children("option"),i=[],r=0;r<s.length;r++){var o=l(s[r]),o=this.item(o);i.push(o)}t.children=i}return(t=this._normalizeItem(t)).element=e[0],a.StoreData(e[0],"data",t),t},n.prototype._normalizeItem=function(e){e!==Object(e)&&(e={id:e,text:e});return null!=(e=l.extend({},{text:""},e)).id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),l.extend({},{selected:!1,disabled:!1},e)},n.prototype.matches=function(e,t){return this.options.get("matcher")(e,t)},n}),u.define("select2/data/array",["./select","../utils","jquery"],function(e,t,c){function s(e,t){this._dataToConvert=t.get("data")||[],s.__super__.constructor.call(this,e,t)}return t.Extend(s,e),s.prototype.bind=function(e,t){s.__super__.bind.call(this,e,t),this.addOptions(this.convertToOptions(this._dataToConvert))},s.prototype.select=function(n){var e=this.$element.find("option").filter(function(e,t){return t.value==n.id.toString()});0===e.length&&(e=this.option(n),this.addOptions(e)),s.__super__.select.call(this,n)},s.prototype.convertToOptions=function(e){var t=this,n=this.$element.find("option"),s=n.map(function(){return t.item(c(this)).id}).get(),i=[];for(var r=0;r<e.length;r++){var o,a,l=this._normalizeItem(e[r]);0<=s.indexOf(l.id)?(o=n.filter(function(e){return function(){return c(this).val()==e.id}}(l)),a=this.item(o),a=c.extend(!0,{},l,a),a=this.option(a),o.replaceWith(a)):(a=this.option(l),l.children&&(l=this.convertToOptions(l.children),a.append(l)),i.push(a))}return i},s}),u.define("select2/data/ajax",["./array","../utils","jquery"],function(e,t,r){function n(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),n.__super__.constructor.call(this,e,t)}return t.Extend(n,e),n.prototype._applyDefaults=function(e){var t={data:function(e){return r.extend({},e,{q:e.term})},transport:function(e,t,n){e=r.ajax(e);return e.then(t),e.fail(n),e}};return r.extend({},t,e,!0)},n.prototype.processResults=function(e){return e},n.prototype.query=function(t,n){var s=this;null!=this._request&&("function"==typeof this._request.abort&&this._request.abort(),this._request=null);var i=r.extend({type:"GET"},this.ajaxOptions);function e(){var e=i.transport(i,function(e){e=s.processResults(e,t);s.options.get("debug")&&window.console&&console.error&&(e&&e.results&&Array.isArray(e.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),n(e)},function(){"status"in e&&(0===e.status||"0"===e.status)||s.trigger("results:message",{message:"errorLoading"})});s._request=e}"function"==typeof i.url&&(i.url=i.url.call(this.$element,t)),"function"==typeof i.data&&(i.data=i.data.call(this.$element,t)),this.ajaxOptions.delay&&null!=t.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(e,this.ajaxOptions.delay)):e()},n}),u.define("select2/data/tags",["jquery"],function(t){function e(e,t,n){var s=n.get("tags"),i=n.get("createTag");void 0!==i&&(this.createTag=i);i=n.get("insertTag");if(void 0!==i&&(this.insertTag=i),e.call(this,t,n),Array.isArray(s))for(var r=0;r<s.length;r++){var o=s[r],o=this._normalizeItem(o),o=this.option(o);this.$element.append(o)}}return e.prototype.query=function(e,c,u){var d=this;this._removeOldTags(),null!=c.term&&null==c.page?e.call(this,c,function e(t,n){for(var s=t.results,i=0;i<s.length;i++){var r=s[i],o=null!=r.children&&!e({results:r.children},!0);if((r.text||"").toUpperCase()===(c.term||"").toUpperCase()||o)return!n&&(t.data=s,void u(t))}if(n)return!0;var a,l=d.createTag(c);null!=l&&((a=d.option(l)).attr("data-select2-tag","true"),d.addOptions([a]),d.insertTag(s,l)),t.results=s,u(t)}):e.call(this,c,u)},e.prototype.createTag=function(e,t){if(null==t.term)return null;t=t.term.trim();return""===t?null:{id:t,text:t}},e.prototype.insertTag=function(e,t,n){t.unshift(n)},e.prototype._removeOldTags=function(e){this.$element.find("option[data-select2-tag]").each(function(){this.selected||t(this).remove()})},e}),u.define("select2/data/tokenizer",["jquery"],function(c){function e(e,t,n){var s=n.get("tokenizer");void 0!==s&&(this.tokenizer=s),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){e.call(this,t,n),this.$search=t.dropdown.$search||t.selection.$search||n.find(".select2-search__field")},e.prototype.query=function(e,t,n){var s=this;t.term=t.term||"";var i=this.tokenizer(t,this.options,function(e){var t,n=s._normalizeItem(e);s.$element.find("option").filter(function(){return c(this).val()===n.id}).length||((t=s.option(n)).attr("data-select2-tag",!0),s._removeOldTags(),s.addOptions([t])),t=n,s.trigger("select",{data:t})});i.term!==t.term&&(this.$search.length&&(this.$search.val(i.term),this.$search.trigger("focus")),t.term=i.term),e.call(this,t,n)},e.prototype.tokenizer=function(e,t,n,s){for(var i=n.get("tokenSeparators")||[],r=t.term,o=0,a=this.createTag||function(e){return{id:e.term,text:e.term}};o<r.length;){var l=r[o];-1!==i.indexOf(l)?(l=r.substr(0,o),null!=(l=a(c.extend({},t,{term:l})))?(s(l),r=r.substr(o+1)||"",o=0):o++):o++}return{term:r}},e}),u.define("select2/data/minimumInputLength",[],function(){function e(e,t,n){this.minimumInputLength=n.get("minimumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",t.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),u.define("select2/data/maximumInputLength",[],function(){function e(e,t,n){this.maximumInputLength=n.get("maximumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",0<this.maximumInputLength&&t.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),u.define("select2/data/maximumSelectionLength",[],function(){function e(e,t,n){this.maximumSelectionLength=n.get("maximumSelectionLength"),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("select",function(){s._checkIfMaximumSelected()})},e.prototype.query=function(e,t,n){var s=this;this._checkIfMaximumSelected(function(){e.call(s,t,n)})},e.prototype._checkIfMaximumSelected=function(e,t){var n=this;this.current(function(e){e=null!=e?e.length:0;0<n.maximumSelectionLength&&e>=n.maximumSelectionLength?n.trigger("results:message",{message:"maximumSelected",args:{maximum:n.maximumSelectionLength}}):t&&t()})},e}),u.define("select2/dropdown",["jquery","./utils"],function(t,e){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return e.Extend(n,e.Observable),n.prototype.render=function(){var e=t('<span class="select2-dropdown"><span class="select2-results"></span></span>');return e.attr("dir",this.options.get("dir")),this.$dropdown=e},n.prototype.bind=function(){},n.prototype.position=function(e,t){},n.prototype.destroy=function(){this.$dropdown.remove()},n}),u.define("select2/dropdown/search",["jquery"],function(r){function e(){}return e.prototype.render=function(e){var t=e.call(this),n=this.options.get("translations").get("search"),e=r('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></span>');return this.$searchContainer=e,this.$search=e.find("input"),this.$search.prop("autocomplete",this.options.get("autocomplete")),this.$search.attr("aria-label",n()),t.prepend(e),t},e.prototype.bind=function(e,t,n){var s=this,i=t.id+"-results";e.call(this,t,n),this.$search.on("keydown",function(e){s.trigger("keypress",e),s._keyUpPrevented=e.isDefaultPrevented()}),this.$search.on("input",function(e){r(this).off("keyup")}),this.$search.on("keyup input",function(e){s.handleSearch(e)}),t.on("open",function(){s.$search.attr("tabindex",0),s.$search.attr("aria-controls",i),s.$search.trigger("focus"),window.setTimeout(function(){s.$search.trigger("focus")},0)}),t.on("close",function(){s.$search.attr("tabindex",-1),s.$search.removeAttr("aria-controls"),s.$search.removeAttr("aria-activedescendant"),s.$search.val(""),s.$search.trigger("blur")}),t.on("focus",function(){t.isOpen()||s.$search.trigger("focus")}),t.on("results:all",function(e){null!=e.query.term&&""!==e.query.term||(s.showSearch(e)?s.$searchContainer[0].classList.remove("select2-search--hide"):s.$searchContainer[0].classList.add("select2-search--hide"))}),t.on("results:focus",function(e){e.data._resultId?s.$search.attr("aria-activedescendant",e.data._resultId):s.$search.removeAttr("aria-activedescendant")})},e.prototype.handleSearch=function(e){var t;this._keyUpPrevented||(t=this.$search.val(),this.trigger("query",{term:t})),this._keyUpPrevented=!1},e.prototype.showSearch=function(e,t){return!0},e}),u.define("select2/dropdown/hidePlaceholder",[],function(){function e(e,t,n,s){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n,s)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return t="string"==typeof t?{id:"",text:t}:t},e.prototype.removePlaceholder=function(e,t){for(var n=t.slice(0),s=t.length-1;0<=s;s--){var i=t[s];this.placeholder.id===i.id&&n.splice(s,1)}return n},e}),u.define("select2/dropdown/infiniteScroll",["jquery"],function(n){function e(e,t,n,s){this.lastParams={},e.call(this,t,n,s),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return e.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&(this.$results.append(this.$loadingMore),this.loadMoreIfNeeded())},e.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("query",function(e){s.lastParams=e,s.loading=!0}),t.on("query:append",function(e){s.lastParams=e,s.loading=!0}),this.$results.on("scroll",this.loadMoreIfNeeded.bind(this))},e.prototype.loadMoreIfNeeded=function(){var e=n.contains(document.documentElement,this.$loadingMore[0]);!this.loading&&e&&(e=this.$results.offset().top+this.$results.outerHeight(!1),this.$loadingMore.offset().top+this.$loadingMore.outerHeight(!1)<=e+50&&this.loadMore())},e.prototype.loadMore=function(){this.loading=!0;var e=n.extend({},{page:1},this.lastParams);e.page++,this.trigger("query:append",e)},e.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},e.prototype.createLoadingMore=function(){var e=n('<li class="select2-results__option select2-results__option--load-more"role="option" aria-disabled="true"></li>'),t=this.options.get("translations").get("loadingMore");return e.html(t(this.lastParams)),e},e}),u.define("select2/dropdown/attachBody",["jquery","../utils"],function(u,o){function e(e,t,n){this.$dropdownParent=u(n.get("dropdownParent")||document.body),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("open",function(){s._showDropdown(),s._attachPositioningHandler(t),s._bindContainerResultHandlers(t)}),t.on("close",function(){s._hideDropdown(),s._detachPositioningHandler(t)}),this.$dropdownContainer.on("mousedown",function(e){e.stopPropagation()})},e.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},e.prototype.position=function(e,t,n){t.attr("class",n.attr("class")),t[0].classList.remove("select2"),t[0].classList.add("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=n},e.prototype.render=function(e){var t=u("<span></span>"),e=e.call(this);return t.append(e),this.$dropdownContainer=t},e.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},e.prototype._bindContainerResultHandlers=function(e,t){var n;this._containerResultsHandlersBound||(n=this,t.on("results:all",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("results:append",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("results:message",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("select",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("unselect",function(){n._positionDropdown(),n._resizeDropdown()}),this._containerResultsHandlersBound=!0)},e.prototype._attachPositioningHandler=function(e,t){var n=this,s="scroll.select2."+t.id,i="resize.select2."+t.id,r="orientationchange.select2."+t.id,t=this.$container.parents().filter(o.hasScroll);t.each(function(){o.StoreData(this,"select2-scroll-position",{x:u(this).scrollLeft(),y:u(this).scrollTop()})}),t.on(s,function(e){var t=o.GetData(this,"select2-scroll-position");u(this).scrollTop(t.y)}),u(window).on(s+" "+i+" "+r,function(e){n._positionDropdown(),n._resizeDropdown()})},e.prototype._detachPositioningHandler=function(e,t){var n="scroll.select2."+t.id,s="resize.select2."+t.id,t="orientationchange.select2."+t.id;this.$container.parents().filter(o.hasScroll).off(n),u(window).off(n+" "+s+" "+t)},e.prototype._positionDropdown=function(){var e=u(window),t=this.$dropdown[0].classList.contains("select2-dropdown--above"),n=this.$dropdown[0].classList.contains("select2-dropdown--below"),s=null,i=this.$container.offset();i.bottom=i.top+this.$container.outerHeight(!1);var r={height:this.$container.outerHeight(!1)};r.top=i.top,r.bottom=i.top+r.height;var o=this.$dropdown.outerHeight(!1),a=e.scrollTop(),l=e.scrollTop()+e.height(),c=a<i.top-o,e=l>i.bottom+o,a={left:i.left,top:r.bottom},l=this.$dropdownParent;"static"===l.css("position")&&(l=l.offsetParent());i={top:0,left:0};(u.contains(document.body,l[0])||l[0].isConnected)&&(i=l.offset()),a.top-=i.top,a.left-=i.left,t||n||(s="below"),e||!c||t?!c&&e&&t&&(s="below"):s="above",("above"==s||t&&"below"!==s)&&(a.top=r.top-i.top-o),null!=s&&(this.$dropdown[0].classList.remove("select2-dropdown--below"),this.$dropdown[0].classList.remove("select2-dropdown--above"),this.$dropdown[0].classList.add("select2-dropdown--"+s),this.$container[0].classList.remove("select2-container--below"),this.$container[0].classList.remove("select2-container--above"),this.$container[0].classList.add("select2-container--"+s)),this.$dropdownContainer.css(a)},e.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},e.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},e}),u.define("select2/dropdown/minimumResultsForSearch",[],function(){function e(e,t,n,s){this.minimumResultsForSearch=n.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,n,s)}return e.prototype.showSearch=function(e,t){return!(function e(t){for(var n=0,s=0;s<t.length;s++){var i=t[s];i.children?n+=e(i.children):n++}return n}(t.data.results)<this.minimumResultsForSearch)&&e.call(this,t)},e}),u.define("select2/dropdown/selectOnClose",["../utils"],function(s){function e(){}return e.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("close",function(e){s._handleSelectOnClose(e)})},e.prototype._handleSelectOnClose=function(e,t){if(t&&null!=t.originalSelect2Event){var n=t.originalSelect2Event;if("select"===n._type||"unselect"===n._type)return}n=this.getHighlightedResults();n.length<1||(null!=(n=s.GetData(n[0],"data")).element&&n.element.selected||null==n.element&&n.selected||this.trigger("select",{data:n}))},e}),u.define("select2/dropdown/closeOnSelect",[],function(){function e(){}return e.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("select",function(e){s._selectTriggered(e)}),t.on("unselect",function(e){s._selectTriggered(e)})},e.prototype._selectTriggered=function(e,t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey)||this.trigger("close",{originalEvent:n,originalSelect2Event:t})},e}),u.define("select2/dropdown/dropdownCss",["../utils"],function(n){function e(){}return e.prototype.render=function(e){var t=e.call(this),e=this.options.get("dropdownCssClass")||"";return-1!==e.indexOf(":all:")&&(e=e.replace(":all:",""),n.copyNonInternalCssClasses(t[0],this.$element[0])),t.addClass(e),t},e}),u.define("select2/dropdown/tagsSearchHighlight",["../utils"],function(s){function e(){}return e.prototype.highlightFirstItem=function(e){var t=this.$results.find(".select2-results__option--selectable:not(.select2-results__option--selected)");if(0<t.length){var n=t.first(),t=s.GetData(n[0],"data").element;if(t&&t.getAttribute&&"true"===t.getAttribute("data-select2-tag"))return void n.trigger("mouseenter")}e.call(this)},e}),u.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var t=e.input.length-e.maximum,e="Please delete "+t+" character";return 1!=t&&(e+="s"),e},inputTooShort:function(e){return"Please enter "+(e.minimum-e.input.length)+" or more characters"},loadingMore:function(){return"Loading more resultsâ€¦"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searchingâ€¦"},removeAllItems:function(){return"Remove all items"},removeItem:function(){return"Remove item"},search:function(){return"Search"}}}),u.define("select2/defaults",["jquery","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/selectionCss","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./dropdown/dropdownCss","./dropdown/tagsSearchHighlight","./i18n/en"],function(l,r,o,a,c,u,d,p,h,f,g,t,m,y,v,_,b,$,w,x,A,D,S,E,O,C,L,T,q,I,e){function n(){this.reset()}return n.prototype.apply=function(e){var t;null==(e=l.extend(!0,{},this.defaults,e)).dataAdapter&&(null!=e.ajax?e.dataAdapter=v:null!=e.data?e.dataAdapter=y:e.dataAdapter=m,0<e.minimumInputLength&&(e.dataAdapter=f.Decorate(e.dataAdapter,$)),0<e.maximumInputLength&&(e.dataAdapter=f.Decorate(e.dataAdapter,w)),0<e.maximumSelectionLength&&(e.dataAdapter=f.Decorate(e.dataAdapter,x)),e.tags&&(e.dataAdapter=f.Decorate(e.dataAdapter,_)),null==e.tokenSeparators&&null==e.tokenizer||(e.dataAdapter=f.Decorate(e.dataAdapter,b))),null==e.resultsAdapter&&(e.resultsAdapter=r,null!=e.ajax&&(e.resultsAdapter=f.Decorate(e.resultsAdapter,E)),null!=e.placeholder&&(e.resultsAdapter=f.Decorate(e.resultsAdapter,S)),e.selectOnClose&&(e.resultsAdapter=f.Decorate(e.resultsAdapter,L)),e.tags&&(e.resultsAdapter=f.Decorate(e.resultsAdapter,I))),null==e.dropdownAdapter&&(e.multiple?e.dropdownAdapter=A:(t=f.Decorate(A,D),e.dropdownAdapter=t),0!==e.minimumResultsForSearch&&(e.dropdownAdapter=f.Decorate(e.dropdownAdapter,C)),e.closeOnSelect&&(e.dropdownAdapter=f.Decorate(e.dropdownAdapter,T)),null!=e.dropdownCssClass&&(e.dropdownAdapter=f.Decorate(e.dropdownAdapter,q)),e.dropdownAdapter=f.Decorate(e.dropdownAdapter,O)),null==e.selectionAdapter&&(e.multiple?e.selectionAdapter=a:e.selectionAdapter=o,null!=e.placeholder&&(e.selectionAdapter=f.Decorate(e.selectionAdapter,c)),e.allowClear&&(e.selectionAdapter=f.Decorate(e.selectionAdapter,u)),e.multiple&&(e.selectionAdapter=f.Decorate(e.selectionAdapter,d)),null!=e.selectionCssClass&&(e.selectionAdapter=f.Decorate(e.selectionAdapter,p)),e.selectionAdapter=f.Decorate(e.selectionAdapter,h)),e.language=this._resolveLanguage(e.language),e.language.push("en");for(var n=[],s=0;s<e.language.length;s++){var i=e.language[s];-1===n.indexOf(i)&&n.push(i)}return e.language=n,e.translations=this._processTranslations(e.language,e.debug),e},n.prototype.reset=function(){function a(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return t[e]||e})}this.defaults={amdLanguageBase:"./i18n/",autocomplete:"off",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:f.escapeMarkup,language:{},matcher:function e(t,n){if(null==t.term||""===t.term.trim())return n;if(n.children&&0<n.children.length){for(var s=l.extend(!0,{},n),i=n.children.length-1;0<=i;i--)null==e(t,n.children[i])&&s.children.splice(i,1);return 0<s.children.length?s:e(t,s)}var r=a(n.text).toUpperCase(),o=a(t.term).toUpperCase();return-1<r.indexOf(o)?n:null},minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,scrollAfterSelect:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},n.prototype.applyFromElement=function(e,t){var n=e.language,s=this.defaults.language,i=t.prop("lang"),t=t.closest("[lang]").prop("lang"),t=Array.prototype.concat.call(this._resolveLanguage(i),this._resolveLanguage(n),this._resolveLanguage(s),this._resolveLanguage(t));return e.language=t,e},n.prototype._resolveLanguage=function(e){if(!e)return[];if(l.isEmptyObject(e))return[];if(l.isPlainObject(e))return[e];for(var t,n=Array.isArray(e)?e:[e],s=[],i=0;i<n.length;i++)s.push(n[i]),"string"==typeof n[i]&&0<n[i].indexOf("-")&&(t=n[i].split("-")[0],s.push(t));return s},n.prototype._processTranslations=function(e,t){for(var n=new g,s=0;s<e.length;s++){var i=new g,r=e[s];if("string"==typeof r)try{i=g.loadPath(r)}catch(e){try{r=this.defaults.amdLanguageBase+r,i=g.loadPath(r)}catch(e){t&&window.console&&console.warn&&console.warn('Select2: The language file for "'+r+'" could not be automatically loaded. A fallback will be used instead.')}}else i=l.isPlainObject(r)?new g(r):r;n.extend(i)}return n},n.prototype.set=function(e,t){var n={};n[l.camelCase(e)]=t;n=f._convertData(n);l.extend(!0,this.defaults,n)},new n}),u.define("select2/options",["jquery","./defaults","./utils"],function(c,n,u){function e(e,t){this.options=e,null!=t&&this.fromElement(t),null!=t&&(this.options=n.applyFromElement(this.options,t)),this.options=n.apply(this.options)}return e.prototype.fromElement=function(e){var t=["select2"];null==this.options.multiple&&(this.options.multiple=e.prop("multiple")),null==this.options.disabled&&(this.options.disabled=e.prop("disabled")),null==this.options.autocomplete&&e.prop("autocomplete")&&(this.options.autocomplete=e.prop("autocomplete")),null==this.options.dir&&(e.prop("dir")?this.options.dir=e.prop("dir"):e.closest("[dir]").prop("dir")?this.options.dir=e.closest("[dir]").prop("dir"):this.options.dir="ltr"),e.prop("disabled",this.options.disabled),e.prop("multiple",this.options.multiple),u.GetData(e[0],"select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),u.StoreData(e[0],"data",u.GetData(e[0],"select2Tags")),u.StoreData(e[0],"tags",!0)),u.GetData(e[0],"ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),e.attr("ajax--url",u.GetData(e[0],"ajaxUrl")),u.StoreData(e[0],"ajax-Url",u.GetData(e[0],"ajaxUrl")));var n={};function s(e,t){return t.toUpperCase()}for(var i=0;i<e[0].attributes.length;i++){var r=e[0].attributes[i].name,o="data-";r.substr(0,o.length)==o&&(r=r.substring(o.length),o=u.GetData(e[0],r),n[r.replace(/-([a-z])/g,s)]=o)}c.fn.jquery&&"1."==c.fn.jquery.substr(0,2)&&e[0].dataset&&(n=c.extend(!0,{},e[0].dataset,n));var a,l=c.extend(!0,{},u.GetData(e[0]),n);for(a in l=u._convertData(l))-1<t.indexOf(a)||(c.isPlainObject(this.options[a])?c.extend(this.options[a],l[a]):this.options[a]=l[a]);return this},e.prototype.get=function(e){return this.options[e]},e.prototype.set=function(e,t){this.options[e]=t},e}),u.define("select2/core",["jquery","./options","./utils","./keys"],function(t,i,r,s){var o=function(e,t){null!=r.GetData(e[0],"select2")&&r.GetData(e[0],"select2").destroy(),this.$element=e,this.id=this._generateId(e),t=t||{},this.options=new i(t,e),o.__super__.constructor.call(this);var n=e.attr("tabindex")||0;r.StoreData(e[0],"old-tabindex",n),e.attr("tabindex","-1");t=this.options.get("dataAdapter");this.dataAdapter=new t(e,this.options);n=this.render();this._placeContainer(n);t=this.options.get("selectionAdapter");this.selection=new t(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,n);t=this.options.get("dropdownAdapter");this.dropdown=new t(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,n);n=this.options.get("resultsAdapter");this.results=new n(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var s=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(e){s.trigger("selection:update",{data:e})}),e[0].classList.add("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),r.StoreData(e[0],"select2",this),e.data("select2",this)};return r.Extend(o,r.Observable),o.prototype._generateId=function(e){return"select2-"+(null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+r.generateChars(2):r.generateChars(4)).replace(/(:|\.|\[|\]|,)/g,"")},o.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},o.prototype._resolveWidth=function(e,t){var n=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var s=this._resolveWidth(e,"style");return null!=s?s:this._resolveWidth(e,"element")}if("element"==t){s=e.outerWidth(!1);return s<=0?"auto":s+"px"}if("style"!=t)return"computedstyle"!=t?t:window.getComputedStyle(e[0]).width;e=e.attr("style");if("string"!=typeof e)return null;for(var i=e.split(";"),r=0,o=i.length;r<o;r+=1){var a=i[r].replace(/\s/g,"").match(n);if(null!==a&&1<=a.length)return a[1]}return null},o.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},o.prototype._registerDomEvents=function(){var t=this;this.$element.on("change.select2",function(){t.dataAdapter.current(function(e){t.trigger("selection:update",{data:e})})}),this.$element.on("focus.select2",function(e){t.trigger("focus",e)}),this._syncA=r.bind(this._syncAttributes,this),this._syncS=r.bind(this._syncSubtree,this),this._observer=new window.MutationObserver(function(e){t._syncA(),t._syncS(e)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})},o.prototype._registerDataEvents=function(){var n=this;this.dataAdapter.on("*",function(e,t){n.trigger(e,t)})},o.prototype._registerSelectionEvents=function(){var n=this,s=["toggle","focus"];this.selection.on("toggle",function(){n.toggleDropdown()}),this.selection.on("focus",function(e){n.focus(e)}),this.selection.on("*",function(e,t){-1===s.indexOf(e)&&n.trigger(e,t)})},o.prototype._registerDropdownEvents=function(){var n=this;this.dropdown.on("*",function(e,t){n.trigger(e,t)})},o.prototype._registerResultsEvents=function(){var n=this;this.results.on("*",function(e,t){n.trigger(e,t)})},o.prototype._registerEvents=function(){var n=this;this.on("open",function(){n.$container[0].classList.add("select2-container--open")}),this.on("close",function(){n.$container[0].classList.remove("select2-container--open")}),this.on("enable",function(){n.$container[0].classList.remove("select2-container--disabled")}),this.on("disable",function(){n.$container[0].classList.add("select2-container--disabled")}),this.on("blur",function(){n.$container[0].classList.remove("select2-container--focus")}),this.on("query",function(t){n.isOpen()||n.trigger("open",{}),this.dataAdapter.query(t,function(e){n.trigger("results:all",{data:e,query:t})})}),this.on("query:append",function(t){this.dataAdapter.query(t,function(e){n.trigger("results:append",{data:e,query:t})})}),this.on("keypress",function(e){var t=e.which;n.isOpen()?t===s.ESC||t===s.UP&&e.altKey?(n.close(e),e.preventDefault()):t===s.ENTER||t===s.TAB?(n.trigger("results:select",{}),e.preventDefault()):t===s.SPACE&&e.ctrlKey?(n.trigger("results:toggle",{}),e.preventDefault()):t===s.UP?(n.trigger("results:previous",{}),e.preventDefault()):t===s.DOWN&&(n.trigger("results:next",{}),e.preventDefault()):(t===s.ENTER||t===s.SPACE||t===s.DOWN&&e.altKey)&&(n.open(),e.preventDefault())})},o.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.isDisabled()?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},o.prototype._isChangeMutation=function(e){var t=this;if(e.addedNodes&&0<e.addedNodes.length){for(var n=0;n<e.addedNodes.length;n++)if(e.addedNodes[n].selected)return!0}else{if(e.removedNodes&&0<e.removedNodes.length)return!0;if(Array.isArray(e))return e.some(function(e){return t._isChangeMutation(e)})}return!1},o.prototype._syncSubtree=function(e){var e=this._isChangeMutation(e),t=this;e&&this.dataAdapter.current(function(e){t.trigger("selection:update",{data:e})})},o.prototype.trigger=function(e,t){var n=o.__super__.trigger,s={open:"opening",close:"closing",select:"selecting",unselect:"unselecting",clear:"clearing"};if(void 0===t&&(t={}),e in s){var i=s[e],s={prevented:!1,name:e,args:t};if(n.call(this,i,s),s.prevented)return void(t.prevented=!0)}n.call(this,e,t)},o.prototype.toggleDropdown=function(){this.isDisabled()||(this.isOpen()?this.close():this.open())},o.prototype.open=function(){this.isOpen()||this.isDisabled()||this.trigger("query",{})},o.prototype.close=function(e){this.isOpen()&&this.trigger("close",{originalEvent:e})},o.prototype.isEnabled=function(){return!this.isDisabled()},o.prototype.isDisabled=function(){return this.options.get("disabled")},o.prototype.isOpen=function(){return this.$container[0].classList.contains("select2-container--open")},o.prototype.hasFocus=function(){return this.$container[0].classList.contains("select2-container--focus")},o.prototype.focus=function(e){this.hasFocus()||(this.$container[0].classList.add("select2-container--focus"),this.trigger("focus",{}))},o.prototype.enable=function(e){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.');e=!(e=null==e||0===e.length?[!0]:e)[0];this.$element.prop("disabled",e)},o.prototype.data=function(){this.options.get("debug")&&0<arguments.length&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var t=[];return this.dataAdapter.current(function(e){t=e}),t},o.prototype.val=function(e){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==e||0===e.length)return this.$element.val();e=e[0];Array.isArray(e)&&(e=e.map(function(e){return e.toString()})),this.$element.val(e).trigger("input").trigger("change")},o.prototype.destroy=function(){r.RemoveData(this.$container[0]),this.$container.remove(),this._observer.disconnect(),this._observer=null,this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",r.GetData(this.$element[0],"old-tabindex")),this.$element[0].classList.remove("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),r.RemoveData(this.$element[0]),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},o.prototype.render=function(){var e=t('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return e.attr("dir",this.options.get("dir")),this.$container=e,this.$container[0].classList.add("select2-container--"+this.options.get("theme")),r.StoreData(e[0],"element",this.$element),e},o}),u.define("jquery-mousewheel",["jquery"],function(e){return e}),u.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults","./select2/utils"],function(i,e,r,t,o){var a;return null==i.fn.select2&&(a=["open","close","destroy"],i.fn.select2=function(t){if("object"==typeof(t=t||{}))return this.each(function(){var e=i.extend(!0,{},t);new r(i(this),e)}),this;if("string"!=typeof t)throw new Error("Invalid arguments for Select2: "+t);var n,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=o.GetData(this,"select2");null==e&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),n=e[t].apply(e,s)}),-1<a.indexOf(t)?this:n}),null==i.fn.select2.defaults&&(i.fn.select2.defaults=t),r}),{define:u.define,require:u.require});function b(e,t){return i.call(e,t)}function l(e,t){var n,s,i,r,o,a,l,c,u,d,p=t&&t.split("/"),h=y.map,f=h&&h["*"]||{};if(e){for(t=(e=e.split("/")).length-1,y.nodeIdCompat&&_.test(e[t])&&(e[t]=e[t].replace(_,"")),"."===e[0].charAt(0)&&p&&(e=p.slice(0,p.length-1).concat(e)),c=0;c<e.length;c++)"."===(d=e[c])?(e.splice(c,1),--c):".."===d&&(0===c||1===c&&".."===e[2]||".."===e[c-1]||0<c&&(e.splice(c-1,2),c-=2));e=e.join("/")}if((p||f)&&h){for(c=(n=e.split("/")).length;0<c;--c){if(s=n.slice(0,c).join("/"),p)for(u=p.length;0<u;--u)if(i=h[p.slice(0,u).join("/")],i=i&&i[s]){r=i,o=c;break}if(r)break;!a&&f&&f[s]&&(a=f[s],l=c)}!r&&a&&(r=a,o=l),r&&(n.splice(0,o,r),e=n.join("/"))}return e}function w(t,n){return function(){var e=a.call(arguments,0);return"string"!=typeof e[0]&&1===e.length&&e.push(null),o.apply(p,e.concat([t,n]))}}function x(e){var t;if(b(m,e)&&(t=m[e],delete m[e],v[e]=!0,r.apply(p,t)),!b(g,e)&&!b(v,e))throw new Error("No "+e);return g[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function A(e){return e?c(e):[]}var u=s.require("jquery.select2");return t.fn.select2.amd=s,u});!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(j(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace"),d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=a.console&&(a.console.warn||a.console.log);return f&&f.call(a.console,e,d),b.apply(this,arguments)}}function i(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&la(d,c)}function j(a,b){return function(){return a.apply(b,arguments)}}function k(a,b){return typeof a==oa?a.apply(b?b[0]||d:d,b):a}function l(a,b){return a===d?b:a}function m(a,b,c){g(q(b),function(b){a.addEventListener(b,c,!1)})}function n(a,b,c){g(q(b),function(b){a.removeEventListener(b,c,!1)})}function o(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a,b){return a.indexOf(b)>-1}function q(a){return a.trim().split(/\s+/g)}function r(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function s(a){return Array.prototype.slice.call(a,0)}function t(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];r(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function u(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ma.length;){if(c=ma[g],e=c?c+f:b,e in a)return e;g++}return d}function v(){return ua++}function w(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}function x(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){k(a.options.enable,[a])&&c.handler(b)},this.init()}function y(a){var b,c=a.options.inputClass;return new(b=c?c:xa?M:ya?P:wa?R:L)(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Ea&&d-e===0,g=b&(Ga|Ha)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=ra(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY);var j=F(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=qa(j.x)>qa(j.y)?j.x:j.y,b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,C(c,b);var k=a.element;o(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Ea&&f.eventType!==Ga||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ha&&(i>Da||h.velocity===d)){var j=b.deltaX-h.deltaX,k=b.deltaY-h.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=qa(l.x)>qa(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:pa(a.pointers[c].clientX),clientY:pa(a.pointers[c].clientY)},c++;return{timeStamp:ra(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:pa(a[0].clientX),y:pa(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:pa(c/b),y:pa(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?Ia:qa(a)>=qa(b)?0>a?Ja:Ka:0>b?La:Ma}function H(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Ra)+I(a[1],a[0],Ra)}function K(a,b){return H(b[0],b[1],Ra)/H(a[0],a[1],Ra)}function L(){this.evEl=Ta,this.evWin=Ua,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Xa,this.evWin=Ya,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=$a,this.evWin=_a,this.started=!1,x.apply(this,arguments)}function O(a,b){var c=s(a.touches),d=s(a.changedTouches);return b&(Ga|Ha)&&(c=t(c.concat(d),"identifier",!0)),[c,d]}function P(){this.evTarget=bb,this.targetIds={},x.apply(this,arguments)}function Q(a,b){var c=s(a.touches),d=this.targetIds;if(b&(Ea|Fa)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=s(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return o(a.target,i)}),b===Ea)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ga|Ha)&&delete d[g[e].identifier],e++;return h.length?[t(f.concat(h),"identifier",!0),h]:void 0}function R(){x.apply(this,arguments);var a=j(this.handler,this);this.touch=new P(this.manager,a),this.mouse=new L(this.manager,a),this.primaryTouch=null,this.lastTouches=[]}function S(a,b){a&Ea?(this.primaryTouch=b.changedPointers[0].identifier,T.call(this,b)):a&(Ga|Ha)&&T.call(this,b)}function T(a){var b=a.changedPointers[0];if(b.identifier===this.primaryTouch){var c={x:b.clientX,y:b.clientY};this.lastTouches.push(c);var d=this.lastTouches,e=function(){var a=d.indexOf(c);a>-1&&d.splice(a,1)};setTimeout(e,cb)}}function U(a){for(var b=a.srcEvent.clientX,c=a.srcEvent.clientY,d=0;d<this.lastTouches.length;d++){var e=this.lastTouches[d],f=Math.abs(b-e.x),g=Math.abs(c-e.y);if(db>=f&&db>=g)return!0}return!1}function V(a,b){this.manager=a,this.set(b)}function W(a){if(p(a,jb))return jb;var b=p(a,kb),c=p(a,lb);return b&&c?jb:b||c?b?kb:lb:p(a,ib)?ib:hb}function X(){if(!fb)return!1;var b={},c=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(d){b[d]=c?a.CSS.supports("touch-action",d):!0}),b}function Y(a){this.options=la({},this.defaults,a||{}),this.id=v(),this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=nb,this.simultaneous={},this.requireFail=[]}function Z(a){return a&sb?"cancel":a&qb?"end":a&pb?"move":a&ob?"start":""}function $(a){return a==Ma?"down":a==La?"up":a==Ja?"left":a==Ka?"right":""}function _(a,b){var c=b.manager;return c?c.get(a):a}function aa(){Y.apply(this,arguments)}function ba(){aa.apply(this,arguments),this.pX=null,this.pY=null}function ca(){aa.apply(this,arguments)}function da(){Y.apply(this,arguments),this._timer=null,this._input=null}function ea(){aa.apply(this,arguments)}function fa(){aa.apply(this,arguments)}function ga(){Y.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ha(a,b){return b=b||{},b.recognizers=l(b.recognizers,ha.defaults.preset),new ia(a,b)}function ia(a,b){this.options=la({},ha.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=a,this.input=y(this),this.touchAction=new V(this,this.options.touchAction),ja(this,!0),g(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ja(a,b){var c=a.element;if(c.style){var d;g(a.options.cssProps,function(e,f){d=u(c.style,f),b?(a.oldCssProps[d]=c.style[d],c.style[d]=e):c.style[d]=a.oldCssProps[d]||""}),b||(a.oldCssProps={})}}function ka(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var la,ma=["","webkit","Moz","MS","ms","o"],na=b.createElement("div"),oa="function",pa=Math.round,qa=Math.abs,ra=Date.now;la="function"!=typeof Object.assign?function(a){if(a===d||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(e!==d&&null!==e)for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}return b}:Object.assign;var sa=h(function(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a},"extend","Use `assign`."),ta=h(function(a,b){return sa(a,b,!0)},"merge","Use `assign`."),ua=1,va=/mobile|tablet|ip(ad|hone|od)|android/i,wa="ontouchstart"in a,xa=u(a,"PointerEvent")!==d,ya=wa&&va.test(navigator.userAgent),za="touch",Aa="pen",Ba="mouse",Ca="kinect",Da=25,Ea=1,Fa=2,Ga=4,Ha=8,Ia=1,Ja=2,Ka=4,La=8,Ma=16,Na=Ja|Ka,Oa=La|Ma,Pa=Na|Oa,Qa=["x","y"],Ra=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(w(this.element),this.evWin,this.domHandler)}};var Sa={mousedown:Ea,mousemove:Fa,mouseup:Ga},Ta="mousedown",Ua="mousemove mouseup";i(L,x,{handler:function(a){var b=Sa[a.type];b&Ea&&0===a.button&&(this.pressed=!0),b&Fa&&1!==a.which&&(b=Ga),this.pressed&&(b&Ga&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:Ba,srcEvent:a}))}});var Va={pointerdown:Ea,pointermove:Fa,pointerup:Ga,pointercancel:Ha,pointerout:Ha},Wa={2:za,3:Aa,4:Ba,5:Ca},Xa="pointerdown",Ya="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(Xa="MSPointerDown",Ya="MSPointerMove MSPointerUp MSPointerCancel"),i(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Va[d],f=Wa[a.pointerType]||a.pointerType,g=f==za,h=r(b,a.pointerId,"pointerId");e&Ea&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Ga|Ha)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Za={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},$a="touchstart",_a="touchstart touchmove touchend touchcancel";i(N,x,{handler:function(a){var b=Za[a.type];if(b===Ea&&(this.started=!0),this.started){var c=O.call(this,a,b);b&(Ga|Ha)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}}});var ab={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},bb="touchstart touchmove touchend touchcancel";i(P,x,{handler:function(a){var b=ab[a.type],c=Q.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}});var cb=2500,db=25;i(R,x,{handler:function(a,b,c){var d=c.pointerType==za,e=c.pointerType==Ba;if(!(e&&c.sourceCapabilities&&c.sourceCapabilities.firesTouchEvents)){if(d)S.call(this,b,c);else if(e&&U.call(this,c))return;this.callback(a,b,c)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var eb=u(na.style,"touchAction"),fb=eb!==d,gb="compute",hb="auto",ib="manipulation",jb="none",kb="pan-x",lb="pan-y",mb=X();V.prototype={set:function(a){a==gb&&(a=this.compute()),fb&&this.manager.element.style&&mb[a]&&(this.manager.element.style[eb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){k(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),W(a.join(" "))},preventDefaults:function(a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=p(d,jb)&&!mb[jb],f=p(d,lb)&&!mb[lb],g=p(d,kb)&&!mb[kb];if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}return g&&f?void 0:e||f&&c&Na||g&&c&Oa?this.preventSrc(b):void 0},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var nb=1,ob=2,pb=4,qb=8,rb=qb,sb=16,tb=32;Y.prototype={defaults:{},set:function(a){return la(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=_(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=_(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=_(a,this),-1===r(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=_(a,this);var b=r(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;qb>d&&b(c.options.event+Z(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=qb&&b(c.options.event+Z(d))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=tb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(tb|nb)))return!1;a++}return!0},recognize:function(a){var b=la({},a);return k(this.options.enable,[this,b])?(this.state&(rb|sb|tb)&&(this.state=nb),this.state=this.process(b),void(this.state&(ob|pb|qb|sb)&&this.tryEmit(b))):(this.reset(),void(this.state=tb))},process:function(a){},getTouchAction:function(){},reset:function(){}},i(aa,Y,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(ob|pb),e=this.attrTest(a);return d&&(c&Ha||!e)?b|sb:d||e?c&Ga?b|qb:b&ob?b|pb:ob:tb}}),i(ba,aa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Pa},getTouchAction:function(){var a=this.options.direction,b=[];return a&Na&&b.push(lb),a&Oa&&b.push(kb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Na?(e=0===f?Ia:0>f?Ja:Ka,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ia:0>g?La:Ma,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return aa.prototype.attrTest.call(this,a)&&(this.state&ob||!(this.state&ob)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=$(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),i(ca,aa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&ob)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),i(da,Y,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[hb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ga|Ha)&&!f)this.reset();else if(a.eventType&Ea)this.reset(),this._timer=e(function(){this.state=rb,this.tryEmit()},b.time,this);else if(a.eventType&Ga)return rb;return tb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===rb&&(a&&a.eventType&Ga?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=ra(),this.manager.emit(this.options.event,this._input)))}}),i(ea,aa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&ob)}}),i(fa,aa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Na|Oa,pointers:1},getTouchAction:function(){return ba.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Na|Oa)?b=a.overallVelocity:c&Na?b=a.overallVelocityX:c&Oa&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&qa(b)>this.options.velocity&&a.eventType&Ga},emit:function(a){var b=$(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),i(ga,Y,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ib]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&Ea&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ga)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=rb,this.tryEmit()},b.interval,this),ob):rb}return tb},failTimeout:function(){return this._timer=e(function(){this.state=tb},this.options.interval,this),tb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==rb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ha.VERSION="2.0.7",ha.defaults={domEvents:!1,touchAction:gb,enable:!0,inputTarget:null,inputClass:null,preset:[[ea,{enable:!1}],[ca,{enable:!1},["rotate"]],[fa,{direction:Na}],[ba,{direction:Na},["swipe"]],[ga],[ga,{event:"doubletap",taps:2},["tap"]],[da]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ub=1,vb=2;ia.prototype={set:function(a){return la(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?vb:ub},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&rb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===vb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(ob|pb|qb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof Y)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=r(b,a);-1!==c&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){if(a!==d&&b!==d){var c=this.handlers;return g(q(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this}},off:function(a,b){if(a!==d){var c=this.handlers;return g(q(a),function(a){b?c[a]&&c[a].splice(r(c[a],b),1):delete c[a]}),this}},emit:function(a,b){this.options.domEvents&&ka(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ja(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},la(ha,{INPUT_START:Ea,INPUT_MOVE:Fa,INPUT_END:Ga,INPUT_CANCEL:Ha,STATE_POSSIBLE:nb,STATE_BEGAN:ob,STATE_CHANGED:pb,STATE_ENDED:qb,STATE_RECOGNIZED:rb,STATE_CANCELLED:sb,STATE_FAILED:tb,DIRECTION_NONE:Ia,DIRECTION_LEFT:Ja,DIRECTION_RIGHT:Ka,DIRECTION_UP:La,DIRECTION_DOWN:Ma,DIRECTION_HORIZONTAL:Na,DIRECTION_VERTICAL:Oa,DIRECTION_ALL:Pa,Manager:ia,Input:x,TouchAction:V,TouchInput:P,MouseInput:L,PointerEventInput:M,TouchMouseInput:R,SingleTouchInput:N,Recognizer:Y,AttrRecognizer:aa,Tap:ga,Pan:ba,Swipe:fa,Pinch:ca,Rotate:ea,Press:da,on:m,off:n,each:g,merge:ta,extend:sa,assign:la,inherit:i,bindFn:j,prefixed:u});var wb="undefined"!=typeof a?a:"undefined"!=typeof self?self:{};wb.Hammer=ha,"function"==typeof define&&define.amd?define(function(){return ha}):"undefined"!=typeof module&&module.exports?module.exports=ha:a[c]=ha}(window,document,"Hammer");!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.Handlebars=b():a.Handlebars=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(){var a=r();return a.compile=function(b,c){return k.compile(b,c,a)},a.precompile=function(b,c){return k.precompile(b,c,a)},a.AST=i["default"],a.Compiler=k.Compiler,a.JavaScriptCompiler=m["default"],a.Parser=j.parser,a.parse=j.parse,a.parseWithoutProcessing=j.parseWithoutProcessing,a}var e=c(1)["default"];b.__esModule=!0;var f=c(2),g=e(f),h=c(45),i=e(h),j=c(46),k=c(51),l=c(52),m=e(l),n=c(49),o=e(n),p=c(44),q=e(p),r=g["default"].create,s=d();s.create=d,q["default"](s),s.Visitor=o["default"],s["default"]=s,b["default"]=s,a.exports=b["default"]},function(a,b){"use strict";b["default"]=function(a){return a&&a.__esModule?a:{default:a}},b.__esModule=!0},function(a,b,c){"use strict";function d(){var a=new h.HandlebarsEnvironment;return n.extend(a,h),a.SafeString=j["default"],a.Exception=l["default"],a.Utils=n,a.escapeExpression=n.escapeExpression,a.VM=p,a.template=function(b){return p.template(b,a)},a}var e=c(3)["default"],f=c(1)["default"];b.__esModule=!0;var g=c(4),h=e(g),i=c(37),j=f(i),k=c(6),l=f(k),m=c(5),n=e(m),o=c(38),p=e(o),q=c(44),r=f(q),s=d();s.create=d,r["default"](s),s["default"]=s,b["default"]=s,a.exports=b["default"]},function(a,b){"use strict";b["default"]=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b},b.__esModule=!0},function(a,b,c){"use strict";function d(a,b,c){this.helpers=a||{},this.partials=b||{},this.decorators=c||{},i.registerDefaultHelpers(this),j.registerDefaultDecorators(this)}var e=c(1)["default"];b.__esModule=!0,b.HandlebarsEnvironment=d;var f=c(5),g=c(6),h=e(g),i=c(10),j=c(30),k=c(32),l=e(k),m=c(33),n="4.7.7";b.VERSION=n;var o=8;b.COMPILER_REVISION=o;var p=7;b.LAST_COMPATIBLE_COMPILER_REVISION=p;var q={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};b.REVISION_CHANGES=q;var r="[object Object]";d.prototype={constructor:d,logger:l["default"],log:l["default"].log,registerHelper:function(a,b){if(f.toString.call(a)===r){if(b)throw new h["default"]("Arg not supported with multiple helpers");f.extend(this.helpers,a)}else this.helpers[a]=b},unregisterHelper:function(a){delete this.helpers[a]},registerPartial:function(a,b){if(f.toString.call(a)===r)f.extend(this.partials,a);else{if("undefined"==typeof b)throw new h["default"]('Attempting to register a partial called "'+a+'" as undefined');this.partials[a]=b}},unregisterPartial:function(a){delete this.partials[a]},registerDecorator:function(a,b){if(f.toString.call(a)===r){if(b)throw new h["default"]("Arg not supported with multiple decorators");f.extend(this.decorators,a)}else this.decorators[a]=b},unregisterDecorator:function(a){delete this.decorators[a]},resetLoggedPropertyAccesses:function(){m.resetLoggedProperties()}};var s=l["default"].log;b.log=s,b.createFrame=f.createFrame,b.logger=l["default"]},function(a,b){"use strict";function c(a){return k[a]}function d(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],c)&&(a[c]=arguments[b][c]);return a}function e(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}function f(a){if("string"!=typeof a){if(a&&a.toHTML)return a.toHTML();if(null==a)return"";if(!a)return a+"";a=""+a}return m.test(a)?a.replace(l,c):a}function g(a){return!a&&0!==a||!(!p(a)||0!==a.length)}function h(a){var b=d({},a);return b._parent=a,b}function i(a,b){return a.path=b,a}function j(a,b){return(a?a+".":"")+b}b.__esModule=!0,b.extend=d,b.indexOf=e,b.escapeExpression=f,b.isEmpty=g,b.createFrame=h,b.blockParams=i,b.appendContextPath=j;var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},l=/[&<>"'`=]/g,m=/[&<>"'`=]/,n=Object.prototype.toString;b.toString=n;var o=function(a){return"function"==typeof a};o(/x/)&&(b.isFunction=o=function(a){return"function"==typeof a&&"[object Function]"===n.call(a)}),b.isFunction=o;var p=Array.isArray||function(a){return!(!a||"object"!=typeof a)&&"[object Array]"===n.call(a)};b.isArray=p},function(a,b,c){"use strict";function d(a,b){var c=b&&b.loc,g=void 0,h=void 0,i=void 0,j=void 0;c&&(g=c.start.line,h=c.end.line,i=c.start.column,j=c.end.column,a+=" - "+g+":"+i);for(var k=Error.prototype.constructor.call(this,a),l=0;l<f.length;l++)this[f[l]]=k[f[l]];Error.captureStackTrace&&Error.captureStackTrace(this,d);try{c&&(this.lineNumber=g,this.endLineNumber=h,e?(Object.defineProperty(this,"column",{value:i,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:j,enumerable:!0})):(this.column=i,this.endColumn=j))}catch(m){}}var e=c(7)["default"];b.__esModule=!0;var f=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];d.prototype=new Error,b["default"]=d,a.exports=b["default"]},function(a,b,c){a.exports={default:c(8),__esModule:!0}},function(a,b,c){var d=c(9);a.exports=function(a,b,c){return d.setDesc(a,b,c)}},function(a,b){var c=Object;a.exports={create:c.create,getProto:c.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:c.getOwnPropertyDescriptor,setDesc:c.defineProperty,setDescs:c.defineProperties,getKeys:c.keys,getNames:c.getOwnPropertyNames,getSymbols:c.getOwnPropertySymbols,each:[].forEach}},function(a,b,c){"use strict";function d(a){h["default"](a),j["default"](a),l["default"](a),n["default"](a),p["default"](a),r["default"](a),t["default"](a)}function e(a,b,c){a.helpers[b]&&(a.hooks[b]=a.helpers[b],c||delete a.helpers[b])}var f=c(1)["default"];b.__esModule=!0,b.registerDefaultHelpers=d,b.moveHelperToHooks=e;var g=c(11),h=f(g),i=c(12),j=f(i),k=c(25),l=f(k),m=c(26),n=f(m),o=c(27),p=f(o),q=c(28),r=f(q),s=c(29),t=f(s)},function(a,b,c){"use strict";b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerHelper("blockHelperMissing",function(b,c){var e=c.inverse,f=c.fn;if(b===!0)return f(this);if(b===!1||null==b)return e(this);if(d.isArray(b))return b.length>0?(c.ids&&(c.ids=[c.name]),a.helpers.each(b,c)):e(this);if(c.data&&c.ids){var g=d.createFrame(c.data);g.contextPath=d.appendContextPath(c.data.contextPath,c.name),c={data:g}}return f(b,c)})},a.exports=b["default"]},function(a,b,c){(function(d){"use strict";var e=c(13)["default"],f=c(1)["default"];b.__esModule=!0;var g=c(5),h=c(6),i=f(h);b["default"]=function(a){a.registerHelper("each",function(a,b){function c(b,c,d){l&&(l.key=b,l.index=c,l.first=0===c,l.last=!!d,m&&(l.contextPath=m+b)),k+=f(a[b],{data:l,blockParams:g.blockParams([a[b],b],[m+b,null])})}if(!b)throw new i["default"]("Must pass iterator to #each");var f=b.fn,h=b.inverse,j=0,k="",l=void 0,m=void 0;if(b.data&&b.ids&&(m=g.appendContextPath(b.data.contextPath,b.ids[0])+"."),g.isFunction(a)&&(a=a.call(this)),b.data&&(l=g.createFrame(b.data)),a&&"object"==typeof a)if(g.isArray(a))for(var n=a.length;j<n;j++)j in a&&c(j,j,j===a.length-1);else if(d.Symbol&&a[d.Symbol.iterator]){for(var o=[],p=a[d.Symbol.iterator](),q=p.next();!q.done;q=p.next())o.push(q.value);a=o;for(var n=a.length;j<n;j++)c(j,j,j===a.length-1)}else!function(){var b=void 0;e(a).forEach(function(a){void 0!==b&&c(b,j-1),b=a,j++}),void 0!==b&&c(b,j-1,!0)}();return 0===j&&(k=h(this)),k})},a.exports=b["default"]}).call(b,function(){return this}())},function(a,b,c){a.exports={default:c(14),__esModule:!0}},function(a,b,c){c(15),a.exports=c(21).Object.keys},function(a,b,c){var d=c(16);c(18)("keys",function(a){return function(b){return a(d(b))}})},function(a,b,c){var d=c(17);a.exports=function(a){return Object(d(a))}},function(a,b){a.exports=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a}},function(a,b,c){var d=c(19),e=c(21),f=c(24);a.exports=function(a,b){var c=(e.Object||{})[a]||Object[a],g={};g[a]=b(c),d(d.S+d.F*f(function(){c(1)}),"Object",g)}},function(a,b,c){var d=c(20),e=c(21),f=c(22),g="prototype",h=function(a,b,c){var i,j,k,l=a&h.F,m=a&h.G,n=a&h.S,o=a&h.P,p=a&h.B,q=a&h.W,r=m?e:e[b]||(e[b]={}),s=m?d:n?d[b]:(d[b]||{})[g];m&&(c=b);for(i in c)j=!l&&s&&i in s,j&&i in r||(k=j?s[i]:c[i],r[i]=m&&"function"!=typeof s[i]?c[i]:p&&j?f(k,d):q&&s[i]==k?function(a){var b=function(b){return this instanceof a?new a(b):a(b)};return b[g]=a[g],b}(k):o&&"function"==typeof k?f(Function.call,k):k,o&&((r[g]||(r[g]={}))[i]=k))};h.F=1,h.G=2,h.S=4,h.P=8,h.B=16,h.W=32,a.exports=h},function(a,b){var c=a.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=c)},function(a,b){var c=a.exports={version:"1.2.6"};"number"==typeof __e&&(__e=c)},function(a,b,c){var d=c(23);a.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},function(a,b){a.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},function(a,b){a.exports=function(a){try{return!!a()}catch(b){return!0}}},function(a,b,c){"use strict";var d=c(1)["default"];b.__esModule=!0;var e=c(6),f=d(e);b["default"]=function(a){a.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new f["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')})},a.exports=b["default"]},function(a,b,c){"use strict";var d=c(1)["default"];b.__esModule=!0;var e=c(5),f=c(6),g=d(f);b["default"]=function(a){a.registerHelper("if",function(a,b){if(2!=arguments.length)throw new g["default"]("#if requires exactly one argument");return e.isFunction(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||e.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){if(2!=arguments.length)throw new g["default"]("#unless requires exactly one argument");return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})})},a.exports=b["default"]},function(a,b){"use strict";b.__esModule=!0,b["default"]=function(a){a.registerHelper("log",function(){for(var b=[void 0],c=arguments[arguments.length-1],d=0;d<arguments.length-1;d++)b.push(arguments[d]);var e=1;null!=c.hash.level?e=c.hash.level:c.data&&null!=c.data.level&&(e=c.data.level),b[0]=e,a.log.apply(a,b)})},a.exports=b["default"]},function(a,b){"use strict";b.__esModule=!0,b["default"]=function(a){a.registerHelper("lookup",function(a,b,c){return a?c.lookupProperty(a,b):a})},a.exports=b["default"]},function(a,b,c){"use strict";var d=c(1)["default"];b.__esModule=!0;var e=c(5),f=c(6),g=d(f);b["default"]=function(a){a.registerHelper("with",function(a,b){if(2!=arguments.length)throw new g["default"]("#with requires exactly one argument");e.isFunction(a)&&(a=a.call(this));var c=b.fn;if(e.isEmpty(a))return b.inverse(this);var d=b.data;return b.data&&b.ids&&(d=e.createFrame(b.data),d.contextPath=e.appendContextPath(b.data.contextPath,b.ids[0])),c(a,{data:d,blockParams:e.blockParams([a],[d&&d.contextPath])})})},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){g["default"](a)}var e=c(1)["default"];b.__esModule=!0,b.registerDefaultDecorators=d;var f=c(31),g=e(f)},function(a,b,c){"use strict";b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerDecorator("inline",function(a,b,c,e){var f=a;return b.partials||(b.partials={},f=function(e,f){var g=c.partials;c.partials=d.extend({},g,b.partials);var h=a(e,f);return c.partials=g,h}),b.partials[e.args[0]]=e.fn,f})},a.exports=b["default"]},function(a,b,c){"use strict";b.__esModule=!0;var d=c(5),e={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(a){if("string"==typeof a){var b=d.indexOf(e.methodMap,a.toLowerCase());a=b>=0?b:parseInt(a,10)}return a},log:function(a){if(a=e.lookupLevel(a),"undefined"!=typeof console&&e.lookupLevel(e.level)<=a){var b=e.methodMap[a];console[b]||(b="log");for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];console[b].apply(console,d)}}};b["default"]=e,a.exports=b["default"]},function(a,b,c){"use strict";function d(a){var b=i(null);b.constructor=!1,b.__defineGetter__=!1,b.__defineSetter__=!1,b.__lookupGetter__=!1;var c=i(null);return c.__proto__=!1,{properties:{whitelist:l.createNewLookupObject(c,a.allowedProtoProperties),defaultValue:a.allowProtoPropertiesByDefault},methods:{whitelist:l.createNewLookupObject(b,a.allowedProtoMethods),defaultValue:a.allowProtoMethodsByDefault}}}function e(a,b,c){return"function"==typeof a?f(b.methods,c):f(b.properties,c)}function f(a,b){return void 0!==a.whitelist[b]?a.whitelist[b]===!0:void 0!==a.defaultValue?a.defaultValue:(g(b),!1)}function g(a){o[a]!==!0&&(o[a]=!0,n.log("error",'Handlebars: Access has been denied to resolve the property "'+a+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}function h(){j(o).forEach(function(a){delete o[a]})}var i=c(34)["default"],j=c(13)["default"],k=c(3)["default"];b.__esModule=!0,b.createProtoAccessControl=d,b.resultIsAllowed=e,b.resetLoggedProperties=h;var l=c(36),m=c(32),n=k(m),o=i(null)},function(a,b,c){a.exports={default:c(35),__esModule:!0}},function(a,b,c){var d=c(9);a.exports=function(a,b){return d.create(a,b)}},function(a,b,c){"use strict";function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return f.extend.apply(void 0,[e(null)].concat(b))}var e=c(34)["default"];b.__esModule=!0,b.createNewLookupObject=d;var f=c(5)},function(a,b){"use strict";function c(a){this.string=a}b.__esModule=!0,c.prototype.toString=c.prototype.toHTML=function(){return""+this.string},b["default"]=c,a.exports=b["default"]},function(a,b,c){"use strict";function d(a){var b=a&&a[0]||1,c=v.COMPILER_REVISION;if(!(b>=v.LAST_COMPATIBLE_COMPILER_REVISION&&b<=v.COMPILER_REVISION)){if(b<v.LAST_COMPATIBLE_COMPILER_REVISION){var d=v.REVISION_CHANGES[c],e=v.REVISION_CHANGES[b];throw new u["default"]("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new u["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){function c(c,d,e){e.hash&&(d=s.extend({},d,e.hash),e.ids&&(e.ids[0]=!0)),c=b.VM.resolvePartial.call(this,c,d,e);var f=s.extend({},e,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),g=b.VM.invokePartial.call(this,c,d,f);if(null==g&&b.compile&&(e.partials[e.name]=b.compile(c,a.compilerOptions,b),g=e.partials[e.name](d,f)),null!=g){if(e.indent){for(var h=g.split("\n"),i=0,j=h.length;i<j&&(h[i]||i+1!==j);i++)h[i]=e.indent+h[i];g=h.join("\n")}return g}throw new u["default"]("The partial "+e.name+" could not be compiled when running in runtime-only mode")}function d(b){function c(b){return""+a.main(g,b,g.helpers,g.partials,f,i,h)}var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],f=e.data;d._setup(e),!e.partial&&a.useData&&(f=j(b,f));var h=void 0,i=a.useBlockParams?[]:void 0;return a.useDepths&&(h=e.depths?b!=e.depths[0]?[b].concat(e.depths):e.depths:[b]),(c=k(a.main,c,g,e.depths||[],f,i))(b,e)}if(!b)throw new u["default"]("No environment passed to template");if(!a||!a.main)throw new u["default"]("Unknown template object: "+typeof a);a.main.decorator=a.main_d,b.VM.checkRevision(a.compiler);var e=a.compiler&&7===a.compiler[0],g={strict:function(a,b,c){if(!(a&&b in a))throw new u["default"]('"'+b+'" not defined in '+a,{loc:c});return g.lookupProperty(a,b)},lookupProperty:function(a,b){var c=a[b];return null==c?c:Object.prototype.hasOwnProperty.call(a,b)?c:y.resultIsAllowed(c,g.protoAccessControl,b)?c:void 0},lookup:function(a,b){for(var c=a.length,d=0;d<c;d++){var e=a[d]&&g.lookupProperty(a[d],b);if(null!=e)return a[d][b]}},lambda:function(a,b){return"function"==typeof a?a.call(b):a},escapeExpression:s.escapeExpression,invokePartial:c,fn:function(b){var c=a[b];return c.decorator=a[b+"_d"],c},programs:[],program:function(a,b,c,d,e){var g=this.programs[a],h=this.fn(a);return b||e||d||c?g=f(this,a,h,b,c,d,e):g||(g=this.programs[a]=f(this,a,h)),g},data:function(a,b){for(;a&&b--;)a=a._parent;return a},mergeIfNeeded:function(a,b){var c=a||b;return a&&b&&a!==b&&(c=s.extend({},b,a)),c},nullContext:n({}),noop:b.VM.noop,compilerInfo:a.compiler};return d.isTop=!0,d._setup=function(c){if(c.partial)g.protoAccessControl=c.protoAccessControl,g.helpers=c.helpers,g.partials=c.partials,g.decorators=c.decorators,g.hooks=c.hooks;else{var d=s.extend({},b.helpers,c.helpers);l(d,g),g.helpers=d,a.usePartial&&(g.partials=g.mergeIfNeeded(c.partials,b.partials)),(a.usePartial||a.useDecorators)&&(g.decorators=s.extend({},b.decorators,c.decorators)),g.hooks={},g.protoAccessControl=y.createProtoAccessControl(c);var f=c.allowCallsToHelperMissing||e;w.moveHelperToHooks(g,"helperMissing",f),w.moveHelperToHooks(g,"blockHelperMissing",f)}},d._child=function(b,c,d,e){if(a.useBlockParams&&!d)throw new u["default"]("must pass block params");if(a.useDepths&&!e)throw new u["default"]("must pass parent depths");return f(g,b,a[b],c,0,d,e)},d}function f(a,b,c,d,e,f,g){function h(b){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],h=g;return!g||b==g[0]||b===a.nullContext&&null===g[0]||(h=[b].concat(g)),c(a,b,a.helpers,a.partials,e.data||d,f&&[e.blockParams].concat(f),h)}return h=k(c,h,a,g,d,f),h.program=b,h.depth=g?g.length:0,h.blockParams=e||0,h}function g(a,b,c){return a?a.call||c.name||(c.name=a,a=c.partials[a]):a="@partial-block"===c.name?c.data["partial-block"]:c.partials[c.name],a}function h(a,b,c){var d=c.data&&c.data["partial-block"];c.partial=!0,c.ids&&(c.data.contextPath=c.ids[0]||c.data.contextPath);var e=void 0;if(c.fn&&c.fn!==i&&!function(){c.data=v.createFrame(c.data);var a=c.fn;e=c.data["partial-block"]=function(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return c.data=v.createFrame(c.data),c.data["partial-block"]=d,a(b,c)},a.partials&&(c.partials=s.extend({},c.partials,a.partials))}(),void 0===a&&e&&(a=e),void 0===a)throw new u["default"]("The partial "+c.name+" could not be found");if(a instanceof Function)return a(b,c)}function i(){return""}function j(a,b){return b&&"root"in b||(b=b?v.createFrame(b):{},b.root=a),b}function k(a,b,c,d,e,f){if(a.decorator){var g={};b=a.decorator(b,g,c,d&&d[0],e,f,d),s.extend(b,g)}return b}function l(a,b){o(a).forEach(function(c){var d=a[c];a[c]=m(d,b)})}function m(a,b){var c=b.lookupProperty;return x.wrapHelper(a,function(a){return s.extend({lookupProperty:c},a)})}var n=c(39)["default"],o=c(13)["default"],p=c(3)["default"],q=c(1)["default"];b.__esModule=!0,b.checkRevision=d,b.template=e,b.wrapProgram=f,b.resolvePartial=g,b.invokePartial=h,b.noop=i;var r=c(5),s=p(r),t=c(6),u=q(t),v=c(4),w=c(10),x=c(43),y=c(33)},function(a,b,c){a.exports={default:c(40),__esModule:!0}},function(a,b,c){c(41),a.exports=c(21).Object.seal},function(a,b,c){var d=c(42);c(18)("seal",function(a){return function(b){return a&&d(b)?a(b):b}})},function(a,b){a.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},function(a,b){"use strict";function c(a,b){if("function"!=typeof a)return a;var c=function(){var c=arguments[arguments.length-1];return arguments[arguments.length-1]=b(c),a.apply(this,arguments)};return c}b.__esModule=!0,b.wrapHelper=c},function(a,b){(function(c){"use strict";b.__esModule=!0,b["default"]=function(a){var b="undefined"!=typeof c?c:window,d=b.Handlebars;a.noConflict=function(){return b.Handlebars===a&&(b.Handlebars=d),a}},a.exports=b["default"]}).call(b,function(){return this}())},function(a,b){"use strict";b.__esModule=!0;var c={helpers:{helperExpression:function(a){return"SubExpression"===a.type||("MustacheStatement"===a.type||"BlockStatement"===a.type)&&!!(a.params&&a.params.length||a.hash)},scopedId:function(a){return/^\.|this\b/.test(a.original)},simpleId:function(a){return 1===a.parts.length&&!c.helpers.scopedId(a)&&!a.depth}}};b["default"]=c,a.exports=b["default"]},function(a,b,c){"use strict";function d(a,b){if("Program"===a.type)return a;i["default"].yy=o,o.locInfo=function(a){return new o.SourceLocation(b&&b.srcName,a)};var c=i["default"].parse(a);return c}function e(a,b){var c=d(a,b),e=new k["default"](b);return e.accept(c)}var f=c(1)["default"],g=c(3)["default"];b.__esModule=!0,b.parseWithoutProcessing=d,b.parse=e;var h=c(47),i=f(h),j=c(48),k=f(j),l=c(50),m=g(l),n=c(5);b.parser=i["default"];var o={};n.extend(o,m)},function(a,b){"use strict";b.__esModule=!0;var c=function(){function a(){this.yy={}}var b={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(a,b,c,d,e,f,g){var h=f.length-1;switch(e){case 1:return f[h-1];case 2:this.$=d.prepareProgram(f[h]);break;case 3:this.$=f[h];break;case 4:this.$=f[h];break;case 5:this.$=f[h];break;case 6:this.$=f[h];break;case 7:this.$=f[h];break;case 8:this.$=f[h];break;case 9:this.$={type:"CommentStatement",value:d.stripComment(f[h]),strip:d.stripFlags(f[h],f[h]),loc:d.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:f[h],value:f[h],loc:d.locInfo(this._$)};break;case 11:this.$=d.prepareRawBlock(f[h-2],f[h-1],f[h],this._$);break;case 12:this.$={path:f[h-3],params:f[h-2],hash:f[h-1]};break;case 13:this.$=d.prepareBlock(f[h-3],f[h-2],f[h-1],f[h],!1,this._$);break;case 14:this.$=d.prepareBlock(f[h-3],f[h-2],f[h-1],f[h],!0,this._$);break;case 15:this.$={open:f[h-5],path:f[h-4],params:f[h-3],hash:f[h-2],blockParams:f[h-1],strip:d.stripFlags(f[h-5],f[h])};break;case 16:this.$={path:f[h-4],params:f[h-3],hash:f[h-2],blockParams:f[h-1],strip:d.stripFlags(f[h-5],f[h])};break;case 17:this.$={path:f[h-4],params:f[h-3],hash:f[h-2],blockParams:f[h-1],strip:d.stripFlags(f[h-5],f[h])};break;case 18:this.$={strip:d.stripFlags(f[h-1],f[h-1]),program:f[h]};break;case 19:var i=d.prepareBlock(f[h-2],f[h-1],f[h],f[h],!1,this._$),j=d.prepareProgram([i],f[h-1].loc);j.chained=!0,this.$={strip:f[h-2].strip,program:j,chain:!0};break;case 20:this.$=f[h];break;case 21:this.$={path:f[h-1],strip:d.stripFlags(f[h-2],f[h])};break;case 22:this.$=d.prepareMustache(f[h-3],f[h-2],f[h-1],f[h-4],d.stripFlags(f[h-4],f[h]),this._$);break;case 23:this.$=d.prepareMustache(f[h-3],f[h-2],f[h-1],f[h-4],d.stripFlags(f[h-4],f[h]),this._$);break;case 24:this.$={type:"PartialStatement",name:f[h-3],params:f[h-2],hash:f[h-1],indent:"",strip:d.stripFlags(f[h-4],f[h]),loc:d.locInfo(this._$)};break;case 25:this.$=d.preparePartialBlock(f[h-2],f[h-1],f[h],this._$);break;case 26:this.$={path:f[h-3],params:f[h-2],hash:f[h-1],strip:d.stripFlags(f[h-4],f[h])};break;case 27:this.$=f[h];break;case 28:this.$=f[h];break;case 29:this.$={type:"SubExpression",path:f[h-3],params:f[h-2],hash:f[h-1],loc:d.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:f[h],loc:d.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:d.id(f[h-2]),value:f[h],loc:d.locInfo(this._$)};break;case 32:this.$=d.id(f[h-1]);break;case 33:this.$=f[h];break;case 34:this.$=f[h];break;case 35:this.$={type:"StringLiteral",value:f[h],original:f[h],loc:d.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(f[h]),original:Number(f[h]),loc:d.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===f[h],original:"true"===f[h],loc:d.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:d.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:d.locInfo(this._$)};break;case 40:this.$=f[h];break;case 41:this.$=f[h];break;case 42:this.$=d.preparePath(!0,f[h],this._$);break;case 43:this.$=d.preparePath(!1,f[h],this._$);break;case 44:f[h-2].push({part:d.id(f[h]),original:f[h],separator:f[h-1]}),this.$=f[h-2];break;case 45:this.$=[{part:d.id(f[h]),original:f[h]}];break;case 46:this.$=[];break;case 47:f[h-1].push(f[h]);break;case 48:this.$=[];break;case 49:f[h-1].push(f[h]);break;case 50:this.$=[];break;case 51:f[h-1].push(f[h]);break;case 58:this.$=[];break;case 59:f[h-1].push(f[h]);break;case 64:this.$=[];break;case 65:f[h-1].push(f[h]);break;case 70:this.$=[];break;case 71:f[h-1].push(f[h]);break;case 78:this.$=[];break;case 79:f[h-1].push(f[h]);break;case 82:this.$=[];break;case 83:f[h-1].push(f[h]);break;case 86:this.$=[];break;case 87:f[h-1].push(f[h]);break;case 90:this.$=[];break;case 91:f[h-1].push(f[h]);break;case 94:this.$=[];break;case 95:f[h-1].push(f[h]);break;case 98:this.$=[f[h]];break;case 99:f[h-1].push(f[h]);break;case 100:this.$=[f[h]];break;case 101:f[h-1].push(f[h])}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(a,b){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:(null!==n&&"undefined"!=typeof n||(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,-1*t*2),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},c=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){function e(a,c){return b.yytext=b.yytext.substring(a,b.yyleng-c+a)}switch(c){case 0:if("\\\\"===b.yytext.slice(-2)?(e(0,1),this.begin("mu")):"\\"===b.yytext.slice(-1)?(e(0,1),this.begin("emu")):this.begin("mu"),b.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(e(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(b.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return b.yytext=e(1,2).replace(/\\"/g,'"'),80;case 32:return b.yytext=e(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return b.yytext=b.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},a.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},a}();return b.lexer=c,a.prototype=b,b.Parser=a,new a}();b["default"]=c,a.exports=b["default"]},function(a,b,c){"use strict";function d(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=a}function e(a,b,c){void 0===b&&(b=a.length);var d=a[b-1],e=a[b-2];return d?"ContentStatement"===d.type?(e||!c?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(d.original):void 0:c}function f(a,b,c){void 0===b&&(b=-1);var d=a[b+1],e=a[b+2];return d?"ContentStatement"===d.type?(e||!c?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(d.original):void 0:c}function g(a,b,c){var d=a[null==b?0:b+1];if(d&&"ContentStatement"===d.type&&(c||!d.rightStripped)){var e=d.value;d.value=d.value.replace(c?/^\s+/:/^[ \t]*\r?\n?/,""),d.rightStripped=d.value!==e}}function h(a,b,c){var d=a[null==b?a.length-1:b-1];if(d&&"ContentStatement"===d.type&&(c||!d.leftStripped)){var e=d.value;return d.value=d.value.replace(c?/\s+$/:/[ \t]+$/,""),d.leftStripped=d.value!==e,d.leftStripped}}var i=c(1)["default"];b.__esModule=!0;var j=c(49),k=i(j);d.prototype=new k["default"],d.prototype.Program=function(a){var b=!this.options.ignoreStandalone,c=!this.isRootSeen;this.isRootSeen=!0;for(var d=a.body,i=0,j=d.length;i<j;i++){var k=d[i],l=this.accept(k);if(l){var m=e(d,i,c),n=f(d,i,c),o=l.openStandalone&&m,p=l.closeStandalone&&n,q=l.inlineStandalone&&m&&n;l.close&&g(d,i,!0),l.open&&h(d,i,!0),b&&q&&(g(d,i),h(d,i)&&"PartialStatement"===k.type&&(k.indent=/([ \t]+$)/.exec(d[i-1].original)[1])),b&&o&&(g((k.program||k.inverse).body),h(d,i)),b&&p&&(g(d,i),h((k.inverse||k.program).body))}}return a},d.prototype.BlockStatement=d.prototype.DecoratorBlock=d.prototype.PartialBlockStatement=function(a){this.accept(a.program),this.accept(a.inverse);var b=a.program||a.inverse,c=a.program&&a.inverse,d=c,i=c;if(c&&c.chained)for(d=c.body[0].program;i.chained;)i=i.body[i.body.length-1].program;var j={open:a.openStrip.open,close:a.closeStrip.close,openStandalone:f(b.body),closeStandalone:e((d||b).body)};if(a.openStrip.close&&g(b.body,null,!0),c){var k=a.inverseStrip;k.open&&h(b.body,null,!0),k.close&&g(d.body,null,!0),a.closeStrip.open&&h(i.body,null,!0),!this.options.ignoreStandalone&&e(b.body)&&f(d.body)&&(h(b.body),g(d.body))}else a.closeStrip.open&&h(b.body,null,!0);return j},d.prototype.Decorator=d.prototype.MustacheStatement=function(a){return a.strip},d.prototype.PartialStatement=d.prototype.CommentStatement=function(a){var b=a.strip||{};return{inlineStandalone:!0,open:b.open,close:b.close}},b["default"]=d,a.exports=b["default"]},function(a,b,c){"use strict";function d(){this.parents=[]}function e(a){this.acceptRequired(a,"path"),this.acceptArray(a.params),this.acceptKey(a,"hash")}function f(a){e.call(this,a),this.acceptKey(a,"program"),this.acceptKey(a,"inverse")}function g(a){this.acceptRequired(a,"name"),this.acceptArray(a.params),this.acceptKey(a,"hash")}var h=c(1)["default"];b.__esModule=!0;var i=c(6),j=h(i);d.prototype={constructor:d,mutating:!1,acceptKey:function(a,b){var c=this.accept(a[b]);if(this.mutating){if(c&&!d.prototype[c.type])throw new j["default"]('Unexpected node type "'+c.type+'" found when accepting '+b+" on "+a.type);a[b]=c}},acceptRequired:function(a,b){if(this.acceptKey(a,b),!a[b])throw new j["default"](a.type+" requires "+b)},acceptArray:function(a){for(var b=0,c=a.length;b<c;b++)this.acceptKey(a,b),a[b]||(a.splice(b,1),b--,c--)},accept:function(a){if(a){if(!this[a.type])throw new j["default"]("Unknown type: "+a.type,a);this.current&&this.parents.unshift(this.current),this.current=a;var b=this[a.type](a);return this.current=this.parents.shift(),!this.mutating||b?b:b!==!1?a:void 0}},Program:function(a){this.acceptArray(a.body)},MustacheStatement:e,Decorator:e,BlockStatement:f,DecoratorBlock:f,PartialStatement:g,PartialBlockStatement:function(a){g.call(this,a),this.acceptKey(a,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:e,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(a){this.acceptArray(a.pairs)},HashPair:function(a){this.acceptRequired(a,"value")}},b["default"]=d,a.exports=b["default"]},function(a,b,c){"use strict";function d(a,b){if(b=b.path?b.path.original:b,a.path.original!==b){var c={loc:a.path.loc};throw new q["default"](a.path.original+" doesn't match "+b,c)}}function e(a,b){this.source=a,this.start={line:b.first_line,column:b.first_column},this.end={line:b.last_line,column:b.last_column}}function f(a){return/^\[.*\]$/.test(a)?a.substring(1,a.length-1):a}function g(a,b){return{open:"~"===a.charAt(2),close:"~"===b.charAt(b.length-3)}}function h(a){return a.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function i(a,b,c){c=this.locInfo(c);for(var d=a?"@":"",e=[],f=0,g=0,h=b.length;g<h;g++){var i=b[g].part,j=b[g].original!==i;if(d+=(b[g].separator||"")+i,j||".."!==i&&"."!==i&&"this"!==i)e.push(i);else{if(e.length>0)throw new q["default"]("Invalid path: "+d,{loc:c});".."===i&&f++}}return{type:"PathExpression",data:a,depth:f,parts:e,original:d,loc:c}}function j(a,b,c,d,e,f){var g=d.charAt(3)||d.charAt(2),h="{"!==g&&"&"!==g,i=/\*/.test(d);return{type:i?"Decorator":"MustacheStatement",path:a,params:b,hash:c,escaped:h,strip:e,loc:this.locInfo(f)}}function k(a,b,c,e){d(a,c),e=this.locInfo(e);var f={type:"Program",body:b,strip:{},loc:e};return{type:"BlockStatement",path:a.path,params:a.params,hash:a.hash,program:f,openStrip:{},inverseStrip:{},closeStrip:{},loc:e}}function l(a,b,c,e,f,g){e&&e.path&&d(a,e);var h=/\*/.test(a.open);b.blockParams=a.blockParams;var i=void 0,j=void 0;if(c){if(h)throw new q["default"]("Unexpected inverse block on decorator",c);c.chain&&(c.program.body[0].closeStrip=e.strip),j=c.strip,i=c.program}return f&&(f=i,i=b,b=f),{type:h?"DecoratorBlock":"BlockStatement",path:a.path,params:a.params,hash:a.hash,program:b,inverse:i,openStrip:a.strip,inverseStrip:j,closeStrip:e&&e.strip,loc:this.locInfo(g)}}function m(a,b){if(!b&&a.length){var c=a[0].loc,d=a[a.length-1].loc;c&&d&&(b={source:c.source,start:{line:c.start.line,column:c.start.column},end:{line:d.end.line,column:d.end.column}})}return{type:"Program",body:a,strip:{},loc:b}}function n(a,b,c,e){return d(a,c),{type:"PartialBlockStatement",name:a.path,params:a.params,hash:a.hash,program:b,openStrip:a.strip,closeStrip:c&&c.strip,loc:this.locInfo(e)}}var o=c(1)["default"];b.__esModule=!0,b.SourceLocation=e,b.id=f,b.stripFlags=g,b.stripComment=h,b.preparePath=i,b.prepareMustache=j,b.prepareRawBlock=k,b.prepareBlock=l,b.prepareProgram=m,b.preparePartialBlock=n;var p=c(6),q=o(p)},function(a,b,c){"use strict";function d(){}function e(a,b,c){if(null==a||"string"!=typeof a&&"Program"!==a.type)throw new l["default"]("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+a);b=b||{},"data"in b||(b.data=!0),b.compat&&(b.useDepths=!0);var d=c.parse(a,b),e=(new c.Compiler).compile(d,b);return(new c.JavaScriptCompiler).compile(e,b)}function f(a,b,c){function d(){var d=c.parse(a,b),e=(new c.Compiler).compile(d,b),f=(new c.JavaScriptCompiler).compile(e,b,void 0,!0);return c.template(f)}function e(a,b){return f||(f=d()),f.call(this,a,b)}if(void 0===b&&(b={}),null==a||"string"!=typeof a&&"Program"!==a.type)throw new l["default"]("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+a);b=m.extend({},b),"data"in b||(b.data=!0),b.compat&&(b.useDepths=!0);var f=void 0;return e._setup=function(a){return f||(f=d()),f._setup(a)},e._child=function(a,b,c,e){return f||(f=d()),f._child(a,b,c,e)},e}function g(a,b){if(a===b)return!0;if(m.isArray(a)&&m.isArray(b)&&a.length===b.length){for(var c=0;c<a.length;c++)if(!g(a[c],b[c]))return!1;return!0}}function h(a){if(!a.path.parts){var b=a.path;a.path={type:"PathExpression",data:!1,depth:0,parts:[b.original+""],original:b.original+"",loc:b.loc}}}var i=c(34)["default"],j=c(1)["default"];b.__esModule=!0,b.Compiler=d,b.precompile=e,b.compile=f;var k=c(6),l=j(k),m=c(5),n=c(45),o=j(n),p=[].slice;d.prototype={compiler:d,equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b)return!1;for(var c=0;c<b;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||!g(d.args,e.args))return!1}b=this.children.length;for(var c=0;c<b;c++)if(!this.children[c].equals(a.children[c]))return!1;return!0},guid:0,compile:function(a,b){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=b,this.stringParams=b.stringParams,this.trackIds=b.trackIds,b.blockParams=b.blockParams||[],b.knownHelpers=m.extend(i(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},b.knownHelpers),this.accept(a)},compileProgram:function(a){var b=new this.compiler,c=b.compile(a,this.options),d=this.guid++;return this.usePartial=this.usePartial||c.usePartial,this.children[d]=c,this.useDepths=this.useDepths||c.useDepths,d},accept:function(a){if(!this[a.type])throw new l["default"]("Unknown type: "+a.type,a);this.sourceNode.unshift(a);var b=this[a.type](a);return this.sourceNode.shift(),b},Program:function(a){this.options.blockParams.unshift(a.blockParams);for(var b=a.body,c=b.length,d=0;d<c;d++)this.accept(b[d]);return this.options.blockParams.shift(),this.isSimple=1===c,this.blockParams=a.blockParams?a.blockParams.length:0,this},BlockStatement:function(a){h(a);var b=a.program,c=a.inverse;b=b&&this.compileProgram(b),c=c&&this.compileProgram(c);var d=this.classifySexpr(a);"helper"===d?this.helperSexpr(a,b,c):"simple"===d?(this.simpleSexpr(a),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("emptyHash"),this.opcode("blockValue",a.path.original)):(this.ambiguousSexpr(a,b,c),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(a){var b=a.program&&this.compileProgram(a.program),c=this.setupFullMustacheParams(a,b,void 0),d=a.path;this.useDecorators=!0,this.opcode("registerDecorator",c.length,d.original)},PartialStatement:function(a){this.usePartial=!0;var b=a.program;b&&(b=this.compileProgram(a.program));var c=a.params;if(c.length>1)throw new l["default"]("Unsupported number of partial arguments: "+c.length,a);c.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):c.push({type:"PathExpression",parts:[],depth:0}));var d=a.name.original,e="SubExpression"===a.name.type;e&&this.accept(a.name),this.setupFullMustacheParams(a,b,void 0,!0);var f=a.indent||"";this.options.preventIndent&&f&&(this.opcode("appendContent",f),f=""),this.opcode("invokePartial",e,d,f),this.opcode("append")},PartialBlockStatement:function(a){this.PartialStatement(a)},MustacheStatement:function(a){this.SubExpression(a),a.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(a){this.DecoratorBlock(a)},ContentStatement:function(a){a.value&&this.opcode("appendContent",a.value)},CommentStatement:function(){},SubExpression:function(a){h(a);var b=this.classifySexpr(a);"simple"===b?this.simpleSexpr(a):"helper"===b?this.helperSexpr(a):this.ambiguousSexpr(a)},ambiguousSexpr:function(a,b,c){var d=a.path,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),d.strict=!0,this.accept(d),this.opcode("invokeAmbiguous",e,f)},simpleSexpr:function(a){var b=a.path;b.strict=!0,this.accept(b),this.opcode("resolvePossibleLambda")},helperSexpr:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.path,f=e.parts[0];if(this.options.knownHelpers[f])this.opcode("invokeKnownHelper",d.length,f);else{if(this.options.knownHelpersOnly)throw new l["default"]("You specified knownHelpersOnly, but used the unknown helper "+f,a);e.strict=!0,e.falsy=!0,this.accept(e),this.opcode("invokeHelper",d.length,e.original,o["default"].helpers.simpleId(e))}},PathExpression:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0],c=o["default"].helpers.scopedId(a),d=!a.depth&&!c&&this.blockParamIndex(b);d?this.opcode("lookupBlockParam",d,a.parts):b?a.data?(this.options.data=!0,this.opcode("lookupData",a.depth,a.parts,a.strict)):this.opcode("lookupOnContext",a.parts,a.falsy,a.strict,c):this.opcode("pushContext")},StringLiteral:function(a){this.opcode("pushString",a.value)},NumberLiteral:function(a){this.opcode("pushLiteral",a.value)},BooleanLiteral:function(a){this.opcode("pushLiteral",a.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(a){var b=a.pairs,c=0,d=b.length;for(this.opcode("pushHash");c<d;c++)this.pushParam(b[c].value);for(;c--;)this.opcode("assignToHash",b[c].key);this.opcode("popHash")},opcode:function(a){this.opcodes.push({opcode:a,args:p.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(a){a&&(this.useDepths=!0)},classifySexpr:function(a){var b=o["default"].helpers.simpleId(a.path),c=b&&!!this.blockParamIndex(a.path.parts[0]),d=!c&&o["default"].helpers.helperExpression(a),e=!c&&(d||b);if(e&&!d){var f=a.path.parts[0],g=this.options;g.knownHelpers[f]?d=!0:g.knownHelpersOnly&&(e=!1)}return d?"helper":e?"ambiguous":"simple"},pushParams:function(a){for(var b=0,c=a.length;b<c;b++)this.pushParam(a[b])},pushParam:function(a){var b=null!=a.value?a.value:a.original||"";if(this.stringParams)b.replace&&(b=b.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),a.depth&&this.addDepth(a.depth),this.opcode("getContext",a.depth||0),this.opcode("pushStringParam",b,a.type),"SubExpression"===a.type&&this.accept(a);else{if(this.trackIds){var c=void 0;if(!a.parts||o["default"].helpers.scopedId(a)||a.depth||(c=this.blockParamIndex(a.parts[0])),c){var d=a.parts.slice(1).join(".");this.opcode("pushId","BlockParam",c,d)}else b=a.original||b,b.replace&&(b=b.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",a.type,b)}this.accept(a)}},setupFullMustacheParams:function(a,b,c,d){var e=a.params;return this.pushParams(e),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.accept(a.hash):this.opcode("emptyHash",d),e},blockParamIndex:function(a){for(var b=0,c=this.options.blockParams.length;b<c;b++){var d=this.options.blockParams[b],e=d&&m.indexOf(d,a);if(d&&e>=0)return[b,e]}}}},function(a,b,c){"use strict";function d(a){this.value=a}function e(){}function f(a,b,c,d){var e=b.popStack(),f=0,g=c.length;for(a&&g--;f<g;f++)e=b.nameLookup(e,c[f],d);return a?[b.aliasable("container.strict"),"(",e,", ",b.quotedString(c[f]),", ",JSON.stringify(b.source.currentLocation)," )"]:e}var g=c(13)["default"],h=c(1)["default"];b.__esModule=!0;var i=c(4),j=c(6),k=h(j),l=c(5),m=c(53),n=h(m);e.prototype={nameLookup:function(a,b){return this.internalNameLookup(a,b)},depthedLookup:function(a){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(a),")"]},compilerInfo:function(){var a=i.COMPILER_REVISION,b=i.REVISION_CHANGES[a];return[a,b]},appendToBuffer:function(a,b,c){return l.isArray(a)||(a=[a]),a=this.source.wrap(a,b),this.environment.isSimple?["return ",a,";"]:c?["buffer += ",a,";"]:(a.appendToBuffer=!0,a)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(a,b){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",a,",",JSON.stringify(b),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(a,b,c,d){this.environment=a,this.options=b,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!d,this.name=this.environment.name,this.isChild=!!c,this.context=c||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(a,b),this.useDepths=this.useDepths||a.useDepths||a.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||a.useBlockParams;var e=a.opcodes,f=void 0,g=void 0,h=void 0,i=void 0;for(h=0,i=e.length;h<i;h++)f=e[h],this.source.currentLocation=f.loc,g=g||f.loc,this[f.opcode].apply(this,f.args);if(this.source.currentLocation=g,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new k["default"]("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),";\n"]),this.decorators.push("return fn;"),d?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators=this.decorators.merge()));var j=this.createFunctionContext(d);if(this.isChild)return j;var l={compiler:this.compilerInfo(),main:j};this.decorators&&(l.main_d=this.decorators,l.useDecorators=!0);var m=this.context,n=m.programs,o=m.decorators;for(h=0,i=n.length;h<i;h++)n[h]&&(l[h]=n[h],o[h]&&(l[h+"_d"]=o[h],l.useDecorators=!0));return this.environment.usePartial&&(l.usePartial=!0),this.options.data&&(l.useData=!0),this.useDepths&&(l.useDepths=!0),this.useBlockParams&&(l.useBlockParams=!0),this.options.compat&&(l.compat=!0),d?l.compilerOptions=this.options:(l.compiler=JSON.stringify(l.compiler),this.source.currentLocation={start:{line:1,column:0}},l=this.objectLiteral(l),b.srcName?(l=l.toStringWithSourceMap({file:b.destName}),l.map=l.map&&l.map.toString()):l=l.toString()),l},preamble:function(){this.lastContext=0,this.source=new n["default"](this.options.srcName),this.decorators=new n["default"](this.options.srcName)},createFunctionContext:function(a){var b=this,c="",d=this.stackVars.concat(this.registers.list);d.length>0&&(c+=", "+d.join(", "));var e=0;g(this.aliases).forEach(function(a){var d=b.aliases[a];d.children&&d.referenceCount>1&&(c+=", alias"+ ++e+"="+a,d.children[0]="alias"+e)}),this.lookupPropertyFunctionIsUsed&&(c+=", "+this.lookupPropertyFunctionVarDeclaration());var f=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&f.push("blockParams"),this.useDepths&&f.push("depths");var h=this.mergeSource(c);return a?(f.push(h),Function.apply(this,f)):this.source.wrap(["function(",f.join(","),") {\n  ",h,"}"])},mergeSource:function(a){var b=this.environment.isSimple,c=!this.forceBuffer,d=void 0,e=void 0,f=void 0,g=void 0;return this.source.each(function(a){a.appendToBuffer?(f?a.prepend("  + "):f=a,g=a):(f&&(e?f.prepend("buffer += "):d=!0,g.add(";"),f=g=void 0),e=!0,b||(c=!1))}),c?f?(f.prepend("return "),g.add(";")):e||this.source.push('return "";'):(a+=", buffer = "+(d?"":this.initializeBuffer()),f?(f.prepend("return buffer + "),g.add(";")):this.source.push("return buffer;")),a&&this.source.prepend("var "+a.substring(2)+(d?"":";\n")),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return"\n      lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    }\n    ".trim()},blockValue:function(a){var b=this.aliasable("container.hooks.blockHelperMissing"),c=[this.contextName(0)];this.setupHelperArgs(a,0,c);var d=this.popStack();c.splice(1,0,d),this.push(this.source.functionCall(b,"call",c))},ambiguousBlockValue:function(){var a=this.aliasable("container.hooks.blockHelperMissing"),b=[this.contextName(0)];this.setupHelperArgs("",0,b,!0),this.flushInline();var c=this.topStack();b.splice(1,0,c),this.pushSource(["if (!",this.lastHelper,") { ",c," = ",this.source.functionCall(a,"call",b),"}"])},appendContent:function(a){this.pendingContent?a=this.pendingContent+a:this.pendingLocation=this.source.currentLocation,this.pendingContent=a},append:function(){if(this.isInline())this.replaceStack(function(a){return[" != null ? ",a,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var a=this.popStack();this.pushSource(["if (",a," != null) { ",this.appendToBuffer(a,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(a){this.lastContext=a},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(a,b,c,d){var e=0;d||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(a[e++])),this.resolvePath("context",a,e,b,c)},lookupBlockParam:function(a,b){this.useBlockParams=!0,this.push(["blockParams[",a[0],"][",a[1],"]"]),this.resolvePath("context",b,1)},lookupData:function(a,b,c){a?this.pushStackLiteral("container.data(data, "+a+")"):this.pushStackLiteral("data"),this.resolvePath("data",b,0,!0,c)},resolvePath:function(a,b,c,d,e){var g=this;if(this.options.strict||this.options.assumeObjects)return void this.push(f(this.options.strict&&e,this,b,a));for(var h=b.length;c<h;c++)this.replaceStack(function(e){var f=g.nameLookup(e,b[c],a);return d?[" && ",f]:[" != null ? ",f," : ",e]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(a,b){this.pushContext(),this.pushString(b),"SubExpression"!==b&&("string"==typeof a?this.pushString(a):this.pushStackLiteral(a))},emptyHash:function(a){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(a?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var a=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(a.ids)),this.stringParams&&(this.push(this.objectLiteral(a.contexts)),this.push(this.objectLiteral(a.types))),this.push(this.objectLiteral(a.values))},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){null!=a?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},registerDecorator:function(a,b){var c=this.nameLookup("decorators",b,"decorator"),d=this.setupHelperArgs(b,a);this.decorators.push(["fn = ",this.decorators.functionCall(c,"",["fn","props","container",d])," || fn;"])},invokeHelper:function(a,b,c){var d=this.popStack(),e=this.setupHelper(a,b),f=[];c&&f.push(e.name),f.push(d),this.options.strict||f.push(this.aliasable("container.hooks.helperMissing"));var g=["(",this.itemsSeparatedBy(f,"||"),")"],h=this.source.functionCall(g,"call",e.callParams);this.push(h)},itemsSeparatedBy:function(a,b){var c=[];c.push(a[0]);for(var d=1;d<a.length;d++)c.push(b,a[d]);return c},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(this.source.functionCall(c.name,"call",c.callParams))},invokeAmbiguous:function(a,b){this.useRegister("helper");var c=this.popStack();this.emptyHash();var d=this.setupHelper(0,a,b),e=this.lastHelper=this.nameLookup("helpers",a,"helper"),f=["(","(helper = ",e," || ",c,")"];this.options.strict||(f[0]="(helper = ",f.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",f,d.paramsInit?["),(",d.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",d.callParams)," : helper))"])},invokePartial:function(a,b,c){var d=[],e=this.setupParams(b,1,d);a&&(b=this.popStack(),delete e.name),c&&(e.indent=JSON.stringify(c)),e.helpers="helpers",e.partials="partials",e.decorators="container.decorators",a?d.unshift(b):d.unshift(this.nameLookup("partials",b,"partial")),this.options.compat&&(e.depths="depths"),e=this.objectLiteral(e),d.push(e),this.push(this.source.functionCall("container.invokePartial","",d))},assignToHash:function(a){var b=this.popStack(),c=void 0,d=void 0,e=void 0;this.trackIds&&(e=this.popStack()),this.stringParams&&(d=this.popStack(),c=this.popStack());var f=this.hash;c&&(f.contexts[a]=c),d&&(f.types[a]=d),e&&(f.ids[a]=e),f.values[a]=b},pushId:function(a,b,c){"BlockParam"===a?this.pushStackLiteral("blockParams["+b[0]+"].path["+b[1]+"]"+(c?" + "+JSON.stringify("."+c):"")):"PathExpression"===a?this.pushString(b):"SubExpression"===a?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:e,compileChildren:function(a,b){for(var c=a.children,d=void 0,e=void 0,f=0,g=c.length;f<g;f++){d=c[f],e=new this.compiler;var h=this.matchExistingProgram(d);if(null==h){this.context.programs.push("");var i=this.context.programs.length;d.index=i,d.name="program"+i,this.context.programs[i]=e.compile(d,b,this.context,!this.precompile),this.context.decorators[i]=e.decorators,this.context.environments[i]=d,this.useDepths=this.useDepths||e.useDepths,this.useBlockParams=this.useBlockParams||e.useBlockParams,d.useDepths=this.useDepths,d.useBlockParams=this.useBlockParams}else d.index=h.index,d.name="program"+h.index,this.useDepths=this.useDepths||h.useDepths,this.useBlockParams=this.useBlockParams||h.useBlockParams}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;b<c;b++){var d=this.context.environments[b];if(d&&d.equals(a))return d}},programExpression:function(a){var b=this.environment.children[a],c=[b.index,"data",b.blockParams];return(this.useBlockParams||this.useDepths)&&c.push("blockParams"),this.useDepths&&c.push("depths"),"container.program("+c.join(", ")+")"},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},push:function(a){return a instanceof d||(a=this.source.wrap(a)),this.inlineStack.push(a),a},pushStackLiteral:function(a){this.push(new d(a))},pushSource:function(a){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),a&&this.source.push(a)},replaceStack:function(a){var b=["("],c=void 0,e=void 0,f=void 0;if(!this.isInline())throw new k["default"]("replaceStack on non-inline");var g=this.popStack(!0);if(g instanceof d)c=[g.value],b=["(",c],f=!0;else{e=!0;var h=this.incrStack();b=["((",this.push(h)," = ",g,")"],c=this.topStack()}var i=a.call(this,c);f||this.popStack(),e&&this.stackSlot--,this.push(b.concat(i,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;this.inlineStack=[];for(var b=0,c=a.length;b<c;b++){var e=a[b];if(e instanceof d)this.compileStack.push(e);else{var f=this.incrStack();this.pushSource([f," = ",e,";"]),this.compileStack.push(f)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var b=this.isInline(),c=(b?this.inlineStack:this.compileStack).pop();if(!a&&c instanceof d)return c.value;if(!b){if(!this.stackSlot)throw new k["default"]("Invalid stack pop");this.stackSlot--}return c},topStack:function(){var a=this.isInline()?this.inlineStack:this.compileStack,b=a[a.length-1];return b instanceof d?b.value:b},contextName:function(a){return this.useDepths&&a?"depths["+a+"]":"depth"+a},quotedString:function(a){return this.source.quotedString(a)},objectLiteral:function(a){return this.source.objectLiteral(a)},aliasable:function(a){var b=this.aliases[a];return b?(b.referenceCount++,b):(b=this.aliases[a]=this.source.wrap(a),b.aliasable=!0,b.referenceCount=1,b)},setupHelper:function(a,b,c){var d=[],e=this.setupHelperArgs(b,a,d,c),f=this.nameLookup("helpers",b,"helper"),g=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:d,paramsInit:e,name:f,callParams:[g].concat(d)}},setupParams:function(a,b,c){var d={},e=[],f=[],g=[],h=!c,i=void 0;h&&(c=[]),d.name=this.quotedString(a),d.hash=this.popStack(),this.trackIds&&(d.hashIds=this.popStack()),this.stringParams&&(d.hashTypes=this.popStack(),d.hashContexts=this.popStack());var j=this.popStack(),k=this.popStack();(k||j)&&(d.fn=k||"container.noop",d.inverse=j||"container.noop");for(var l=b;l--;)i=this.popStack(),c[l]=i,this.trackIds&&(g[l]=this.popStack()),this.stringParams&&(f[l]=this.popStack(),e[l]=this.popStack());return h&&(d.args=this.source.generateArray(c)),this.trackIds&&(d.ids=this.source.generateArray(g)),this.stringParams&&(d.types=this.source.generateArray(f),d.contexts=this.source.generateArray(e)),this.options.data&&(d.data="data"),this.useBlockParams&&(d.blockParams="blockParams"),d},setupHelperArgs:function(a,b,c,d){var e=this.setupParams(a,b,c);return e.loc=JSON.stringify(this.source.currentLocation),e=this.objectLiteral(e),d?(this.useRegister("options"),c.push("options"),["options=",e]):c?(c.push(e),""):e}},function(){for(var a="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),b=e.RESERVED_WORDS={},c=0,d=a.length;c<d;c++)b[a[c]]=!0}(),e.isValidJavaScriptVariableName=function(a){return!e.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(a)},b["default"]=e,a.exports=b["default"]},function(a,b,c){"use strict";function d(a,b,c){if(g.isArray(a)){for(var d=[],e=0,f=a.length;e<f;e++)d.push(b.wrap(a[e],c));return d}return"boolean"==typeof a||"number"==typeof a?a+"":a}function e(a){this.srcFile=a,this.source=[]}var f=c(13)["default"];b.__esModule=!0;var g=c(5),h=void 0;try{}catch(i){}h||(h=function(a,b,c,d){this.src="",d&&this.add(d)},h.prototype={add:function(a){g.isArray(a)&&(a=a.join("")),this.src+=a},prepend:function(a){g.isArray(a)&&(a=a.join("")),this.src=a+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),e.prototype={isEmpty:function(){return!this.source.length},prepend:function(a,b){this.source.unshift(this.wrap(a,b))},push:function(a,b){this.source.push(this.wrap(a,b))},merge:function(){var a=this.empty();return this.each(function(b){a.add(["  ",b,"\n"])}),a},each:function(a){for(var b=0,c=this.source.length;b<c;b++)a(this.source[b])},empty:function(){var a=this.currentLocation||{start:{}};return new h(a.start.line,a.start.column,this.srcFile)},wrap:function(a){var b=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return a instanceof h?a:(a=d(a,this,b),new h(b.start.line,b.start.column,this.srcFile,a))},functionCall:function(a,b,c){return c=this.generateList(c),this.wrap([a,b?"."+b+"(":"(",c,")"])},quotedString:function(a){return'"'+(a+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(a){var b=this,c=[];f(a).forEach(function(e){var f=d(a[e],b);"undefined"!==f&&c.push([b.quotedString(e),":",f])});var e=this.generateList(c);return e.prepend("{"),e.add("}"),e},generateList:function(a){for(var b=this.empty(),c=0,e=a.length;c<e;c++)c&&b.add(","),b.add(d(a[c],this));return b},generateArray:function(a){var b=this.generateList(a);return b.prepend("["),b.add("]"),b}},b["default"]=e,a.exports=b["default"]}])});!function(t,e){function n(t,e,n){var r=t.children(),o=!1;t.empty();for(var i=0,d=r.length;d>i;i++){var l=r.eq(i);if(t.append(l),n&&t.append(n),a(t,e)){l.remove(),o=!0;break}n&&n.detach()}return o}function r(e,n,i,d,l){var s=!1,c="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",u="script, .dotdotdot-keep";return e.contents().detach().each(function(){var f=this,h=t(f);if("undefined"==typeof f||3==f.nodeType&&0==t.trim(f.data).length)return!0;if(h.is(u))e.append(h);else{if(s)return!0;e.append(h),l&&e[e.is(c)?"after":"append"](l),a(i,d)&&(s=3==f.nodeType?o(h,n,i,d,l):r(h,n,i,d,l),s||(h.detach(),s=!0)),s||l&&l.detach()}}),s}function o(e,n,r,o,d){var c=e[0];if(!c)return!1;var f=s(c),h=-1!==f.indexOf(" ")?" ":"ã€€",p="letter"==o.wrap?"":h,g=f.split(p),v=-1,w=-1,b=0,y=g.length-1;for(o.fallbackToLetter&&0==b&&0==y&&(p="",g=f.split(p),y=g.length-1);y>=b&&(0!=b||0!=y);){var m=Math.floor((b+y)/2);if(m==w)break;w=m,l(c,g.slice(0,w+1).join(p)+o.ellipsis),a(r,o)?(y=w,o.fallbackToLetter&&0==b&&0==y&&(p="",g=g[0].split(p),v=-1,w=-1,b=0,y=g.length-1)):(v=w,b=w)}if(-1==v||1==g.length&&0==g[0].length){var x=e.parent();e.detach();var T=d&&d.closest(x).length?d.length:0;x.contents().length>T?c=u(x.contents().eq(-1-T),n):(c=u(x,n,!0),T||x.detach()),c&&(f=i(s(c),o),l(c,f),T&&d&&t(c).parent().append(d))}else f=i(g.slice(0,v+1).join(p),o),l(c,f);return!0}function a(t,e){return t.innerHeight()>e.maxHeight}function i(e,n){for(;t.inArray(e.slice(-1),n.lastCharacter.remove)>-1;)e=e.slice(0,-1);return t.inArray(e.slice(-1),n.lastCharacter.noEllipsis)<0&&(e+=n.ellipsis),e}function d(t){return{width:t.innerWidth(),height:t.innerHeight()}}function l(t,e){t.innerText?t.innerText=e:t.nodeValue?t.nodeValue=e:t.textContent&&(t.textContent=e)}function s(t){return t.innerText?t.innerText:t.nodeValue?t.nodeValue:t.textContent?t.textContent:""}function c(t){do{t=t.previousSibling}while(t&&1!==t.nodeType&&3!==t.nodeType);return t}function u(e,n,r){var o,a=e&&e[0];if(a){if(!r){if(3===a.nodeType)return a;if(t.trim(e.text()))return u(e.contents().last(),n)}for(o=c(a);!o;){if(e=e.parent(),e.is(n)||!e.length)return!1;o=c(e[0])}if(o)return u(t(o),n)}return!1}function f(e,n){return e?"string"==typeof e?(e=t(e,n),e.length?e:!1):e.jquery?e:!1:!1}function h(t){for(var e=t.innerHeight(),n=["paddingTop","paddingBottom"],r=0,o=n.length;o>r;r++){var a=parseInt(t.css(n[r]),10);isNaN(a)&&(a=0),e-=a}return e}if(!t.fn.dotdotdot){t.fn.dotdotdot=function(e){if(0==this.length)return t.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){t(this).dotdotdot(e)});var o=this;o.data("dotdotdot")&&o.trigger("destroy.dot"),o.data("dotdotdot-style",o.attr("style")||""),o.css("word-wrap","break-word"),"nowrap"===o.css("white-space")&&o.css("white-space","normal"),o.bind_events=function(){return o.bind("update.dot",function(e,d){e.preventDefault(),e.stopPropagation(),l.maxHeight="number"==typeof l.height?l.height:h(o),l.maxHeight+=l.tolerance,"undefined"!=typeof d&&(("string"==typeof d||d instanceof HTMLElement)&&(d=t("<div />").append(d).contents()),d instanceof t&&(i=d)),g=o.wrapInner('<div class="dotdotdot" />').children(),g.contents().detach().end().append(i.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var c=!1,u=!1;return s.afterElement&&(c=s.afterElement.clone(!0),c.show(),s.afterElement.detach()),a(g,l)&&(u="children"==l.wrap?n(g,l,c):r(g,o,g,l,c)),g.replaceWith(g.contents()),g=null,t.isFunction(l.callback)&&l.callback.call(o[0],u,i),s.isTruncated=u,u}).bind("isTruncated.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],s.isTruncated),s.isTruncated}).bind("originalContent.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],i),i}).bind("destroy.dot",function(t){t.preventDefault(),t.stopPropagation(),o.unwatch().unbind_events().contents().detach().end().append(i).attr("style",o.data("dotdotdot-style")||"").data("dotdotdot",!1)}),o},o.unbind_events=function(){return o.unbind(".dot"),o},o.watch=function(){if(o.unwatch(),"window"==l.watch){var e=t(window),n=e.width(),r=e.height();e.bind("resize.dot"+s.dotId,function(){n==e.width()&&r==e.height()&&l.windowResizeFix||(n=e.width(),r=e.height(),u&&clearInterval(u),u=setTimeout(function(){o.trigger("update.dot")},100))})}else c=d(o),u=setInterval(function(){if(o.is(":visible")){var t=d(o);(c.width!=t.width||c.height!=t.height)&&(o.trigger("update.dot"),c=t)}},500);return o},o.unwatch=function(){return t(window).unbind("resize.dot"+s.dotId),u&&clearInterval(u),o};var i=o.contents(),l=t.extend(!0,{},t.fn.dotdotdot.defaults,e),s={},c={},u=null,g=null;return l.lastCharacter.remove instanceof Array||(l.lastCharacter.remove=t.fn.dotdotdot.defaultArrays.lastCharacter.remove),l.lastCharacter.noEllipsis instanceof Array||(l.lastCharacter.noEllipsis=t.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),s.afterElement=f(l.after,o),s.isTruncated=!1,s.dotId=p++,o.data("dotdotdot",!0).bind_events().trigger("update.dot"),l.watch&&o.watch(),o},t.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},t.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","ã€€",",",";",".","!","?"],noEllipsis:[]}},t.fn.dotdotdot.debug=function(){};var p=1,g=t.fn.html;t.fn.html=function(n){return n!=e&&!t.isFunction(n)&&this.data("dotdotdot")?this.trigger("update",[n]):g.apply(this,arguments)};var v=t.fn.text;t.fn.text=function(n){return n!=e&&!t.isFunction(n)&&this.data("dotdotdot")?(n=t("<div />").text(n).html(),this.trigger("update",[n])):v.apply(this,arguments)}}}(jQuery);(function($,Drupal){function handleClickChange(e){e.preventDefault();var page=$(this).data("page");var $parent=$(this).closest(e.data.wrapper);var url=$parent.find('input[name="api-request"]').val();var $pager=$parent.find(".pager-next");$pager.find("a").hide();$pager.append('<div class="ajax-progress ajax-progress-throbber"><div class="throbber">&nbsp;</div></div>');url=Drupal.behaviors.crisiswatchDatabase.updateUrlParam(url,"page",page);try{Drupal.behaviors.crisiswatchDatabase.fetchContent($parent,url)}catch(err){console.error(new Error(err))}}Drupal.behaviors.pagerAjax={attach:function(context){if($(".our-people-locations__pager .pager-next a").length>0){$(".our-people-locations__pager .pager-next a",context).click({wrapper:".our-people-locations"},handleClickChange)}if($(".latest-updates-staff__pager .pager-next a").length>0){$(".latest-updates-staff__pager .pager-next a",context).click({wrapper:".latest-updates-staff"},handleClickChange)}if($(".staff-group__pager .pager-next a").length>0){$(".staff-group__pager .pager-next a",context).click({wrapper:".staff-group"},handleClickChange)}}}})(jQuery,Drupal);(function($){$("document").ready(function(){if($(".subscribe-form-page").length>0){$("#subscribe-popup").remove()}var match=document.cookie.match(new RegExp("(^| )subscription_popup=([^;]+)"));if(match){$("#subscribe-popup").remove()}$(window).scroll(function(){if($("#subscribe-popup").length>0){var body=$(document).height();if($(".page-node-type-visual-explainer").length>0){var body=$(".s-article__main").height()}var scrollPercent=100*$(window).scrollTop()/(body-$(window).height());if(body>10200){if($(window).scrollTop()>=3500){if(!$("#subscribe-popup").hasClass("show")){$("#subscribe-popup").addClass("show")}}}else{if(scrollPercent>=25){if(!$("#subscribe-popup").hasClass("show")){$("#subscribe-popup").addClass("show")}}}}});$("#subscribe-popup .close").click(function(e){e.preventDefault();$("#subscribe-popup").remove();document.cookie="subscription_popup=closed;"})})})(jQuery);(function($){$("document").ready(function(){$(".s-main p, .s-main span, .s-main q, .s-main i, .s-main u, .s-main b, .s-main strong, .s-main h1, .s-main h2, .s-main h3, .s-main h4, .s-main h5, .s-main h6").contents().filter(function(){return this.nodeType==3}).each(function(){var text=this.nodeValue.replace(/'''/g,"â€´").replace(/(\W|^)"(\S)/g,"$1â€œ$2").replace(/(\u201c[^"]*)"([^"]*$|[^\u201c"]*\u201c)/g,"$1â€$2").replace(/([^0-9])"/g,"$1â€").replace(/''/g,"â€³").replace(/(\W|^)'(\S)/g,"$1â€˜$2").replace(/([a-z])'([a-z])/gi,"$1â€™$2").replace(/((\u2018[^']*)|[a-z])'([^0-9]|$)/gi,"$1â€™$3").replace(/(\u2018)([0-9]{2}[^\u2019]*)(\u2018([^0-9]|$)|$|\u2019[a-z])/gi,"â€™$2$3").replace(/(\B|^)\u2018(?=([^\u2019]*\u2019\b)*([^\u2019\u2018]*\W[\u2019\u2018]\b|[^\u2019\u2018]*$))/gi,"$1â€™").replace(/'/g,"â€²");this.nodeValue=text})})})(jQuery);(function($){$("document").ready(function(){if($('a[name^="_ftnref"]').length>0){var footnotes=1;$(".s-visual-article__body").each(function(i,parent){var anchorFootnotes=$(parent).find('a[name^="_ftnref"]');$('a[name^="_ftnref"] sup').contents().unwrap();anchorFootnotes.each(function(i,elem){var href="href="+$(elem).attr("href");var name="name="+$(elem).attr("name");var text=$(elem).find("span:first-child").text();$(elem).find("span:first-child").replaceWith("<a "+href+" "+name+">"+text+"</a>");$(elem).replaceWith("<span "+name+">"+$(elem).html()+"</span>")});anchorFootnotes.each(function(i,elem){var anchorRef=$(elem).attr("href").replace("#_","");if($("#"+anchorRef).length>0){$(parent).find("#"+anchorRef+" p:first-child").wrapInner('<span class="o-footnote__body u-gray"></span>');var anchorText=$(parent).find("#"+anchorRef+" p:first-child").html();var anchorFN=$(parent).find('a[href="#_'+anchorRef+'"]');$(anchorText).insertAfter(anchorFN);anchorFN.parent().find(".o-footnote__body").append('<a class="hide-footnote u-db u-mar-t25" href="#">Hide Footnote</a>');anchorFN.html(footnotes);$('.o-footnote__body a[name^="_ftn"]').remove();footnotes++;anchorFN.click(function(e){e.preventDefault();if($(this).parent().find(".o-footnote__body").hasClass("is-active")){$(this).parent().find(".o-footnote__body").removeClass("is-active")}else{$(this).parent().find(".o-footnote__body").addClass("is-active")}});anchorFN.parent().find(".hide-footnote").click(function(e){e.preventDefault();$(this).parent().removeClass("is-active")});anchorFN.parent().find(".o-footnote__body a").each(function(){if($(this).attr("href")===""||$(this).attr("href")===undefined){var keeping=$(this).contents();$(keeping).insertAfter($(this));$(this).remove()}});$(parent).find("#"+anchorRef).parent().hide()}})})}})})(jQuery);(function($){$("document").ready(function(){if($("#crypto-donate").length>0){$("#crypto-donate").click(function(e){e.preventDefault();var width=400;var height=600;var left=(window.outerWidth-width)/2;var top=(window.outerHeight-height)/2;window.open($("#crypto-donate").attr("href"),"Cryptocurrency","top="+top+",left="+left+",width="+width+",height="+height+",scrollbars=yes")})}$(document).on("change","#amount, #currency",function(){paymentDonate()});paymentDonate();function paymentDonate(){$("#paypal-donate-button").children().remove();$("#apple-pay-button").children().remove();if($("#currency").length>0){var currencyCode=$("#currency").val().toUpperCase();var countryCode="US";if(currencyCode=="GBP"){countryCode="GB"}else if(currencyCode=="EUR"){countryCode="EU"}}if($("#paypal-donate-button").length>0){PayPal.Donation.Button({env:"production",business:"LTFHDDFREKDGN",image:{src:"https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif",alt:"Donate with PayPal button",title:"PayPal - The safer, easier way to pay online!"},amount:$("#amount").val(),currency_code:currencyCode,onComplete:function(params){$.ajax({url:"/charge/paypal",type:"POST",data:params,success:function(data){console.log("success paypal",data)},error:function(data){console.log("error",data)}})}}).render("#paypal-donate-button")}if($("#apple-pay-container").length>0){var stripe=Stripe("pk_live_TBqSlTcKEGk4GjhlzqNqVNRo",{stripeAccount:"acct_18MdPeLXRFzliQmo"});var transactionDetails={currencyCode:currencyCode.toLowerCase(),amount:$("#amount").val()*100};var paymentRequest=stripe.paymentRequest({country:countryCode,currency:currencyCode.toLowerCase(),total:{label:"Donation amount",amount:$("#amount").val()*100,name:$("#fullname").val(),email:$("#email").val()},requestPayerName:true,requestPayerEmail:true});var elements=stripe.elements();var prButton=elements.create("paymentRequestButton",{paymentRequest:paymentRequest});paymentRequest.canMakePayment().then(function(result){if(result){prButton.mount("#apple-pay-button")}else{$("#apple-pay-container").hide()}});paymentRequest.on("paymentmethod",function(e){$.ajax({url:"/charge/apple-pay",type:"POST",data:transactionDetails,success:function(data){console.log("apple-pay-data",data);stripe.confirmCardPayment(data.payment_intent.client_secret,{payment_method:e.paymentMethod.id},{handleActions:false}).then(function(result){if(result.error&&result.error.payment_intent.status!="succeeded"){e.complete("fail");window.location.reload()}else if(result.paymentIntent&&result.paymentIntent.status==="succeeded"||result.paymentIntent&&result.paymentIntent.status==="processing"||result.error&&result.error.payment_intent.status==="succeeded"){e.complete("success");window.location.href=window.location.origin+"/thank-you/"+data.payment_intent.id}else if(result.paymentIntent&&result.paymentIntent.status==="requires_action"){stripe.confirmCardPayment(data.payment_intent.client_secret)}else{window.location.reload()}})}})})}}})})(jQuery);(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){function corslite(n,t,o){function e(n){return n>=200&&300>n||304===n}function i(){void 0===r.status||e(r.status)?t.call(r,null,r):t.call(r,r,null)}var l=!1;if("undefined"==typeof window.XMLHttpRequest)return t(Error("Browser not supported"));if("undefined"==typeof o){var u=n.match(/^\s*https?:\/\/[^\/]*/);o=u&&u[0]!==location.protocol+"//"+location.domain+(location.port?":"+location.port:"")}var r=new window.XMLHttpRequest;if(o&&!("withCredentials"in r)){r=new window.XDomainRequest;var a=t;t=function(){if(l)a.apply(this,arguments);else{var n=this,t=arguments;setTimeout(function(){a.apply(n,t)},0)}}}return"onload"in r?r.onload=i:r.onreadystatechange=function(){4===r.readyState&&i()},r.onerror=function(n){t.call(this,n||!0,null),t=function(){}},r.onprogress=function(){},r.ontimeout=function(n){t.call(this,n,null),t=function(){}},r.onabort=function(n){t.call(this,n,null),t=function(){}},r.open("GET",n,!0),r.send(null),l=!0,r}"undefined"!=typeof module&&(module.exports=corslite)},{}],2:[function(require,module,exports){module.exports=Array.isArray||function(r){return"[object Array]"==Object.prototype.toString.call(r)}},{}],3:[function(require,module,exports){!function(t,e,i){var n=t.L,o={};o.version="0.7.7","object"==typeof module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd&&define(o),o.noConflict=function(){return t.L=n,this},t.L=o,o.Util={extend:function(t){var e,i,n,o,s=Array.prototype.slice.call(arguments,1);for(i=0,n=s.length;n>i;i++){o=s[i]||{};for(e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t},bind:function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,i||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(i){return i[e]=i[e]||++t,i[e]}}(),invokeEach:function(t,e,i){var n,o;if("object"==typeof t){o=Array.prototype.slice.call(arguments,3);for(n in t)e.apply(i,[n,t[n]].concat(o));return!0}return!1},limitExecByInterval:function(t,e,i){var n,o;return function s(){var a=arguments;return n?void(o=!0):(n=!0,setTimeout(function(){n=!1,o&&(s.apply(i,a),o=!1)},e),void t.apply(i,a))}},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return o.Util.trim(t).split(/\s+/)},setOptions:function(t,e){return t.options=o.extend({},t.options,e),t.options},getParamString:function(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,n){var o=e[n];if(o===i)throw new Error("No value provided for variable "+t);return"function"==typeof o&&(o=o(e)),o})},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){var i,n,o=["webkit","moz","o","ms"];for(i=0;i<o.length&&!n;i++)n=t[o[i]+e];return n}function i(e){var i=+new Date,o=Math.max(0,16-(i-n));return n=i+o,t.setTimeout(e,o)}var n=0,s=t.requestAnimationFrame||e("RequestAnimationFrame")||i,a=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};o.Util.requestAnimFrame=function(e,n,a,r){return e=o.bind(e,n),a&&s===i?void e():s.call(t,e,r)},o.Util.cancelAnimFrame=function(e){e&&a.call(t,e)}}(),o.extend=o.Util.extend,o.bind=o.Util.bind,o.stamp=o.Util.stamp,o.setOptions=o.Util.setOptions,o.Class=function(){},o.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},i=function(){};i.prototype=this.prototype;var n=new i;n.constructor=e,e.prototype=n;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&(e[s]=this[s]);t.statics&&(o.extend(e,t.statics),delete t.statics),t.includes&&(o.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),t.options&&n.options&&(t.options=o.extend({},n.options,t.options)),o.extend(n,t),n._initHooks=[];var a=this;return e.__super__=a.prototype,n.callInitHooks=function(){if(!this._initHooksCalled){a.prototype.callInitHooks&&a.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;e>t;t++)n._initHooks[t].call(this)}},e},o.Class.include=function(t){o.extend(this.prototype,t)},o.Class.mergeOptions=function(t){o.extend(this.prototype.options,t)},o.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)};var s="_leaflet_events";o.Mixin={},o.Mixin.Events={addEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addEventListener,this,e,i))return this;var n,a,r,h,l,u,c,d=this[s]=this[s]||{},p=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,a=t.length;a>n;n++)r={action:e,context:i||this},h=t[n],p?(l=h+"_idx",u=l+"_len",c=d[l]=d[l]||{},c[p]||(c[p]=[],d[u]=(d[u]||0)+1),c[p].push(r)):(d[h]=d[h]||[],d[h].push(r));return this},hasEventListeners:function(t){var e=this[s];return!!e&&(t in e&&e[t].length>0||t+"_idx"in e&&e[t+"_idx_len"]>0)},removeEventListener:function(t,e,i){if(!this[s])return this;if(!t)return this.clearAllEventListeners();if(o.Util.invokeEach(t,this.removeEventListener,this,e,i))return this;var n,a,r,h,l,u,c,d,p,_=this[s],m=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,a=t.length;a>n;n++)if(r=t[n],u=r+"_idx",c=u+"_len",d=_[u],e){if(h=m&&d?d[m]:_[r]){for(l=h.length-1;l>=0;l--)h[l].action!==e||i&&h[l].context!==i||(p=h.splice(l,1),p[0].action=o.Util.falseFn);i&&d&&0===h.length&&(delete d[m],_[c]--)}}else delete _[r],delete _[u],delete _[c];return this},clearAllEventListeners:function(){return delete this[s],this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var i,n,a,r,h,l=o.Util.extend({},e,{type:t,target:this}),u=this[s];if(u[t])for(i=u[t].slice(),n=0,a=i.length;a>n;n++)i[n].action.call(i[n].context,l);r=u[t+"_idx"];for(h in r)if(i=r[h].slice())for(n=0,a=i.length;a>n;n++)i[n].action.call(i[n].context,l);return this},addOneTimeEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addOneTimeEventListener,this,e,i))return this;var n=o.bind(function(){this.removeEventListener(t,e,i).removeEventListener(t,n,i)},this);return this.addEventListener(t,e,i).addEventListener(t,n,i)}},o.Mixin.Events.on=o.Mixin.Events.addEventListener,o.Mixin.Events.off=o.Mixin.Events.removeEventListener,o.Mixin.Events.once=o.Mixin.Events.addOneTimeEventListener,o.Mixin.Events.fire=o.Mixin.Events.fireEvent,function(){var n="ActiveXObject"in t,s=n&&!e.addEventListener,a=navigator.userAgent.toLowerCase(),r=-1!==a.indexOf("webkit"),h=-1!==a.indexOf("chrome"),l=-1!==a.indexOf("phantom"),u=-1!==a.indexOf("android"),c=-1!==a.search("android [23]"),d=-1!==a.indexOf("gecko"),p=typeof orientation!=i+"",_=!t.PointerEvent&&t.MSPointerEvent,m=t.PointerEvent&&t.navigator.pointerEnabled||_,f="devicePixelRatio"in t&&t.devicePixelRatio>1||"matchMedia"in t&&t.matchMedia("(min-resolution:144dpi)")&&t.matchMedia("(min-resolution:144dpi)").matches,g=e.documentElement,v=n&&"transition"in g.style,y="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!c,P="MozPerspective"in g.style,L="OTransition"in g.style,x=!t.L_DISABLE_3D&&(v||y||P||L)&&!l,w=!t.L_NO_TOUCH&&!l&&(m||"ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch);o.Browser={ie:n,ielt9:s,webkit:r,gecko:d&&!r&&!t.opera&&!n,android:u,android23:c,chrome:h,ie3d:v,webkit3d:y,gecko3d:P,opera3d:L,any3d:x,mobile:p,mobileWebkit:p&&r,mobileWebkit3d:p&&y,mobileOpera:p&&t.opera,touch:w,msPointer:_,pointer:m,retina:f}}(),o.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},add:function(t){return this.clone()._add(o.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(o.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=o.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=o.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=o.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+o.Util.formatNum(this.x)+", "+o.Util.formatNum(this.y)+")"}},o.point=function(t,e,n){return t instanceof o.Point?t:o.Util.isArray(t)?new o.Point(t[0],t[1]):t===i||null===t?t:new o.Point(t,e,n)},o.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},o.Bounds.prototype={extend:function(t){return t=o.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new o.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new o.Point(this.min.x,this.max.y)},getTopRight:function(){return new o.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof o.Point?o.point(t):o.bounds(t),t instanceof o.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,a=s.x>=e.x&&n.x<=i.x,r=s.y>=e.y&&n.y<=i.y;return a&&r},isValid:function(){return!(!this.min||!this.max)}},o.bounds=function(t,e){return!t||t instanceof o.Bounds?t:new o.Bounds(t,e)},o.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},o.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new o.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},o.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i];if(!n&&t.currentStyle&&(n=t.currentStyle[i]),(!n||"auto"===n)&&e.defaultView){var o=e.defaultView.getComputedStyle(t,null);n=o?o[i]:null}return"auto"===n?null:n},getViewportOffset:function(t){var i,n=0,s=0,a=t,r=e.body,h=e.documentElement;do{if(n+=a.offsetTop||0,s+=a.offsetLeft||0,n+=parseInt(o.DomUtil.getStyle(a,"borderTopWidth"),10)||0,s+=parseInt(o.DomUtil.getStyle(a,"borderLeftWidth"),10)||0,i=o.DomUtil.getStyle(a,"position"),a.offsetParent===r&&"absolute"===i)break;if("fixed"===i){n+=r.scrollTop||h.scrollTop||0,s+=r.scrollLeft||h.scrollLeft||0;break}if("relative"===i&&!a.offsetLeft){var l=o.DomUtil.getStyle(a,"width"),u=o.DomUtil.getStyle(a,"max-width"),c=a.getBoundingClientRect();("none"!==l||"none"!==u)&&(s+=c.left+a.clientLeft),n+=c.top+(r.scrollTop||h.scrollTop||0);break}a=a.offsetParent}while(a);a=t;do{if(a===r)break;n-=a.scrollTop||0,s-=a.scrollLeft||0,a=a.parentNode}while(a);return new o.Point(s,n)},documentIsLtr:function(){return o.DomUtil._docIsLtrCached||(o.DomUtil._docIsLtrCached=!0,o.DomUtil._docIsLtr="ltr"===o.DomUtil.getStyle(e.body,"direction")),o.DomUtil._docIsLtr},create:function(t,i,n){var o=e.createElement(t);return o.className=i,n&&n.appendChild(o),o},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=o.DomUtil._getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=o.Util.splitWords(e),s=0,a=n.length;a>s;s++)t.classList.add(n[s]);else if(!o.DomUtil.hasClass(t,e)){var r=o.DomUtil._getClass(t);o.DomUtil._setClass(t,(r?r+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):o.DomUtil._setClass(t,o.Util.trim((" "+o.DomUtil._getClass(t)+" ").replace(" "+e+" "," ")))},_setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},_getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(o){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},getTranslateString:function(t){var e=o.Browser.webkit3d,i="translate"+(e?"3d":"")+"(",n=(e?",0":"")+")";return i+t.x+"px,"+t.y+"px"+n},getScaleString:function(t,e){var i=o.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),n=" scale("+t+") ";return i+n},setPosition:function(t,e,i){t._leaflet_pos=e,!i&&o.Browser.any3d?t.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},o.DomUtil.TRANSFORM=o.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),o.DomUtil.TRANSITION=o.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),o.DomUtil.TRANSITION_END="webkitTransition"===o.DomUtil.TRANSITION||"OTransition"===o.DomUtil.TRANSITION?o.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in e)o.extend(o.DomUtil,{disableTextSelection:function(){o.DomEvent.on(t,"selectstart",o.DomEvent.preventDefault)},enableTextSelection:function(){o.DomEvent.off(t,"selectstart",o.DomEvent.preventDefault)}});else{var i=o.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);o.extend(o.DomUtil,{disableTextSelection:function(){if(i){var t=e.documentElement.style;this._userSelect=t[i],t[i]="none"}},enableTextSelection:function(){i&&(e.documentElement.style[i]=this._userSelect,delete this._userSelect)}})}o.extend(o.DomUtil,{disableImageDrag:function(){o.DomEvent.on(t,"dragstart",o.DomEvent.preventDefault)},enableImageDrag:function(){o.DomEvent.off(t,"dragstart",o.DomEvent.preventDefault)}})}(),o.LatLng=function(t,e,n){if(t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=t,this.lng=e,n!==i&&(this.alt=parseFloat(n))},o.extend(o.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),o.LatLng.prototype={equals:function(t){if(!t)return!1;t=o.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return e<=o.LatLng.MAX_MARGIN},toString:function(t){return"LatLng("+o.Util.formatNum(this.lat,t)+", "+o.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=o.latLng(t);var e=6378137,i=o.LatLng.DEG_TO_RAD,n=(t.lat-this.lat)*i,s=(t.lng-this.lng)*i,a=this.lat*i,r=t.lat*i,h=Math.sin(n/2),l=Math.sin(s/2),u=h*h+l*l*Math.cos(a)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))},wrap:function(t,e){var i=this.lng;return t=t||-180,e=e||180,i=(i+e)%(e-t)+(t>i||i===e?e:t),new o.LatLng(this.lat,i)}},o.latLng=function(t,e){return t instanceof o.LatLng?t:o.Util.isArray(t)?"number"==typeof t[0]||"string"==typeof t[0]?new o.LatLng(t[0],t[1],t[2]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new o.LatLng(t.lat,"lng"in t?t.lng:t.lon):e===i?null:new o.LatLng(t,e)},o.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},o.LatLngBounds.prototype={extend:function(t){if(!t)return this;var e=o.latLng(t);return t=null!==e?e:o.latLngBounds(t),t instanceof o.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new o.LatLng(t.lat,t.lng),this._northEast=new o.LatLng(t.lat,t.lng)):t instanceof o.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new o.LatLngBounds(new o.LatLng(e.lat-n,e.lng-s),new o.LatLng(i.lat+n,i.lng+s))},getCenter:function(){return new o.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new o.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new o.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof o.LatLng?o.latLng(t):o.latLngBounds(t);var e,i,n=this._southWest,s=this._northEast;return t instanceof o.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=s.lat&&e.lng>=n.lng&&i.lng<=s.lng},intersects:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),a=s.lat>=e.lat&&n.lat<=i.lat,r=s.lng>=e.lng&&n.lng<=i.lng;return a&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=o.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},o.latLngBounds=function(t,e){return!t||t instanceof o.LatLngBounds?t:new o.LatLngBounds(t,e)},o.Projection={},o.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=t.lng*e,a=n*e;return a=Math.log(Math.tan(Math.PI/4+a/2)),new o.Point(s,a)},unproject:function(t){var e=o.LatLng.RAD_TO_DEG,i=t.x*e,n=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new o.LatLng(n,i)}},o.Projection.LonLat={project:function(t){return new o.Point(t.lng,t.lat)},unproject:function(t){return new o.LatLng(t.y,t.x)}},o.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)},getSize:function(t){var e=this.scale(t);return o.point(e,e)}},o.CRS.Simple=o.extend({},o.CRS,{projection:o.Projection.LonLat,transformation:new o.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),o.CRS.EPSG3857=o.extend({},o.CRS,{code:"EPSG:3857",projection:o.Projection.SphericalMercator,transformation:new o.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),i=6378137;return e.multiplyBy(i)}}),o.CRS.EPSG900913=o.extend({},o.CRS.EPSG3857,{code:"EPSG:900913"}),o.CRS.EPSG4326=o.extend({},o.CRS,{code:"EPSG:4326",projection:o.Projection.LonLat,transformation:new o.Transformation(1/360,.5,-1/360,.5)}),o.Map=o.Class.extend({includes:o.Mixin.Events,options:{crs:o.CRS.EPSG3857,fadeAnimation:o.DomUtil.TRANSITION&&!o.Browser.android23,trackResize:!0,markerZoomAnimation:o.DomUtil.TRANSITION&&o.Browser.any3d},initialize:function(t,e){e=o.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=o.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==i&&this.setView(o.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(e.layers)},setView:function(t,e){return e=e===i?this.getZoom():e,this._resetView(o.latLng(t),this._limitZoom(e)),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=this._limitZoom(t),this)},zoomIn:function(t,e){return this.setZoom(this._zoom+(t||1),e)},zoomOut:function(t,e){return this.setZoom(this._zoom-(t||1),e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),s=this.getSize().divideBy(2),a=t instanceof o.Point?t:this.latLngToContainerPoint(t),r=a.subtract(s).multiplyBy(1-1/n),h=this.containerPointToLatLng(s.add(r));return this.setView(h,e,{zoom:i})},fitBounds:function(t,e){e=e||{},t=t.getBounds?t.getBounds():o.latLngBounds(t);var i=o.point(e.paddingTopLeft||e.padding||[0,0]),n=o.point(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,i.add(n));s=e.maxZoom?Math.min(e.maxZoom,s):s;var a=n.subtract(i).divideBy(2),r=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s),l=this.unproject(r.add(h).divideBy(2).add(a),s);return this.setView(l,s,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(o.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=o.latLngBounds(t),this.options.maxBounds=t,t?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(t,e){var i=this.getCenter(),n=this._limitCenter(i,this._zoom,t);return i.equals(n)?this:this.panTo(n,e)},addLayer:function(t){var e=o.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(t),this)},removeLayer:function(t){var e=o.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&this.fire("layerremove",{layer:t}),this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(t){return t?o.stamp(t)in this._layers:!1},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},invalidateSize:function(t){if(!this._loaded)return this;t=o.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),s=i.divideBy(2).round(),a=n.subtract(s);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(t){this._container._leaflet=i}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new o.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom===i?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=o.latLngBounds(t);var n,s=this.getMinZoom()-(e?1:0),a=this.getMaxZoom(),r=this.getSize(),h=t.getNorthWest(),l=t.getSouthEast(),u=!0;i=o.point(i||[0,0]);do{s++,n=this.project(l,s).subtract(this.project(h,s)).add(i),u=e?n.x<r.x||n.y<r.y:r.contains(n)}while(u&&a>=s);return u&&e?null:e?s:s-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new o.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new o.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(o.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(o.point(t),e)},layerPointToLatLng:function(t){var e=o.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(o.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return o.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return o.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(o.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(o.latLng(t)))},mouseEventToContainerPoint:function(t){return o.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=o.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet)throw new Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;o.DomUtil.addClass(t,"leaflet-container"+(o.Browser.touch?" leaflet-touch":"")+(o.Browser.retina?" leaflet-retina":"")+(o.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var e=o.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(o.DomUtil.addClass(t.markerPane,e),o.DomUtil.addClass(t.shadowPane,e),o.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){return o.DomUtil.create("div",t,e||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(t){t=t?o.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;i>e;e++)this.addLayer(t[e])},_resetView:function(t,e,i,n){var s=this._zoom!==e;n||(this.fire("movestart"),s&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),i?this._initialTopLeftPoint._add(this._getMapPanePos()):o.DomUtil.setPosition(this._mapPane,new o.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var a=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!i}),a&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(s||n)&&this.fire("zoomend"),this.fire("moveend",{hard:!i})},_rawPanBy:function(t){o.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,n=-(1/0),o=this._getZoomSpan();for(t in this._zoomBoundLayers){var s=this._zoomBoundLayers[t];isNaN(s.options.minZoom)||(e=Math.min(e,s.options.minZoom)),isNaN(s.options.maxZoom)||(n=Math.max(n,s.options.maxZoom))}t===i?this._layersMaxZoom=this._layersMinZoom=i:(this._layersMaxZoom=n,this._layersMinZoom=e),o!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(o.DomEvent){e=e||"on",o.DomEvent[e](this._container,"click",this._onMouseClick,this);var i,n,s=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,n=s.length;n>i;i++)o.DomEvent[e](this._container,s[i],this._fireMouseEvent,this);this.options.trackResize&&o.DomEvent[e](t,"resize",this._onResize,this)}},_onResize:function(){o.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=o.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(t){!this._loaded||!t._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||o.DomEvent._skipped(t)||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded&&!o.DomEvent._skipped(t)){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&o.DomEvent.preventDefault(t);var i=this.mouseEventToContainerPoint(t),n=this.containerPointToLayerPoint(i),s=this.layerPointToLatLng(n);this.fire(e,{latlng:s,layerPoint:n,containerPoint:i,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var t=0,e=this._handlers.length;e>t;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_layerAdd:function(t){t.onAdd(this),this.fire("layeradd",{layer:t})},_getMapPanePos:function(){return o.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewTopLeftPoint(i,e).add(this._getMapPanePos());return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),s=this.getSize().divideBy(2),a=new o.Bounds(n.subtract(s),n.add(s)),r=this._getBoundsOffset(a,i,e);return this.unproject(n.add(r),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new o.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=this.project(e.getNorthWest(),i).subtract(t.min),s=this.project(e.getSouthEast(),i).subtract(t.max),a=this._rebound(n.x,-s.x),r=this._rebound(n.y,-s.y);return new o.Point(a,r)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return Math.max(e,Math.min(i,t))}}),o.map=function(t,e){return new o.Map(t,e)},o.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=this.R_MAJOR,a=this.R_MINOR,r=t.lng*e*s,h=n*e,l=a/s,u=Math.sqrt(1-l*l),c=u*Math.sin(h);c=Math.pow((1-c)/(1+c),.5*u);var d=Math.tan(.5*(.5*Math.PI-h))/c;return h=-s*Math.log(d),new o.Point(r,h)},unproject:function(t){for(var e,i=o.LatLng.RAD_TO_DEG,n=this.R_MAJOR,s=this.R_MINOR,a=t.x*i/n,r=s/n,h=Math.sqrt(1-r*r),l=Math.exp(-t.y/n),u=Math.PI/2-2*Math.atan(l),c=15,d=1e-7,p=c,_=.1;Math.abs(_)>d&&--p>0;)e=h*Math.sin(u),_=Math.PI/2-2*Math.atan(l*Math.pow((1-e)/(1+e),.5*h))-u,u+=_;return new o.LatLng(u*i,a)}},o.CRS.EPSG3395=o.extend({},o.CRS,{code:"EPSG:3395",projection:o.Projection.Mercator,transformation:function(){var t=o.Projection.Mercator,e=t.R_MAJOR,i=.5/(Math.PI*e);return new o.Transformation(i,.5,-i,.5)}()}),o.TileLayer=o.Class.extend({includes:o.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:o.Browser.mobile,updateWhenIdle:o.Browser.mobile},initialize:function(t,e){e=o.setOptions(this,e),e.detectRetina&&o.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=o.latLngBounds(e.bounds)),this._url=t;var i=this.options.subdomains;"string"==typeof i&&(this.options.subdomains=i.split(""))},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._initContainer(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=o.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var i,n,o,s=t.children,a=-e(1/0,-(1/0));for(n=0,o=s.length;o>n;n++)s[n]!==this._container&&(i=parseInt(s[n].style.zIndex,10),isNaN(i)||(a=e(a,i)));this.options.zIndex=this._container.style.zIndex=(isFinite(a)?a:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(o.Browser.ielt9)for(t in e)o.DomUtil.setOpacity(e[t],this.options.opacity);else o.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=o.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container";this._bgBuffer=o.DomUtil.create("div",e,this._container),this._tileContainer=o.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(t){for(var e in this._tiles)this.fire("tileunload",{tile:this._tiles[e]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var t=this._map,e=t.getZoom()+this.options.zoomOffset,i=this.options.maxNativeZoom,n=this.options.tileSize;return i&&e>i&&(n=Math.round(t.getZoomScale(e)/t.getZoomScale(i)*n)),n},_update:function(){if(this._map){var t=this._map,e=t.getPixelBounds(),i=t.getZoom(),n=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var s=o.bounds(e.min.divideBy(n)._floor(),e.max.divideBy(n)._floor());this._addTilesFromCenterOut(s),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(s)}}},_addTilesFromCenterOut:function(t){var i,n,s,a=[],r=t.getCenter();for(i=t.min.y;i<=t.max.y;i++)for(n=t.min.x;n<=t.max.x;n++)s=new o.Point(n,i),this._tileShouldBeLoaded(s)&&a.push(s);var h=a.length;if(0!==h){a.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)});var l=e.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=h,n=0;h>n;n++)this._addTile(a[n],l);this._tileContainer.appendChild(l)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var i=this._getWrapTileNum();if(e.noWrap&&(t.x<0||t.x>=i.x)||t.y<0||t.y>=i.y)return!1}if(e.bounds){var n=this._getTileSize(),o=t.multiplyBy(n),s=o.add([n,n]),a=this._map.unproject(o),r=this._map.unproject(s);if(e.continuousWorld||e.noWrap||(a=a.wrap(),r=r.wrap()),!e.bounds.intersects([a,r]))return!1}return!0},_removeOtherTiles:function(t){var e,i,n,o;for(o in this._tiles)e=o.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10),(i<t.min.x||i>t.max.x||n<t.min.y||n>t.max.y)&&this._removeTile(o)},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(o.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),o.Browser.android||(e.onload=null,e.src=o.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var i=this._getTilePos(t),n=this._getTile();o.DomUtil.setPosition(n,i,o.Browser.chrome),this._tiles[t.x+":"+t.y]=n,this._loadTile(n,t),n.parentNode!==this._tileContainer&&e.appendChild(n)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this._getTileSize();return t.multiplyBy(i).subtract(e)},getTileUrl:function(t){return o.Util.template(this._url,o.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){var t=this._map.options.crs,e=t.getSize(this._map.getZoom());return e.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e.x+e.x)%e.x),this.options.tms&&(t.y=e.y-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=o.DomUtil.create("img","leaflet-tile");return t.style.width=t.style.height=this._getTileSize()+"px",t.galleryimg="no",t.onselectstart=t.onmousemove=o.Util.falseFn,o.Browser.ielt9&&this.options.opacity!==i&&o.DomUtil.setOpacity(t,this.options.opacity),o.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden"),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e),this.fire("tileloadstart",{tile:t,url:t.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&o.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(o.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==o.Util.emptyImageUrl&&(o.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),o.tileLayer=function(t,e){return new o.TileLayer(t,e)},o.TileLayer.WMS=o.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var i=o.extend({},this.defaultWmsParams),n=e.tileSize||this.options.tileSize;e.detectRetina&&o.Browser.retina?i.width=i.height=2*n:i.width=i.height=n;for(var s in e)this.options.hasOwnProperty(s)||"crs"===s||(i[s]=e[s]);this.wmsParams=i,o.setOptions(this,e)},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,o.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._map,i=this.options.tileSize,n=t.multiplyBy(i),s=n.add([i,i]),a=this._crs.project(e.unproject(n,t.z)),r=this._crs.project(e.unproject(s,t.z)),h=this._wmsVersion>=1.3&&this._crs===o.CRS.EPSG4326?[r.y,a.x,a.y,r.x].join(","):[a.x,r.y,r.x,a.y].join(","),l=o.Util.template(this._url,{s:this._getSubdomain(t)});return l+o.Util.getParamString(this.wmsParams,l,!0)+"&BBOX="+h},setParams:function(t,e){return o.extend(this.wmsParams,t),e||this.redraw(),this}}),o.tileLayer.wms=function(t,e){return new o.TileLayer.WMS(t,e)},o.TileLayer.Canvas=o.TileLayer.extend({options:{async:!1},initialize:function(t){o.setOptions(this,t)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var t in this._tiles)this._redrawTile(this._tiles[t]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTile:function(){var t=o.DomUtil.create("canvas","leaflet-tile");return t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=o.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),o.tileLayer.canvas=function(t){return new o.TileLayer.Canvas(t)},o.ImageOverlay=o.Class.extend({includes:o.Mixin.Events,options:{opacity:1},initialize:function(t,e,i){this._url=t,this._bounds=o.latLngBounds(e),o.setOptions(this,i)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&o.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},setUrl:function(t){this._url=t,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=o.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&o.Browser.any3d?o.DomUtil.addClass(this._image,"leaflet-zoom-animated"):o.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),o.extend(this._image,{galleryimg:"no",onselectstart:o.Util.falseFn,onmousemove:o.Util.falseFn,onload:o.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,i=this._image,n=e.getZoomScale(t.zoom),s=this._bounds.getNorthWest(),a=this._bounds.getSouthEast(),r=e._latLngToNewLayerPoint(s,t.zoom,t.center),h=e._latLngToNewLayerPoint(a,t.zoom,t.center)._subtract(r),l=r._add(h._multiplyBy(.5*(1-1/n)));i.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(l)+" scale("+n+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);o.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){o.DomUtil.setOpacity(this._image,this.options.opacity)}}),o.imageOverlay=function(t,e,i){return new o.ImageOverlay(t,e,i)},o.Icon=o.Class.extend({options:{className:""},initialize:function(t){o.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n;return n=e&&"IMG"===e.tagName?this._createImg(i,e):this._createImg(i),this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i,n=this.options,s=o.point(n[e+"Size"]);i="shadow"===e?o.point(n.shadowAnchor||n.iconAnchor):o.point(n.iconAnchor),!i&&s&&(i=s.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+n.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return o.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),o.icon=function(t){return new o.Icon(t)},o.Icon.Default=o.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];o.Browser.retina&&"icon"===t&&(t+="-2x");var i=o.Icon.Default.imagePath;if(!i)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return i+"/marker-"+t+".png"}}),o.Icon.Default.imagePath=function(){var t,i,n,o,s,a=e.getElementsByTagName("script"),r=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,i=a.length;i>t;t++)if(n=a[t].src,o=n.match(r))return s=n.split(r)[0],(s?s+"/":"")+"images"}(),o.Marker=o.Class.extend({includes:o.Mixin.Events,options:{icon:new o.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){return this._icon&&this._setPos(this._map.latLngToLayerPoint(this._latlng).round()),this},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,n=i?"leaflet-zoom-animated":"leaflet-zoom-hide",s=t.icon.createIcon(this._icon),a=!1;s!==this._icon&&(this._icon&&this._removeIcon(),a=!0,t.title&&(s.title=t.title),t.alt&&(s.alt=t.alt)),o.DomUtil.addClass(s,n),t.keyboard&&(s.tabIndex="0"),this._icon=s,this._initInteraction(),t.riseOnHover&&o.DomEvent.on(s,"mouseover",this._bringToFront,this).on(s,"mouseout",this._resetZIndex,this);var r=t.icon.createShadow(this._shadow),h=!1;r!==this._shadow&&(this._removeShadow(),h=!0),r&&o.DomUtil.addClass(r,n),this._shadow=r,t.opacity<1&&this._updateOpacity();var l=this._map._panes;a&&l.markerPane.appendChild(this._icon),r&&h&&l.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&o.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(t){o.DomUtil.setPosition(this._icon,t),this._shadow&&o.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];o.DomUtil.addClass(t,"leaflet-clickable"),o.DomEvent.on(t,"click",this._onMouseClick,this),o.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)o.DomEvent.on(t,e[i],this._fireMouseEvent,this);o.Handler.MarkerDrag&&(this.dragging=new o.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&o.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t,latlng:this._latlng})},_onKeyPress:function(t){13===t.keyCode&&this.fire("click",{originalEvent:t,latlng:this._latlng})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t,latlng:this._latlng}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&o.DomEvent.preventDefault(t),"mousedown"!==t.type?o.DomEvent.stopPropagation(t):o.DomEvent.preventDefault(t)},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){o.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&o.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),o.marker=function(t,e){return new o.Marker(t,e)},o.DivIcon=o.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;return n.html!==!1?i.innerHTML=n.html:i.innerHTML="",n.bgPos&&(i.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),o.divIcon=function(t){return new o.DivIcon(t)},o.Map.mergeOptions({closePopupOnClick:!0}),o.Popup=o.Class.extend({includes:o.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(t,e){o.setOptions(this,t),this._source=e,this._animated=o.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(t){this._map=t,this._container||this._initLayout();var e=t.options.fadeAnimation;e&&o.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on(this._getEvents(),this),this.update(),e&&o.DomUtil.setOpacity(this._container,1),this.fire("open"),t.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),o.Util.falseFn(this._container.offsetWidth),t.off(this._getEvents(),this),t.options.fadeAnimation&&o.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),t.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t,e="leaflet-popup",i=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),n=this._container=o.DomUtil.create("div",i);this.options.closeButton&&(t=this._closeButton=o.DomUtil.create("a",e+"-close-button",n),t.href="#close",t.innerHTML="&#215;",o.DomEvent.disableClickPropagation(t),o.DomEvent.on(t,"click",this._onCloseButtonClick,this));var s=this._wrapper=o.DomUtil.create("div",e+"-content-wrapper",n);o.DomEvent.disableClickPropagation(s),this._contentNode=o.DomUtil.create("div",e+"-content",s),o.DomEvent.disableScrollPropagation(this._contentNode),o.DomEvent.on(s,"contextmenu",o.DomEvent.stopPropagation),this._tipContainer=o.DomUtil.create("div",e+"-tip-container",n),this._tip=o.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,s=this.options.maxHeight,a="leaflet-popup-scrolled";s&&n>s?(e.height=s+"px",o.DomUtil.addClass(t,a)):o.DomUtil.removeClass(t,a),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,i=o.point(this.options.offset);e&&o.DomUtil.setPosition(this._container,t),this._containerBottom=-i.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);o.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,i=this._containerWidth,n=new o.Point(this._containerLeft,-e-this._containerBottom);this._animated&&n._add(o.DomUtil.getPosition(this._container));var s=t.layerPointToContainerPoint(n),a=o.point(this.options.autoPanPadding),r=o.point(this.options.autoPanPaddingTopLeft||a),h=o.point(this.options.autoPanPaddingBottomRight||a),l=t.getSize(),u=0,c=0;s.x+i+h.x>l.x&&(u=s.x+i-l.x+h.x),s.x-u-r.x<0&&(u=s.x-r.x),s.y+e+h.y>l.y&&(c=s.y+e-l.y+h.y),s.y-c-r.y<0&&(c=s.y-r.y),(u||c)&&t.fire("autopanstart").panBy([u,c])}},_onCloseButtonClick:function(t){this._close(),o.DomEvent.stop(t)}}),o.popup=function(t,e){return new o.Popup(t,e)},o.Map.include({openPopup:function(t,e,i){if(this.closePopup(),!(t instanceof o.Popup)){var n=t;t=new o.Popup(i).setLatLng(e).setContent(n)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&(this.removeLayer(t),t._isOpen=!1),this}}),o.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(t,e){var i=o.point(this.options.icon.options.popupAnchor||[0,0]);return i=i.add(o.Popup.prototype.options.offset),e&&e.offset&&(i=i.add(e.offset)),e=o.extend({offset:i},e),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),t instanceof o.Popup?(o.setOptions(t,e),this._popup=t,t._source=this):this._popup=new o.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),o.LayerGroup=o.Class.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;i>e;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return t?t in this._layers||this.getLayerId(t)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o.stamp(t)}}),o.layerGroup=function(t){return new o.LayerGroup(t)},o.FeatureGroup=o.LayerGroup.extend({includes:o.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(t){return this.hasLayer(t)?this:("on"in t&&t.on(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),"off"in t&&t.off(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:t})):this},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},openPopup:function(t){for(var e in this._layers){this._layers[e].openPopup(t);break}return this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new o.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof o.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t=o.extend({layer:t.target,target:this},t),this.fire(t.type,t)}}),o.featureGroup=function(t){return new o.FeatureGroup(t)},o.Path=o.Class.extend({includes:[o.Mixin.Events],statics:{CLIP_PADDING:function(){var e=o.Browser.mobile?1280:2e3,i=(e/Math.max(t.outerWidth,t.outerHeight)-1)/2;return Math.max(0,Math.min(.5,i))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){o.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,o.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return o.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),o.Map.include({_updatePathViewport:function(){var t=o.Path.CLIP_PADDING,e=this.getSize(),i=o.DomUtil.getPosition(this._mapPane),n=i.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),s=n.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new o.Bounds(n,s)}}),o.Path.SVG_NS="http://www.w3.org/2000/svg",o.Browser.svg=!(!e.createElementNS||!e.createElementNS(o.Path.SVG_NS,"svg").createSVGRect),o.Path=o.Path.extend({statics:{SVG:o.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,i=t.firstChild;return e&&i!==e&&t.insertBefore(e,i),this},getPathString:function(){},_createElement:function(t){return e.createElementNS(o.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&o.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){(o.Browser.svg||!o.Browser.vml)&&o.DomUtil.addClass(this._path,"leaflet-clickable"),o.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;e<t.length;e++)o.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this._map&&this.hasEventListeners(t.type)){var e=this._map,i=e.mouseEventToContainerPoint(t),n=e.containerPointToLayerPoint(i),s=e.layerPointToLatLng(n);this.fire(t.type,{latlng:s,layerPoint:n,containerPoint:i,originalEvent:t}),"contextmenu"===t.type&&o.DomEvent.preventDefault(t),"mousemove"!==t.type&&o.DomEvent.stopPropagation(t)}}}),o.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=o.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&o.Browser.any3d?(o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),i=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(i)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max,n=i.x-e.x,s=i.y-e.y,a=this._pathRoot,r=this._panes.overlayPane;o.Browser.mobileWebkit&&r.removeChild(a),o.DomUtil.setPosition(a,e),a.setAttribute("width",n),a.setAttribute("height",s),a.setAttribute("viewBox",[e.x,e.y,n,s].join(" ")),o.Browser.mobileWebkit&&r.appendChild(a)}}}),o.Path.include({bindPopup:function(t,e){return t instanceof o.Popup?this._popup=t:((!this._popup||e)&&(this._popup=new o.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),o.Browser.vml=!o.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(n){return!1}}(),o.Path=o.Browser.svg||!o.Browser.vml?o.Path:o.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");o.DomUtil.addClass(t,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&o.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,i=this.options,n=this._container;n.stroked=i.stroke,n.filled=i.fill,i.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",n.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,i.dashArray?t.dashStyle=o.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):t.dashStyle="",i.lineCap&&(t.endcap=i.lineCap.replace("butt","flat")),i.lineJoin&&(t.joinstyle=i.lineJoin)):t&&(n.removeChild(t),this._stroke=null),i.fill?(e||(e=this._fill=this._createElement("fill"),n.appendChild(e)),e.color=i.fillColor||i.color,e.opacity=i.fillOpacity):e&&(n.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),o.Map.include(o.Browser.svg||!o.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=e.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),o.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),o.Path=o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?o.Path:o.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return o.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!o.Path._updateRequest&&(o.Path._updateRequest=o.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){o.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color),t.lineCap&&(this._ctx.lineCap=t.lineCap),t.lineJoin&&(this._ctx.lineJoin=t.lineJoin)},_drawPath:function(){var t,e,i,n,s,a;for(this._ctx.beginPath(),t=0,i=this._parts.length;i>t;t++){for(e=0,n=this._parts[t].length;n>e;e++)s=this._parts[t][e],a=(0===e?"move":"line")+"To",this._ctx[a](s.x,s.y);this instanceof o.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill(e.fillRule||"evenodd")),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click dblclick contextmenu",this._fireMouseEvent,this))},_fireMouseEvent:function(t){this._containsPoint(t.layerPoint)&&this.fire(t.type,t)},_onMouseMove:function(t){this._map&&!this._map._animatingZoom&&(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),o.Map.include(o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?{}:{_initPathRoot:function(){var t,i=this._pathRoot;i||(i=this._pathRoot=e.createElement("canvas"),i.style.position="absolute",t=this._canvasCtx=i.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(i),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max.subtract(e),n=this._pathRoot;o.DomUtil.setPosition(n,e),n.width=i.x,n.height=i.y,n.getContext("2d").translate(-e.x,-e.y)}}}),o.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,o=typeof Uint8Array!=i+""?Uint8Array:Array,s=new o(n);s[0]=s[n-1]=1,this._simplifyDPStep(t,s,e,0,n-1);var a,r=[];for(a=0;n>a;a++)s[a]&&r.push(t[a]);return r},_simplifyDPStep:function(t,e,i,n,o){var s,a,r,h=0;for(a=n+1;o-1>=a;a++)r=this._sqClosestPointOnSegment(t[a],t[n],t[o],!0),r>h&&(s=a,h=r);h>i&&(e[s]=1,this._simplifyDPStep(t,e,i,n,s),this._simplifyDPStep(t,e,i,s,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;s>n;n++)this._sqDist(t[n],t[o])>e&&(i.push(t[n]),o=n);return s-1>o&&i.push(t[s-1]),i},clipSegment:function(t,e,i,n){var o,s,a,r=n?this._lastCode:this._getBitCode(t,i),h=this._getBitCode(e,i);for(this._lastCode=h;;){if(!(r|h))return[t,e];if(r&h)return!1;o=r||h,s=this._getEdgeIntersection(t,e,o,i),a=this._getBitCode(s,i),o===r?(t=s,r=a):(e=s,h=a)}},_getEdgeIntersection:function(t,e,i,n){var s=e.x-t.x,a=e.y-t.y,r=n.min,h=n.max;return 8&i?new o.Point(t.x+s*(h.y-t.y)/a,h.y):4&i?new o.Point(t.x+s*(r.y-t.y)/a,r.y):2&i?new o.Point(h.x,t.y+a*(h.x-t.x)/s):1&i?new o.Point(r.x,t.y+a*(r.x-t.x)/s):void 0},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var s,a=e.x,r=e.y,h=i.x-a,l=i.y-r,u=h*h+l*l;return u>0&&(s=((t.x-a)*h+(t.y-r)*l)/u,s>1?(a=i.x,r=i.y):s>0&&(a+=h*s,r+=l*s)),h=t.x-a,l=t.y-r,n?h*h+l*l:new o.Point(a,r)}},o.Polyline=o.Path.extend({initialize:function(t,e){o.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;e>t;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,i="";e>t;t++)i+=this._getPathPartStr(this._parts[t]);return i},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(o.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,i,n=1/0,s=this._parts,a=null,r=0,h=s.length;h>r;r++)for(var l=s[r],u=1,c=l.length;c>u;u++){e=l[u-1],i=l[u];var d=o.LineUtil._sqClosestPointOnSegment(t,e,i,!0);n>d&&(n=d,a=o.LineUtil._sqClosestPointOnSegment(t,e,i))}return a&&(a.distance=Math.sqrt(n)),a},getBounds:function(){return new o.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var i,n,s=e?t:[];for(i=0,n=t.length;n>i;i++){if(o.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;s[i]=o.latLng(t[i])}return s},_initEvents:function(){o.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,i=o.Path.VML,n=0,s=t.length,a="";s>n;n++)e=t[n],i&&e._round(),a+=(n?"L":"M")+e.x+" "+e.y;return a},_clipPoints:function(){var t,e,i,n=this._originalPoints,s=n.length;if(this.options.noClip)return void(this._parts=[n]);this._parts=[];var a=this._parts,r=this._map._pathViewport,h=o.LineUtil;for(t=0,e=0;s-1>t;t++)i=h.clipSegment(n[t],n[t+1],r,t),i&&(a[e]=a[e]||[],a[e].push(i[0]),(i[1]!==n[t+1]||t===s-2)&&(a[e].push(i[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=o.LineUtil,i=0,n=t.length;n>i;i++)t[i]=e.simplify(t[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),o.Path.prototype._updatePath.call(this))}}),o.polyline=function(t,e){return new o.Polyline(t,e)},o.PolyUtil={},o.PolyUtil.clipPolygon=function(t,e){var i,n,s,a,r,h,l,u,c,d=[1,4,2,8],p=o.LineUtil;for(n=0,l=t.length;l>n;n++)t[n]._code=p._getBitCode(t[n],e);for(a=0;4>a;a++){for(u=d[a],i=[],n=0,l=t.length,s=l-1;l>n;s=n++)r=t[n],h=t[s],r._code&u?h._code&u||(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)):(h._code&u&&(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)),i.push(r));t=i}return t},o.Polygon=o.Polyline.extend({options:{fill:!0},initialize:function(t,e){o.Polyline.prototype.initialize.call(this,t,e),this._initWithHoles(t)},_initWithHoles:function(t){var e,i,n;if(t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),e=0,i=this._holes.length;i>e;e++)n=this._holes[e]=this._convertLatLngs(this._holes[e]),n[0].equals(n[n.length-1])&&n.pop();t=this._latlngs,t.length>=2&&t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(o.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,i,n;for(t=0,i=this._holes.length;i>t;t++)for(this._holePoints[t]=[],e=0,n=this._holes[t].length;n>e;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},setLatLngs:function(t){return t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0]?(this._initWithHoles(t),this.redraw()):o.Polyline.prototype.setLatLngs.call(this,t)},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var i=0,n=this._parts.length;n>i;i++){var s=o.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);s.length&&e.push(s)}this._parts=e}},_getPathPartStr:function(t){var e=o.Polyline.prototype._getPathPartStr.call(this,t);return e+(o.Browser.svg?"z":"x")}}),o.polygon=function(t,e){return new o.Polygon(t,e)},function(){function t(t){return o.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var i=0,n=e.length;for(this.eachLayer(function(t){n>i?t.setLatLngs(e[i++]):this.removeLayer(t)},this);n>i;)this.addLayer(new t(e[i++],this._options));return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t.push(e.getLatLngs())}),t}})}o.MultiPolyline=t(o.Polyline),o.MultiPolygon=t(o.Polygon),o.multiPolyline=function(t,e){return new o.MultiPolyline(t,e)},o.multiPolygon=function(t,e){return new o.MultiPolygon(t,e)}}(),o.Rectangle=o.Polygon.extend({initialize:function(t,e){o.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=o.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),o.rectangle=function(t,e){return new o.Rectangle(t,e)},o.Circle=o.Path.extend({initialize:function(t,e,i){o.Path.prototype.initialize.call(this,i),this._latlng=o.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=o.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=this._latlng,i=this._map.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this._map.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1)},getBounds:function(){var t=this._getLngRadius(),e=this._mRadius/40075017*360,i=this._latlng;return new o.LatLngBounds([i.lat-e,i.lng-t],[i.lat+e,i.lng+t])},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":o.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(o.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,i=this._point;return i.x-e>t.max.x||i.y-e>t.max.y||i.x+e<t.min.x||i.y+e<t.min.y}}),o.circle=function(t,e,i){return new o.Circle(t,e,i)},o.CircleMarker=o.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){o.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){o.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(t){return o.Circle.prototype.setLatLng.call(this,t),this._popup&&this._popup._isOpen&&this._popup.setLatLng(t),this},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius}}),o.circleMarker=function(t,e){return new o.CircleMarker(t,e)},o.Polyline.include(o.Path.CANVAS?{_containsPoint:function(t,e){var i,n,s,a,r,h,l,u=this.options.weight/2;for(o.Browser.touch&&(u+=10),i=0,a=this._parts.length;a>i;i++)for(l=this._parts[i],n=0,r=l.length,s=r-1;r>n;s=n++)if((e||0!==n)&&(h=o.LineUtil.pointToSegmentDistance(t,l[s],l[n]),u>=h))return!0;return!1}}:{}),o.Polygon.include(o.Path.CANVAS?{_containsPoint:function(t){var e,i,n,s,a,r,h,l,u=!1;if(o.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(s=0,h=this._parts.length;h>s;s++)for(e=this._parts[s],a=0,l=e.length,r=l-1;l>a;r=a++)i=e[a],n=e[r],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(u=!u);return u}}:{}),o.Circle.include(o.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,i=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+i}}:{}),o.CircleMarker.include(o.Path.CANVAS?{_updateStyle:function(){o.Path.prototype._updateStyle.call(this)}}:{}),o.GeoJSON=o.FeatureGroup.extend({initialize:function(t,e){o.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,s=o.Util.isArray(t)?t:t.features;if(s){for(e=0,i=s.length;i>e;e++)n=s[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(s[e]);return this}var a=this.options;if(!a.filter||a.filter(t)){var r=o.GeoJSON.geometryToLayer(t,a.pointToLayer,a.coordsToLatLng,a);return r.feature=o.GeoJSON.asFeature(t),r.defaultOptions=r.options,this.resetStyle(r),a.onEachFeature&&a.onEachFeature(t,r),this.addLayer(r)}},resetStyle:function(t){var e=this.options.style;e&&(o.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),o.extend(o.GeoJSON,{geometryToLayer:function(t,e,i,n){var s,a,r,h,l="Feature"===t.type?t.geometry:t,u=l.coordinates,c=[];switch(i=i||this.coordsToLatLng,l.type){case"Point":return s=i(u),e?e(t,s):new o.Marker(s);case"MultiPoint":for(r=0,h=u.length;h>r;r++)s=i(u[r]),c.push(e?e(t,s):new o.Marker(s));return new o.FeatureGroup(c);case"LineString":return a=this.coordsToLatLngs(u,0,i),new o.Polyline(a,n);case"Polygon":if(2===u.length&&!u[1].length)throw new Error("Invalid GeoJSON object.");return a=this.coordsToLatLngs(u,1,i),new o.Polygon(a,n);case"MultiLineString":return a=this.coordsToLatLngs(u,1,i),new o.MultiPolyline(a,n);case"MultiPolygon":return a=this.coordsToLatLngs(u,2,i),new o.MultiPolygon(a,n);case"GeometryCollection":for(r=0,h=l.geometries.length;h>r;r++)c.push(this.geometryToLayer({geometry:l.geometries[r],type:"Feature",properties:t.properties},e,i,n));return new o.FeatureGroup(c);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new o.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){var n,o,s,a=[];for(o=0,s=t.length;s>o;o++)n=e?this.coordsToLatLngs(t[o],e-1,i):(i||this.coordsToLatLng)(t[o]),a.push(n);return a},latLngToCoords:function(t){var e=[t.lng,t.lat];return t.alt!==i&&e.push(t.alt),e},latLngsToCoords:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(o.GeoJSON.latLngToCoords(t[i]));return e},getFeature:function(t,e){return t.feature?o.extend({},t.feature,{geometry:e}):o.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var a={toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"Point",coordinates:o.GeoJSON.latLngToCoords(this.getLatLng())})}};o.Marker.include(a),o.Circle.include(a),o.CircleMarker.include(a),o.Polyline.include({toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"LineString",coordinates:o.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),o.Polygon.include({toGeoJSON:function(){var t,e,i,n=[o.GeoJSON.latLngsToCoords(this.getLatLngs())];if(n[0].push(n[0][0]),this._holes)for(t=0,e=this._holes.length;e>t;t++)i=o.GeoJSON.latLngsToCoords(this._holes[t]),i.push(i[0]),n.push(i);return o.GeoJSON.getFeature(this,{type:"Polygon",coordinates:n})}}),function(){function t(t){return function(){var e=[];return this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)}),o.GeoJSON.getFeature(this,{type:t,coordinates:e})}}o.MultiPolyline.include({toGeoJSON:t("MultiLineString")}),o.MultiPolygon.include({toGeoJSON:t("MultiPolygon")}),o.LayerGroup.include({toGeoJSON:function(){var e,i=this.feature&&this.feature.geometry,n=[];if(i&&"MultiPoint"===i.type)return t("MultiPoint").call(this);var s=i&&"GeometryCollection"===i.type;return this.eachLayer(function(t){t.toGeoJSON&&(e=t.toGeoJSON(),n.push(s?e.geometry:o.GeoJSON.asFeature(e)))}),s?o.GeoJSON.getFeature(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}})}(),o.geoJson=function(t,e){return new o.GeoJSON(t,e)},o.DomEvent={addListener:function(t,e,i,n){var s,a,r,h=o.stamp(i),l="_leaflet_"+e+h;return t[l]?this:(s=function(e){return i.call(n||t,e||o.DomEvent._getEvent())},o.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(t,e,s,h):(o.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,s,h),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",s,!1),t.addEventListener(e,s,!1)):"mouseenter"===e||"mouseleave"===e?(a=s,r="mouseenter"===e?"mouseover":"mouseout",s=function(e){return o.DomEvent._checkMouse(t,e)?a(e):void 0},t.addEventListener(r,s,!1)):"click"===e&&o.Browser.android?(a=s,s=function(t){return o.DomEvent._filterClick(t,a)},t.addEventListener(e,s,!1)):t.addEventListener(e,s,!1):"attachEvent"in t&&t.attachEvent("on"+e,s),t[l]=s,this))},removeListener:function(t,e,i){var n=o.stamp(i),s="_leaflet_"+e+n,a=t[s];return a?(o.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,n):o.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,n):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",a,!1),t.removeEventListener(e,a,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",a,!1):t.removeEventListener(e,a,!1):"detachEvent"in t&&t.detachEvent("on"+e,a),t[s]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,o.DomEvent._skipped(t),this},disableScrollPropagation:function(t){var e=o.DomEvent.stopPropagation;return o.DomEvent.on(t,"mousewheel",e).on(t,"MozMousePixelScroll",e)},disableClickPropagation:function(t){for(var e=o.DomEvent.stopPropagation,i=o.Draggable.START.length-1;i>=0;i--)o.DomEvent.on(t,o.Draggable.START[i],e);return o.DomEvent.on(t,"click",o.DomEvent._fakeStop).on(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return o.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new o.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new o.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_skipEvents:{},_fakeStop:function(t){o.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(n){return!1}return i!==t},_getEvent:function(){var e=t.event;if(!e)for(var i=arguments.callee.caller;i&&(e=i.arguments[0],!e||t.Event!==e.constructor);)i=i.caller;return e},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent.timeStamp,n=o.DomEvent._lastClick&&i-o.DomEvent._lastClick;return n&&n>100&&500>n||t.target._simulatedClick&&!t._simulated?void o.DomEvent.stop(t):(o.DomEvent._lastClick=i,e(t))}},o.DomEvent.on=o.DomEvent.addListener,o.DomEvent.off=o.DomEvent.removeListener,o.Draggable=o.Class.extend({includes:o.Mixin.Events,statics:{START:o.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e){this._element=t,this._dragStartTarget=e||t},enable:function(){if(!this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.on(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.off(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(this._moved=!1,!t.shiftKey&&(1===t.which||1===t.button||t.touches)&&(o.DomEvent.stopPropagation(t),!o.Draggable._disabled&&(o.DomUtil.disableImageDrag(),o.DomUtil.disableTextSelection(),!this._moving))){var i=t.touches?t.touches[0]:t;this._startPoint=new o.Point(i.clientX,i.clientY),this._startPos=this._newPos=o.DomUtil.getPosition(this._element),o.DomEvent.on(e,o.Draggable.MOVE[t.type],this._onMove,this).on(e,o.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var i=t.touches&&1===t.touches.length?t.touches[0]:t,n=new o.Point(i.clientX,i.clientY),s=n.subtract(this._startPoint);(s.x||s.y)&&(o.Browser.touch&&Math.abs(s.x)+Math.abs(s.y)<3||(o.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=o.DomUtil.getPosition(this._element).subtract(s),o.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,o.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(s),this._moving=!0,o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),o.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){o.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&&(o.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in o.Draggable.MOVE)o.DomEvent.off(e,o.Draggable.MOVE[t],this._onMove).off(e,o.Draggable.END[t],this._onUp);o.DomUtil.enableImageDrag(),o.DomUtil.enableTextSelection(),this._moved&&this._moving&&(o.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),o.Handler=o.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),o.Map.mergeOptions({dragging:!0,inertia:!o.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:o.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),o.Map.Drag=o.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new o.Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this),t.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,s=(n+e+i)%t-e-i,a=Math.abs(o+i)<Math.abs(s+i)?o:s;this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,i=e.options,n=+new Date-this._lastTime,s=!i.inertia||n>i.inertiaThreshold||!this._positions[0];if(e.fire("dragend",t),s)e.fire("moveend");else{var a=this._lastPos.subtract(this._positions[0]),r=(this._lastTime+n-this._times[0])/1e3,h=i.easeLinearity,l=a.multiplyBy(h/r),u=l.distanceTo([0,0]),c=Math.min(i.inertiaMaxSpeed,u),d=l.multiplyBy(c/u),p=c/(i.inertiaDeceleration*h),_=d.multiplyBy(-p/2).round();_.x&&_.y?(_=e._limitOffset(_,e.options.maxBounds),o.Util.requestAnimFrame(function(){e.panBy(_,{duration:p,easeLinearity:h,noMoveStart:!0})})):e.fire("moveend")}}}),o.Map.addInitHook("addHandler","dragging",o.Map.Drag),o.Map.mergeOptions({doubleClickZoom:!0}),o.Map.DoubleClickZoom=o.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom()+(t.originalEvent.shiftKey?-1:1);"center"===e.options.doubleClickZoom?e.setZoom(i):e.setZoomAround(t.containerPoint,i)}}),o.Map.addInitHook("addHandler","doubleClickZoom",o.Map.DoubleClickZoom),o.Map.mergeOptions({scrollWheelZoom:!0}),o.Map.ScrollWheelZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),o.DomEvent.on(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault),this._delta=0},removeHooks:function(){o.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),o.DomEvent.off(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault)},_onWheelScroll:function(t){var e=o.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o.bind(this._performZoom,this),i),o.DomEvent.preventDefault(t),o.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,i=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(i+e)-i,this._delta=0,this._startTime=null,e&&("center"===t.options.scrollWheelZoom?t.setZoom(i+e):t.setZoomAround(this._lastMousePos,i+e))}}),o.Map.addInitHook("addHandler","scrollWheelZoom",o.Map.ScrollWheelZoom),o.extend(o.DomEvent,{_touchstart:o.Browser.msPointer?"MSPointerDown":o.Browser.pointer?"pointerdown":"touchstart",_touchend:o.Browser.msPointer?"MSPointerUp":o.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,i,n){function s(t){var e;if(o.Browser.pointer?(_.push(t.pointerId),e=_.length):e=t.touches.length,!(e>1)){var i=Date.now(),n=i-(r||i);h=t.touches?t.touches[0]:t,l=n>0&&u>=n,r=i}}function a(t){if(o.Browser.pointer){var e=_.indexOf(t.pointerId);if(-1===e)return;_.splice(e,1)}if(l){if(o.Browser.pointer){var n,s={};for(var a in h)n=h[a],"function"==typeof n?s[a]=n.bind(h):s[a]=n;h=s}h.type="dblclick",i(h),r=null}}var r,h,l=!1,u=250,c="_leaflet_",d=this._touchstart,p=this._touchend,_=[];t[c+d+n]=s,t[c+p+n]=a;var m=o.Browser.pointer?e.documentElement:t;return t.addEventListener(d,s,!1),m.addEventListener(p,a,!1),o.Browser.pointer&&m.addEventListener(o.DomEvent.POINTER_CANCEL,a,!1),this},removeDoubleTapListener:function(t,i){var n="_leaflet_";return t.removeEventListener(this._touchstart,t[n+this._touchstart+i],!1),(o.Browser.pointer?e.documentElement:t).removeEventListener(this._touchend,t[n+this._touchend+i],!1),o.Browser.pointer&&e.documentElement.removeEventListener(o.DomEvent.POINTER_CANCEL,t[n+this._touchend+i],!1),this}}),o.extend(o.DomEvent,{POINTER_DOWN:o.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:o.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:o.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:o.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(t,e,i,n){switch(e){case"touchstart":return this.addPointerListenerStart(t,e,i,n);case"touchend":return this.addPointerListenerEnd(t,e,i,n);case"touchmove":return this.addPointerListenerMove(t,e,i,n);default:throw"Unknown touch event type"}},addPointerListenerStart:function(t,i,n,s){var a="_leaflet_",r=this._pointers,h=function(t){"mouse"!==t.pointerType&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&o.DomEvent.preventDefault(t);for(var e=!1,i=0;i<r.length;i++)if(r[i].pointerId===t.pointerId){e=!0;break}e||r.push(t),t.touches=r.slice(),t.changedTouches=[t],n(t)};if(t[a+"touchstart"+s]=h,t.addEventListener(this.POINTER_DOWN,h,!1),!this._pointerDocumentListener){var l=function(t){for(var e=0;e<r.length;e++)if(r[e].pointerId===t.pointerId){r.splice(e,1);break}};e.documentElement.addEventListener(this.POINTER_UP,l,!1),e.documentElement.addEventListener(this.POINTER_CANCEL,l,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(t,e,i,n){function o(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons){for(var e=0;e<a.length;e++)if(a[e].pointerId===t.pointerId){a[e]=t;break}t.touches=a.slice(),t.changedTouches=[t],i(t)}}var s="_leaflet_",a=this._pointers;return t[s+"touchmove"+n]=o,t.addEventListener(this.POINTER_MOVE,o,!1),this},addPointerListenerEnd:function(t,e,i,n){var o="_leaflet_",s=this._pointers,a=function(t){for(var e=0;e<s.length;e++)if(s[e].pointerId===t.pointerId){s.splice(e,1);break}t.touches=s.slice(),t.changedTouches=[t],i(t)};return t[o+"touchend"+n]=a,t.addEventListener(this.POINTER_UP,a,!1),t.addEventListener(this.POINTER_CANCEL,a,!1),this},removePointerListener:function(t,e,i){var n="_leaflet_",o=t[n+e+i];switch(e){case"touchstart":t.removeEventListener(this.POINTER_DOWN,o,!1);break;case"touchmove":t.removeEventListener(this.POINTER_MOVE,o,!1);break;case"touchend":t.removeEventListener(this.POINTER_UP,o,!1),t.removeEventListener(this.POINTER_CANCEL,o,!1)}return this}}),o.Map.mergeOptions({touchZoom:o.Browser.touch&&!o.Browser.android23,bounceAtZoomLimits:!0}),o.Map.TouchZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToLayerPoint(t.touches[0]),s=i.mouseEventToLayerPoint(t.touches[1]),a=i._getCenterLayerPoint();this._startCenter=n.add(s)._divideBy(2),this._startDist=n.distanceTo(s),this._moved=!1,this._zooming=!0,this._centerOffset=a.subtract(this._startCenter),i._panAnim&&i._panAnim.stop(),o.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),o.DomEvent.preventDefault(t)}},_onTouchMove:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&this._zooming){var i=e.mouseEventToLayerPoint(t.touches[0]),n=e.mouseEventToLayerPoint(t.touches[1]);this._scale=i.distanceTo(n)/this._startDist,this._delta=i._add(n)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(e.options.bounceAtZoomLimits||!(e.getZoom()===e.getMinZoom()&&this._scale<1||e.getZoom()===e.getMaxZoom()&&this._scale>1))&&(this._moved||(o.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),o.DomEvent.preventDefault(t))}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),i=t.layerPointToLatLng(e),n=t.getScaleZoom(this._scale);t._animateZoom(i,n,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var t=this._map;this._zooming=!1,o.DomUtil.removeClass(t._mapPane,"leaflet-touching"),o.Util.cancelAnimFrame(this._animRequest),o.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd);var i=this._getScaleOrigin(),n=t.layerPointToLatLng(i),s=t.getZoom(),a=t.getScaleZoom(this._scale)-s,r=a>0?Math.ceil(a):Math.floor(a),h=t._limitZoom(s+r),l=t.getZoomScale(h)/this._scale;t._animateZoom(n,h,i,l)},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),o.Map.addInitHook("addHandler","touchZoom",o.Map.TouchZoom),o.Map.mergeOptions({tap:!0,tapTolerance:15}),o.Map.Tap=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(o.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new o.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(o.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),o.DomEvent.on(e,"touchmove",this._onMove,this).on(e,"touchend",this._onUp,this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),o.DomEvent.off(e,"touchmove",this._onMove,this).off(e,"touchend",this._onUp,this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.removeClass(n,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new o.Point(e.clientX,e.clientY)},_simulateEvent:function(i,n){var o=e.createEvent("MouseEvents");o._simulated=!0,n.target._simulatedClick=!0,o.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),o.Browser.touch&&!o.Browser.pointer&&o.Map.addInitHook("addHandler","tap",o.Map.Tap),o.Map.mergeOptions({boxZoom:!0}),o.Map.BoxZoom=o.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._moved=!1},addHooks:function(){o.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){o.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(t){return this._moved=!1,!t.shiftKey||1!==t.which&&1!==t.button?!1:(o.DomUtil.disableTextSelection(),o.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),void o.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this))},_onMouseMove:function(t){this._moved||(this._box=o.DomUtil.create("div","leaflet-zoom-box",this._pane),o.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var e=this._startLayerPoint,i=this._box,n=this._map.mouseEventToLayerPoint(t),s=n.subtract(e),a=new o.Point(Math.min(n.x,e.x),Math.min(n.y,e.y));o.DomUtil.setPosition(i,a),this._moved=!0,i.style.width=Math.max(0,Math.abs(s.x)-4)+"px",i.style.height=Math.max(0,Math.abs(s.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),o.DomUtil.enableTextSelection(),o.DomUtil.enableImageDrag(),o.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,i=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(i)){var n=new o.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(i));e.fitBounds(n),e.fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),o.Map.addInitHook("addHandler","boxZoom",o.Map.BoxZoom),o.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),o.Map.Keyboard=o.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;-1===t.tabIndex&&(t.tabIndex="0"),o.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;o.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,o=i.scrollTop||n.scrollTop,s=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(s,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;i>e;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;i>e;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;i>e;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;i>e;e++)n[o.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;i>e;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;i>e;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){o.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){o.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,i=this._map;if(e in this._panKeys){if(i._panAnim&&i._panAnim._inProgress)return;i.panBy(this._panKeys[e]),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds)}else{if(!(e in this._zoomKeys))return;i.setZoom(i.getZoom()+this._zoomKeys[e])}o.DomEvent.stop(t)}}),o.Map.addInitHook("addHandler","keyboard",o.Map.Keyboard),o.Handler.MarkerDrag=o.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new o.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),o.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),o.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,i=o.DomUtil.getPosition(t._icon),n=t._map.layerPointToLatLng(i);e&&o.DomUtil.setPosition(e,i),t._latlng=n,t.fire("move",{latlng:n}).fire("drag")},_onDragEnd:function(t){this._marker.fire("moveend").fire("dragend",t)}}),o.Control=o.Class.extend({options:{position:"topright"},initialize:function(t){o.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return o.DomUtil.addClass(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),o.control=function(t){return new o.Control(t)},o.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,s){var a=i+t+" "+i+s;e[t+s]=o.DomUtil.create("div",a,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=o.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),o.Control.Zoom=o.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=o.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,e+"-in",i,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,e+"-out",i,this._zoomOut,this),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,i,n,s,a){var r=o.DomUtil.create("a",i,n);r.innerHTML=t,r.href="#",r.title=e;var h=o.DomEvent.stopPropagation;return o.DomEvent.on(r,"click",h).on(r,"mousedown",h).on(r,"dblclick",h).on(r,"click",o.DomEvent.preventDefault).on(r,"click",s,a).on(r,"click",this._refocusOnMap,a),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";o.DomUtil.removeClass(this._zoomInButton,e),o.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&o.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&o.DomUtil.addClass(this._zoomInButton,e)}}),o.Map.mergeOptions({zoomControl:!0}),o.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new o.Control.Zoom,this.addControl(this.zoomControl))}),o.control.zoom=function(t){return new o.Control.Zoom(t)},o.Control.Attribution=o.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){o.setOptions(this,t),this._attributions={}},onAdd:function(t){this._container=o.DomUtil.create("div","leaflet-control-attribution"),o.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):void 0},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):void 0},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),o.Map.mergeOptions({attributionControl:!0}),o.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new o.Control.Attribution).addTo(this))}),o.control.attribution=function(t){return new o.Control.Attribution(t)},o.Control.Scale=o.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;var e="leaflet-control-scale",i=o.DomUtil.create("div",e),n=this.options;return this._addScales(n,e,i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=o.DomUtil.create("div",e+"-line",i)),t.imperial&&(this._iScale=o.DomUtil.create("div",e+"-line",i))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,o=this._map.getSize(),s=this.options,a=0;o.x>0&&(a=n*(s.maxWidth/o.x)),this._updateScales(s,a)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,i,n,o=3.2808399*t,s=this._iScale;o>5280?(e=o/5280,i=this._getRoundNum(e),s.style.width=this._getScaleWidth(i/e)+"px",s.innerHTML=i+" mi"):(n=this._getRoundNum(o),s.style.width=this._getScaleWidth(n/o)+"px",s.innerHTML=n+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),o.control.scale=function(t){return new o.Control.Scale(t)},o.Control.Layers=o.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,i){o.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=o.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=o.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),o.Browser.touch?o.DomEvent.on(e,"click",o.DomEvent.stopPropagation):o.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);var i=this._form=o.DomUtil.create("form",t+"-list");if(this.options.collapsed){o.Browser.android||o.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var n=this._layersLink=o.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",o.Browser.touch?o.DomEvent.on(n,"click",o.DomEvent.stop).on(n,"click",this._expand,this):o.DomEvent.on(n,"focus",this._expand,this),o.DomEvent.on(i,"click",function(){setTimeout(o.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=o.DomUtil.create("div",t+"-base",i),this._separator=o.DomUtil.create("div",t+"-separator",i),this._overlaysList=o.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i){var n=o.stamp(t);this._layers[n]={layer:t,name:e,overlay:i},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,i=!1,n=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),n=n||e.overlay,i=i||!e.overlay;this._separator.style.display=n&&i?"":"none"}},_onLayerChange:function(t){var e=this._layers[o.stamp(t.layer)];if(e){this._handlingClick||this._update();var i=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)}},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';i&&(n+=' checked="checked"'),n+="/>";var o=e.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var i,n=e.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=s):i=this._createRadioElement("leaflet-base-layers",s),i.layerId=o.stamp(t.layer),o.DomEvent.on(i,"click",this._onInputClick,this);var a=e.createElement("span");a.innerHTML=" "+t.name,n.appendChild(i),n.appendChild(a);var r=t.overlay?this._overlaysList:this._baseLayersList;return r.appendChild(n),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),o=n.length;for(this._handlingClick=!0,t=0;o>t;t++)e=n[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!e.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){o.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),o.control.layers=function(t,e,i){return new o.Control.Layers(t,e,i)},o.PosAnimation=o.Class.extend({includes:o.Mixin.Events,run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._newPos=e,this.fire("start"),t.style[o.DomUtil.TRANSITION]="all "+(i||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",o.DomEvent.on(t,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),o.DomUtil.setPosition(t,e),o.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(o.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(o.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),o.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var t=this._getPos();return t?(this._el._leaflet_pos=t,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,i,n,s=this._el,a=t.getComputedStyle(s);if(o.Browser.any3d){if(n=a[o.DomUtil.TRANSFORM].match(this._transformRe),!n)return;e=parseFloat(n[1]),i=parseFloat(n[2])}else e=parseFloat(a.left),i=parseFloat(a.top);return new o.Point(e,i,!0)},_onTransitionEnd:function(){o.DomEvent.off(this._el,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[o.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),o.Map.include({setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(o.latLng(t),e,this.options.maxBounds),n=n||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=o.extend({animate:n.animate},n.zoom),n.pan=o.extend({animate:n.animate},n.pan));var s=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=o.point(t).round(),e=e||{},!t.x&&!t.y)return this;if(this._panAnim||(this._panAnim=new o.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){o.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){o.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return(e&&e.animate)===!0||this.getSize().contains(i)?(this.panBy(i,e),!0):!1}}),o.PosAnimation=o.DomUtil.TRANSITION?o.PosAnimation:o.PosAnimation.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=o.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=o.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;e>t?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));o.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){o.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),o.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),o.DomUtil.TRANSITION&&o.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&o.DomUtil.TRANSITION&&o.Browser.any3d&&!o.Browser.android23&&!o.Browser.mobileOpera,this._zoomAnimated&&o.DomEvent.on(this._mapPane,o.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),o.Map.include(o.DomUtil.TRANSITION?{_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/n),s=this._getCenterLayerPoint()._add(o);return i.animate===!0||this.getSize().contains(o)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,s,n,null,!0),!0):!1},_animateZoom:function(t,e,i,n,s,a,r){r||(this._animatingZoom=!0),o.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,o.Draggable&&(o.Draggable._disabled=!0),o.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:t,zoom:e,origin:i,scale:n,delta:s,backwards:a}),setTimeout(o.bind(this._onZoomTransitionEnd,this),250)},this)},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._animatingZoom=!1,o.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),o.Util.requestAnimFrame(function(){this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),o.Draggable&&(o.Draggable._disabled=!1)},this))}}:{}),o.TileLayer.include({_animateZoom:function(t){this._animating||(this._animating=!0,this._prepareBgBuffer());var e=this._bgBuffer,i=o.DomUtil.TRANSFORM,n=t.delta?o.DomUtil.getTranslateString(t.delta):e.style[i],s=o.DomUtil.getScaleString(t.scale,t.origin);e.style[i]=t.backwards?s+" "+n:n+" "+s},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.parentNode.appendChild(t),o.Util.falseFn(e.offsetWidth);var i=this._map.getZoom();(i>this.options.maxZoom||i<this.options.minZoom)&&this._clearBgBuffer(),this._animating=!1},_clearBgBuffer:function(){var t=this._map;!t||t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[o.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer,i=this._getLoadedTilesPercentage(e),n=this._getLoadedTilesPercentage(t);return e&&i>.5&&.5>n?(t.style.visibility="hidden",void this._stopLoadingImages(t)):(e.style.visibility="hidden",e.style[o.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(t){var e,i,n=t.getElementsByTagName("img"),o=0;for(e=0,i=n.length;i>e;e++)n[e].complete&&o++;return o/i},_stopLoadingImages:function(t){var e,i,n,s=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,i=s.length;i>e;e++)n=s[e],n.complete||(n.onload=o.Util.falseFn,n.onerror=o.Util.falseFn,n.src=o.Util.emptyImageUrl,n.parentNode.removeChild(n))}}),o.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locateOptions=o.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o.bind(this._handleGeolocationResponse,this),i=o.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new o.LatLng(e,i),s=180*t.coords.accuracy/40075017,a=s/Math.cos(o.LatLng.DEG_TO_RAD*e),r=o.latLngBounds([e-s,i-a],[e+s,i+a]),h=this._locateOptions;if(h.setView){var l=Math.min(this.getBoundsZoom(r),h.maxZoom);this.setView(n,l)}var u={latlng:n,bounds:r,timestamp:t.timestamp};for(var c in t.coords)"number"==typeof t.coords[c]&&(u[c]=t.coords[c]);this.fire("locationfound",u)}})}(window,document)},{}],4:[function(require,module,exports){!function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e.Mustache={},t(e.Mustache))}(this,function(e){function t(e){return"function"==typeof e}function n(e){return g(e)?"array":typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return null!=e&&"object"==typeof e&&t in e}function o(e,t){return v.call(e,t)}function s(e){return!o(w,e)}function a(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return y[e]})}function u(t,n){function i(){if(w&&!y)for(;v.length;)delete d[v.pop()];else v=[];w=!1,y=!1}function o(e){if("string"==typeof e&&(e=e.split(k,2)),!g(e)||2!==e.length)throw new Error("Invalid tags: "+e);a=new RegExp(r(e[0])+"\\s*"),u=new RegExp("\\s*"+r(e[1])),h=new RegExp("\\s*"+r("}"+e[1]))}if(!t)return[];var a,u,h,f=[],d=[],v=[],w=!1,y=!1;o(n||e.tags);for(var U,T,j,S,V,C,A=new l(t);!A.eos();){if(U=A.pos,j=A.scanUntil(a))for(var I=0,R=j.length;R>I;++I)S=j.charAt(I),s(S)?v.push(d.length):y=!0,d.push(["text",S,U,U+1]),U+=1,"\n"===S&&i();if(!A.scan(a))break;if(w=!0,T=A.scan(E)||"name",A.scan(x),"="===T?(j=A.scanUntil(b),A.scan(b),A.scanUntil(u)):"{"===T?(j=A.scanUntil(h),A.scan(m),A.scanUntil(u),T="&"):j=A.scanUntil(u),!A.scan(u))throw new Error("Unclosed tag at "+A.pos);if(V=[T,j,U,A.pos],d.push(V),"#"===T||"^"===T)f.push(V);else if("/"===T){if(C=f.pop(),!C)throw new Error('Unopened section "'+j+'" at '+U);if(C[1]!==j)throw new Error('Unclosed section "'+C[1]+'" at '+U)}else"name"===T||"{"===T||"&"===T?y=!0:"="===T&&o(j)}if(C=f.pop())throw new Error('Unclosed section "'+C[1]+'" at '+A.pos);return p(c(d))}function c(e){for(var t,n,r=[],i=0,o=e.length;o>i;++i)t=e[i],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}function p(e){for(var t,n,r=[],i=r,o=[],s=0,a=e.length;a>s;++s)switch(t=e[s],t[0]){case"#":case"^":i.push(t),o.push(t),i=t[4]=[];break;case"/":n=o.pop(),n[5]=t[2],i=o.length>0?o[o.length-1][4]:r;break;default:i.push(t)}return r}function l(e){this.string=e,this.tail=e,this.pos=0}function h(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function f(){this.cache={}}var d=Object.prototype.toString,g=Array.isArray||function(e){return"[object Array]"===d.call(e)},v=RegExp.prototype.test,w=/\S/,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},x=/\s*/,k=/\s+/,b=/\s*=/,m=/\s*\}/,E=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},l.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},h.prototype.push=function(e){return new h(e,this)},h.prototype.lookup=function(e){var n,r=this.cache;if(r.hasOwnProperty(e))n=r[e];else{for(var o,s,a=this,u=!1;a;){if(e.indexOf(".")>0)for(n=a.view,o=e.split("."),s=0;null!=n&&s<o.length;)s===o.length-1&&(u=i(n,o[s])),n=n[o[s++]];else n=a.view[e],u=i(a.view,e);if(u)break;a=a.parent}r[e]=n}return t(n)&&(n=n.call(this.view)),n},f.prototype.clearCache=function(){this.cache={}},f.prototype.parse=function(e,t){var n=this.cache,r=n[e];return null==r&&(r=n[e]=u(e,t)),r},f.prototype.render=function(e,t,n){var r=this.parse(e),i=t instanceof h?t:new h(t);return this.renderTokens(r,i,n,e)},f.prototype.renderTokens=function(e,t,n,r){for(var i,o,s,a="",u=0,c=e.length;c>u;++u)s=void 0,i=e[u],o=i[0],"#"===o?s=this.renderSection(i,t,n,r):"^"===o?s=this.renderInverted(i,t,n,r):">"===o?s=this.renderPartial(i,t,n,r):"&"===o?s=this.unescapedValue(i,t):"name"===o?s=this.escapedValue(i,t):"text"===o&&(s=this.rawValue(i)),void 0!==s&&(a+=s);return a},f.prototype.renderSection=function(e,n,r,i){function o(e){return s.render(e,n,r)}var s=this,a="",u=n.lookup(e[1]);if(u){if(g(u))for(var c=0,p=u.length;p>c;++c)a+=this.renderTokens(e[4],n.push(u[c]),r,i);else if("object"==typeof u||"string"==typeof u||"number"==typeof u)a+=this.renderTokens(e[4],n.push(u),r,i);else if(t(u)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");u=u.call(n.view,i.slice(e[3],e[5]),o),null!=u&&(a+=u)}else a+=this.renderTokens(e[4],n,r,i);return a}},f.prototype.renderInverted=function(e,t,n,r){var i=t.lookup(e[1]);return!i||g(i)&&0===i.length?this.renderTokens(e[4],t,n,r):void 0},f.prototype.renderPartial=function(e,n,r){if(r){var i=t(r)?r(e[1]):r[e[1]];return null!=i?this.renderTokens(this.parse(i),n,r,i):void 0}},f.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);return null!=n?n:void 0},f.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);return null!=r?e.escape(r):void 0},f.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.2.1",e.tags=["{{","}}"];var U=new f;e.clearCache=function(){return U.clearCache()},e.parse=function(e,t){return U.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+n(e)+'" was given as the first argument for mustache#render(template, view, partials)');return U.render(e,t,r)},e.to_html=function(n,r,i,o){var s=e.render(n,r,i);return t(o)?void o(s):s},e.escape=a,e.Scanner=l,e.Context=h,e.Writer=f})},{}],5:[function(require,module,exports){function cleanUrl(t){"use strict";return/^https?/.test(t.getScheme())?t.toString():/^mailto?/.test(t.getScheme())?t.toString():"data"==t.getScheme()&&/^image/.test(t.getPath())?t.toString():void 0}function cleanId(t){return t}var html_sanitize=require("./sanitizer-bundle.js");module.exports=function(t){return t?html_sanitize(t,cleanUrl,cleanId):""}},{"./sanitizer-bundle.js":6}],6:[function(require,module,exports){var URI=function(){function e(e){var t=(""+e).match(p);return t?new s(c(t[1]),c(t[2]),c(t[3]),c(t[4]),c(t[5]),c(t[6]),c(t[7])):null}function t(e,t,o,i,l,c,m){var u=new s(n(e,d),n(t,d),a(o),i>0?i.toString():null,n(l,f),null,a(m));return c&&("string"==typeof c?u.setRawQuery(c.replace(/[^?&=0-9A-Za-z_\-~.%]/g,r)):u.setAllParameters(c)),u}function a(e){return"string"==typeof e?encodeURIComponent(e):null}function n(e,t){return"string"==typeof e?encodeURI(e).replace(t,r):null}function r(e){var t=e.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(t>>4&15)+"0123456789ABCDEF".charAt(15&t)}function o(e){return e.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/")}function i(e){if(null===e)return null;for(var t,a=o(e),n=u;(t=a.replace(n,"$1"))!=a;a=t);return a}function l(e,t){var a=e.clone(),n=t.hasScheme();n?a.setRawScheme(t.getRawScheme()):n=t.hasCredentials(),n?a.setRawCredentials(t.getRawCredentials()):n=t.hasDomain(),n?a.setRawDomain(t.getRawDomain()):n=t.hasPort();var r=t.getRawPath(),o=i(r);if(n)a.setPort(t.getPort()),o=o&&o.replace(h,"");else if(n=!!r){if(47!==o.charCodeAt(0)){var l=i(a.getRawPath()||"").replace(h,""),s=l.lastIndexOf("/")+1;o=i((s?l.substring(0,s):"")+i(r)).replace(h,"")}}else o=o&&o.replace(h,""),o!==r&&a.setRawPath(o);return n?a.setRawPath(o):n=t.hasQuery(),n?a.setRawQuery(t.getRawQuery()):n=t.hasFragment(),n&&a.setRawFragment(t.getRawFragment()),a}function s(e,t,a,n,r,o,i){this.scheme_=e,this.credentials_=t,this.domain_=a,this.port_=n,this.path_=r,this.query_=o,this.fragment_=i,this.paramCache_=null}function c(e){return"string"==typeof e&&e.length>0?e:null}var m=new RegExp("(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)"),u=new RegExp(m),h=/^(?:\.\.\/)*(?:\.\.$)?/;s.prototype.toString=function(){var e=[];return null!==this.scheme_&&e.push(this.scheme_,":"),null!==this.domain_&&(e.push("//"),null!==this.credentials_&&e.push(this.credentials_,"@"),e.push(this.domain_),null!==this.port_&&e.push(":",this.port_.toString())),null!==this.path_&&e.push(this.path_),null!==this.query_&&e.push("?",this.query_),null!==this.fragment_&&e.push("#",this.fragment_),e.join("")},s.prototype.clone=function(){return new s(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)},s.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase()},s.prototype.getRawScheme=function(){return this.scheme_},s.prototype.setScheme=function(e){return this.scheme_=n(e,d),this},s.prototype.setRawScheme=function(e){return this.scheme_=e?e:null,this},s.prototype.hasScheme=function(){return null!==this.scheme_},s.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},s.prototype.getRawCredentials=function(){return this.credentials_},s.prototype.setCredentials=function(e){return this.credentials_=n(e,d),this},s.prototype.setRawCredentials=function(e){return this.credentials_=e?e:null,this},s.prototype.hasCredentials=function(){return null!==this.credentials_},s.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},s.prototype.getRawDomain=function(){return this.domain_},s.prototype.setDomain=function(e){return this.setRawDomain(e&&encodeURIComponent(e))},s.prototype.setRawDomain=function(e){return this.domain_=e?e:null,this.setRawPath(this.path_)},s.prototype.hasDomain=function(){return null!==this.domain_},s.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},s.prototype.setPort=function(e){if(e){if(e=Number(e),e!==(65535&e))throw new Error("Bad port number "+e);this.port_=""+e}else this.port_=null;return this},s.prototype.hasPort=function(){return null!==this.port_},s.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},s.prototype.getRawPath=function(){return this.path_},s.prototype.setPath=function(e){return this.setRawPath(n(e,f))},s.prototype.setRawPath=function(e){return e?(e=String(e),this.path_=!this.domain_||/^\//.test(e)?e:"/"+e):this.path_=null,this},s.prototype.hasPath=function(){return null!==this.path_},s.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g," ")},s.prototype.getRawQuery=function(){return this.query_},s.prototype.setQuery=function(e){return this.paramCache_=null,this.query_=a(e),this},s.prototype.setRawQuery=function(e){return this.paramCache_=null,this.query_=e?e:null,this},s.prototype.hasQuery=function(){return null!==this.query_},s.prototype.setAllParameters=function(e){if("object"==typeof e&&!(e instanceof Array)&&(e instanceof Object||"[object Array]"!==Object.prototype.toString.call(e))){var t=[],a=-1;for(var n in e){var r=e[n];"string"==typeof r&&(t[++a]=n,t[++a]=r)}e=t}this.paramCache_=null;for(var o=[],i="",l=0;l<e.length;){var n=e[l++],r=e[l++];o.push(i,encodeURIComponent(n.toString())),i="&",r&&o.push("=",encodeURIComponent(r.toString()))}return this.query_=o.join(""),this},s.prototype.checkParameterCache_=function(){if(!this.paramCache_){var e=this.query_;if(e){for(var t=e.split(/[&\?]/),a=[],n=-1,r=0;r<t.length;++r){var o=t[r].match(/^([^=]*)(?:=(.*))?$/);a[++n]=decodeURIComponent(o[1]).replace(/\+/g," "),a[++n]=decodeURIComponent(o[2]||"").replace(/\+/g," ")}this.paramCache_=a}else this.paramCache_=[]}},s.prototype.setParameterValues=function(e,t){"string"==typeof t&&(t=[t]),this.checkParameterCache_();for(var a=0,n=this.paramCache_,r=[],o=0;o<n.length;o+=2)e===n[o]?a<t.length&&r.push(e,t[a++]):r.push(n[o],n[o+1]);for(;a<t.length;)r.push(e,t[a++]);return this.setAllParameters(r),this},s.prototype.removeParameter=function(e){return this.setParameterValues(e,[])},s.prototype.getAllParameters=function(){return this.checkParameterCache_(),this.paramCache_.slice(0,this.paramCache_.length)},s.prototype.getParameterValues=function(e){this.checkParameterCache_();for(var t=[],a=0;a<this.paramCache_.length;a+=2)e===this.paramCache_[a]&&t.push(this.paramCache_[a+1]);return t},s.prototype.getParameterMap=function(e){this.checkParameterCache_();for(var t={},a=0;a<this.paramCache_.length;a+=2){var n=this.paramCache_[a++],r=this.paramCache_[a++];n in t?t[n].push(r):t[n]=[r]}return t},s.prototype.getParameterValue=function(e){this.checkParameterCache_();for(var t=0;t<this.paramCache_.length;t+=2)if(e===this.paramCache_[t])return this.paramCache_[t+1];return null},s.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)},s.prototype.getRawFragment=function(){return this.fragment_},s.prototype.setFragment=function(e){return this.fragment_=e?encodeURIComponent(e):null,this},s.prototype.setRawFragment=function(e){return this.fragment_=e?e:null,this},s.prototype.hasFragment=function(){return null!==this.fragment_};var p=new RegExp("^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),d=/[#\/\?@]/g,f=/[\#\?]/g;return s.parse=e,s.create=t,s.resolve=l,s.collapse_dots=i,s.utils={mimeTypeOf:function(t){var a=e(t);return/\.html$/.test(a.getPath())?"text/html":"application/javascript"},resolve:function(t,a){return t?l(e(t),e(a)).toString():""+a}},s}(),html4={};if(html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13},html4.atype=html4.atype,html4.ATTRIBS={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"select::tabindex":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::tabindex":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::width":0},html4.ATTRIBS=html4.ATTRIBS,html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256},html4.eflags=html4.eflags,html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:16,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,var:0,video:0,wbr:2},html4.ELEMENTS=html4.ELEMENTS,html4.ELEMENT_DOM_INTERFACES={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement",var:"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"},html4.ELEMENT_DOM_INTERFACES=html4.ELEMENT_DOM_INTERFACES,html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.ueffects=html4.ueffects,html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1},html4.URIEFFECTS=html4.URIEFFECTS,html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.ltypes=html4.ltypes,html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1},html4.LOADERTYPES=html4.LOADERTYPES,"i"!=="I".toLowerCase())throw"I/i problem";var html=function(e){function t(e){if(S.hasOwnProperty(e))return S[e];var t=e.match(P);if(t)return String.fromCharCode(parseInt(t[1],10));if(t=e.match(D))return String.fromCharCode(parseInt(t[1],16));if(I&&k.test(e)){I.innerHTML="&"+e+";";var a=I.textContent;return S[e]=a,a}return"&"+e+";"}function a(e,a){return t(a)}function n(e){return e.replace(x,"")}function r(e){return e.replace(N,a)}function o(e){return(""+e).replace(F,"&amp;").replace(B,"&lt;").replace(q,"&gt;").replace(z,"&#34;")}function i(e){return e.replace(U,"&amp;$1").replace(B,"&lt;").replace(q,"&gt;")}function l(e){var t={cdata:e.cdata||e.cdata,comment:e.comment||e.comment,endDoc:e.endDoc||e.endDoc,endTag:e.endTag||e.endTag,pcdata:e.pcdata||e.pcdata,rcdata:e.rcdata||e.rcdata,startDoc:e.startDoc||e.startDoc,startTag:e.startTag||e.startTag};return function(e,a){return s(e,t,a)}}function s(e,t,a){var n=u(e),r={noMoreGT:!1,noMoreEndComments:!1};m(t,n,0,r,a)}function c(e,t,a,n,r){return function(){m(e,t,a,n,r)}}function m(t,a,n,r,o){try{t.startDoc&&0==n&&t.startDoc(o);for(var i,l,s,m=n,u=a.length;u>m;){var f=a[m++],g=a[m];switch(f){case"&":O.test(g)?(t.pcdata&&t.pcdata("&"+g,o,Y,c(t,a,m,r,o)),m++):t.pcdata&&t.pcdata("&amp;",o,Y,c(t,a,m,r,o));break;case"</":(i=/^([-\w:]+)[^\'\"]*/.exec(g))?i[0].length===g.length&&">"===a[m+1]?(m+=2,s=i[1].toLowerCase(),t.endTag&&t.endTag(s,o,Y,c(t,a,m,r,o))):m=h(a,m,t,o,Y,r):t.pcdata&&t.pcdata("&lt;/",o,Y,c(t,a,m,r,o));break;case"<":if(i=/^([-\w:]+)\s*\/?/.exec(g))if(i[0].length===g.length&&">"===a[m+1]){m+=2,s=i[1].toLowerCase(),t.startTag&&t.startTag(s,[],o,Y,c(t,a,m,r,o));var E=e.ELEMENTS[s];if(E&j){var T={name:s,next:m,eflags:E};m=d(a,T,t,o,Y,r)}}else m=p(a,m,t,o,Y,r);else t.pcdata&&t.pcdata("&lt;",o,Y,c(t,a,m,r,o));break;case"\x3c!--":if(!r.noMoreEndComments){for(l=m+1;u>l&&(">"!==a[l]||!/--$/.test(a[l-1]));l++);if(u>l){if(t.comment){var L=a.slice(m,l).join("");t.comment(L.substr(0,L.length-2),o,Y,c(t,a,l+1,r,o))}m=l+1}else r.noMoreEndComments=!0}r.noMoreEndComments&&t.pcdata&&t.pcdata("&lt;!--",o,Y,c(t,a,m,r,o));break;case"<!":if(/^\w/.test(g)){if(!r.noMoreGT){for(l=m+1;u>l&&">"!==a[l];l++);u>l?m=l+1:r.noMoreGT=!0}r.noMoreGT&&t.pcdata&&t.pcdata("&lt;!",o,Y,c(t,a,m,r,o))}else t.pcdata&&t.pcdata("&lt;!",o,Y,c(t,a,m,r,o));break;case"<?":if(!r.noMoreGT){for(l=m+1;u>l&&">"!==a[l];l++);u>l?m=l+1:r.noMoreGT=!0}r.noMoreGT&&t.pcdata&&t.pcdata("&lt;?",o,Y,c(t,a,m,r,o));break;case">":t.pcdata&&t.pcdata("&gt;",o,Y,c(t,a,m,r,o));break;case"":break;default:t.pcdata&&t.pcdata(f,o,Y,c(t,a,m,r,o))}}t.endDoc&&t.endDoc(o)}catch(M){if(M!==Y)throw M}}function u(e){var t=/(<\/|<\!--|<[!?]|[&<>])/g;if(e+="",$)return e.split(t);for(var a,n=[],r=0;null!==(a=t.exec(e));)n.push(e.substring(r,a.index)),n.push(a[0]),r=a.index+a[0].length;return n.push(e.substring(r)),n}function h(e,t,a,n,r,o){var i=f(e,t);return i?(a.endTag&&a.endTag(i.name,n,r,c(a,e,t,o,n)),i.next):e.length}function p(e,t,a,n,r,o){var i=f(e,t);return i?(a.startTag&&a.startTag(i.name,i.attrs,n,r,c(a,e,i.next,o,n)),i.eflags&j?d(e,i,a,n,r,o):i.next):e.length}function d(t,a,n,r,o,l){var s=t.length;Q.hasOwnProperty(a.name)||(Q[a.name]=new RegExp("^"+a.name+"(?:[\\s\\/]|$)","i"));for(var m=Q[a.name],u=a.next,h=a.next+1;s>h&&("</"!==t[h-1]||!m.test(t[h]));h++);s>h&&(h-=1);var p=t.slice(u,h).join("");if(a.eflags&e.eflags.CDATA)n.cdata&&n.cdata(p,r,o,c(n,t,h,l,r));else{if(!(a.eflags&e.eflags.RCDATA))throw new Error("bug");n.rcdata&&n.rcdata(i(p),r,o,c(n,t,h,l,r))}return h}function f(t,a){var n=/^([-\w:]+)/.exec(t[a]),r={};r.name=n[1].toLowerCase(),r.eflags=e.ELEMENTS[r.name];for(var o=t[a].substr(n[0].length),i=a+1,l=t.length;l>i&&">"!==t[i];i++)o+=t[i];if(i>=l)return void 0;for(var s=[];""!==o;)if(n=G.exec(o)){if(n[4]&&!n[5]||n[6]&&!n[7]){for(var c=n[4]||n[6],m=!1,u=[o,t[i++]];l>i;i++){if(m){if(">"===t[i])break}else 0<=t[i].indexOf(c)&&(m=!0);u.push(t[i])}if(i>=l)break;o=u.join("");continue}var h=n[1].toLowerCase(),p=n[2]?g(n[3]):"";s.push(h,p),o=o.substr(n[0].length)}else o=o.replace(/^[\s\S][^a-z\s]*/,"");return r.attrs=s,r.next=i+1,r}function g(e){var t=e.charCodeAt(0);return(34===t||39===t)&&(e=e.substr(1,e.length-2)),r(n(e))}function E(t){var a,n,r=function(e,t){n||t.push(e)};return l({startDoc:function(e){a=[],n=!1},startTag:function(r,i,l){if(!n&&e.ELEMENTS.hasOwnProperty(r)){var s=e.ELEMENTS[r];if(!(s&e.eflags.FOLDABLE)){var c=t(r,i);if(!c)return void(n=!(s&e.eflags.EMPTY));if("object"!=typeof c)throw new Error("tagPolicy did not return object (old API?)");if(!("attribs"in c))throw new Error("tagPolicy gave no attribs");i=c.attribs;var m,u;if("tagName"in c?(u=c.tagName,m=e.ELEMENTS[u]):(u=r,m=s),s&e.eflags.OPTIONAL_ENDTAG){var h=a[a.length-1];!h||h.orig!==r||h.rep===u&&r===u||l.push("</",h.rep,">")}s&e.eflags.EMPTY||a.push({orig:r,rep:u}),l.push("<",u);for(var p=0,d=i.length;d>p;p+=2){var f=i[p],g=i[p+1];null!==g&&void 0!==g&&l.push(" ",f,'="',o(g),'"')}l.push(">"),s&e.eflags.EMPTY&&!(m&e.eflags.EMPTY)&&l.push("</",u,">")}}},endTag:function(t,r){if(n)return void(n=!1);if(e.ELEMENTS.hasOwnProperty(t)){var o=e.ELEMENTS[t];if(!(o&(e.eflags.EMPTY|e.eflags.FOLDABLE))){var i;if(o&e.eflags.OPTIONAL_ENDTAG)for(i=a.length;--i>=0;){var l=a[i].orig;if(l===t)break;if(!(e.ELEMENTS[l]&e.eflags.OPTIONAL_ENDTAG))return}else for(i=a.length;--i>=0&&a[i].orig!==t;);if(0>i)return;for(var s=a.length;--s>i;){var c=a[s].rep;e.ELEMENTS[c]&e.eflags.OPTIONAL_ENDTAG||r.push("</",c,">")}i<a.length&&(t=a[i].rep),a.length=i,r.push("</",t,">")}}},pcdata:r,rcdata:r,cdata:r,endDoc:function(e){for(;a.length;a.length--)e.push("</",a[a.length-1].rep,">")}})}function T(e,t,a,n,r){if(!r)return null;try{var o=URI.parse(""+e);if(o&&(!o.hasScheme()||V.test(o.getScheme()))){var i=r(o,t,a,n);return i?i.toString():null}}catch(l){return null}return null}function L(e,t,a,n,r){if(a||e(t+" removed",{change:"removed",tagName:t}),n!==r){var o="changed";n&&!r?o="removed":!n&&r&&(o="added"),e(t+"."+a+" "+o,{change:o,tagName:t,attribName:a,oldValue:n,newValue:r})}}function M(e,t,a){var n;return n=t+"::"+a,e.hasOwnProperty(n)?e[n]:(n="*::"+a,e.hasOwnProperty(n)?e[n]:void 0)}function b(t,a){return M(e.LOADERTYPES,t,a)}function y(t,a){return M(e.URIEFFECTS,t,a)}function v(t,a,n,r,o){for(var i=0;i<a.length;i+=2){var l,s=a[i],c=a[i+1],m=c,u=null;if(l=t+"::"+s,(e.ATTRIBS.hasOwnProperty(l)||(l="*::"+s,e.ATTRIBS.hasOwnProperty(l)))&&(u=e.ATTRIBS[l]),null!==u)switch(u){case e.atype.NONE:break;case e.atype.SCRIPT:c=null,o&&L(o,t,s,m,c);break;case e.atype.STYLE:if("undefined"==typeof A){c=null,o&&L(o,t,s,m,c);break}var h=[];A(c,{declaration:function(t,a){var r=t.toLowerCase(),o=C[r];o&&(R(r,o,a,n?function(t){return T(t,e.ueffects.SAME_DOCUMENT,e.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:r},n)}:null),h.push(t+": "+a.join(" ")))}}),c=h.length>0?h.join(" ; "):null,o&&L(o,t,s,m,c);break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:c=r?r(c):c,o&&L(o,t,s,m,c);break;case e.atype.URI:c=T(c,y(t,s),b(t,s),{TYPE:"MARKUP",XML_ATTR:s,XML_TAG:t},n),o&&L(o,t,s,m,c);break;case e.atype.URI_FRAGMENT:c&&"#"===c.charAt(0)?(c=c.substring(1),c=r?r(c):c,null!==c&&void 0!==c&&(c="#"+c)):c=null,o&&L(o,t,s,m,c);break;default:c=null,o&&L(o,t,s,m,c)}else c=null,o&&L(o,t,s,m,c);a[i+1]=c}return a}function H(t,a,n){return function(r,o){return e.ELEMENTS[r]&e.eflags.UNSAFE?void(n&&L(n,r,void 0,void 0,void 0)):{attribs:v(r,o,t,a,n)}}}function _(e,t){var a=[];return E(t)(e,a),a.join("")}function w(e,t,a,n){var r=H(t,a,n);return _(e,r)}var A,R,C;"undefined"!=typeof window&&(A=window.parseCssDeclarations,R=window.sanitizeCssProperty,C=window.cssSchema);var S={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:"Â "},P=/^#(\d+)$/,D=/^#x([0-9A-Fa-f]+)$/,k=/^[A-Za-z][A-za-z0-9]+$/,I="undefined"!=typeof window&&window.document?window.document.createElement("textarea"):null,x=/\0/g,N=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,O=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,F=/&/g,U=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,B=/[<]/g,q=/>/g,z=/\"/g,G=new RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?","i"),$=3==="a,b".split(/(,)/).length,j=e.eflags.CDATA|e.eflags.RCDATA,Y={},Q={},V=/^(?:https?|mailto|data)$/i,X={};return X.escapeAttrib=X.escapeAttrib=o,X.makeHtmlSanitizer=X.makeHtmlSanitizer=E,X.makeSaxParser=X.makeSaxParser=l,X.makeTagPolicy=X.makeTagPolicy=H,X.normalizeRCData=X.normalizeRCData=i,X.sanitize=X.sanitize=w,X.sanitizeAttribs=X.sanitizeAttribs=v,X.sanitizeWithPolicy=X.sanitizeWithPolicy=_,X.unescapeEntities=X.unescapeEntities=r,X}(html4),html_sanitize=html.sanitize;html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0,"undefined"!=typeof module&&(module.exports=html_sanitize)},{}],7:[function(require,module,exports){module.exports={author:"Mapbox",name:"mapbox.js",description:"mapbox javascript api",version:"2.4.0",homepage:"http://mapbox.com/",repository:{type:"git",url:"git://github.com/mapbox/mapbox.js.git"},main:"src/index.js",dependencies:{corslite:"0.0.6",isarray:"0.0.1",leaflet:"0.7.7",mustache:"2.2.1","sanitize-caja":"0.1.3"},scripts:{test:"eslint --no-eslintrc -c .eslintrc src && mocha-phantomjs test/index.html"},license:"BSD-3-Clause",devDependencies:{browserify:"^13.0.0","clean-css":"~2.0.7",eslint:"^0.23.0","expect.js":"0.3.1",happen:"0.1.3","leaflet-fullscreen":"0.0.4","leaflet-hash":"0.2.1",marked:"~0.3.0",minifyify:"^6.1.0",minimist:"0.0.5",mocha:"2.4.5","mocha-phantomjs":"4.0.2",sinon:"1.10.2"},optionalDependencies:{},engines:{node:"*"}}},{}],8:[function(require,module,exports){"use strict";module.exports={HTTP_URL:"http://a.tiles.mapbox.com/v4",HTTPS_URL:"https://a.tiles.mapbox.com/v4",FORCE_HTTPS:!1,REQUIRE_ACCESS_TOKEN:!0}},{}],9:[function(require,module,exports){"use strict";var util=require("./util"),format_url=require("./format_url"),request=require("./request"),marker=require("./marker"),simplestyle=require("./simplestyle"),FeatureLayer=L.FeatureGroup.extend({options:{filter:function(){return!0},sanitizer:require("sanitize-caja"),style:simplestyle.style,popupOptions:{closeButton:!1}},initialize:function(e,t){L.setOptions(this,t),this._layers={},"string"==typeof e?util.idUrl(e,this):e&&"object"==typeof e&&this.setGeoJSON(e)},setGeoJSON:function(e){return this._geojson=e,this.clearLayers(),this._initialize(e),this},getGeoJSON:function(){return this._geojson},loadURL:function(e){return this._request&&"abort"in this._request&&this._request.abort(),this._request=request(e,L.bind(function(t,i){this._request=null,t&&"abort"!==t.type?(util.log("could not load features at "+e),this.fire("error",{error:t})):i&&(this.setGeoJSON(i),this.fire("ready"))},this)),this},loadID:function(e){return this.loadURL(format_url("/v4/"+e+"/features.json",this.options.accessToken))},setFilter:function(e){return this.options.filter=e,this._geojson&&(this.clearLayers(),this._initialize(this._geojson)),this},getFilter:function(){return this.options.filter},_initialize:function(e){var t,i,r=L.Util.isArray(e)?e:e.features;if(r)for(t=0,i=r.length;i>t;t++)(r[t].geometries||r[t].geometry||r[t].features)&&this._initialize(r[t]);else if(this.options.filter(e)){var s={accessToken:this.options.accessToken},o=this.options.pointToLayer||function(e,t){return marker.style(e,t,s)},n=L.GeoJSON.geometryToLayer(e,o),u=marker.createPopup(e,this.options.sanitizer),a=this.options.style,l=a===simplestyle.style;!(a&&"setStyle"in n)||l&&(n instanceof L.Circle||n instanceof L.CircleMarker)||("function"==typeof a&&(a=a(e)),n.setStyle(a)),n.feature=e,u&&n.bindPopup(u,this.options.popupOptions),this.addLayer(n)}}});module.exports.FeatureLayer=FeatureLayer,module.exports.featureLayer=function(e,t){return new FeatureLayer(e,t)}},{"./format_url":11,"./marker":25,"./request":26,"./simplestyle":28,"./util":31,"sanitize-caja":5}],10:[function(require,module,exports){"use strict";var Feedback=L.Class.extend({includes:L.Mixin.Events,data:{},record:function(e){L.extend(this.data,e),this.fire("change")}});module.exports=new Feedback},{}],11:[function(require,module,exports){"use strict";var config=require("./config"),version=require("../package.json").version;module.exports=function(e,o){if(o=o||L.mapbox.accessToken,!o&&config.REQUIRE_ACCESS_TOKEN)throw new Error("An API access token is required to use Mapbox.js. See https://www.mapbox.com/mapbox.js/api/v"+version+"/api-access-tokens/");var t="https:"===document.location.protocol||config.FORCE_HTTPS?config.HTTPS_URL:config.HTTP_URL;if(t=t.replace(/\/v4$/,""),t+=e,config.REQUIRE_ACCESS_TOKEN){if("s"===o[0])throw new Error("Use a public access token (pk.*) with Mapbox.js, not a secret access token (sk.*). See https://www.mapbox.com/mapbox.js/api/v"+version+"/api-access-tokens/");t+=-1!==t.indexOf("?")?"&access_token=":"?access_token=",t+=o}return t},module.exports.tileJSON=function(e,o){if(0===e.indexOf("mapbox://styles"))throw new Error("Styles created with Mapbox Studio need to be used with L.mapbox.styleLayer, not L.mapbox.tileLayer");if(-1!==e.indexOf("/"))return e;var t=module.exports("/v4/"+e+".json",o);return 0===t.indexOf("https")&&(t+="&secure"),t},module.exports.style=function(e,o){if(-1===e.indexOf("mapbox://styles/"))throw new Error("Incorrectly formatted Mapbox style at "+e);var t=e.split("mapbox://styles/")[1],s=module.exports("/styles/v1/"+t,o).replace("http://","https://");return s}},{"../package.json":7,"./config":8}],12:[function(require,module,exports){"use strict";var isArray=require("isarray"),util=require("./util"),format_url=require("./format_url"),feedback=require("./feedback"),request=require("./request");module.exports=function(e,t){function r(e,t){var r=Math.pow(10,t);return e.lat=Math.round(e.lat*r)/r,e.lng=Math.round(e.lng*r)/r,e}t||(t={});var n={};return util.strict(e,"string"),-1===e.indexOf("/")&&(e=format_url("/geocoding/v5/"+e+"/{query}.json",t.accessToken,5)),n.getURL=function(){return e},n.queryURL=function(e){var t=!(isArray(e)||"string"==typeof e),u=t?e.query:e;if(isArray(u)){for(var o=[],i=0;i<u.length;i++)o[i]=encodeURIComponent(u[i]);u=o.join(";")}else u=encodeURIComponent(u);feedback.record({geocoding:u});var a=L.Util.template(n.getURL(),{query:u});if(t){if(e.types&&(a+=isArray(e.types)?"&types="+e.types.join():"&types="+e.types),e.country&&(a+=isArray(e.country)?"&country="+e.country.join():"&country="+e.country),e.proximity){var l=r(L.latLng(e.proximity),3);a+="&proximity="+l.lng+","+l.lat}"boolean"==typeof e.autocomplete&&(a+="&autocomplete="+e.autocomplete)}return a},n.query=function(e,t){return util.strict(t,"function"),request(n.queryURL(e),function(e,r){if(r&&(r.length||r.features)){var n={results:r};r.features&&r.features.length&&(n.latlng=[r.features[0].center[1],r.features[0].center[0]],r.features[0].bbox&&(n.bounds=r.features[0].bbox,n.lbounds=util.lbounds(n.bounds))),t(null,n)}else t(e||!0)}),n},n.reverseQuery=function(e,t){function u(e){var t;return t=void 0!==e.lat&&void 0!==e.lng?L.latLng(e.lat,e.lng):void 0!==e.lat&&void 0!==e.lon?L.latLng(e.lat,e.lon):L.latLng(e[1],e[0]),t=r(t,5),t.lng+","+t.lat}var o="";if(e.length&&e[0].length){for(var i=0,a=[];i<e.length;i++)a.push(u(e[i]));o=a.join(";")}else o=u(e);return request(n.queryURL(o),function(e,r){t(e,r)}),n},n}},{"./feedback":10,"./format_url":11,"./request":26,"./util":31,isarray:2}],13:[function(require,module,exports){"use strict";var geocoder=require("./geocoder"),util=require("./util"),GeocoderControl=L.Control.extend({includes:L.Mixin.Events,options:{proximity:!0,position:"topleft",pointZoom:16,keepOpen:!1,autocomplete:!1,queryOptions:{}},initialize:function(t,e){L.Util.setOptions(this,e),this.setURL(t),this._updateSubmit=L.bind(this._updateSubmit,this),this._updateAutocomplete=L.bind(this._updateAutocomplete,this),this._chooseResult=L.bind(this._chooseResult,this)},setURL:function(t){return this.geocoder=geocoder(t,{accessToken:this.options.accessToken}),this},getURL:function(){return this.geocoder.getURL()},setID:function(t){return this.setURL(t)},setTileJSON:function(t){return this.setURL(t.geocoder)},_toggle:function(t){t&&L.DomEvent.stop(t),L.DomUtil.hasClass(this._container,"active")?(L.DomUtil.removeClass(this._container,"active"),this._results.innerHTML="",this._input.blur()):(L.DomUtil.addClass(this._container,"active"),this._input.focus(),this._input.select())},_closeIfOpen:function(){L.DomUtil.hasClass(this._container,"active")&&!this.options.keepOpen&&(L.DomUtil.removeClass(this._container,"active"),this._results.innerHTML="",this._input.blur())},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-control-mapbox-geocoder leaflet-bar leaflet-control"),i=L.DomUtil.create("a","leaflet-control-mapbox-geocoder-toggle mapbox-icon mapbox-icon-geocoder",e),o=L.DomUtil.create("div","leaflet-control-mapbox-geocoder-results",e),s=L.DomUtil.create("div","leaflet-control-mapbox-geocoder-wrap",e),n=L.DomUtil.create("form","leaflet-control-mapbox-geocoder-form",s),r=L.DomUtil.create("input","",n);return i.href="#",i.innerHTML="&nbsp;",r.type="text",r.setAttribute("placeholder","Search"),L.DomEvent.addListener(n,"submit",this._geocode,this),L.DomEvent.addListener(r,"keyup",this._autocomplete,this),L.DomEvent.disableClickPropagation(e),this._map=t,this._results=o,this._input=r,this._form=n,this.options.keepOpen?L.DomUtil.addClass(e,"active"):(this._map.on("click",this._closeIfOpen,this),L.DomEvent.addListener(i,"click",this._toggle,this)),e},_updateSubmit:function(t,e){if(L.DomUtil.removeClass(this._container,"searching"),this._results.innerHTML="",t||!e)this.fire("error",{error:t});else{var i=[];e.results&&e.results.features&&(i=e.results.features),1===i.length?(this.fire("autoselect",{feature:i[0]}),this.fire("found",{results:e.results}),this._chooseResult(i[0]),this._closeIfOpen()):i.length>1?(this.fire("found",{results:e.results}),this._displayResults(i)):(this.fire("notfound"),this._displayResults(i))}},_updateAutocomplete:function(t,e){if(this._results.innerHTML="",t||!e)this.fire("error",{error:t});else{var i=[];e.results&&e.results.features&&(i=e.results.features),i.length?this.fire("found",{results:e.results}):this.fire("notfound"),this._displayResults(i)}},_displayResults:function(t){for(var e=0,i=Math.min(t.length,5);i>e;e++){var o=t[e],s=o.place_name;if(s.length){var n=L.DomUtil.create("a","",this._results),r="innerText"in n?"innerText":"textContent";n[r]=s,n.setAttribute("title",s),n.href="#",L.bind(function(t){L.DomEvent.addListener(n,"click",function(e){this._chooseResult(t),L.DomEvent.stop(e),this.fire("select",{feature:t})},this)},this)(o)}}if(t.length>5){var l=L.DomUtil.create("span","",this._results);l.innerHTML="Top 5 of "+t.length+"  results"}},_chooseResult:function(t){t.bbox?this._map.fitBounds(util.lbounds(t.bbox)):t.center&&this._map.setView([t.center[1],t.center[0]],void 0===this._map.getZoom()?this.options.pointZoom:Math.max(this._map.getZoom(),this.options.pointZoom))},_geocode:function(t){return L.DomEvent.preventDefault(t),""===this._input.value?this._updateSubmit():(L.DomUtil.addClass(this._container,"searching"),void this.geocoder.query(L.Util.extend({query:this._input.value,proximity:this.options.proximity?this._map.getCenter():!1},this.options.queryOptions),this._updateSubmit))},_autocomplete:function(){return this.options.autocomplete?""===this._input.value?this._updateAutocomplete():void this.geocoder.query(L.Util.extend({query:this._input.value,proximity:this.options.proximity?this._map.getCenter():!1},this.options.queryOptions),this._updateAutocomplete):void 0}});module.exports.GeocoderControl=GeocoderControl,module.exports.geocoderControl=function(t,e){return new GeocoderControl(t,e)}},{"./geocoder":12,"./util":31}],14:[function(require,module,exports){"use strict";function utfDecode(t){return t>=93&&t--,t>=35&&t--,t-32}module.exports=function(t){return function(e,r){if(t){var u=utfDecode(t.grid[r].charCodeAt(e)),n=t.keys[u];return t.data[n]}}}},{}],15:[function(require,module,exports){"use strict";var util=require("./util"),Mustache=require("mustache"),GridControl=L.Control.extend({options:{pinnable:!0,follow:!1,sanitizer:require("sanitize-caja"),touchTeaser:!0,location:!0},_currentContent:"",_pinned:!1,initialize:function(t,o){L.Util.setOptions(this,o),util.strict_instance(t,L.Class,"L.mapbox.gridLayer"),this._layer=t},setTemplate:function(t){return util.strict(t,"string"),this.options.template=t,this},_template:function(t,o){if(o){var i=this.options.template||this._layer.getTileJSON().template;if(i){var e={};return e["__"+t+"__"]=!0,this.options.sanitizer(Mustache.to_html(i,L.extend(e,o)))}}},_show:function(t,o){t!==this._currentContent&&(this._currentContent=t,this.options.follow?(this._popup.setContent(t).setLatLng(o.latLng),this._map._popup!==this._popup&&this._popup.openOn(this._map)):(this._container.style.display="block",this._contentWrapper.innerHTML=t))},hide:function(){return this._pinned=!1,this._currentContent="",this._map.closePopup(),this._container.style.display="none",this._contentWrapper.innerHTML="",L.DomUtil.removeClass(this._container,"closable"),this},_mouseover:function(t){if(t.data?L.DomUtil.addClass(this._map._container,"map-clickable"):L.DomUtil.removeClass(this._map._container,"map-clickable"),!this._pinned){var o=this._template("teaser",t.data);o?this._show(o,t):this.hide()}},_mousemove:function(t){this._pinned||this.options.follow&&this._popup.setLatLng(t.latLng)},_navigateTo:function(t){window.top.location.href=t},_click:function(t){var o=this._template("location",t.data);if(this.options.location&&o&&0===o.search(/^https?:/))return this._navigateTo(this._template("location",t.data));if(this.options.pinnable){var i=this._template("full",t.data);!i&&this.options.touchTeaser&&L.Browser.touch&&(i=this._template("teaser",t.data)),i?(L.DomUtil.addClass(this._container,"closable"),this._pinned=!0,this._show(i,t)):this._pinned&&(L.DomUtil.removeClass(this._container,"closable"),this._pinned=!1,this.hide())}},_onPopupClose:function(){this._currentContent=null,this._pinned=!1},_createClosebutton:function(t,o){var i=L.DomUtil.create("a","close",t);return i.innerHTML="close",i.href="#",i.title="close",L.DomEvent.on(i,"click",L.DomEvent.stopPropagation).on(i,"mousedown",L.DomEvent.stopPropagation).on(i,"dblclick",L.DomEvent.stopPropagation).on(i,"click",L.DomEvent.preventDefault).on(i,"click",o,this),i},onAdd:function(t){this._map=t;var o="leaflet-control-grid map-tooltip",i=L.DomUtil.create("div",o),e=L.DomUtil.create("div","map-tooltip-content");return i.style.display="none",this._createClosebutton(i,this.hide),i.appendChild(e),this._contentWrapper=e,this._popup=new L.Popup({autoPan:!1,closeOnClick:!1}),t.on("popupclose",this._onPopupClose,this),L.DomEvent.disableClickPropagation(i).addListener(i,"mousewheel",L.DomEvent.stopPropagation),this._layer.on("mouseover",this._mouseover,this).on("mousemove",this._mousemove,this).on("click",this._click,this),i},onRemove:function(t){t.off("popupclose",this._onPopupClose,this),this._layer.off("mouseover",this._mouseover,this).off("mousemove",this._mousemove,this).off("click",this._click,this)}});module.exports.GridControl=GridControl,module.exports.gridControl=function(t,o){return new GridControl(t,o)}},{"./util":31,mustache:4,"sanitize-caja":5}],16:[function(require,module,exports){"use strict";var util=require("./util"),request=require("./request"),grid=require("./grid"),GridLayer=L.Class.extend({includes:[L.Mixin.Events,require("./load_tilejson")],options:{template:function(){return""}},_mouseOn:null,_tilejson:{},_cache:{},initialize:function(t,i){L.Util.setOptions(this,i),this._loadTileJSON(t)},_setTileJSON:function(t){return util.strict(t,"object"),L.extend(this.options,{grids:t.grids,minZoom:t.minzoom,maxZoom:t.maxzoom,bounds:t.bounds&&util.lbounds(t.bounds)}),this._tilejson=t,this._cache={},this._update(),this},getTileJSON:function(){return this._tilejson},active:function(){return!!(this._map&&this.options.grids&&this.options.grids.length)},addTo:function(t){return t.addLayer(this),this},onAdd:function(t){this._map=t,this._update(),this._map.on("click",this._click,this).on("mousemove",this._move,this).on("moveend",this._update,this)},onRemove:function(){this._map.off("click",this._click,this).off("mousemove",this._move,this).off("moveend",this._update,this)},getData:function(t,i){if(this.active()){var e=this._map,o=e.project(t.wrap()),s=256,n=4,a=Math.floor(o.x/s),h=Math.floor(o.y/s),r=e.options.crs.scale(e.getZoom())/s;return a=(a+r)%r,h=(h+r)%r,this._getTile(e.getZoom(),a,h,function(t){var e=Math.floor((o.x-a*s)/n),r=Math.floor((o.y-h*s)/n);i(t(e,r))}),this}},_click:function(t){this.getData(t.latlng,L.bind(function(i){this.fire("click",{latLng:t.latlng,data:i})},this))},_move:function(t){this.getData(t.latlng,L.bind(function(i){i!==this._mouseOn?(this._mouseOn&&this.fire("mouseout",{latLng:t.latlng,data:this._mouseOn}),this.fire("mouseover",{latLng:t.latlng,data:i}),this._mouseOn=i):this.fire("mousemove",{latLng:t.latlng,data:i})},this))},_getTileURL:function(t){var i=this.options.grids,e=(t.x+t.y)%i.length,o=i[e];return L.Util.template(o,t)},_update:function(){if(this.active()){var t=this._map.getPixelBounds(),i=this._map.getZoom(),e=256;if(!(i>this.options.maxZoom||i<this.options.minZoom))for(var o=L.bounds(t.min.divideBy(e)._floor(),t.max.divideBy(e)._floor()),s=this._map.options.crs.scale(i)/e,n=o.min.x;n<=o.max.x;n++)for(var a=o.min.y;a<=o.max.y;a++)this._getTile(i,(n%s+s)%s,(a%s+s)%s)}},_getTile:function(t,i,e,o){var s=t+"_"+i+"_"+e,n=L.point(i,e);if(n.z=t,this._tileShouldBeLoaded(n)){if(s in this._cache){if(!o)return;return void("function"==typeof this._cache[s]?o(this._cache[s]):this._cache[s].push(o))}this._cache[s]=[],o&&this._cache[s].push(o),request(this._getTileURL(n),L.bind(function(t,i){var e=this._cache[s];this._cache[s]=grid(i);for(var o=0;o<e.length;++o)e[o](this._cache[s])},this))}},_tileShouldBeLoaded:function(t){if(t.z>this.options.maxZoom||t.z<this.options.minZoom)return!1;if(this.options.bounds){var i=256,e=t.multiplyBy(i),o=e.add(new L.Point(i,i)),s=this._map.unproject(e),n=this._map.unproject(o),a=new L.LatLngBounds([s,n]);if(!this.options.bounds.intersects(a))return!1}return!0}});module.exports.GridLayer=GridLayer,module.exports.gridLayer=function(t,i){return new GridLayer(t,i)}},{"./grid":14,"./load_tilejson":21,"./request":26,"./util":31}],17:[function(require,module,exports){"use strict";var leaflet=require("./leaflet");require("./mapbox"),module.exports=leaflet},{"./leaflet":19,"./mapbox":23}],18:[function(require,module,exports){"use strict";var InfoControl=L.Control.extend({options:{position:"bottomright",sanitizer:require("sanitize-caja")},initialize:function(t){L.setOptions(this,t),this._info={},console.warn("infoControl has been deprecated and will be removed in mapbox.js v3.0.0. Use the default attribution control instead, which is now responsive.")},onAdd:function(t){this._container=L.DomUtil.create("div","mapbox-control-info mapbox-small"),this._content=L.DomUtil.create("div","map-info-container",this._container);var i=L.DomUtil.create("a","mapbox-info-toggle mapbox-icon mapbox-icon-info",this._container);i.href="#",L.DomEvent.addListener(i,"click",this._showInfo,this),L.DomEvent.disableClickPropagation(this._container);for(var n in t._layers)t._layers[n].getAttribution&&this.addInfo(t._layers[n].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd,this).off("layerremove",this._onLayerRemove,this)},addInfo:function(t){return t?(this._info[t]||(this._info[t]=0),this._info[t]=!0,this._update()):this},removeInfo:function(t){return t?(this._info[t]&&(this._info[t]=!1),this._update()):this},_showInfo:function(t){return L.DomEvent.preventDefault(t),this._active===!0?this._hidecontent():(L.DomUtil.addClass(this._container,"active"),this._active=!0,void this._update())},_hidecontent:function(){this._content.innerHTML="",this._active=!1,L.DomUtil.removeClass(this._container,"active")},_update:function(){if(!this._map)return this;this._content.innerHTML="";var t="none",i=[];for(var n in this._info)this._info.hasOwnProperty(n)&&this._info[n]&&(i.push(this.options.sanitizer(n)),t="block");return this._content.innerHTML+=i.join(" | "),this._container.style.display=t,this},_onLayerAdd:function(t){t.layer.getAttribution&&t.layer.getAttribution()?this.addInfo(t.layer.getAttribution()):"on"in t.layer&&t.layer.getAttribution&&t.layer.on("ready",L.bind(function(){this.addInfo(t.layer.getAttribution())},this))},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeInfo(t.layer.getAttribution())}});module.exports.InfoControl=InfoControl,module.exports.infoControl=function(t){return new InfoControl(t)}},{"sanitize-caja":5}],19:[function(require,module,exports){module.exports=window.L=require("leaflet/dist/leaflet-src")},{"leaflet/dist/leaflet-src":3}],20:[function(require,module,exports){"use strict";var LegendControl=L.Control.extend({options:{position:"bottomright",sanitizer:require("sanitize-caja")},initialize:function(e){L.setOptions(this,e),this._legends={}},onAdd:function(){return this._container=L.DomUtil.create("div","map-legends wax-legends"),L.DomEvent.disableClickPropagation(this._container),this._update(),this._container},addLegend:function(e){return e?(this._legends[e]||(this._legends[e]=0),this._legends[e]++,this._update()):this},removeLegend:function(e){return e?(this._legends[e]&&this._legends[e]--,this._update()):this},_update:function(){if(!this._map)return this;this._container.innerHTML="";var e="none";for(var t in this._legends)if(this._legends.hasOwnProperty(t)&&this._legends[t]){var n=L.DomUtil.create("div","map-legend wax-legend",this._container);n.innerHTML=this.options.sanitizer(t),e="block"}return this._container.style.display=e,this}});module.exports.LegendControl=LegendControl,module.exports.legendControl=function(e){return new LegendControl(e)}},{"sanitize-caja":5}],21:[function(require,module,exports){"use strict";var request=require("./request"),format_url=require("./format_url"),util=require("./util");module.exports={_loadTileJSON:function(e){"string"==typeof e?(e=format_url.tileJSON(e,this.options&&this.options.accessToken),request(e,L.bind(function(t,r){t?(util.log("could not load TileJSON at "+e),this.fire("error",{error:t})):r&&(this._setTileJSON(r),this.fire("ready"))},this))):e&&"object"==typeof e&&this._setTileJSON(e)}}},{"./format_url":11,"./request":26,"./util":31}],22:[function(require,module,exports){"use strict";function withAccessToken(t,o){return!o||t.accessToken?t:L.extend({accessToken:o},t)}var tileLayer=require("./tile_layer").tileLayer,featureLayer=require("./feature_layer").featureLayer,gridLayer=require("./grid_layer").gridLayer,gridControl=require("./grid_control").gridControl,infoControl=require("./info_control").infoControl,shareControl=require("./share_control").shareControl,legendControl=require("./legend_control").legendControl,mapboxLogoControl=require("./mapbox_logo").mapboxLogoControl,feedback=require("./feedback"),LMap=L.Map.extend({includes:[require("./load_tilejson")],options:{tileLayer:{},featureLayer:{},gridLayer:{},legendControl:{},gridControl:{},infoControl:!1,shareControl:!1,sanitizer:require("sanitize-caja")},_tilejson:{},initialize:function(t,o,e){if(L.Map.prototype.initialize.call(this,t,L.extend({},L.Map.prototype.options,e)),this.attributionControl){this.attributionControl.setPrefix("");var i=this.options.attributionControl.compact;(i||i!==!1&&this._container.offsetWidth<=640)&&L.DomUtil.addClass(this.attributionControl._container,"leaflet-compact-attribution"),void 0===i&&this.on("resize",function(){this._container.offsetWidth>640?L.DomUtil.removeClass(this.attributionControl._container,"leaflet-compact-attribution"):L.DomUtil.addClass(this.attributionControl._container,"leaflet-compact-attribution")})}this.options.tileLayer&&(this.tileLayer=tileLayer(void 0,withAccessToken(this.options.tileLayer,this.options.accessToken)),this.addLayer(this.tileLayer)),this.options.featureLayer&&(this.featureLayer=featureLayer(void 0,withAccessToken(this.options.featureLayer,this.options.accessToken)),this.addLayer(this.featureLayer)),this.options.gridLayer&&(this.gridLayer=gridLayer(void 0,withAccessToken(this.options.gridLayer,this.options.accessToken)),this.addLayer(this.gridLayer)),this.options.gridLayer&&this.options.gridControl&&(this.gridControl=gridControl(this.gridLayer,this.options.gridControl),this.addControl(this.gridControl)),this.options.infoControl&&(this.infoControl=infoControl(this.options.infoControl),this.addControl(this.infoControl)),this.options.legendControl&&(this.legendControl=legendControl(this.options.legendControl),this.addControl(this.legendControl)),this.options.shareControl&&(this.shareControl=shareControl(void 0,withAccessToken(this.options.shareControl,this.options.accessToken)),this.addControl(this.shareControl)),this._mapboxLogoControl=mapboxLogoControl(this.options.mapboxLogoControl),this.addControl(this._mapboxLogoControl),this._loadTileJSON(o),this.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this).on("moveend",this._updateMapFeedbackLink,this),this.whenReady(function(){feedback.on("change",this._updateMapFeedbackLink,this)}),this.on("unload",function(){feedback.off("change",this._updateMapFeedbackLink,this)})},_setTileJSON:function(t){return this._tilejson=t,this._initialize(t),this},getTileJSON:function(){return this._tilejson},_initialize:function(t){if(this.tileLayer&&(this.tileLayer._setTileJSON(t),this._updateLayer(this.tileLayer)),this.featureLayer&&!this.featureLayer.getGeoJSON()&&t.data&&t.data[0]&&this.featureLayer.loadURL(t.data[0]),this.gridLayer&&(this.gridLayer._setTileJSON(t),this._updateLayer(this.gridLayer)),this.infoControl&&t.attribution&&(this.infoControl.addInfo(this.options.sanitizer(t.attribution)),this._updateMapFeedbackLink()),this.legendControl&&t.legend&&this.legendControl.addLegend(t.legend),this.shareControl&&this.shareControl._setTileJSON(t),this._mapboxLogoControl._setTileJSON(t),!this._loaded&&t.center){var o=void 0!==this.getZoom()?this.getZoom():t.center[2],e=L.latLng(t.center[1],t.center[0]);this.setView(e,o)}},_updateMapFeedbackLink:function(){if(this._controlContainer.getElementsByClassName){var t=this._controlContainer.getElementsByClassName("mapbox-improve-map");if(t.length&&this._loaded){var o=this.getCenter().wrap(),e=this._tilejson||{},i=e.id||"",n="#"+i+"/"+o.lng.toFixed(3)+"/"+o.lat.toFixed(3)+"/"+this.getZoom();for(var r in feedback.data)n+="/"+r+"="+feedback.data[r];for(var a=0;a<t.length;a++)t[a].hash=n}}},_onLayerAdd:function(t){"on"in t.layer&&t.layer.on("ready",this._onLayerReady,this),window.setTimeout(L.bind(this._updateMapFeedbackLink,this),0)},_onLayerRemove:function(t){"on"in t.layer&&t.layer.off("ready",this._onLayerReady,this),window.setTimeout(L.bind(this._updateMapFeedbackLink,this),0)},_onLayerReady:function(t){this._updateLayer(t.target)},_updateLayer:function(t){t.options&&(this.infoControl&&this._loaded&&this.infoControl.addInfo(t.options.infoControl),this.attributionControl&&this._loaded&&t.getAttribution&&this.attributionControl.addAttribution(t.getAttribution()),L.stamp(t)in this._zoomBoundLayers||!t.options.maxZoom&&!t.options.minZoom||(this._zoomBoundLayers[L.stamp(t)]=t),this._updateMapFeedbackLink(),this._updateZoomLevels())}});module.exports.Map=LMap,module.exports.map=function(t,o,e){return new LMap(t,o,e)}},{"./feature_layer":9,"./feedback":10,"./grid_control":15,"./grid_layer":16,"./info_control":18,"./legend_control":20,"./load_tilejson":21,"./mapbox_logo":24,"./share_control":27,"./tile_layer":30,"sanitize-caja":5}],23:[function(require,module,exports){"use strict";var geocoderControl=require("./geocoder_control"),gridControl=require("./grid_control"),featureLayer=require("./feature_layer"),legendControl=require("./legend_control"),shareControl=require("./share_control"),tileLayer=require("./tile_layer"),infoControl=require("./info_control"),map=require("./map"),gridLayer=require("./grid_layer"),styleLayer=require("./style_layer");L.mapbox=module.exports={VERSION:require("../package.json").version,geocoder:require("./geocoder"),marker:require("./marker"),simplestyle:require("./simplestyle"),tileLayer:tileLayer.tileLayer,TileLayer:tileLayer.TileLayer,styleLayer:styleLayer.styleLayer,StyleLayer:styleLayer.StyleLayer,infoControl:infoControl.infoControl,InfoControl:infoControl.InfoControl,shareControl:shareControl.shareControl,ShareControl:shareControl.ShareControl,legendControl:legendControl.legendControl,LegendControl:legendControl.LegendControl,geocoderControl:geocoderControl.geocoderControl,GeocoderControl:geocoderControl.GeocoderControl,gridControl:gridControl.gridControl,GridControl:gridControl.GridControl,gridLayer:gridLayer.gridLayer,GridLayer:gridLayer.GridLayer,featureLayer:featureLayer.featureLayer,FeatureLayer:featureLayer.FeatureLayer,map:map.map,Map:map.Map,config:require("./config"),sanitize:require("sanitize-caja"),template:require("mustache").to_html,feedback:require("./feedback")},window.L.Icon.Default.imagePath=("https:"===document.location.protocol||"http:"===document.location.protocol?"":"https:")+"//api.tiles.mapbox.com/mapbox.js/v"+require("../package.json").version+"/images"},{"../package.json":7,"./config":8,"./feature_layer":9,"./feedback":10,"./geocoder":12,"./geocoder_control":13,"./grid_control":15,"./grid_layer":16,"./info_control":18,"./legend_control":20,"./map":22,"./marker":25,"./share_control":27,"./simplestyle":28,"./style_layer":29,"./tile_layer":30,mustache:4,"sanitize-caja":5}],24:[function(require,module,exports){"use strict";var MapboxLogoControl=L.Control.extend({options:{position:"bottomleft"},initialize:function(o){L.setOptions(this,o)},onAdd:function(){return this._container=L.DomUtil.create("div","mapbox-logo"),this._container},_setTileJSON:function(o){o.mapbox_logo&&L.DomUtil.addClass(this._container,"mapbox-logo-true")}});module.exports.MapboxLogoControl=MapboxLogoControl,module.exports.mapboxLogoControl=function(o){return new MapboxLogoControl(o)}},{}],25:[function(require,module,exports){"use strict";function icon(r,e){r=r||{};var i={small:[20,50],medium:[30,70],large:[35,90]},t=r["marker-size"]||"medium",o="marker-symbol"in r&&""!==r["marker-symbol"]?"-"+r["marker-symbol"]:"",s=(r["marker-color"]||"7e7e7e").replace("#","");return L.icon({iconUrl:format_url("/v4/marker/pin-"+t.charAt(0)+o+"+"+s+(L.Browser.retina?"@2x":"")+".png",e&&e.accessToken),iconSize:i[t],iconAnchor:[i[t][0]/2,i[t][1]/2],popupAnchor:[0,-i[t][1]/2]})}function style(r,e,i){return L.marker(e,{icon:icon(r.properties,i),title:util.strip_tags(sanitize(r.properties&&r.properties.title||""))})}function createPopup(r,e){if(!r||!r.properties)return"";var i="";return r.properties.title&&(i+='<div class="marker-title">'+r.properties.title+"</div>"),r.properties.description&&(i+='<div class="marker-description">'+r.properties.description+"</div>"),(e||sanitize)(i)}var format_url=require("./format_url"),util=require("./util"),sanitize=require("sanitize-caja");module.exports={icon:icon,style:style,createPopup:createPopup}},{"./format_url":11,"./util":31,"sanitize-caja":5}],26:[function(require,module,exports){"use strict";var corslite=require("corslite"),strict=require("./util").strict,config=require("./config"),protocol=/^(https?:)?(?=\/\/(.|api)\.tiles\.mapbox\.com\/)/;module.exports=function(t,o){function r(t,r){!t&&r&&(r=JSON.parse(r.responseText)),o(t,r)}return strict(t,"string"),strict(o,"function"),t=t.replace(protocol,function(t,o){return"withCredentials"in new window.XMLHttpRequest?"https:"===o||"https:"===document.location.protocol||config.FORCE_HTTPS?"https:":"http:":document.location.protocol}),corslite(t,r)}},{"./config":8,"./util":31,corslite:1}],27:[function(require,module,exports){"use strict";var format_url=require("./format_url"),ShareControl=L.Control.extend({includes:[require("./load_tilejson")],options:{position:"topleft",url:""},initialize:function(t,e){L.setOptions(this,e),this._loadTileJSON(t)},_setTileJSON:function(t){this._tilejson=t},onAdd:function(t){this._map=t;var e=L.DomUtil.create("div","leaflet-control-mapbox-share leaflet-bar"),o=L.DomUtil.create("a","mapbox-share mapbox-icon mapbox-icon-share",e);return o.href="#",this._modal=L.DomUtil.create("div","mapbox-modal",this._map._container),this._mask=L.DomUtil.create("div","mapbox-modal-mask",this._modal),this._content=L.DomUtil.create("div","mapbox-modal-content",this._modal),L.DomEvent.addListener(o,"click",this._shareClick,this),L.DomEvent.disableClickPropagation(e),this._map.on("mousedown",this._clickOut,this),e},_clickOut:function(t){return this._sharing?(L.DomEvent.preventDefault(t),L.DomUtil.removeClass(this._modal,"active"),this._content.innerHTML="",void(this._sharing=null)):void 0},_shareClick:function(t){function e(t,e,o){var i=document.createElement("a");return i.setAttribute("class",t),i.setAttribute("href",e),i.setAttribute("target","_blank"),o=document.createTextNode(o),i.appendChild(o),i}if(L.DomEvent.stop(t),this._sharing)return this._clickOut(t);var o=this._tilejson||this._map._tilejson||{},i=encodeURIComponent(this.options.url||o.webpage||window.location),a=encodeURIComponent(o.name),n=format_url("/v4/"+o.id+"/"+this._map.getCenter().lng+","+this._map.getCenter().lat+","+this._map.getZoom()+"/600x600.png",this.options.accessToken),r=format_url("/v4/"+o.id+".html",this.options.accessToken),s="//twitter.com/intent/tweet?status="+a+" "+i,l="//www.facebook.com/sharer.php?u="+i+"&t="+a,m="//www.pinterest.com/pin/create/button/?url="+i+"&media="+n+"&description="+a,c='<iframe width="100%" height="500px" frameBorder="0" src="'+r+'"></iframe>',h="Copy and paste this <strong>HTML code</strong> into documents to embed this map on web pages.";L.DomUtil.addClass(this._modal,"active"),this._sharing=L.DomUtil.create("div","mapbox-modal-body",this._content);var p=e("mapbox-button mapbox-button-icon mapbox-icon-twitter",s,"Twitter"),d=e("mapbox-button mapbox-button-icon mapbox-icon-facebook",l,"Facebook"),u=e("mapbox-button mapbox-button-icon mapbox-icon-pinterest",m,"Pinterest"),b=document.createElement("h3"),_=document.createTextNode("Share this map");b.appendChild(_);var v=document.createElement("div");v.setAttribute("class","mapbox-share-buttons"),v.appendChild(d),v.appendChild(p),v.appendChild(u),this._sharing.appendChild(b),this._sharing.appendChild(v);var x=L.DomUtil.create("input","mapbox-embed",this._sharing);x.type="text",x.value=c;var f=L.DomUtil.create("label","mapbox-embed-description",this._sharing);f.innerHTML=h;var g=L.DomUtil.create("a","leaflet-popup-close-button",this._sharing);g.href="#",L.DomEvent.disableClickPropagation(this._sharing),L.DomEvent.addListener(g,"click",this._clickOut,this),L.DomEvent.addListener(x,"click",function(t){t.target.focus(),t.target.select()})}});module.exports.ShareControl=ShareControl,module.exports.shareControl=function(t,e){return new ShareControl(t,e)}},{"./format_url":11,"./load_tilejson":21}],28:[function(require,module,exports){"use strict";function fallback(t,l){var i={};for(var r in l)void 0===t[r]?i[r]=l[r]:i[r]=t[r];return i}function remap(t){for(var l={},i=0;i<mapping.length;i++)l[mapping[i][1]]=t[mapping[i][0]];return l}function style(t){return remap(fallback(t.properties||{},defaults))}var defaults={stroke:"#555555","stroke-width":2,"stroke-opacity":1,fill:"#555555","fill-opacity":.5},mapping=[["stroke","color"],["stroke-width","weight"],["stroke-opacity","opacity"],["fill","fillColor"],["fill-opacity","fillOpacity"]];module.exports={style:style,defaults:defaults}},{}],29:[function(require,module,exports){"use strict";var util=require("./util"),format_url=require("./format_url"),request=require("./request"),StyleLayer=L.TileLayer.extend({options:{sanitizer:require("sanitize-caja")},initialize:function(t,i){L.TileLayer.prototype.initialize.call(this,void 0,i),this.options.tiles=this._formatTileURL(t),this.options.tileSize=512,this.options.zoomOffset=-1,this.options.tms=!1,this._getAttribution(t)},_getAttribution:function(t){var i=format_url.style(t,this.options&&this.options.accessToken);request(i,L.bind(function(e,r){e&&(util.log("could not load Mapbox style at "+i),this.fire("error",{error:e}));var o=[];for(var s in r.sources){var l=r.sources[s].url.split("mapbox://")[1];o.push(l)}request(format_url.tileJSON(o.join(),this.options.accessToken),L.bind(function(i,e){i?(util.log("could not load TileJSON at "+t),this.fire("error",{error:i})):e&&(util.strict(e,"object"),this.options.attribution=this.options.sanitizer(e.attribution),this._tilejson=e,this.fire("ready"))},this))},this))},setUrl:null,_formatTileURL:function(t){var i=L.Browser.retina?"@2x":"";if("string"==typeof t){-1===t.indexOf("mapbox://styles/")&&(util.log("Incorrectly formatted Mapbox style at "+t),this.fire("error"));var e=t.split("mapbox://styles/")[1];return format_url("/styles/v1/"+e+"/tiles/{z}/{x}/{y}"+i,this.options.accessToken)}return"object"==typeof t?format_url("/styles/v1/"+t.owner+"/"+t.id+"/tiles/{z}/{x}/{y}"+i,this.options.accessToken):void 0},getTileUrl:function(t){var i=L.Util.template(this.options.tiles,t);return i}});module.exports.StyleLayer=StyleLayer,module.exports.styleLayer=function(t,i){return new StyleLayer(t,i)}},{"./format_url":11,"./request":26,"./util":31,"sanitize-caja":5}],30:[function(require,module,exports){"use strict";var util=require("./util"),formatPattern=/\.((?:png|jpg)\d*)(?=$|\?)/,TileLayer=L.TileLayer.extend({includes:[require("./load_tilejson")],options:{sanitizer:require("sanitize-caja")},formats:["png","jpg","png32","png64","png128","png256","jpg70","jpg80","jpg90"],scalePrefix:"@2x.",initialize:function(t,i){L.TileLayer.prototype.initialize.call(this,void 0,i),this._tilejson={},i&&i.format&&util.strict_oneof(i.format,this.formats),this._loadTileJSON(t)},setFormat:function(t){return util.strict(t,"string"),this.options.format=t,this.redraw(),this},setUrl:null,_setTileJSON:function(t){return util.strict(t,"object"),this.options.format=this.options.format||t.tiles[0].match(formatPattern)[1],L.extend(this.options,{tiles:t.tiles,attribution:this.options.sanitizer(t.attribution),minZoom:t.minzoom||0,maxZoom:t.maxzoom||18,tms:"tms"===t.scheme,bounds:t.bounds&&util.lbounds(t.bounds)}),this._tilejson=t,this.redraw(),this},getTileJSON:function(){return this._tilejson},getTileUrl:function(t){var i=this.options.tiles,e=Math.floor(Math.abs(t.x+t.y)%i.length),o=i[e],r=L.Util.template(o,t);return r?r.replace(formatPattern,(L.Browser.retina?this.scalePrefix:".")+this.options.format):r},_update:function(){this.options.tiles&&L.TileLayer.prototype._update.call(this)}});module.exports.TileLayer=TileLayer,module.exports.tileLayer=function(t,i){return new TileLayer(t,i)}},{"./load_tilejson":21,"./util":31,"sanitize-caja":5}],31:[function(require,module,exports){"use strict";function contains(n,t){if(!t||!t.length)return!1;for(var r=0;r<t.length;r++)if(t[r]===n)return!0;return!1}module.exports={idUrl:function(n,t){-1===n.indexOf("/")?t.loadID(n):t.loadURL(n)},log:function(n){"object"==typeof console&&"function"==typeof console.error&&console.error(n)},strict:function(n,t){if(typeof n!==t)throw new Error("Invalid argument: "+t+" expected")},strict_instance:function(n,t,r){if(!(n instanceof t))throw new Error("Invalid argument: "+r+" expected")},strict_oneof:function(n,t){if(!contains(n,t))throw new Error("Invalid argument: "+n+" given, valid values are "+t.join(", "))},strip_tags:function(n){return n.replace(/<[^<]+>/g,"")},lbounds:function(n){return new L.LatLngBounds([[n[1],n[0]],[n[3],n[2]]])}}},{}]},{},[17]);(function(window,document,undefined){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:true,showCoverageOnHover:true,zoomToBoundsOnClick:true,singleMarkerMode:false,disableClusteringAtZoom:null,removeOutsideVisibleBounds:true,animate:true,animateAddingMarkers:false,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:false,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(options){L.Util.setOptions(this,options);if(!this.options.iconCreateFunction){this.options.iconCreateFunction=this._defaultIconCreateFunction}this._featureGroup=L.featureGroup();this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this);this._nonPointGroup=L.featureGroup();this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this);this._inZoomAnimation=0;this._needsClustering=[];this._needsRemoving=[];this._currentShownBounds=null;this._queue=[];var animate=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,animate?this._withAnimation:this._noAnimation);this._markerCluster=animate?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(layer){if(layer instanceof L.LayerGroup){var array=[];for(var i in layer._layers){array.push(layer._layers[i])}return this.addLayers(array)}if(!layer.getLatLng){this._nonPointGroup.addLayer(layer);return this}if(!this._map){this._needsClustering.push(layer);return this}if(this.hasLayer(layer)){return this}if(this._unspiderfy){this._unspiderfy()}this._addLayer(layer,this._maxZoom);this._topClusterLevel._recalculateBounds();var visibleLayer=layer,currentZoom=this._map.getZoom();if(layer.__parent){while(visibleLayer.__parent._zoom>=currentZoom){visibleLayer=visibleLayer.__parent}}if(this._currentShownBounds.contains(visibleLayer.getLatLng())){if(this.options.animateAddingMarkers){this._animationAddLayer(layer,visibleLayer)}else{this._animationAddLayerNonAnimated(layer,visibleLayer)}}return this},removeLayer:function(layer){if(layer instanceof L.LayerGroup){var array=[];for(var i in layer._layers){array.push(layer._layers[i])}return this.removeLayers(array)}if(!layer.getLatLng){this._nonPointGroup.removeLayer(layer);return this}if(!this._map){if(!this._arraySplice(this._needsClustering,layer)&&this.hasLayer(layer)){this._needsRemoving.push(layer)}return this}if(!layer.__parent){return this}if(this._unspiderfy){this._unspiderfy();this._unspiderfyLayer(layer)}this._removeLayer(layer,true);this._topClusterLevel._recalculateBounds();if(this._featureGroup.hasLayer(layer)){this._featureGroup.removeLayer(layer);if(layer.clusterShow){layer.clusterShow()}}return this},addLayers:function(layersArray){var fg=this._featureGroup,npg=this._nonPointGroup,chunked=this.options.chunkedLoading,chunkInterval=this.options.chunkInterval,chunkProgress=this.options.chunkProgress,newMarkers,i,l,m;if(this._map){var offset=0,started=(new Date).getTime();var process=L.bind(function(){var start=(new Date).getTime();for(;offset<layersArray.length;offset++){if(chunked&&offset%200===0){var elapsed=(new Date).getTime()-start;if(elapsed>chunkInterval){break}}m=layersArray[offset];if(!m.getLatLng){npg.addLayer(m);continue}if(this.hasLayer(m)){continue}this._addLayer(m,this._maxZoom);if(m.__parent){if(m.__parent.getChildCount()===2){var markers=m.__parent.getAllChildMarkers(),otherMarker=markers[0]===m?markers[1]:markers[0];fg.removeLayer(otherMarker)}}}if(chunkProgress){chunkProgress(offset,layersArray.length,(new Date).getTime()-started)}if(offset===layersArray.length){this._topClusterLevel._recalculateBounds();this._featureGroup.eachLayer(function(c){if(c instanceof L.MarkerCluster&&c._iconNeedsUpdate){c._updateIcon()}});this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)}else{setTimeout(process,this.options.chunkDelay)}},this);process()}else{newMarkers=[];for(i=0,l=layersArray.length;i<l;i++){m=layersArray[i];if(!m.getLatLng){npg.addLayer(m);continue}if(this.hasLayer(m)){continue}newMarkers.push(m)}this._needsClustering=this._needsClustering.concat(newMarkers)}return this},removeLayers:function(layersArray){var i,l,m,fg=this._featureGroup,npg=this._nonPointGroup;if(!this._map){for(i=0,l=layersArray.length;i<l;i++){m=layersArray[i];this._arraySplice(this._needsClustering,m);npg.removeLayer(m);if(this.hasLayer(m)){this._needsRemoving.push(m)}}return this}if(this._unspiderfy){this._unspiderfy();for(i=0,l=layersArray.length;i<l;i++){m=layersArray[i];this._unspiderfyLayer(m)}}for(i=0,l=layersArray.length;i<l;i++){m=layersArray[i];if(!m.__parent){npg.removeLayer(m);continue}this._removeLayer(m,true,true);if(fg.hasLayer(m)){fg.removeLayer(m);if(m.clusterShow){m.clusterShow()}}}this._topClusterLevel._recalculateBounds();this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds);fg.eachLayer(function(c){if(c instanceof L.MarkerCluster){c._updateIcon()}});return this},clearLayers:function(){if(!this._map){this._needsClustering=[];delete this._gridClusters;delete this._gridUnclustered}if(this._noanimationUnspiderfy){this._noanimationUnspiderfy()}this._featureGroup.clearLayers();this._nonPointGroup.clearLayers();this.eachLayer(function(marker){delete marker.__parent});if(this._map){this._generateInitialClusters()}return this},getBounds:function(){var bounds=new L.LatLngBounds;if(this._topClusterLevel){bounds.extend(this._topClusterLevel._bounds)}for(var i=this._needsClustering.length-1;i>=0;i--){bounds.extend(this._needsClustering[i].getLatLng())}bounds.extend(this._nonPointGroup.getBounds());return bounds},eachLayer:function(method,context){var markers=this._needsClustering.slice(),i;if(this._topClusterLevel){this._topClusterLevel.getAllChildMarkers(markers)}for(i=markers.length-1;i>=0;i--){method.call(context,markers[i])}this._nonPointGroup.eachLayer(method,context)},getLayers:function(){var layers=[];this.eachLayer(function(l){layers.push(l)});return layers},getLayer:function(id){var result=null;id=parseInt(id,10);this.eachLayer(function(l){if(L.stamp(l)===id){result=l}});return result},hasLayer:function(layer){if(!layer){return false}var i,anArray=this._needsClustering;for(i=anArray.length-1;i>=0;i--){if(anArray[i]===layer){return true}}anArray=this._needsRemoving;for(i=anArray.length-1;i>=0;i--){if(anArray[i]===layer){return false}}return!!(layer.__parent&&layer.__parent._group===this)||this._nonPointGroup.hasLayer(layer)},zoomToShowLayer:function(layer,callback){if(typeof callback!=="function"){callback=function(){}}var showMarker=function(){if((layer._icon||layer.__parent._icon)&&!this._inZoomAnimation){this._map.off("moveend",showMarker,this);this.off("animationend",showMarker,this);if(layer._icon){callback()}else if(layer.__parent._icon){this.once("spiderfied",callback,this);layer.__parent.spiderfy()}}};if(layer._icon&&this._map.getBounds().contains(layer.getLatLng())){callback()}else if(layer.__parent._zoom<this._map.getZoom()){this._map.on("moveend",showMarker,this);this._map.panTo(layer.getLatLng())}else{var moveStart=function(){this._map.off("movestart",moveStart,this);moveStart=null};this._map.on("movestart",moveStart,this);this._map.on("moveend",showMarker,this);this.on("animationend",showMarker,this);layer.__parent.zoomToBounds();if(moveStart){showMarker.call(this)}}},onAdd:function(map){this._map=map;var i,l,layer;if(!isFinite(this._map.getMaxZoom())){throw"Map has no maxZoom specified"}this._featureGroup.onAdd(map);this._nonPointGroup.onAdd(map);if(!this._gridClusters){this._generateInitialClusters()}this._maxLat=map.options.crs.projection.MAX_LATITUDE;for(i=0,l=this._needsRemoving.length;i<l;i++){layer=this._needsRemoving[i];this._removeLayer(layer,true)}this._needsRemoving=[];this._zoom=this._map.getZoom();this._currentShownBounds=this._getExpandedVisibleBounds();this._map.on("zoomend",this._zoomEnd,this);this._map.on("moveend",this._moveEnd,this);if(this._spiderfierOnAdd){this._spiderfierOnAdd()}this._bindEvents();l=this._needsClustering;this._needsClustering=[];this.addLayers(l)},onRemove:function(map){map.off("zoomend",this._zoomEnd,this);map.off("moveend",this._moveEnd,this);this._unbindEvents();this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","");if(this._spiderfierOnRemove){this._spiderfierOnRemove()}delete this._maxLat;this._hideCoverage();this._featureGroup.onRemove(map);this._nonPointGroup.onRemove(map);this._featureGroup.clearLayers();this._map=null},getVisibleParent:function(marker){var vMarker=marker;while(vMarker&&!vMarker._icon){vMarker=vMarker.__parent}return vMarker||null},_arraySplice:function(anArray,obj){for(var i=anArray.length-1;i>=0;i--){if(anArray[i]===obj){anArray.splice(i,1);return true}}},_removeFromGridUnclustered:function(marker,z){var map=this._map,gridUnclustered=this._gridUnclustered;for(;z>=0;z--){if(!gridUnclustered[z].removeObject(marker,map.project(marker.getLatLng(),z))){break}}},_removeLayer:function(marker,removeFromDistanceGrid,dontUpdateMap){var gridClusters=this._gridClusters,gridUnclustered=this._gridUnclustered,fg=this._featureGroup,map=this._map;if(removeFromDistanceGrid){this._removeFromGridUnclustered(marker,this._maxZoom)}var cluster=marker.__parent,markers=cluster._markers,otherMarker;this._arraySplice(markers,marker);while(cluster){cluster._childCount--;cluster._boundsNeedUpdate=true;if(cluster._zoom<0){break}else if(removeFromDistanceGrid&&cluster._childCount<=1){otherMarker=cluster._markers[0]===marker?cluster._markers[1]:cluster._markers[0];gridClusters[cluster._zoom].removeObject(cluster,map.project(cluster._cLatLng,cluster._zoom));gridUnclustered[cluster._zoom].addObject(otherMarker,map.project(otherMarker.getLatLng(),cluster._zoom));this._arraySplice(cluster.__parent._childClusters,cluster);cluster.__parent._markers.push(otherMarker);otherMarker.__parent=cluster.__parent;if(cluster._icon){fg.removeLayer(cluster);if(!dontUpdateMap){fg.addLayer(otherMarker)}}}else{if(!dontUpdateMap||!cluster._icon){cluster._updateIcon()}}cluster=cluster.__parent}delete marker.__parent},_isOrIsParent:function(el,oel){while(oel){if(el===oel){return true}oel=oel.parentNode}return false},_propagateEvent:function(e){if(e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget)){return}e.type="cluster"+e.type}this.fire(e.type,e)},_defaultIconCreateFunction:function(cluster){var childCount=cluster.getChildCount();var c=" marker-cluster-";if(childCount<10){c+="small"}else if(childCount<100){c+="medium"}else{c+="large"}return new L.DivIcon({html:"<div><span>"+childCount+"</span></div>",className:"marker-cluster"+c,iconSize:new L.Point(40,40)})},_bindEvents:function(){var map=this._map,spiderfyOnMaxZoom=this.options.spiderfyOnMaxZoom,showCoverageOnHover=this.options.showCoverageOnHover,zoomToBoundsOnClick=this.options.zoomToBoundsOnClick;if(spiderfyOnMaxZoom||zoomToBoundsOnClick){this.on("clusterclick",this._zoomOrSpiderfy,this)}if(showCoverageOnHover){this.on("clustermouseover",this._showCoverage,this);this.on("clustermouseout",this._hideCoverage,this);map.on("zoomend",this._hideCoverage,this)}},_zoomOrSpiderfy:function(e){var cluster=e.layer,bottomCluster=cluster;while(bottomCluster._childClusters.length===1){bottomCluster=bottomCluster._childClusters[0]}if(bottomCluster._zoom===this._maxZoom&&bottomCluster._childCount===cluster._childCount){if(this.options.spiderfyOnMaxZoom){cluster.spiderfy()}}else if(this.options.zoomToBoundsOnClick){cluster.zoomToBounds()}if(e.originalEvent&&e.originalEvent.keyCode===13){this._map._container.focus()}},_showCoverage:function(e){var map=this._map;if(this._inZoomAnimation){return}if(this._shownPolygon){map.removeLayer(this._shownPolygon)}if(e.layer.getChildCount()>2&&e.layer!==this._spiderfied){this._shownPolygon=new L.Polygon(e.layer.getConvexHull(),this.options.polygonOptions);map.addLayer(this._shownPolygon)}},_hideCoverage:function(){if(this._shownPolygon){this._map.removeLayer(this._shownPolygon);this._shownPolygon=null}},_unbindEvents:function(){var spiderfyOnMaxZoom=this.options.spiderfyOnMaxZoom,showCoverageOnHover=this.options.showCoverageOnHover,zoomToBoundsOnClick=this.options.zoomToBoundsOnClick,map=this._map;if(spiderfyOnMaxZoom||zoomToBoundsOnClick){this.off("clusterclick",this._zoomOrSpiderfy,this)}if(showCoverageOnHover){this.off("clustermouseover",this._showCoverage,this);this.off("clustermouseout",this._hideCoverage,this);map.off("zoomend",this._hideCoverage,this)}},_zoomEnd:function(){if(!this._map){return}this._mergeSplitClusters();this._zoom=this._map._zoom;this._currentShownBounds=this._getExpandedVisibleBounds()},_moveEnd:function(){if(this._inZoomAnimation){return}var newBounds=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,newBounds);this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,newBounds);this._currentShownBounds=newBounds;return},_generateInitialClusters:function(){var maxZoom=this._map.getMaxZoom(),radius=this.options.maxClusterRadius,radiusFn=radius;if(typeof radius!=="function"){radiusFn=function(){return radius}}if(this.options.disableClusteringAtZoom){maxZoom=this.options.disableClusteringAtZoom-1}this._maxZoom=maxZoom;this._gridClusters={};this._gridUnclustered={};for(var zoom=maxZoom;zoom>=0;zoom--){this._gridClusters[zoom]=new L.DistanceGrid(radiusFn(zoom));this._gridUnclustered[zoom]=new L.DistanceGrid(radiusFn(zoom))}this._topClusterLevel=new this._markerCluster(this,-1)},_addLayer:function(layer,zoom){var gridClusters=this._gridClusters,gridUnclustered=this._gridUnclustered,markerPoint,z;if(this.options.singleMarkerMode){this._overrideMarkerIcon(layer)}for(;zoom>=0;zoom--){markerPoint=this._map.project(layer.getLatLng(),zoom);var closest=gridClusters[zoom].getNearObject(markerPoint);if(closest){closest._addChild(layer);layer.__parent=closest;return}closest=gridUnclustered[zoom].getNearObject(markerPoint);if(closest){var parent=closest.__parent;if(parent){this._removeLayer(closest,false)}var newCluster=new this._markerCluster(this,zoom,closest,layer);gridClusters[zoom].addObject(newCluster,this._map.project(newCluster._cLatLng,zoom));closest.__parent=newCluster;layer.__parent=newCluster;var lastParent=newCluster;for(z=zoom-1;z>parent._zoom;z--){lastParent=new this._markerCluster(this,z,lastParent);gridClusters[z].addObject(lastParent,this._map.project(closest.getLatLng(),z))}parent._addChild(lastParent);this._removeFromGridUnclustered(closest,zoom);return}gridUnclustered[zoom].addObject(layer,markerPoint)}this._topClusterLevel._addChild(layer);layer.__parent=this._topClusterLevel;return},_enqueue:function(fn){this._queue.push(fn);if(!this._queueTimeout){this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300)}},_processQueue:function(){for(var i=0;i<this._queue.length;i++){this._queue[i].call(this)}this._queue.length=0;clearTimeout(this._queueTimeout);this._queueTimeout=null},_mergeSplitClusters:function(){this._processQueue();if(this._zoom<this._map._zoom&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())){this._animationStart();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds());this._animationZoomIn(this._zoom,this._map._zoom)}else if(this._zoom>this._map._zoom){this._animationStart();this._animationZoomOut(this._zoom,this._map._zoom)}else{this._moveEnd()}},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds){return this._mapBoundsInfinite}else if(L.Browser.mobile){return this._checkBoundsMaxLat(this._map.getBounds())}return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(bounds){var maxLat=this._maxLat;if(maxLat!==undefined){if(bounds.getNorth()>=maxLat){bounds._northEast.lat=Infinity}if(bounds.getSouth()<=-maxLat){bounds._southWest.lat=-Infinity}}return bounds},_animationAddLayerNonAnimated:function(layer,newCluster){if(newCluster===layer){this._featureGroup.addLayer(layer)}else if(newCluster._childCount===2){newCluster._addToMap();var markers=newCluster.getAllChildMarkers();this._featureGroup.removeLayer(markers[0]);this._featureGroup.removeLayer(markers[1])}else{newCluster._updateIcon()}},_overrideMarkerIcon:function(layer){var icon=layer.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[layer]}});return icon}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-Infinity,-Infinity),new L.LatLng(Infinity,Infinity))});L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(previousZoomLevel,newZoomLevel){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,previousZoomLevel);this._topClusterLevel._recursivelyAddChildrenToMap(null,newZoomLevel,this._getExpandedVisibleBounds());this.fire("animationend")},_animationZoomOut:function(previousZoomLevel,newZoomLevel){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,previousZoomLevel);this._topClusterLevel._recursivelyAddChildrenToMap(null,newZoomLevel,this._getExpandedVisibleBounds());this.fire("animationend")},_animationAddLayer:function(layer,newCluster){this._animationAddLayerNonAnimated(layer,newCluster)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim";this._inZoomAnimation++},_animationZoomIn:function(previousZoomLevel,newZoomLevel){var bounds=this._getExpandedVisibleBounds(),fg=this._featureGroup,i;this._topClusterLevel._recursively(bounds,previousZoomLevel,0,function(c){var startPos=c._latlng,markers=c._markers,m;if(!bounds.contains(startPos)){startPos=null}if(c._isSingleParent()&&previousZoomLevel+1===newZoomLevel){fg.removeLayer(c);c._recursivelyAddChildrenToMap(null,newZoomLevel,bounds)}else{c.clusterHide();c._recursivelyAddChildrenToMap(startPos,newZoomLevel,bounds)}for(i=markers.length-1;i>=0;i--){m=markers[i];if(!bounds.contains(m._latlng)){fg.removeLayer(m)}}});this._forceLayout();this._topClusterLevel._recursivelyBecomeVisible(bounds,newZoomLevel);fg.eachLayer(function(n){if(!(n instanceof L.MarkerCluster)&&n._icon){n.clusterShow()}});this._topClusterLevel._recursively(bounds,previousZoomLevel,newZoomLevel,function(c){c._recursivelyRestoreChildPositions(newZoomLevel)});this._enqueue(function(){this._topClusterLevel._recursively(bounds,previousZoomLevel,0,function(c){fg.removeLayer(c);c.clusterShow()});this._animationEnd()})},_animationZoomOut:function(previousZoomLevel,newZoomLevel){this._animationZoomOutSingle(this._topClusterLevel,previousZoomLevel-1,newZoomLevel);this._topClusterLevel._recursivelyAddChildrenToMap(null,newZoomLevel,this._getExpandedVisibleBounds());this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,previousZoomLevel,this._getExpandedVisibleBounds())},_animationAddLayer:function(layer,newCluster){var me=this,fg=this._featureGroup;fg.addLayer(layer);if(newCluster!==layer){if(newCluster._childCount>2){newCluster._updateIcon();this._forceLayout();this._animationStart();layer._setPos(this._map.latLngToLayerPoint(newCluster.getLatLng()));layer.clusterHide();this._enqueue(function(){fg.removeLayer(layer);layer.clusterShow();me._animationEnd()})}else{this._forceLayout();me._animationStart();me._animationZoomOutSingle(newCluster,this._map.getMaxZoom(),this._map.getZoom())}}}},_animationZoomOutSingle:function(cluster,previousZoomLevel,newZoomLevel){var bounds=this._getExpandedVisibleBounds();cluster._recursivelyAnimateChildrenInAndAddSelfToMap(bounds,previousZoomLevel+1,newZoomLevel);var me=this;this._forceLayout();cluster._recursivelyBecomeVisible(bounds,newZoomLevel);this._enqueue(function(){if(cluster._childCount===1){var m=cluster._markers[0];m.setLatLng(m.getLatLng());if(m.clusterShow){m.clusterShow()}}else{cluster._recursively(bounds,newZoomLevel,0,function(c){c._recursivelyRemoveChildrenFromMap(bounds,previousZoomLevel+1)})}me._animationEnd()})},_animationEnd:function(){if(this._map){this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")}this._inZoomAnimation--;this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}});L.markerClusterGroup=function(options){return new L.MarkerClusterGroup(options)};L.MarkerCluster=L.Marker.extend({initialize:function(group,zoom,a,b){L.Marker.prototype.initialize.call(this,a?a._cLatLng||a.getLatLng():new L.LatLng(0,0),{icon:this});this._group=group;this._zoom=zoom;this._markers=[];this._childClusters=[];this._childCount=0;this._iconNeedsUpdate=true;this._boundsNeedUpdate=true;this._bounds=new L.LatLngBounds;if(a){this._addChild(a)}if(b){this._addChild(b)}},getAllChildMarkers:function(storageArray){storageArray=storageArray||[];for(var i=this._childClusters.length-1;i>=0;i--){this._childClusters[i].getAllChildMarkers(storageArray)}for(var j=this._markers.length-1;j>=0;j--){storageArray.push(this._markers[j])}return storageArray},getChildCount:function(){return this._childCount},zoomToBounds:function(){var childClusters=this._childClusters.slice(),map=this._group._map,boundsZoom=map.getBoundsZoom(this._bounds),zoom=this._zoom+1,mapZoom=map.getZoom(),i;while(childClusters.length>0&&boundsZoom>zoom){zoom++;var newClusters=[];for(i=0;i<childClusters.length;i++){newClusters=newClusters.concat(childClusters[i]._childClusters)}childClusters=newClusters}if(boundsZoom>zoom){this._group._map.setView(this._latlng,zoom)}else if(boundsZoom<=mapZoom){this._group._map.setView(this._latlng,mapZoom+1)}else{this._group._map.fitBounds(this._bounds)}},getBounds:function(){var bounds=new L.LatLngBounds;bounds.extend(this._bounds);return bounds},_updateIcon:function(){this._iconNeedsUpdate=true;if(this._icon){this.setIcon(this)}},createIcon:function(){if(this._iconNeedsUpdate){this._iconObj=this._group.options.iconCreateFunction(this);this._iconNeedsUpdate=false}return this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(new1,isNotificationFromChild){this._iconNeedsUpdate=true;this._boundsNeedUpdate=true;this._setClusterCenter(new1);if(new1 instanceof L.MarkerCluster){if(!isNotificationFromChild){this._childClusters.push(new1);new1.__parent=this}this._childCount+=new1._childCount}else{if(!isNotificationFromChild){this._markers.push(new1)}this._childCount++}if(this.__parent){this.__parent._addChild(new1,true)}},_setClusterCenter:function(child){if(!this._cLatLng){this._cLatLng=child._cLatLng||child._latlng}},_resetBounds:function(){var bounds=this._bounds;if(bounds._southWest){bounds._southWest.lat=Infinity;bounds._southWest.lng=Infinity}if(bounds._northEast){bounds._northEast.lat=-Infinity;bounds._northEast.lng=-Infinity}},_recalculateBounds:function(){var markers=this._markers,childClusters=this._childClusters,latSum=0,lngSum=0,totalCount=this._childCount,i,child,childLatLng,childCount;if(totalCount===0){return}this._resetBounds();for(i=0;i<markers.length;i++){childLatLng=markers[i]._latlng;this._bounds.extend(childLatLng);latSum+=childLatLng.lat;lngSum+=childLatLng.lng}for(i=0;i<childClusters.length;i++){child=childClusters[i];if(child._boundsNeedUpdate){child._recalculateBounds()}this._bounds.extend(child._bounds);childLatLng=child._wLatLng;childCount=child._childCount;latSum+=childLatLng.lat*childCount;lngSum+=childLatLng.lng*childCount}this._latlng=this._wLatLng=new L.LatLng(latSum/totalCount,lngSum/totalCount);this._boundsNeedUpdate=false},_addToMap:function(startPos){if(startPos){this._backupLatlng=this._latlng;this.setLatLng(startPos)}this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(bounds,center,maxZoom){this._recursively(bounds,0,maxZoom-1,function(c){var markers=c._markers,i,m;for(i=markers.length-1;i>=0;i--){m=markers[i];if(m._icon){m._setPos(center);m.clusterHide()}}},function(c){var childClusters=c._childClusters,j,cm;for(j=childClusters.length-1;j>=0;j--){cm=childClusters[j];if(cm._icon){cm._setPos(center);cm.clusterHide()}}})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(bounds,previousZoomLevel,newZoomLevel){this._recursively(bounds,newZoomLevel,0,function(c){c._recursivelyAnimateChildrenIn(bounds,c._group._map.latLngToLayerPoint(c.getLatLng()).round(),previousZoomLevel);if(c._isSingleParent()&&previousZoomLevel-1===newZoomLevel){c.clusterShow();c._recursivelyRemoveChildrenFromMap(bounds,previousZoomLevel)}else{c.clusterHide()}c._addToMap()})},_recursivelyBecomeVisible:function(bounds,zoomLevel){this._recursively(bounds,0,zoomLevel,null,function(c){c.clusterShow()})},_recursivelyAddChildrenToMap:function(startPos,zoomLevel,bounds){this._recursively(bounds,-1,zoomLevel,function(c){if(zoomLevel===c._zoom){return}for(var i=c._markers.length-1;i>=0;i--){var nm=c._markers[i];if(!bounds.contains(nm._latlng)){continue}if(startPos){nm._backupLatlng=nm.getLatLng();nm.setLatLng(startPos);if(nm.clusterHide){nm.clusterHide()}}c._group._featureGroup.addLayer(nm)}},function(c){c._addToMap(startPos)})},_recursivelyRestoreChildPositions:function(zoomLevel){for(var i=this._markers.length-1;i>=0;i--){var nm=this._markers[i];if(nm._backupLatlng){nm.setLatLng(nm._backupLatlng);delete nm._backupLatlng}}if(zoomLevel-1===this._zoom){for(var j=this._childClusters.length-1;j>=0;j--){this._childClusters[j]._restorePosition()}}else{for(var k=this._childClusters.length-1;k>=0;k--){this._childClusters[k]._recursivelyRestoreChildPositions(zoomLevel)}}},_restorePosition:function(){if(this._backupLatlng){this.setLatLng(this._backupLatlng);delete this._backupLatlng}},_recursivelyRemoveChildrenFromMap:function(previousBounds,zoomLevel,exceptBounds){var m,i;this._recursively(previousBounds,-1,zoomLevel-1,function(c){for(i=c._markers.length-1;i>=0;i--){m=c._markers[i];if(!exceptBounds||!exceptBounds.contains(m._latlng)){c._group._featureGroup.removeLayer(m);if(m.clusterShow){m.clusterShow()}}}},function(c){for(i=c._childClusters.length-1;i>=0;i--){m=c._childClusters[i];if(!exceptBounds||!exceptBounds.contains(m._latlng)){c._group._featureGroup.removeLayer(m);if(m.clusterShow){m.clusterShow()}}}})},_recursively:function(boundsToApplyTo,zoomLevelToStart,zoomLevelToStop,runAtEveryLevel,runAtBottomLevel){var childClusters=this._childClusters,zoom=this._zoom,i,c;if(zoomLevelToStart>zoom){for(i=childClusters.length-1;i>=0;i--){c=childClusters[i];if(boundsToApplyTo.intersects(c._bounds)){c._recursively(boundsToApplyTo,zoomLevelToStart,zoomLevelToStop,runAtEveryLevel,runAtBottomLevel)}}}else{if(runAtEveryLevel){runAtEveryLevel(this)}if(runAtBottomLevel&&this._zoom===zoomLevelToStop){runAtBottomLevel(this)}if(zoomLevelToStop>zoom){for(i=childClusters.length-1;i>=0;i--){c=childClusters[i];if(boundsToApplyTo.intersects(c._bounds)){c._recursively(boundsToApplyTo,zoomLevelToStart,zoomLevelToStop,runAtEveryLevel,runAtBottomLevel)}}}}},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){this.options.opacityWhenUnclustered=this.options.opacity||1;return this.setOpacity(0)},clusterShow:function(){var ret=this.setOpacity(this.options.opacity||this.options.opacityWhenUnclustered);delete this.options.opacityWhenUnclustered;return ret}});L.DistanceGrid=function(cellSize){this._cellSize=cellSize;this._sqCellSize=cellSize*cellSize;this._grid={};this._objectPoint={}};L.DistanceGrid.prototype={addObject:function(obj,point){var x=this._getCoord(point.x),y=this._getCoord(point.y),grid=this._grid,row=grid[y]=grid[y]||{},cell=row[x]=row[x]||[],stamp=L.Util.stamp(obj);this._objectPoint[stamp]=point;cell.push(obj)},updateObject:function(obj,point){this.removeObject(obj);this.addObject(obj,point)},removeObject:function(obj,point){var x=this._getCoord(point.x),y=this._getCoord(point.y),grid=this._grid,row=grid[y]=grid[y]||{},cell=row[x]=row[x]||[],i,len;delete this._objectPoint[L.Util.stamp(obj)];for(i=0,len=cell.length;i<len;i++){if(cell[i]===obj){cell.splice(i,1);if(len===1){delete row[x]}return true}}},eachObject:function(fn,context){var i,j,k,len,row,cell,removed,grid=this._grid;for(i in grid){row=grid[i];for(j in row){cell=row[j];for(k=0,len=cell.length;k<len;k++){removed=fn.call(context,cell[k]);if(removed){k--;len--}}}}},getNearObject:function(point){var x=this._getCoord(point.x),y=this._getCoord(point.y),i,j,k,row,cell,len,obj,dist,objectPoint=this._objectPoint,closestDistSq=this._sqCellSize,closest=null;for(i=y-1;i<=y+1;i++){row=this._grid[i];if(row){for(j=x-1;j<=x+1;j++){cell=row[j];if(cell){for(k=0,len=cell.length;k<len;k++){obj=cell[k];dist=this._sqDist(objectPoint[L.Util.stamp(obj)],point);if(dist<closestDistSq){closestDistSq=dist;closest=obj}}}}}}return closest},_getCoord:function(x){return Math.floor(x/this._cellSize)},_sqDist:function(p,p2){var dx=p2.x-p.x,dy=p2.y-p.y;return dx*dx+dy*dy}};(function(){L.QuickHull={getDistant:function(cpt,bl){var vY=bl[1].lat-bl[0].lat,vX=bl[0].lng-bl[1].lng;return vX*(cpt.lat-bl[0].lat)+vY*(cpt.lng-bl[0].lng)},findMostDistantPointFromBaseLine:function(baseLine,latLngs){var maxD=0,maxPt=null,newPoints=[],i,pt,d;for(i=latLngs.length-1;i>=0;i--){pt=latLngs[i];d=this.getDistant(pt,baseLine);if(d>0){newPoints.push(pt)}else{continue}if(d>maxD){maxD=d;maxPt=pt}}return{maxPoint:maxPt,newPoints:newPoints}},buildConvexHull:function(baseLine,latLngs){var convexHullBaseLines=[],t=this.findMostDistantPointFromBaseLine(baseLine,latLngs);if(t.maxPoint){convexHullBaseLines=convexHullBaseLines.concat(this.buildConvexHull([baseLine[0],t.maxPoint],t.newPoints));convexHullBaseLines=convexHullBaseLines.concat(this.buildConvexHull([t.maxPoint,baseLine[1]],t.newPoints));return convexHullBaseLines}else{return[baseLine[0]]}},getConvexHull:function(latLngs){var maxLat=false,minLat=false,maxLng=false,minLng=false,maxLatPt=null,minLatPt=null,maxLngPt=null,minLngPt=null,maxPt=null,minPt=null,i;for(i=latLngs.length-1;i>=0;i--){var pt=latLngs[i];if(maxLat===false||pt.lat>maxLat){maxLatPt=pt;maxLat=pt.lat}if(minLat===false||pt.lat<minLat){minLatPt=pt;minLat=pt.lat}if(maxLng===false||pt.lng>maxLng){maxLngPt=pt;maxLng=pt.lng}if(minLng===false||pt.lng<minLng){minLngPt=pt;minLng=pt.lng}}if(minLat!==maxLat){minPt=minLatPt;maxPt=maxLatPt}else{minPt=minLngPt;maxPt=maxLngPt}var ch=[].concat(this.buildConvexHull([minPt,maxPt],latLngs),this.buildConvexHull([maxPt,minPt],latLngs));return ch}}})();L.MarkerCluster.include({getConvexHull:function(){var childMarkers=this.getAllChildMarkers(),points=[],p,i;for(i=childMarkers.length-1;i>=0;i--){p=childMarkers[i].getLatLng();points.push(p)}return L.QuickHull.getConvexHull(points)}});L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied===this||this._group._inZoomAnimation){return}var childMarkers=this.getAllChildMarkers(),group=this._group,map=group._map,center=map.latLngToLayerPoint(this._latlng),positions;this._group._unspiderfy();this._group._spiderfied=this;if(childMarkers.length>=this._circleSpiralSwitchover){positions=this._generatePointsSpiral(childMarkers.length,center)}else{center.y+=10;positions=this._generatePointsCircle(childMarkers.length,center)}this._animationSpiderfy(childMarkers,positions)},unspiderfy:function(zoomDetails){if(this._group._inZoomAnimation){return}this._animationUnspiderfy(zoomDetails);this._group._spiderfied=null},_generatePointsCircle:function(count,centerPt){var circumference=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+count),legLength=circumference/this._2PI,angleStep=this._2PI/count,res=[],i,angle;res.length=count;for(i=count-1;i>=0;i--){angle=this._circleStartAngle+i*angleStep;res[i]=new L.Point(centerPt.x+legLength*Math.cos(angle),centerPt.y+legLength*Math.sin(angle))._round()}return res},_generatePointsSpiral:function(count,centerPt){var spiderfyDistanceMultiplier=this._group.options.spiderfyDistanceMultiplier,legLength=spiderfyDistanceMultiplier*this._spiralLengthStart,separation=spiderfyDistanceMultiplier*this._spiralFootSeparation,lengthFactor=spiderfyDistanceMultiplier*this._spiralLengthFactor*this._2PI,angle=0,res=[],i;res.length=count;for(i=count-1;i>=0;i--){angle+=separation/legLength+i*5e-4;res[i]=new L.Point(centerPt.x+legLength*Math.cos(angle),centerPt.y+legLength*Math.sin(angle))._round();legLength+=lengthFactor/angle}return res},_noanimationUnspiderfy:function(){var group=this._group,map=group._map,fg=group._featureGroup,childMarkers=this.getAllChildMarkers(),m,i;this.setOpacity(1);for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i];fg.removeLayer(m);if(m._preSpiderfyLatlng){m.setLatLng(m._preSpiderfyLatlng);delete m._preSpiderfyLatlng}if(m.setZIndexOffset){m.setZIndexOffset(0)}if(m._spiderLeg){map.removeLayer(m._spiderLeg);delete m._spiderLeg}}group.fire("unspiderfied",{cluster:this,markers:childMarkers});group._spiderfied=null}});L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(childMarkers,positions){var group=this._group,map=group._map,fg=group._featureGroup,legOptions=this._group.options.spiderLegPolylineOptions,i,m,leg,newPos;for(i=0;i<childMarkers.length;i++){newPos=map.layerPointToLatLng(positions[i]);m=childMarkers[i];leg=new L.Polyline([this._latlng,newPos],legOptions);map.addLayer(leg);m._spiderLeg=leg;m._preSpiderfyLatlng=m._latlng;m.setLatLng(newPos);if(m.setZIndexOffset){m.setZIndexOffset(1e6)}fg.addLayer(m)}this.setOpacity(.3);group.fire("spiderfied",{cluster:this,markers:childMarkers})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}});L.MarkerCluster.include({_animationSpiderfy:function(childMarkers,positions){var me=this,group=this._group,map=group._map,fg=group._featureGroup,thisLayerLatLng=this._latlng,thisLayerPos=map.latLngToLayerPoint(thisLayerLatLng),svg=L.Path.SVG,legOptions=L.extend({},this._group.options.spiderLegPolylineOptions),finalLegOpacity=legOptions.opacity,i,m,leg,legPath,legLength,newPos;if(finalLegOpacity===undefined){finalLegOpacity=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity}if(svg){legOptions.opacity=0;legOptions.className=(legOptions.className||"")+" leaflet-cluster-spider-leg"}else{legOptions.opacity=finalLegOpacity}for(i=0;i<childMarkers.length;i++){m=childMarkers[i];newPos=map.layerPointToLatLng(positions[i]);leg=new L.Polyline([thisLayerLatLng,newPos],legOptions);map.addLayer(leg);m._spiderLeg=leg;if(svg){legPath=leg._path;legLength=legPath.getTotalLength()+.1;legPath.style.strokeDasharray=legLength;legPath.style.strokeDashoffset=legLength}if(m.setZIndexOffset){m.setZIndexOffset(1e6)}if(m.clusterHide){m.clusterHide()}fg.addLayer(m);if(m._setPos){m._setPos(thisLayerPos)}}group._forceLayout();group._animationStart();for(i=childMarkers.length-1;i>=0;i--){newPos=map.layerPointToLatLng(positions[i]);m=childMarkers[i];m._preSpiderfyLatlng=m._latlng;m.setLatLng(newPos);if(m.clusterShow){m.clusterShow()}if(svg){leg=m._spiderLeg;legPath=leg._path;legPath.style.strokeDashoffset=0;leg.setStyle({opacity:finalLegOpacity})}}this.setOpacity(.3);setTimeout(function(){group._animationEnd();group.fire("spiderfied",{cluster:me,markers:childMarkers})},200)},_animationUnspiderfy:function(zoomDetails){var me=this,group=this._group,map=group._map,fg=group._featureGroup,thisLayerPos=zoomDetails?map._latLngToNewLayerPoint(this._latlng,zoomDetails.zoom,zoomDetails.center):map.latLngToLayerPoint(this._latlng),childMarkers=this.getAllChildMarkers(),svg=L.Path.SVG,m,i,leg,legPath,legLength,nonAnimatable;group._animationStart();this.setOpacity(1);for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i];if(!m._preSpiderfyLatlng){continue}m.setLatLng(m._preSpiderfyLatlng);delete m._preSpiderfyLatlng;nonAnimatable=true;if(m._setPos){m._setPos(thisLayerPos);nonAnimatable=false}if(m.clusterHide){m.clusterHide();nonAnimatable=false}if(nonAnimatable){fg.removeLayer(m)}if(svg){leg=m._spiderLeg;legPath=leg._path;legLength=legPath.getTotalLength()+.1;legPath.style.strokeDashoffset=legLength;leg.setStyle({opacity:0})}}setTimeout(function(){var stillThereChildCount=0;for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i];if(m._spiderLeg){stillThereChildCount++}}for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i];if(!m._spiderLeg){continue}if(m.clusterShow){m.clusterShow()}if(m.setZIndexOffset){m.setZIndexOffset(0)}if(stillThereChildCount>1){fg.removeLayer(m)}map.removeLayer(m._spiderLeg);delete m._spiderLeg}group._animationEnd();group.fire("unspiderfied",{cluster:me,markers:childMarkers})},200)}});L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this);if(this._map.options.zoomAnimation){this._map.on("zoomstart",this._unspiderfyZoomStart,this)}this._map.on("zoomend",this._noanimationUnspiderfy,this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this);this._map.off("zoomstart",this._unspiderfyZoomStart,this);this._map.off("zoomanim",this._unspiderfyZoomAnim,this);this._map.off("zoomend",this._noanimationUnspiderfy,this);this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){if(!this._map){return}this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(zoomDetails){if(L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")){return}this._map.off("zoomanim",this._unspiderfyZoomAnim,this);this._unspiderfy(zoomDetails)},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(zoomDetails){if(this._spiderfied){this._spiderfied.unspiderfy(zoomDetails)}},_noanimationUnspiderfy:function(){if(this._spiderfied){this._spiderfied._noanimationUnspiderfy()}},_unspiderfyLayer:function(layer){if(layer._spiderLeg){this._featureGroup.removeLayer(layer);if(layer.clusterShow){layer.clusterShow()}if(layer.setZIndexOffset){layer.setZIndexOffset(0)}this._map.removeLayer(layer._spiderLeg);delete layer._spiderLeg}}});L.MarkerClusterGroup.include({refreshClusters:function(layers){if(!layers){layers=this._topClusterLevel.getAllChildMarkers()}else if(layers instanceof L.MarkerClusterGroup){layers=layers._topClusterLevel.getAllChildMarkers()}else if(layers instanceof L.LayerGroup){layers=layers._layers}else if(layers instanceof L.MarkerCluster){layers=layers.getAllChildMarkers()}else if(layers instanceof L.Marker){layers=[layers]}this._flagParentsIconsNeedUpdate(layers);this._refreshClustersIcons();if(this.options.singleMarkerMode){this._refreshSingleMarkerModeMarkers(layers)}return this},_flagParentsIconsNeedUpdate:function(layers){var id,parent;for(id in layers){parent=layers[id].__parent;while(parent){parent._iconNeedsUpdate=true;parent=parent.__parent}}},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(c){if(c instanceof L.MarkerCluster&&c._iconNeedsUpdate){c._updateIcon()}})},_refreshSingleMarkerModeMarkers:function(layers){var id,layer;for(id in layers){layer=layers[id];if(this.hasLayer(layer)){layer.setIcon(this._overrideMarkerIcon(layer))}}}});L.Marker.include({refreshIconOptions:function(options,directlyRefreshClusters){var icon=this.options.icon;L.setOptions(icon,options);this.setIcon(icon);if(directlyRefreshClusters&&this.__parent){this.__parent._group.refreshClusters(this)}return this}})})(window,document);(function($,Drupal){function fetchContent($parent,url){$.getJSON(url,function(data){$parent.html(data.container);Drupal.attachBehaviors($parent.get(0))})}function updateUrlParam(url,key,value){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i");var separator=url.indexOf("?")!==-1?"&":"?";if(url.match(re)){return url.replace(re,"$1"+key+"="+value+"$2")}else{return url+separator+key+"="+value}}function handleClickChange(e){e.preventDefault();var page=$(this).data("page");var $parent=$(this).closest(".cw-database");var $pager=$parent.find(".pager-next");$pager.find("a").hide();$pager.append('<div class="ajax-progress ajax-progress-throbber"><div class="throbber">&nbsp;</div></div>');var url=$parent.find('input[name="api-request"]').val();url=updateUrlParam(url,"page",page);try{fetchContent($parent,url)}catch(err){console.error(new Error(err))}}Drupal.behaviors.crisiswatchDatabase={attach:function(context){$(".cw-database__pager .pager-next a",context).on("click",handleClickChange)},fetchContent:function($parent,url){fetchContent($parent,url)},updateUrlParam:function(url,key,value){return updateUrlParam(url,key,value)}}})(jQuery,Drupal);window.App=window.App||{};window.App=function(window,$,app){"use strict";app.module={};app.module.items=new ObservableArray([]);app.module.items.addEventListener("itemadded",function(e){if(app[e.item]){if(app[e.item].preInit&&app[e.item].init){if(typeof app[e.item].init==="function"&&!app[e.item].isLoaded){app[e.item].init()}}}app[e.item].isLoaded=true});app.module.create=function(name,obj){if(!obj)return;obj.isModule=true;obj.isLoaded=false;app[name]=obj;if(typeof app[name].preInit==="function"){if(app[name].preInit()){app.module.items.push(name)}}};return app}(window,jQuery,window.App);App.module.create("utilities",function(window,$,app){"use strict";var module={},selector="body";module.preInit=function(){return document.querySelector(selector)!==null};app.$win=$(window);app.$doc=$(document);app.$html=$(document).find("html");app.$body=$(document).find("body");app.breakpoints={SMALL:320,MEDIUM:760,LARGE:1080,XLARGE:1584};app.isScrollable=true;app.isOverlayOpen=false;app.isNavBarOpen=false;app.isModalOpen=false;app.EventHandler=new SubPub;app.resizeEvents=[];app.resizeEventsInstant=[];app.scrollEvents=[];app.scrollEventsInstant=[];app.scrollLocation=app.$win.scrollTop();app.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;app.isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);app.ls=$.localStorage;app.storage=new ObservableArray([]);app.cs=$.cookieStorage;app.preventDefault=function(element,event){event.preventDefault();element.blur();return element};app.getCurrentBreakpoint=function(type){var $breakpoint;if(typeof type==="undefined"||type==="string"){$breakpoint=app.$win.outerWidth()<app.breakpoints.MEDIUM?"small":app.$win.outerWidth()<app.breakpoints.LARGE?"medium":"large"}else if(type==="number"){$breakpoint=app.$win.outerWidth()<app.breakpoints.MEDIUM?app.breakpoints.SMALL:app.$win.outerWidth()<app.breakpoints.LARGE?app.breakpoints.MEDIUM:app.breakpoints.LARGE}return $breakpoint};app.setScrolling=function($context,disableScroll){if(!$context.length){return}if(disableScroll){$context.addClass("u-no-scroll")}else{$context.removeClass("u-no-scroll")}app.isScrollable=!disableScroll};app.showOverlay=function($context,overlayState){if(!$context.length){return}var $overlay=$context.hasClass("js-header")?$(".js-overlay--nav",$context):$(".js-overlay",app.$body);if(overlayState){$overlay.addClass("u-is-visible").addClass("u-is-shown")}else{$overlay.removeClass("u-is-shown");setTimeout(function(){$overlay.removeClass("u-is-visible")},350)}app.isOverlayOpen=overlayState;return $overlay};app.setSelector=function(value,context){var _scope=typeof context==="undefined"?document:context;if(typeof value==="string"){if(_scope.querySelector(value)===null){return false}}else if(typeof value==="object"){if(value===null){return false}}else{return false}return value};app.toggleNavBar=function(context,isInstant){if(!$(context).length){return}var showNav=app.isNavBarOpen?false:true;var isMedium=app.$win.width()>=app.breakpoints.MEDIUM;app.setScrolling(app.$body,showNav);app.isNavBarOpen=showNav;if(showNav){var $currentNav=isMedium?$(".js-mega-menu__groups--medium",$(context)):$(".js-mega-menu__groups",$(context));$(context).addClass("is-open");$(context).find(".js-mega-menu").addClass("u-is-visible");$currentNav.scrollTop(0);$("[data-level=1]",$currentNav).addClass("is-open");$('[data-level=1] [data-menu="main"]',$currentNav).addClass("is-open");app.EventHandler.publish("MEGA_MENU_OPEN",context)}else{$(context).removeClass("is-open");if(typeof isInstant!=="undefined"&&isInstant){$(".u-is-visible",$(context)).removeClass("u-is-visible");$(".u-is-shown",$(context)).removeClass("u-is-shown");$(".is-open",$(context)).removeClass("is-open");$("[data-menu-depth]",$(context)).attr("data-menu-depth",1);app.EventHandler.publish("MEGA_MENU_CLOSE",context)}else{setTimeout(function(){$(".u-is-visible",$(context)).removeClass("u-is-visible");$(".u-is-shown",$(context)).removeClass("u-is-shown");$(".is-open",$(context)).removeClass("is-open");$("[data-menu-depth]",$(context)).attr("data-menu-depth",1);app.EventHandler.publish("MEGA_MENU_CLOSE",context)},350)}}app.showOverlay($(context),showNav);return showNav};app.resizeHandler=function(){var resizeObject={};app.$win.on("resize",function(){resizeObject={url:window.location,time:Date.now(),winWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),winHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),icg:true};app.EventHandler.publish("EVENT_RESIZE_INSTANT",resizeObject)});app.$win.on("resize",debounce(function(){app.EventHandler.publish("EVENT_RESIZE",resizeObject)},300))};app.orientationHandler=function(obj){if(app.$win.outerHeight()>app.$win.outerWidth()){app.$body.addClass("is-portrait").removeClass("is-landscape")}else{app.$body.addClass("is-landscape").removeClass("is-portrait")}};app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",app.orientationHandler);app.scrollHandler=function(){var scrollObject={};app.$win.on("scroll",function(){var st=app.$win.scrollTop();scrollObject={url:window.location,time:Date.now(),scrollY:window.scrollY||window.pageYOffset,scrollX:window.scrollX||window.pageXOffset,dir:st>app.scrollLocation?"up":"down",icg:true};app.scrollLocation=st;app.EventHandler.publish("EVENT_SCROLL_INSTANT",scrollObject)});app.$win.on("scroll",debounce(function(){app.EventHandler.publish("EVENT_SCROLL",scrollObject)},300))};app.classAddRemove=function($context,_add,_remove,timing){var _addClass=typeof _add==="undefined"?"u-db":_add;var _removeClass=typeof _remove==="undefined"?"u-opacity":_remove;$context.addClass(_addClass);if(typeof timing!=="undefined"){timing=Math.abs(timing);setTimeout(function(){$context.addClass(_removeClass)},timing)}};app.classRemoveAdd=function($context,_add,_remove,timing){var _addClass=typeof _add==="undefined"?"u-db":_add;var _removeClass=typeof _remove==="undefined"?"u-opacity":_remove;$context.removeClass(_removeClass);if(typeof timing!=="undefined"){timing=Math.abs(timing);setTimeout(function(){$context.removeClass(_addClass)},timing)}};app.objectFitImagesPolyfill=function(){$(".o-image img").on("load",function(event){objectFitImages(".o-image img")})};app.selectCustom=function(){$(".o-select").each(function(){var $self=$(this),$theme=$self.data("selectTheme");var selected_theme=$theme?$theme:"";$self.select2({theme:selected_theme})})};app.cleanUpLocalStorage=function(storageKey){var obj=app.ls.get("icg",storageKey);app.storage[storageKey]=$.unique(app.ls.get("icg",storageKey))};app.initializeLocalStorage=function(){app.storage=app.ls.get("icg");app.ls.set("icg",app.storage)};app.handleLocalStorage=function(){if(!app.ls.isEmpty("icg")){app.initializeLocalStorage()}else{console.warn("ICG Local Storage is Empty. Creating a new one.");app.ls.set("icg",{saved:[],highlights:{}});app.storage=app.ls.get("icg")}};app.setCookie=function(name,value){var expiryDate=new Date((new Date).setFullYear((new Date).getFullYear()+1)).toUTCString();document.cookie=name+"="+value+"; expires="+expiryDate+"; path=/"};app.getCookie=function(name){var name=name+"=",ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1);if(c.indexOf(name)!=-1)return c.substring(name.length,c.length)}return""};app.handleCookieStorage=function(){var cookie=app.getCookie("icg");if(app.getCookie("icg")){app.$body.addClass("has-cookie").removeClass("no-cookie");$(".js-cookie").removeClass("u-df").addClass("u-dn")}else{app.$body.addClass("no-cookie").removeClass("has-cookie");$(".js-cookie").addClass("u-df").removeClass("u-dn")}$(".js-cookie-agree").on("click",function(e){var $el=app.preventDefault($(this),e);app.setCookie("icg",true);$(".js-cookie").fadeOut("600",function(){$(".js-cookie").removeClass("u-df").addClass("u-dn").removeAttr("style")})})};module.handleMailtoLinks=function(){$('a[href^="mailto"]').on("click",function(e){app.$html.addClass("no-fade")})};module.initialResize=function(){app.orientationHandler();$("body").attr("data-breakpoint-current",app.getCurrentBreakpoint());$("body").attr("data-breakpoint-prev",app.getCurrentBreakpoint())};module.init=function(){app.resizeHandler();app.scrollHandler();app.objectFitImagesPolyfill();app.selectCustom();app.handleLocalStorage();app.handleCookieStorage();module.initialResize();module.handleMailtoLinks()};return module}(window,jQuery,window.App));App.module.create("slider",function(window,$,app){"use strict";var module={},selector=".js-slider";module.preInit=function(){return document.querySelector(selector)!==null};app.sliders=new ObservableArray([]);var $context=$(selector);app.Slider=function(selector,options){var _dis=this;var _obj=$(selector);var xDown=null;var yDown=null;if(!_obj.length){console.error('FlexSliderJS Error: Object "'+selector+'" does not exist.');return}_dis.context=_obj;var _opt={};_opt.trackClass=app.setSelector(".c-slider__track");_opt.itemClass=app.setSelector(".c-slider__item");_opt.ctrlClass=app.setSelector(".c-slider__controls");_opt.prevClass=app.setSelector(".c-slider__controls--left");_opt.nextClass=app.setSelector(".c-slider__controls--right");_opt.hasControls=true;_opt.animateTrack=true;_opt.disableButtons=true;_opt.fadeItem=true;_opt.delay=350;_opt.initPage=1;_opt.isStream=false;_opt.perPage={};if(typeof options!=="undefined"){$.extend(_opt,options)}var _num=$(_opt.itemClass,_obj).length;var _current=0;var _perPage=Object.size(_opt.perPage)===0?{0:1}:_opt.perPage;var _slideDivider=1;_dis.prevtBtn=_opt.prevClass;_dis.nextBtn=_opt.nextClass;Object.defineProperty(_dis,"length",{get:function(){return _num}});Object.defineProperty(_dis,"current",{get:function(){return _current+1},set:function(page){if(typeof page==="number"&&page>0){moveSlider(_obj,page)}}});Object.defineProperty(_dis,"lastPage",{get:function(){return Math.ceil(_dis.current/_slideDivider)*_slideDivider-(_slideDivider-1)}});if(_opt.hasControls){$(_opt.ctrlClass,_obj).addClass("is-shown")}else{$(_opt.ctrlClass,_obj).remove()}if(_opt.disableButtons){$(_opt.prevClass,_obj).addClass("u-is-disabled");$(_opt.nextClass,_obj).addClass("u-is-disabled");if(typeof _opt.onClickStart==="function"||typeof _opt.onClickEnd==="function"){console.warn('FlexSliderJS Warning: "onClickStart" and "onClickEnd" are unreachable while "disableButton" is set to "true"')}}if(!_opt.animateTrack){$(_opt.trackClass,_obj).addClass("u-no-transition")}if(!_opt.fadeItem){$(_opt.itemClass,_obj).addClass("u-no-transition")}if(typeof $(_opt.ctrlClass,_obj).attr("data-page")==="undefined"){$(_opt.ctrlClass,_obj).attr("data-page",1);$($(_opt.itemClass,_obj)[_current]).addClass("is-shown").addClass("is-visible")}var moveSlider=function(context,page){var sliderIndex;sliderIndex=_current=typeof page==="undefined"?_current:page-1;if(_current==0){if(_opt.disableButtons){$(_opt.prevClass,context).addClass("u-is-disabled")}if(typeof _opt.onReachStart==="function"){_opt.onReachStart(_dis)}}else{$(_opt.prevClass,context).removeClass("u-is-disabled")}if(_current==_num-_slideDivider){if(_opt.disableButtons){$(_opt.nextClass,context).addClass("u-is-disabled")}if(typeof _opt.onReachEnd==="function"){_opt.onReachEnd(_dis)}}else{$(_opt.nextClass,context).removeClass("u-is-disabled")}_dis.recheckPaging=function(){$.each(_perPage,function(index,value){var intIndex=parseInt(index);var widthComparison=intIndex===NaN?app.$win.width()+1:intIndex;if(app.$win.width()<widthComparison){_slideDivider=value;return false}else{_slideDivider=value}})};if(_opt.isStream){_dis.recheckPaging()}$(_opt.itemClass,context).removeClass("is-shown").addClass("will-fadeout");$(_opt.trackClass,context).css({transform:"translateX("+-100*sliderIndex/_slideDivider+"%)"});$(_opt.ctrlClass,context).attr("data-page",sliderIndex+1);$($(_opt.itemClass,context)[sliderIndex]).addClass("is-visible").addClass("is-shown").removeClass("will-fadeout");if(_opt.fadeItem){if(typeof _opt.onClick==="function"){_opt.onClick(_dis)}setTimeout(function(){$(".will-fadeout",context).removeClass("is-visible").removeClass("will-fadeout");if(typeof _opt.onChange==="function"){_opt.onChange(_dis)}},_opt.delay)}};var moveLeft=function(e){e.preventDefault();if(_obj.hasClass("unslide")){return}var sliderPage=_current+1;if(sliderPage==1){if(typeof _opt.onClickStart==="function"){_opt.onClickStart(_dis)}return}_current--;moveSlider(_obj)};var moveRight=function(e){e.preventDefault();if(_obj.hasClass("unslide")){return}var sliderPage=_current+1;if(sliderPage==_num-(_slideDivider-1)||_num<_slideDivider){if(typeof _opt.onClickEnd==="function"){_opt.onClickEnd(_dis)}return}_current++;moveSlider(_obj)};Object.defineProperty(_dis,"reposition",{value:function(){_dis.current=_dis.lastPage}});Object.defineProperty(_dis,"recompute",{value:function(){_num=$(_opt.itemClass,_obj).length;moveSlider(_obj,1);_dis.recheckPaging();if(_opt.onRecompute==="function"){_opt.onRecompute(_dis)}return _num}});$(_opt.prevClass,_obj).on("click",moveLeft);$(_opt.nextClass,_obj).on("click",moveRight);if(_opt.isStream){var moveSliderOnResize;if(typeof _opt.onResize=="function"){moveSliderOnResize=function(obj){_opt.onResize(_dis)}}else{moveSliderOnResize=function(obj){while(_num-_current<_slideDivider&&_current>1){_current--}moveSlider(_obj)}}app.EventHandler.subscribe("EVENT_RESIZE",moveSliderOnResize)}else{if(typeof _opt.onResize=="function"){var moveSliderOnResize=function(obj){_opt.onResize(obj)};app.EventHandler.subscribe("EVENT_RESIZE",moveSliderOnResize)}}var $trackHammer=new Hammer(document.querySelector(_opt.trackClass));$trackHammer.on("swipeleft",moveRight);$trackHammer.on("swiperight",moveLeft);if(window.hasOwnProperty("trackHammer")){window.trackHammer.push($trackHammer)}else{window.trackHammer=[];window.trackHammer.push($trackHammer)}if(typeof _opt.initPage!=="undefined"&&_opt.initPage>0){_current=_opt.initPage-1;moveSlider(_obj)}if(typeof _opt.onLoad==="function"){_opt.onLoad(_dis)}Object.defineProperty(_dis,"unslide",{value:function(){moveSlider(_obj,1);_obj.addClass("unslide");return _dis}});app.sliders.push(_dis);return _dis};module.init=function(){};return module}(window,jQuery,window.App));App.module.create("slideshow",function(window,$,app){"use strict";var module={},selector=".js-slideshow";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var unslideOnMobile=function(obj){if(obj.winWidth<app.breakpoints.MEDIUM){$(".js-slideshow--modal",app.$body).addClass("unslide");$(".js-slideshow--modal",app.$body).parent(".o-modal__content").addClass("u-scroll-y")}else{$(".js-slideshow--modal",app.$body).removeClass("unslide");$(".js-slideshow--modal",app.$body).parent(".o-modal__content").removeClass("u-scroll-y")}};app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",unslideOnMobile);var handleSlideshowPaging=function(slider){var currentScrollTop=$(".o-modal__content").scrollTop();var _dis=slider;var wHeight=app.$win.outerHeight();if(!$(".o-modal--slideshow",app.$body).hasClass("unslide")){return}var $slides=$(".js-slideshow--modal").find(".c-slider__item--slideshow");$.each($slides,function(ctr,slide){var $slide=$(slide),offsetTop=$slide.offset().top,fiftyPercent=Math.round($slide.outerHeight()/2);if(offsetTop<=fiftyPercent){_dis.current=ctr+1}})};module.slideShowModalInit=function(slideshowId,slideshowPage){var sliderContext=selector,descText=$(".c-slider__item--0 .c-slideshow__text--desc",$(sliderContext)).text(),metaText=$(".c-slider__item--0 .c-slideshow__text--meta",$(sliderContext)).text(),$target=$(".c-slideshow__content",$(sliderContext)),$targetDesc=$(".c-slideshow__content--desc",$(sliderContext)),$targetMeta=$(".c-slideshow__content--meta",$(sliderContext)),$slides=$(".c-slider__item--slideshow",$(".js-slideshow--modal")),$fbShare=$(".js-slideshow--facebook-target",$(sliderContext)),$twShare=$(".js-slideshow--twitter-target",$(sliderContext));$targetDesc.text(descText);$targetMeta.text(metaText);$target.addClass("u-db-imp").addClass("is-shown");var shClick=function(slider){$target.removeClass("is-shown")};var shChange=function(slider){var currentHash=getStringParts(window.location.hash,"-");var newHash=window.location.hash;descText=$(".c-slider__item--"+(slider.current-1)+" .c-slideshow__text--desc",$(sliderContext)).text();metaText=$(".c-slider__item--"+(slider.current-1)+" .c-slideshow__text--meta",$(sliderContext)).text();var twShareHref="https://twitter.com/intent/tweet?via=crisisgroup&url=";$targetDesc.text(descText);$targetMeta.text(metaText);$target.addClass("is-shown");newHash=currentHash[0]+"-"+currentHash[1]+"-"+slider.current;window.location.hash=newHash;var imageId=$(".c-slider__item--"+(slider.current-1)).attr("data-iid"),shareURL=window.location.origin+window.location.pathname+"?iid="+imageId+window.location.hash,twitterShareURL=shareURL.replace("#","&slideshow=");$fbShare.attr("href",shareURL);$twShare.attr("href",twShareHref+encodeURIComponent(twitterShareURL)+"&text="+descText);$(".js-slider__page--numerator",$(sliderContext)).text(slider.current)};var checkOrientation=function(obj){if(obj.winWidth>=app.breakpoints.MEDIUM){if(obj.winWidth<obj.winHeight){$(".js-slideshow--modal",app.$body).addClass("is-portrait")}else{$(".js-slideshow--modal",app.$body).removeClass("is-portrait")}}else{$(".js-slideshow--modal",app.$body).removeClass("is-portrait")}};var shLoad=function(slider){var _dis=slider,onLoadHash=window.location.hash,onLoadHashObj=getStringParts(window.location.hash,"-");if(onLoadHashObj.length===2){onLoadHash+="-"+1}else if(onLoadHashObj.length===3){if(onLoadHashObj.length<3&&onLoadHashObj[2]===""){onLoadHash+=1}}window.location.hash=onLoadHash;$(".js-slideshow__desc-title").text($(".js-slideshow--modal").attr("data-title"));$(".c-slideshow .o-modal__content").on("scroll",function(){debounce(handleSlideshowPaging(_dis),300)});checkOrientation({winWidth:app.$win.outerWidth(),winHeight:app.$win.outerHeight()});unslideOnMobile({winWidth:app.$win.outerWidth()})};app.$slideshow=new app.Slider(sliderContext,{onClick:shClick,onChange:shChange,onLoad:shLoad,initPage:typeof slideshowPage!=="undefined"?parseInt(slideshowPage):1,onResize:function(obj){checkOrientation(obj)}})};module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("modal",function(window,$,app){"use strict";var module={},selector=".js-modal";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector),$target=$(".o-modal__content",$context),$modalContainer=$context,$modalContent=$target,$toggleModal=$("[data-modal]",app.$body);app.toggleModal=function(obj){var _obj=typeof obj==="undefined"||obj==null?".o-modal":obj;var modalState=!app.isModalOpen;var $modal=$(_obj,app.$body);app.showOverlay(app.$body,modalState);app.setScrolling(app.$body,modalState);app.isModalOpen=modalState;if(modalState){runInSequence([function(){$modal.addClass("u-df-imp")},function(){$modal.addClass("is-open");$modal.removeClass("u-is-uninteractive");Drupal.attachBehaviors()}],150)}else{history.replaceState("",document.title,window.location.pathname);runInSequence([function(){$modal.removeClass("is-open");$modal.addClass("u-is-uninteractive")},function(){$modal.removeClass("u-df-imp");$modal.removeClass("c-slideshow")}],350)}};module.loadTemplate=function(type,data,trigger){var templateName="#"+type,template=$(templateName).html(),target=$context;var rendered=Handlebars.compile(template);$target.html(rendered(data));switch(type){case"slideshow":{var slideshowPage=trigger;$(".o-modal",app.$body).addClass("c-slideshow").attr("data-slideshow-id",data.id).attr("data-context","slideshow");app.slideshow.slideShowModalInit(data.id,slideshowPage);break}}};module.openModal=function(jsonContent,trigger){app.toggleModal();module.loadTemplate(jsonContent.type,jsonContent,trigger)};module.handleModalAutoOpen=function(){var modalGet=getStringParts(window.location.search,"slideshow=");var modalHash=getStringParts(window.location.hash,"-");if(modalHash[0]==="#ss"||modalHash[0]==="#map"){var slideshowlId=modalHash[1],slideshowPage=modalHash[2]===""?1:modalHash[2],$modalJson=modalHash[0]==="#ss"?window.slideshows[slideshowlId]:window.maps[slideshowlId];if(typeof $modalJson==="undefined"){history.replaceState("",document.title,window.location.pathname);return}module.openModal($modalJson,slideshowPage)}else if(modalGet[0]!=""&&typeof modalGet[1]!="undefined"&&modalGet[1].startsWith("ss")){modalHash=getStringParts(modalGet[1],"-");window.location.hash=modalGet[1];var slideshowlId=modalHash[1],slideshowPage=modalHash[2]===""?1:modalHash[2],$modalJson=window.slideshows[slideshowlId];if(typeof $modalJson==="undefined"){window.location.hash="";return}module.openModal($modalJson,slideshowPage)}};app.modalGlobal=function(obj,modalTarget){obj.on("click",function(e){var $el=app.preventDefault($(this),e),modalName=$("#"+$(this).data("modal")),_size=$el.data("modalSize"),_color=$el.data("modalColor");if(modalName.length){app.toggleModal();var template=$(modalName,app.$body).html(),rendered=Handlebars.compile(template);$target.html(rendered(template))}else{app.toggleModal(modalTarget)}$modalContainer.attr("data-context",$(this).data("modal"));$modalContainer.addClass("u-ofs u-pad-b20");if($(this).data("modal").includes("download")){$modalContainer.find("span.scroll-bar").remove();$modalContainer.css("background-image","none")}switch(_size){case"wide":$modalContainer.addClass("o-modal--wide");break;case"small":$modalContainer.addClass("o-modal--small");break}switch(_color){case"white":$modalContainer.addClass("u-bg-white");break;case"gray":$modalContainer.addClass("u-bg-gray--primary");break}})};handlers.push({name:"_handleModalSlideshow",handle:function(){$(".js-slideshow",app.$body).on("click",function(e){var $el=app.preventDefault($(this),e),$slideshowId=$el.attr("data-json"),$slideshowJson=window.slideshows[$slideshowId];if(typeof $slideshowJson==="undefined"){console.error("Slideshow "+$slideshowId+" does not exist");return}window.location.hash="ss-"+$slideshowId+"-";module.openModal($slideshowJson,1);$modalContainer.attr("data-context","slideshow")})}});handlers.push({name:"_handleMaps",handle:function(){$(".js-view-maps",app.$body).on("click",function(e){var $el=app.preventDefault($(this),e),$mapsId=$el.attr("data-json"),$mapsJson=window.maps[$mapsId];window.location.hash="map-"+$mapsId+"-";module.openModal($mapsJson,1);$modalContainer.attr("data-context","slideshow")})}});handlers.push({name:"_handleModalPrint",handle:function(){$(".js-print-download",app.$body).on("click",function(e){var $el=app.preventDefault($(this),e),template=$("#print-download").html(),rendered=Handlebars.compile(template);app.toggleModal();$target.html(rendered(template));$modalContainer.attr("data-context","print");$modalContainer.removeClass("u-df-imp").addClass("o-modal--wide u-bg-gray--primary u-ofs u-pad-b20 u-db-imp");$modalContent.addClass("u-pad-l20 u-pad-r20 u-pad-l70@m u-pad-r70@m")});$(".js-download").on("click",function(e){e.preventDefault();window.location.href=$(this).attr("href")})}});handlers.push({name:"_handleCustomScroll",handle:function(){var $modal=$(".js-modal");var $modalContent=$(".o-modal__content");var windowWidth=$(window).innerWidth();var windowHeight=$(window).innerHeight();var $modalHeight=740;if(windowWidth<760){$modalHeight=windowHeight}var $documentHeight=$modal.innerHeight()-$modalHeight;var $currentPosition=0;var $gotoPosition=0;var $modalTop=windowHeight/2-$modalHeight/2;$($modal).scroll(function(){var $scrollTop=$(this).scrollTop();$currentPosition=$scrollTop/$documentHeight*100;if($currentPosition>1){$currentPosition=1}$gotoPosition=$modalHeight*$currentPosition-25;if($scrollTop<16){$gotoPosition=$modalHeight*$currentPosition}$(".scroll-bar").css({top:$gotoPosition+$modalTop+"px"})})}});handlers.push({name:"_handleModalSubscribe",handle:function(){$(".js-subscribe",app.$body).on("click",function(e){var $el=app.preventDefault($(this),e),template=$("#subscribe").html(),rendered=Handlebars.compile(template);app.toggleModal();$target.html(rendered(template));$modalContainer.attr("data-context","subscribe");$modalContainer.removeClass("u-df-imp").addClass("o-modal--wide u-bg-gray--primary u-ofs u-pad-b20 u-db-imp");$modalContent.addClass("u-pad-l20 u-pad-r20 u-pad-l70@m u-pad-r70@m");$(app.$doc).ajaxSuccess(function(event,request,settings){if($modalContainer.data("context")==="subscribe"){if($modalContent.find("form").length){app.form.Validation.email("#subscribe-email");app.form.Validation.checkboxGroup(".js-checkboxes-1");app.form.Validation.checkboxGroup(".js-checkboxes-2");app.form.Validation.required("#subscribe_terms_of_use");return}$modalContainer.addClass("o-modal--alert")}})});var subscribeModalClose=function(modalObj){if(modalObj==="subscribe"){$modalContainer.removeClass("o-modal--wide o-modal--alert u-bg-gray--primary u-ofs u-pad-b20");$modalContent.removeClass("u-pad-l20 u-pad-r20 u-pad-l70@m u-pad-r70@m")}};app.EventHandler.subscribe("EVENT_MODAL_TOGGLE",subscribeModalClose)},attach:function(context,settings){}});handlers.push({name:"_handleGlobalModal",handle:function(){var $toggleModal=$("[data-modal]",app.$body);$toggleModal.each(function(index,val){app.modalGlobal($(val))});var globalModalClose=function(modalObj){if(modalObj){setTimeout(function(){$modalContainer.removeClass("o-modal--wide o-modal--video o-modal--small u-bg-gray--primary u-bg-white u-ofs u-pad-b20")},500);$modalContent.removeClass("u-pad-l20 u-pad-r20 u-pad-l70@m u-pad-r70@m")}};app.EventHandler.subscribe("EVENT_MODAL_TOGGLE",globalModalClose)}});handlers.push({name:"_closeModalToggle",handle:function(){$(".js-modal-toggle").on("click",function(e){console.log("Closing..");e.preventDefault();app.toggleModal();$target.html("");var modalObject=$modalContainer.data("context");app.EventHandler.publish("EVENT_MODAL_TOGGLE",modalObject)})}});handlers.push({name:"_handleModalDonationCancel",handle:function(){$(".js-donation-cancel",app.$body).on("click",function(e){var $el=app.preventDefault($(this),e),template=$("#donation-cancel").html(),rendered=Handlebars.compile(template);app.toggleModal();$target.html(rendered(template));$modalContainer.attr("data-context","donation-cancel");$modalContainer.removeClass("u-df-imp").addClass("c-donation-cancel__modal u-bg-gray--primary u-ofs u-pad-b40 u-pad-b60@m u-db-imp");$modalContent.addClass("u-pad-l20 u-pad-r20 u-pad-l70@m u-pad-r70@m");loadReCaptcha();$(app.$doc).ajaxSuccess(function(event,request,settings){if($modalContainer.data("context")==="donation-cancel"){if($modalContent.find("form").length){app.form.Validation.email("#donation-cancel-email");loadReCaptcha();return}$modalContainer.addClass("o-modal--alert")}})});var loadReCaptcha=function(){if($(".g-recaptcha",$modalContainer).length>0){grecaptcha.render($(".g-recaptcha",$modalContainer)[0])}};var donationCancelModalClose=function(modalObj){if(modalObj==="donation-cancel"){$modalContainer.removeClass("o-modal--wide o-modal--alert u-bg-gray--primary u-ofs u-pad-b50");$modalContent.removeClass("u-pad-l20 u-pad-r20 u-pad-l70@m u-pad-r70@m")}};app.EventHandler.subscribe("EVENT_MODAL_TOGGLE",donationCancelModalClose)},attach:function(context,settings){}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}});module.handleModalAutoOpen()};return module}(window,jQuery,window.App));App.module.create("navigation",function(window,$,app){"use strict";var module={},selector=".s-header",$hero=$(".c-page-hero");module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);handlers.push({name:"_handleMainNavStyles",handle:function(){if(typeof $hero!=="undefined"){if(!$hero.first().hasClass("c-page-hero--full c-page-hero--max")){$(selector).addClass(selector.substring(1)+"--dark")}}}});handlers.push({name:"_handleMainNav",handle:function(){var $megaMenu=$(".js-mega-menu",$context);$(".js-nav-toggle",$context).on("click",function(e){var $el=app.preventDefault($(this),e);var navBarState=app.toggleNavBar(selector)});$(".js-text-mode-toggle").on("click",function(e){var $el=app.preventDefault($(this),e);var currentMode=$el.data("mode");if(currentMode=="full"){document.cookie="text_mode=on"}else{document.cookie="text_mode=off"}location.reload(true)});var megaMenuClickEvent=function(e){var $el=app.preventDefault($(this),e);var $menuGroups=$(this).closest(".c-mega-menu__groups"),menuDepth=$(this).attr("data-depth"),menuTarget=$(this).attr("data-target");var $whichGroup=$menuGroups.hasClass("c-mega-menu__groups--medium")?$(".c-mega-menu__groups--medium",$context):$(".c-mega-menu__groups--mobile",$context);if(!$menuGroups.hasClass("c-mega-menu__groups--medium")){$(".c-mega-menu__group",$whichGroup).addClass("fadeOutLater");$("[data-menu="+menuTarget+"]",$whichGroup).addClass("is-open")}else{if($megaMenu.hasClass("is-open")){$megaMenu.removeClass("is-open")}else{$megaMenu.addClass("is-open");$("[data-menu="+menuTarget+"]",$whichGroup).addClass("is-open").removeClass("fadeOutLater")}}$whichGroup.attr("data-menu-depth",menuDepth);$("[data-level="+menuDepth+"]",$whichGroup).addClass("is-open").removeClass("fadeOutLater");$("[data-menu]",$whichGroup).addClass("fadeOutLater");$("[data-menu="+menuTarget+"]",$whichGroup).removeClass("fadeOutLater");if(!$(this).hasClass("js-nav-toggle")){$("[data-target]",$whichGroup).addClass("u-is-uninteractive");if(app.$win<app.breakpoints.MEDIUM){$("[data-menu="+menuTarget+"]",$whichGroup).addClass("is-open").scrollTop(0)}else{setTimeout(function(){$("[data-menu="+menuTarget+"]",$whichGroup).addClass("is-open").scrollTop(0)},350)}setTimeout(function(){$("[data-target]",$whichGroup).removeClass("u-is-uninteractive");$megaMenu.addClass("is-open");$(".fadeOutLater[data-menu]",$whichGroup).removeClass("is-open").removeClass("fadeOutLater");$(".c-mega-menu__group.fadeOutLater [data-menu]",$whichGroup).removeClass("is-open");$(".c-mega-menu__group.fadeOutLater",$whichGroup).removeClass("is-open").removeClass("fadeOutLater")},350)}$(".has-submenu").removeClass("is-active");if($el.hasClass("has-submenu")){$el.addClass("is-active")}};var sideNavClickEvent=function(e){var $el=app.preventDefault($(this),e);if($el.hasClass("js-side-nav__item")){app.toggleNavBar(selector);var $menu=$(".js-mega-menu",$context);var $group=$(".js-mega-menu__groups--medium",$context);var $level=$('[data-level="'+$el.attr("data-depth")+'"]',$group);var $region=$('[data-menu="'+$el.attr("data-target")+'"]',$level);setTimeout(function(){$menu.addClass("is-open");$level.addClass("is-open");$region.addClass("is-open")},500)}};$("[data-target]",$context).on("click",megaMenuClickEvent);if($(".js-side-nav").length){$("[data-target]",$(".js-side-nav")).on("click",sideNavClickEvent)}$(".js-overlay--nav",$context).on("click",function(e){var $el=app.preventDefault($(this),e);var navBarState=app.toggleNavBar(selector)});var hideNavOnBreakpointChange=function(obj){if(app.isNavBarOpen&&app.$body.attr("data-breakpoint-current")!=app.$body.attr("data-breakpoint-prev")){app.toggleNavBar(selector,true)}};app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",hideNavOnBreakpointChange);if($(".js-header-container",$context).length){if($(".c-page-hero picture").length){$(".js-header-container").removeClass("no-hero")}if($(".c-mapbox").length){$(".js-header-container",$context).addClass("is-text-dark@m")}var changeNavigationState=function(obj){var heroHeight=$(".c-page-hero").outerHeight();if(obj.dir=="up"&&obj.scrollY>80){$(".js-header-container",$context).addClass("is-stuck");$context.addClass("is-header-stuck")}else{if(obj.scrollY<44){$(".js-header-container",$context).removeClass("is-stuck");$context.removeClass("is-header-stuck")}}};app.EventHandler.subscribe("EVENT_SCROLL_INSTANT",changeNavigationState)}}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("autocomplete",function(window,$,app){"use strict";var module={},selector=".js-autocomplete";module.preInit=function(){return document.querySelector(selector)!==null};var $autoCompField=$(selector);module.handleSearchKeyPress=function(e){e.preventDefault();var keypressObject={url:window.location,time:Date.now(),keyCode:e.keyCode,target:e.target.id,query:$(e.target).val()};app.EventHandler.publish("EVENT_KEY_PRESS",keypressObject)};module.init=function(){$autoCompField.on("keyup",debounce(module.handleSearchKeyPress,300))};return module}(window,jQuery,window.App));App.module.create("triggerList",function(window,$,app){"use strict";var module={},selector=".js-trigger-list";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var isIE=function(){var ua=window.navigator.userAgent;var msie=ua.indexOf("MSIE ");return msie>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)};var $elm={map:$("#js-trigger-list-map"),overview:$(".js-trigger-list-overview",$context),flashpoint:$(".js-trigger-list-flashpoint",$context),flashpoints:$(".js-trigger-list-flashpoints",$context),flashpoints_list:$(".js-trigger-list-flashpoints-cont",$context),toggle:$(".js-trigger-list-flashpoints-toggle",$context),article:$(".js-flashpoint",$context),iframe:$("#js-flaspoint-iframe",$context),cover:$(".js-trigger-list-cover",$context),coverInner:$(".js-trigger-list-cover-inner",$context),header:$(".js-header"),toolbarSticky:$(".js-toolbar--sticky"),legend:$(".js-trigger-list-legend",$context),close:$(".js-trigger-list-flashpoint-close",$context),legendDetail:$(".js-trigger-list-legend-detail",$context),flashpointCovers:$(".js-flashpoint-cover",$context),flashpointCoversTrigger:$(".js-flashpoint-cover-trigger",$context),btn:{close:$(".js-trigger-list-close",$context),mapClose:$(".js-trigger-list-close-map",$context),map:$(".js-show-map",$context),bigPicture:$(".js-show-big-picture",$context),toggleLegend:$(".js-toggle-legend",$context),actions:$(".js-trigger-list-actions",$context),preloader:$(".js-loading-map",$context),showDetails:$(".js-show-details",$context),closeDetails:$(".js-trigger-list-close-legend-detail",$context)},scroll:{container:$(".js-trigger-list-flashpoints-cont",$context),controls:$(".js-trigger-list-flashpoints-controls",$context),up:$(".js-trigger-list-scroll-up",$context),down:$(".js-trigger-list-scroll-down",$context)},mapLat:$("#js-trigger-list-map").data("latitude"),mapLon:$("#js-trigger-list-map").data("longitude"),mapZoom:$("#js-trigger-list-map").data("zoom")};var flashpoints={initScroll:0,isOpen:false};var mapInfo={mapbox:{endpoint:"https://api.mapbox.com/v4/",access_token:"pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw"},api:{url:"/api/json/flashpoints/"},isOpen:false};var $map;var _data={};var _markers=[];var addToolbar=function(data){var template=$("#tm-sticky-toolbar-2").html(),template=Handlebars.compile(template);runInSequence([function(){$elm.header[0].classList.add("has-flashpoint");$elm.header.append(template(data))},function(){_data.id=data.id;_data.$stickyToolbar=$(".js-toolbar--sticky");_data.$tooltip=$(".js-tooltip-toggle");_data.$backToMap=$(".js-trigger-list-close");_data.$video=$(".js-video");reInitModules(data)}],350);App.EventHandler.subscribe("EVENT_SCROLL_INSTANT",onScroll)};var reInitModules=function(data){App.tooltip.initTooltip(_data.$tooltip);_data.$backToMap.on("click",module.close);$(".js-toolbar-close").off("click");$(".js-toolbar-close").on("click",module.close);if(App.timelineMax.isLoaded){App.timelineMax.renderTimeline()}else{App.module.create("timelineMax",App.timelineMax);App.timelineMax.renderTimeline()}if(_data.$video){_data.$video.each(function(index,val){App.videoCollection.push($(val))})}if(data.toolbar.headings||typeof data.toolbar.headings!="undefined"){App.initTOC(_data.$stickyToolbar)}App.print.createIframe();$(".js-print").on("click",function(e){var $el=app.preventDefault($(this),e),articleId=$el.parents(".c-toolbar").data("id");App.print.getIframeObj(articleId).get(0).contentWindow.print()})};var onScroll=function(obj){var windowHeight=$(window).height();_data.$header=$elm.header;_data.$headerCont=$(".js-header-container",_data.$header);_data.$toolbar=$(".js-toolbar");obj.dir=="up"&&obj.scrollY>=_data.$toolbar.offset().top&&$context.hasClass("has-flashpoint")?App.article.stickyToolbar.show(_data):App.article.stickyToolbar.hide(_data);if(obj.dir=="down"&&obj.scrollY<=windowHeight-_data.$headerCont.height()&&mapInfo.isOpen){$(".js-header").addClass("has-mapbox")}if(obj.dir=="up"&&obj.scrollY>windowHeight){$(".js-header").removeClass("has-mapbox")}if(obj.scrollY===0){$(".js-header").addClass("has-mapbox");$map._controlContainer.style.display="block";$map._controlCorners.bottomleft.style.display="block";$map._controlCorners.bottomright.style.display="block"}};var removeElements=function(){if((window.scrollY||window.pageYOffset)==0){$($elm.flashpoint[0]).removeClass("is-added");$($elm.overview[0]).removeClass("is-added");$($elm.header[0]).removeClass("has-flashpoint");typeof _data.$stickyToolbar!="undefined"?_data.$stickyToolbar.remove():""}};var showPreloader=function(){$elm.coverInner.addClass("is-loading")};var hidePreloader=function(){$elm.coverInner.removeClass("is-loading")};var getFlashpoint=function(id){showPreloader();return $.getJSON("/api/json/flashpoint/"+id)};module.open=function(type,id,cb){var contentToScroll=type=="flashpoint"?$elm.flashpoint:$elm.overview;var flashpointPromise=getFlashpoint(id);flashpointPromise.then(function(response){runInSequence([function(){$elm.flashpoint.css("opacity",0);$map._controlContainer.style.display="none";$map._controlCorners.bottomleft.style.display="none";$map._controlCorners.bottomright.style.display="none";$(contentToScroll[0]).addClass("is-added");$(contentToScroll[0]).addClass("has-toolbar");if(id!=null){$elm.iframe.attr("src","/node/"+id);$elm.map.addClass("has-flashpoint");addToolbar(response)}closeFlashpoint();if(type=="flashpoint"){$elm.overview.removeClass("is-added");App.$body.addClass("u-no-scroll")}},function(){$elm.flashpoint.css("opacity",1);$elm.flashpoint.scrollTop(0);$elm.overview.scrollTop(0);if(type==="overview"){module.smoothScroll(contentToScroll[0].offsetTop);$context.addClass("has-flashpoint")}},function(){hidePreloader();$map._controlContainer.style.display="block";if(type==="overview"){$(".js-header").removeClass("has-mapbox")}if(typeof cb!==typeof undefined&&typeof cb=="function"){cb.apply(this,arguments)}}],350)});$elm.iframe.on("load",function(){var head=$(this).contents().find("head");var css='<style type="text/css">.title-component h1{font-size: 33px !important;}.title-component h2{font-size: 28px !important;}.title-component h3{font-size: 21px !important;}.title-component h1.special-report-heading{font-size: 59px !important;}</style>';$(head).append(css)})};module.close=function(e,cb){e.preventDefault();var featuredWidget=document.querySelector(".c-trigger-list__featured-banner");runInSequence([function(){$map._controlContainer.style.display="block";$map._controlCorners.bottomleft.style.display="block";$map._controlCorners.bottomright.style.display="block";$map.closePopup();$elm.map.removeClass("has-flashpoint");module.smoothScroll(0);$context.removeClass("has-flashpoint");removeElements();App.$body.removeClass("u-no-scroll");if(featuredWidget){featuredWidget.classList.add("is-visible")}},function(){if(!$(e.target).parents(".js-trigger-list-overview").length){$(".js-header").addClass("has-mapbox")}if(typeof cb!==typeof undefined&&typeof cb=="function"){cb.call()}}],350)};module.smoothScroll=function(coordY){$("html, body").animate({scrollTop:coordY||0},350)};module.showMap=function(){if(!mapInfo.isOpen){var featuredWidget=document.querySelector(".c-trigger-list__featured-banner");$elm.overview.removeClass("is-added");$(".js-header").addClass("has-mapbox");$elm.cover.fadeOut(300,function(){$elm.cover.addClass("is-open");if(featuredWidget){featuredWidget.classList.add("is-visible")}$elm.cover.fadeIn(150,function(){$elm.cover.removeAttr("style")})});mapInfo.isOpen=true}};module.openDetail=function(){$elm.coverInner.css("z-index",1);$elm.legendDetail.slideDown()};module.closeDetail=function(){var featuredWidget=document.querySelector(".c-trigger-list__featured-banner");if(featuredWidget){featuredWidget.classList.add("is-visible")}$elm.coverInner.css("z-index",5);$elm.legendDetail.slideUp()};module.closeMap=function(e){e.preventDefault();if(!!mapInfo.isOpen){$elm.cover.fadeOut(300,function(){$elm.cover.removeClass("is-open");$elm.cover.fadeIn(150,function(){$elm.cover.removeAttr("style");$(".js-header").removeClass("has-mapbox")})});mapInfo.isOpen=false}module.close(e);closeFlashpoint();runInSequence([function(){module.closeDetail()}]);flashpoints.isOpen=false};handlers.push({name:"_triggerListHandler",handle:function(){$(".js-header").removeClass("no-hero");$(".js-header-container").removeClass("no-hero");$elm.btn.close.on("click",module.close);$elm.btn.showDetails.on("click",function(e){e.preventDefault();module.openDetail()});$elm.btn.closeDetails.on("click",function(e){e.preventDefault();module.closeDetail()});$elm.btn.map.on("click",function(e){e.preventDefault();module.showMap()});$elm.cover.on("click",function(e){if(e.target.localName!=="a"){e.preventDefault()}if($(e.target).hasClass("js-trigger-list-cover-inner")){module.showMap()}});$elm.btn.bigPicture.on("click",function(e){e.preventDefault();module.open("overview")})}});var renderMap=function(){L.mapbox.accessToken="pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw";var _zoomLevel=$elm.mapZoom===null||$elm.mapZoom===""?3:$elm.mapZoom;var _latt=$elm.mapLat===null||$elm.mapLat===""?45:$elm.mapLat;var _long=$elm.mapLon===null||$elm.mapLon===""?0:$elm.mapLon;var map=new L.mapbox.map("js-trigger-list-map","",{trackResize:true,maxBounds:[[85,-180],[-85,200]],minZoom:3,scrollWheelZoom:false,touchZoom:false}).setView([_latt,_long],_zoomLevel);L.mapbox.styleLayer("mapbox://styles/daltonwb/cj8bko9az7ef82sp1mve80x09").addTo(map);map.scrollWheelZoom.disable();$map=map;app.$mapbox=map};var renderFlashpointList=function(flashpoints){var template=$("#tm-flashpoint").html();template=Handlebars.compile(template);runInSequence([function(){for(var i=0,len=flashpoints.length;i<len;i++){flashpoints[i].color=getSeverityColor(flashpoints[i].severity_level).color;$elm.flashpoints_list.append(template(flashpoints[i]))}},function(){checkIfHasScrolling();bindFlashpoint()}],350)};var getSeverityColor=function(level,capital){return!!capital?{color:"#ffffff",label:"capital"}:level>=80?{color:"#de1e29",label:"critical"}:level>=60?{color:"#e87722",label:"severe"}:level>=40?{color:"#ffb81c",label:"substantial"}:level>=20?{color:"#209770",label:"moderate"}:{color:"#51adff",label:"low"}};var renderMarkers=function(markers){markers.forEach(function(marker){if(marker.lat===null||marker.lat===""||marker.long===null||marker.long===""){return}var m=L.marker([marker.lat,marker.long]);m.spot={title:marker.title,severity:marker.severity_level,flashpoint:marker.id,"marker-color":getSeverityColor(marker.severity_level,marker.capital).color,"marker-label":getSeverityColor(marker.severity_level,marker.capital).label,date:marker.updated,capital:marker.capital,icon:{className:"c-flashpoint-icon c-flashpoint-icon--"+getSeverityColor(marker.severity_level,marker.capital).label,html:"&nbsp;",iconSize:L.point(15,15),iconAnchor:L.point(15,15),popupAnchor:L.point(marker.lat,marker.long)}};m.spot.tooltip=function(){var _divStart='<span class="marker marker--'+m.spot["marker-label"]+'">'+'<a href="#" class="c-marker-close js-marker-close"><span class="o-icon o-icon--sm"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#close"></use></svg></span></a>';var _h1=!!m.spot.capital?"":'<h1><div class="bar" style="left: '+m.spot.severity+'%"></div></h1>';var _divEnd="<h2>"+m.spot.title+"</h2><time>"+m.spot.date+"</time>";var _div=_divStart+_h1+_divEnd;m.tooltip=L.popup({closeButton:false,offset:L.point(-7,-7)}).setLatLng([marker.lat,marker.long]).setContent(_div).openOn($map)};m.setIcon(L.divIcon(m.spot.icon));m.on("click",function(e){runInSequence([function(){closeFlashpoint();m.spot.tooltip()},function(){module.open("flashpoint",m.spot.flashpoint);$map.setView(m._latlng,11)}]);var _matrix=$(".leaflet-popup").css("transform").replace("matrix","").replace("(","").replace(")","").split(",");if(isIE()){$(".leaflet-popup").css("transform","translate("+_matrix[_matrix.length-2]+"px, "+Math.ceil(parseInt(_matrix[_matrix.length-1])+parseInt($(".leaflet-popup").height())+50)+"px)")}$($map.getContainer()).find(".js-marker-close").on("click",function(e){e.preventDefault();runInSequence([function(){$map.closePopup(m.tooltip);$map.setZoom(11);$elm.map.removeClass("has-flashpoint")},function(){module.close(e)}]);$($map.getContainer()).find(".js-marker-close").off("click")})});$map.addLayer(m);_markers.push(m)});window.$map=$map;$elm.btn.toggleLegend.on("click",function(e){e.preventDefault();$elm.legend.toggleClass("is-open")});$elm.btn.mapClose.on("click",function(e){var _zoomLevel=$elm.mapZoom===null||$elm.mapZoom===""?3:$elm.mapZoom;var _latt=$elm.mapLat===null||$elm.mapLat===""?45:$elm.mapLat;var _long=$elm.mapLon===null||$elm.mapLon===""?0:$elm.mapLon;hidePreloader();module.closeMap(e);runInSequence([function(){},function(){$map.setZoom(_zoomLevel)},function(){},function(){$map.setView([_latt,_long],_zoomLevel,{pan:{animate:true,duration:.5}})}])})};handlers.push({name:"_triggerListMap",handle:function(){module.triggerListID=$("#js-trigger-list-map").data("map-id");if(app.isIOS){$elm.legend.addClass("is-ios");$elm.btn.toggleLegend.addClass("is-ios")}$.getJSON(mapInfo.api.url+module.triggerListID).done(function(response){runInSequence([function(){renderMap()},function(){if(response.flashpoints){renderFlashpointList(response.flashpoints);renderMarkers(response.flashpoints)}},function(){$elm.btn.preloader.fadeOut(300,function(){$elm.btn.preloader.addClass("is-hidden")})}],250)})}});var checkIfHasScrolling=function(){if($elm.scroll.container.height()>$elm.scroll.container.parent().height()){$elm.scroll.controls.addClass("has-scrolling");bindScrollButtons()}else{$elm.scroll.controls.removeClass("has-scrolling")}flashpoints.initScroll=0;$elm.scroll.container.css({transform:"translateY(0)"})};var scrollMe=function(dir){var $li=$elm.scroll.container.find("li");var getHeight=$li[0].clientHeight;var bp=App.$win.width()<App.breakpoints.MEDIUM?5:App.$win.width()<App.breakpoints.LARGE?2:App.$win.width()>=App.breakpoints.LARGE?5:0;$elm.scroll.container.css({transform:"translateY("+flashpoints.initScroll+"px)"});if(dir=="up"&&flashpoints.initScroll<0){flashpoints.initScroll+=getHeight}else if(dir=="down"&&flashpoints.initScroll>($li.length-bp)*getHeight*-1){flashpoints.initScroll-=getHeight}};var bindScrollButtons=function(){$elm.scroll.up.on("click",function(){scrollMe("up")});$elm.scroll.down.on("click",function(){scrollMe("down")})};var bindFlashpoint=function(){$elm.scroll.container.find("li").each(function(){var $self=$(this);$self.on("click",function(e){e.preventDefault();var m=_markers.find(function(item){return parseInt(item.spot.flashpoint)===parseInt($self.data("id"))});var _latlng=m._latlng;runInSequence([function(){closeFlashpoint();m.spot.tooltip()},function(){module.open("flashpoint",$self.data("id"));$map.setView(_latlng,11,{pan:{animate:true,duration:1}})}])})})};var toggleFlashpoint=function(){if(!flashpoints.isOpen){App.$body.addClass("u-no-scroll");$elm.flashpoints.addClass("is-open");$elm.toggle.addClass("is-open");flashpoints.isOpen=true}else{closeFlashpoint()}};var closeFlashpoint=function(){App.$body.removeClass("u-no-scroll");$elm.flashpoints.removeClass("is-open");$elm.toggle.removeClass("is-open");flashpoints.isOpen=false};handlers.push({name:"_handleScroll",handle:function(){$elm.toggle.on("click",toggleFlashpoint);$elm.close.on("click",toggleFlashpoint);App.EventHandler.subscribe("EVENT_RESIZE",checkIfHasScrolling)}});handlers.push({name:"_handleTicker",handle:function(){var _active=$elm.flashpointCovers.filter(".active");if(_active.length===0){_active=$elm.flashpointCovers.first().addClass("active")}setInterval(function(){var _active=$elm.flashpointCovers.filter(".active");if(_active.length===0){_active=$elm.flashpointCovers.first().addClass("active")}var _next=_active.next();if(_next.length===0){_next=$elm.flashpointCovers.first().addClass("active")}_active.removeClass("active");_next.addClass("active")},5e3);$elm.flashpointCoversTrigger.on("click",function(e){e.preventDefault();var $self=$(this);var m=_markers.find(function(item){return parseInt(item.spot.flashpoint)===parseInt($self.data("id"))});if(typeof m!=="undefined"){runInSequence([function(){module.showMap()},function(){module.open("flashpoint",$self.data("id"));m.spot.tooltip();$map.setView(m._latlng,11,{pan:{animate:true,duration:1}})}])}})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("article",function(window,$,app){"use strict";var module={},iframe="iframe",selector=".s-article";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var cssHideClass="u-opacity-0 u-invisible",baseOpacity=.6;module.data=[];module.currentUrl="";module.getId=function($el){var $toolbar=$el.parents(".c-toolbar");return $toolbar.hasClass("c-toolbar--sticky")?$toolbar.data("id"):$toolbar.parents(".s-article").data("id")};module.filterRange=function(arr,scrollY){var obj=$(arr).filter(function(i,n){return scrollY>n.range.start&&scrollY<n.range.end});return $(obj)};module.$stickyToolbar=function(id,$header){return $header?$('.js-toolbar--sticky[data-id="'+id+'"]',$header):$('.js-toolbar--sticky[data-id="'+id+'"]')};module.createTransporter=function($article){var t={},$cloneHeader=$("header.s-header:first").clone(true,true),$cloneHeaderCont=$(".js-header-container",$cloneHeader);t.$cont=$article.parents(".js-transporter");t.$article=$(".c-transporter__article",t.$cont);if($(".c-page-hero__image",$article).length){$cloneHeaderCont.removeClass("is-text-dark@m");$cloneHeaderCont.addClass("no-hero");if($(".c-page-hero",$article).hasClass("c-page-hero--full")){$cloneHeaderCont.removeClass("no-hero");t.$cont.addClass("transporter-has-full-hero")}}else{$cloneHeaderCont.addClass("no-hero is-text-dark@m");if($(".c-page-hero",$article).hasClass("c-page-hero--full")){$cloneHeaderCont.removeClass("is-text-dark@m");t.$cont.addClass("transporter-has-full-hero")}}$cloneHeader.removeClass("is-stuck").css("position","absolute");$cloneHeader.prependTo(t.$article);t.$clone=t.$article.clone();t.$clone.removeClass("c-transporter__article").addClass("c-transporter__clone c-transporter__article--fixed");t.$clone.find(".js-toolbar--sticky").remove();t.$clone.appendTo(t.$cont);t.$article.addClass(cssHideClass);$('<aside class="c-transporter__bg c-transporter__bg--fixed" />').appendTo(t.$cont);$('<aside class="c-transporter__overlay u-z-100" />').appendTo(t.$cont)};module.createData=function(){module.data=[];$.each($(".s-article"),function(idx,val){if($(val).parents(".c-transporter__clone").length){return}var $a=$(val),article={$el:$a,$cont:$a.parent(),id:$a.data("id"),title:$(".c-page-hero__title",$a).text(),url:$a.data("url").replace(/^.*\/\/[^\/]+/,""),$toolbar:$(".js-toolbar",$a),$stickyToolbar:module.$stickyToolbar($a.data("id")),hasUpNext:$(".js-transporter-upnext",$a).length?true:false,isTransporter:false};article.$header=$(".s-header:first");article.$headerCont=$(".js-header-container",article.$header);article.$stickyToolbar=module.$stickyToolbar(article.id,article.$header);!article.$header.hasClass("has-toolbar")&&article.$header.addClass("has-toolbar");if($a.parents(".js-transporter").length){article.isTransporter=true;!$a.parents(".js-transporter").find(".c-transporter__clone").length&&module.createTransporter($a);article.$cont=$a.parents(".js-transporter");article.$el=$(".c-transporter__article",article.$cont);article.$clone=$(".c-transporter__clone",article.$cont);article.$overlay=$(".c-transporter__overlay",article.$cont);article.$whiteBg=$(".c-transporter__bg",article.$cont);article.$overlay.css("opacity",baseOpacity);article.$whiteBg.css("height",$a.offset().top);article.$header=$(".s-header",article.$el);article.$headerCont=$(".js-header-container",article.$header);article.$stickyToolbar=module.$stickyToolbar(article.id,article.$header);article.$stickyToolbar.siblings(".c-toolbar").remove();article.$header.find(".js-overlay--nav ").remove()}article.range={start:article.$cont.offset().top,end:article.$cont.offset().top+article.$cont.outerHeight()};article.offset={top:article.$cont.offset().top,bottom:article.$cont.offset().top+article.$cont.outerHeight()};article.toolbar={end:article.range.end-article.$stickyToolbar.outerHeight(),start:!!article.$toolbar.length?article.$toolbar.offset().top+article.$toolbar.outerHeight()-article.$stickyToolbar.outerHeight():0};if(article.hasUpNext){article.range.end=$(".js-transporter-upnext",article.$cont).offset().top;article.toolbar.end=article.range.end-article.$stickyToolbar.outerHeight();article.range.end=article.range.end+10}article.$progress=$(".js-progress__bar",article.$stickyToolbar);if(window.hasOwnProperty("maps")&&window.maps[article.id]===undefined){$(".js-view-maps",article.$stickyToolbar).closest("li").addClass("is-hide")}module.data.push(article)});module.ChangeUrl=function(page,url){if(typeof history.pushState!="undefined"){var obj={Page:page,Url:url};history.pushState(obj,obj.Page,obj.Url);return}console.log("Browser does not support HTML5.")}};module.stickyToolbar={show:function(obj){if(obj.$stickyToolbar.hasClass("is-show")){return}module.$stickyToolbar(obj.id,obj.$header).addClass("is-show");obj.$headerCont.addClass("is-hide")},hide:function(obj){if(!obj.$headerCont.hasClass("is-hide")){return}$(".is-toc-open").removeClass("is-toc-open");obj.$headerCont.removeClass("is-hide");module.$stickyToolbar(obj.id,obj.$header).removeClass("is-show").delay(600).queue(function(){$(this).removeAttr("style").dequeue()})}};module.progressBar=function(obj,scrollY){obj.value=scrollY-obj.offset.top+obj.$stickyToolbar.outerHeight();obj.value=obj.value/(obj.$el.outerHeight()-app.$win.height()+obj.$stickyToolbar.outerHeight());obj.value=obj.value*100;obj.$progress.attr("value",obj.value)};module.transporter={show:function(obj){if(obj.$cont.hasClass("is-active")){return}obj.$cont.addClass("is-active");obj.$el.removeClass(cssHideClass);obj.$clone.addClass(cssHideClass);obj.$overlay.addClass("u-dn");obj.$cont.parents("main").prev().hide();obj.$header.removeAttr("style")},hide:function(){if(!$(".js-transporter").hasClass("is-active")){return}var obj={$cont:$(".js-transporter.is-active:first")};obj.$el=$(".c-transporter__article",obj.$cont);obj.$clone=$(".c-transporter__clone",obj.$cont);obj.$overlay=$(".c-transporter__overlay",obj.$cont);obj.$header=$(".s-header",obj.$cont);obj.$cont.removeClass("is-active");obj.$el.addClass(cssHideClass);obj.$clone.removeClass(cssHideClass);obj.$overlay.removeClass("u-dn");obj.$cont.parents("main").prev().show();obj.$header.css("position","absolute")}};handlers.push({name:"_handleArticle",handle:function(){if(!$context.length||!$(".c-toolbar").length){return}module.createData();module.currentUrl=module.data[0].url;if(module.data.length>1){var t=module.data[1];app.EventHandler.subscribe("MEGA_MENU_OPEN",function(obj){return t.$el.addClass("u-z-1")});app.EventHandler.subscribe("MEGA_MENU_CLOSE",function(obj){return t.$el.removeClass("u-z-1")})}var onScroll=function(obj){if(module.data[0].offset.bottom!==module.data[0].$el.offset().top+module.data[0].$el.outerHeight()){module.createData()}$(".c-transporter__bg--fixed").length&&$(".c-transporter__bg--fixed").removeClass("c-transporter__bg--fixed");$(".js-transporter.is-active").length&&obj.scrollY<$(".js-transporter.is-active:first").offset().top&&module.transporter.hide();obj.scrollY>module.data[0].range.end&&module.data[0].$stickyToolbar.removeClass("is-show");if($(".c-transporter__overlay").length){var overlay={offsetTop:$(".c-transporter__overlay").offset().top};overlay.offsetMid=overlay.offsetTop-app.$win.outerHeight()/2;overlay.opacity=1-(obj.scrollY-overlay.offsetMid)/(overlay.offsetTop-overlay.offsetMid);if(obj.scrollY>=overlay.offsetMid&&obj.scrollY!==overlay.offsetTop){$(".c-transporter__overlay").css("opacity",overlay.opacity*baseOpacity)}else{obj.scrollY==overlay.offsetTop&&$(".c-transporter__overlay").css("opacity",0);obj.scrollY<overlay.offsetMid&&$(".c-transporter__overlay").css("opacity",baseOpacity)}}var getArticleData=module.filterRange(module.data,obj.scrollY);if(!getArticleData.length){return}var _a=getArticleData[0];obj.dir=="up"&&obj.scrollY>=_a.toolbar.start?module.stickyToolbar.show(_a):module.stickyToolbar.hide(_a);obj.scrollY>=_a.toolbar.end&&_a.$stickyToolbar.css("margin-top",-(obj.scrollY-_a.toolbar.end));module.progressBar(_a,obj.scrollY);var isTocOpen=$(".is-toc-open").length?true:false;isTocOpen=app.isModalOpen?true:isTocOpen;app.setScrolling(app.$body,isTocOpen);if(_a.isTransporter){obj.scrollY>=_a.range.start&&module.transporter.show(_a)}if($(".s-header",_a.$el).length){if(obj.dir=="up"&&obj.scrollY>_a.range.start+80){_a.$headerCont.addClass("is-stuck");_a.$header.addClass("is-header-stuck")}else{if(obj.scrollY<_a.range.start+44){_a.$headerCont.removeClass("is-stuck");_a.$header.removeClass("is-header-stuck")}}}if(module.currentUrl!==_a.url){module.currentUrl=_a.url;module.ChangeUrl(_a.title,_a.url);ga("send","pageview",location.pathname)}};app.EventHandler.subscribe("EVENT_SCROLL_INSTANT",onScroll);app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",onScroll)}});handlers.push({name:"linkHandler",handle:function(){var $link=$(".c-page-hero__teaser, .s-article__main",$context).find('a[target="_blank"]');$link.each(function(i,elem){$(elem).on("click",function(e){e.preventDefault();var $self=$(this);var _href=$self.attr("href");window.open(_href,"_blank")})});var windowOpen=function(_href){window.open(_href,"_blank","resizable=yes,location=yes,menubar=yes,toolbar=yes,fullscreen=yes,scrollbars=yes,dependent=yes")};var $iframe=$(iframe);$("document").ready(function(){$iframe.each(function(i,elem){var counter=0;elem.addEventListener("load",function(){if(counter>0){return}elem.src+="";++counter})})})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("toc",function(window,$,app){"use strict";var module={},selector=".js-toolbar--sticky";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);app.toggleTOC=function($context){var $context=typeof $context!=="undefined"?$context:$(".js-toolbar--sticky");var $caret=$(".o-icon--caret-down",$context);if(!$context.hasClass("is-toc-open")){$context.addClass("is-toc-open");$caret.addClass("o-icon--reverse-v")}else{$context.removeClass("is-toc-open");$caret.removeClass("o-icon--reverse-v")}};app.smoothPageScroll=function($context){$($context).on("click",function(e){var $headerHeight=$(".s-header").height(),$toolbarStick=$(".js-toolbar--sticky");var isTocOpen=$toolbarStick.hasClass("is-toc-open")?false:true;if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var $target=$(this.hash);$target=$target.length?$target:$("[name="+this.hash.slice(1)+"]");if($target.length){$("html, body").animate({scrollTop:$target.offset().top-($headerHeight+30)},500);app.toggleTOC();app.setScrolling(app.$body,isTocOpen);return false}}})};app.initTOC=function($context){var $a=$('.js-toc .c-toc__body a[href*="#"]:not([href="#"])',$context);$context.each(function(idx,val){var $self=$(val),$toggle=$(".js-toc__toggle",$self),$caret=$(".o-icon--caret-down",$toggle);$toggle.on("click",function(e){var $el=app.preventDefault($(this),e);var isTocOpen=$self.hasClass("is-toc-open")?false:true;app.toggleTOC($self);app.setScrolling(app.$body,isTocOpen)})});app.smoothPageScroll($a)};handlers.push({name:"_handleTOC",handle:function(){app.initTOC($context)}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("footnote",function(window,$,app){"use strict";var module={},selector=".js-footnote";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);app.toggleFootnote=function($context,_index){var $body=$(".js-footnote__body",app.$body);if(!$context.hasClass("is-active")){$context.addClass("is-active");$body.filter('[data-footnote-index="'+_index+'"]').addClass("is-active")}else{$context.removeClass("is-active");$body.filter('[data-footnote-index="'+_index+'"]').removeClass("is-active")}};module.countFootnote=function($context,$body,index){var idx=index+1;$context.attr("data-footnote-index",idx);$body.attr("data-footnote-index",idx)};handlers.push({name:"_handleFootnote",handle:function(){$context.each(function(index,val){var $footnote=$(this),$footnoteBody=$footnote.next(".js-footnote__body"),$close=$footnoteBody.children(".js-footnote__close");module.countFootnote($footnote,$footnoteBody,index);$footnote.on("click",function(){var $this=$(this),_index=$this.data("footnoteIndex");app.toggleFootnote($this,_index)});$close.on("click",function(){var $this=$(this).parent().prev($footnote),_index=$this.data("footnoteIndex");app.toggleFootnote($this,_index)})})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("accordion",function(window,$,app){"use strict";var module={},selector=".js-accordion";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);module.toggleAccordion=function($item){var $this=$($item),$icon=$this.find(".o-icon");if(!$this.parent().hasClass("c-accordion__item--active")){app.classAddRemove($this.parent(),"c-accordion__item--active");app.classAddRemove($icon,"o-icon--reverse-v")}else{app.classRemoveAdd($this.parent(),"","c-accordion__item--active");app.classRemoveAdd($icon,"","o-icon--reverse-v")}};handlers.push({name:"_handleAccordion",handle:function(){var $item=$(".js-accordion__item",$context),$head=$item.find(".c-accordion__head");$head.on("click",function(){module.toggleAccordion($(this))})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("video",function(window,$,app){"use strict";var module={},selector=".js-video";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector),ytParams={controls:2,showinfo:0,showsearch:0,rel:0,iv_load_policy:3,cc_load_policy:0,disablekb:1,modestbranding:1,autoplay:1,mute:1,loop:1},ytWebParams=Object.keys(ytParams).map(function(k){return encodeURIComponent(k)+"="+encodeURIComponent(ytParams[k])}).join("&");app.videoCollection=new ObservableArray([]);module.handleVideo=function(e){var _dis=e;var $video=$(_dis.item);var $frame=$(".js-video__frame",$video);var videoSrc=$frame.attr("src");var $win=$(window);var elementTop,elementBottom,viewportTop,viewportBottom;if($video.hasClass("c-inline-media--hero")){ytParams={controls:0,showinfo:0,showsearch:0,rel:0,iv_load_policy:3,cc_load_policy:0,disablekb:1,modestbranding:0,autoplay:1,mute:1,loop:1,playlist:$frame.attr("src").split("/")[4].split("?")[0]},ytWebParams=Object.keys(ytParams).map(function(k){return encodeURIComponent(k)+"="+encodeURIComponent(ytParams[k])}).join("&");$frame.attr("src","#");$frame.attr("src",videoSrc+ytWebParams);if(/Android|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)===false){$(".c-inline-media__icon",$video).addClass("u-dn-imp");$video.addClass("is-playing")}_dis.ytPlayer=new YT.Player($frame.attr("id"),{playerVars:ytParams,events:{onStateChange:function(evt){if(evt.data==YT.PlayerState.PLAYING||app.isChrome){$(".c-inline-media__icon",$video).addClass("u-dn-imp");$video.addClass("is-playing")}if(evt.data==YT.PlayerState.PAUSED){$(".c-inline-media__icon",$video).find(".o-icon--play").removeClass("u-dn-imp");$(".c-inline-media__icon",$video).find(".o-icon--preloader").removeClass("u-db-imp");$(".c-inline-media__icon",$video).removeClass("u-dn-imp")}if(evt.data==YT.PlayerState.UNSTARTED||evt.data==YT.PlayerState.BUFFERING){$(".c-inline-media__icon",$video).find(".o-icon--play").addClass("u-dn-imp");$(".c-inline-media__icon",$video).find(".o-icon--preloader").addClass("u-db-imp");$(".c-inline-media__icon",$video).removeClass("u-dn-imp")}}}})}else{var ytParams={controls:2,showinfo:0,showsearch:0,rel:0,iv_load_policy:3,cc_load_policy:0,disablekb:1,modestbranding:0,autoplay:1,mute:1,loop:1,playlist:$frame.attr("src").split("/")[4].split("?")[0]};if(!$video.hasClass("is-playing")){ytParams.autoplay=0}var ytWebParams=Object.keys(ytParams).map(function(k){return encodeURIComponent(k)+"="+encodeURIComponent(ytParams[k])}).join("&");$frame.attr("src",videoSrc+ytWebParams);_dis.ytPlayer=new YT.Player($frame.attr("id"),{playerVars:ytParams})}if($video.hasClass("is-playing")){$win.scroll(function(){$frame.each(function(){if(isScrolledIntoView(this)==true){_dis.ytPlayer.mute();_dis.ytPlayer.playVideo()}else{_dis.ytPlayer.pauseVideo()}})})}var isScrolledIntoView=function(elem){elementTop=$(elem).offset().top;elementBottom=elementTop+$(elem).outerHeight();viewportTop=$win.scrollTop();viewportBottom=viewportTop+$win.height();return elementBottom>viewportTop&&elementTop<viewportBottom};var playVideoInline=function(evt){var $el=app.preventDefault($(this),evt);$video.addClass("is-playing");$(".c-inline-media__icon",$video).addClass("u-dn-imp");$(".c-inline-media__icon",$video).find(".o-icon--preloader").addClass("u-db-imp");if(!app.isIOS){_dis.ytPlayer.mute();_dis.ytPlayer.playVideo()}};var playVideoModal=function(evt){if(app.$win.width()<app.breakpoints.MEDIUM&&!$(".is-text-mode").length){playVideoInline(evt);return}$(".js-modal",app.$body).addClass("o-modal--video");app.modal.openModal({type:"video",video:$(".js-video__frame",$(evt.currentTarget))[0].outerHTML},$(evt.currentTarget));$(".js-video__frame",$(".js-modal",app.$body))[0].src+="&autoplay=1"};var playVideo=$video.parent("div").hasClass("c-inset")?playVideoModal:playVideoInline;$video.on("click",playVideo)};app.videoCollection.addEventListener("itemadded",module.handleVideo);handlers.push({name:"_handleVideoModules",handle:function(){window.onYouTubeIframeAPIReady=function(){$.each($context,function(index,value){app.videoCollection.push($(value))})};if($(".o-video").parent().next().hasClass("c-radial-graph")==true){$(".o-video").parent().wrap('<div class="clearfix"></div>')}}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("podcast",function(window,$,app){"use strict";var module={},selector=".js-podcast";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $podcasts=$(selector);handlers.push({name:"_podcastHandler",handle:function(){if(!$podcasts.length){return}app.podcasts={};module.getIframe=function(_dis,data){var frame;if(data.type=="compact"){frame=_dis.querySelector(".js-podcast__frame");frame.setAttribute("buying","false");frame.setAttribute("sharing","false");frame.setAttribute("download","false");frame.setAttribute("show_bpm","false");frame.setAttribute("enable_api","false");frame.setAttribute("auto_play","false");frame.setAttribute("show_comments","false");frame.setAttribute("show_user","false");frame.setAttribute("hide_related","true")}else{frame=document.createElement("iframe");frame.setAttribute("id",data.id);frame.setAttribute("src",data.src);frame.setAttribute("buying","false");frame.setAttribute("sharing","false");frame.setAttribute("download","false");frame.setAttribute("show_bpm","false");frame.setAttribute("show_playcount","false");frame.setAttribute("enable_api","false");frame.setAttribute("auto_play","false");frame.setAttribute("show_comments","false");frame.setAttribute("show_user","false");frame.setAttribute("hide_related","true");frame.setAttribute("liking","past");frame.setAttribute("download","true");frame.setAttribute("show_reposts","false");frame.setAttribute("visual","true");frame.setAttribute("show_artwork","true");frame.classList.add("o-podcast__frame");frame.classList.add("js-podcast__frame")}return frame};var togglePlay=function(_dis,id){if(_dis.classList.contains("is-playing")){app.podcasts[id].pause()}else{$("picture",_dis).addClass("is-played");app.podcasts[id].play()}_dis.classList.toggle("is-playing")};$podcasts.each(function(idx,_dis){var data={id:_dis.dataset["identifier"],src:_dis.dataset["src"],type:_dis.dataset["type"]};var frame=module.getIframe(_dis,data);if(data.type=="compact"){app.podcasts[data.id]=SC.Widget(frame)}$(".js-podcast--"+data.id).on("click",function(e){var _dis=this;_dis.querySelector(".o-icon--play").classList.toggle("u-db-imp");_dis.querySelector(".o-icon--play").classList.toggle("u-dn-imp");_dis.querySelector(".o-icon--preloader").classList.toggle("u-db-imp");_dis.querySelector(".o-icon--preloader").classList.toggle("u-dn-imp");if(data.type=="full"||data.type=="small"){if(!_dis.classList.contains("is-loaded")){_dis.querySelector(".js-podcast__container").appendChild(frame);app.podcasts[data.id]=SC.Widget(frame);app.podcasts[data.id].bind(SC.Widget.Events.READY,function(){_dis.classList.add("is-loaded");togglePlay(_dis,data.id)})}else{togglePlay(_dis,data.id)}}else{togglePlay(_dis,data.id)}})})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("form",function(window,$,app){"use strict";var module={},selector=".js-form";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);handlers.push({name:"_formToggleCheckbox",handle:function(){$("[data-form-toggle]").on("click",function(){var $this=$(this),_attr=$this.data("formToggle");var $elmShow=$context.find('[data-form-toggle-value="'+_attr+'"]');if($this.is(":checked")){app.classAddRemove($elmShow,"u-db","u-opacity",200)}else{app.classRemoveAdd($elmShow,"u-db","u-opacity",200);if($elmShow.find(".o-error").hasClass("o-error")){$elmShow.find(".o-error").removeClass("o-error");$elmShow.find(".js-error").remove()}}})}});handlers.push({name:"_handleToggle",handle:function(){var $elm=$context.find("[data-form-toggle-value]");$(".o-select--custom").on("select2:select",function(e){var $this=$(this),_attr=$this.data("formToggle");var $elmShow=$context.find('[data-form-toggle-value="'+_attr+'"]');if(e.target.value=="custom"){app.classAddRemove($elmShow,"u-db","u-opacity",200)}else{app.classRemoveAdd($elm,"u-db","u-opacity",300)}})}});module.Validation={_message:{text:"This field is required.",email:"Please enter a valid email address.",min:"Minimum of %amout% is required.",checkboxGroup:"Please select at least one option."},_getErrorMsg:function(elem,messageType){var msg=this._message[messageType];if($(elem).is("[error-"+messageType+"-message]")){msg=$(elem).attr("error-"+messageType+"-message")}if(messageType=="min"){var minValue=$(elem).attr("min");msg=msg.replace("%amout%",minValue)}return msg},_success:function(elem){elem.removeClass("o-error");if(elem.next().is(".js-error")){elem.next().remove()}else if(elem.find(".js-error")){elem.find(".js-error").remove()}else if(elem.parent().find(".js-error")){elem.parent().find(".js-error").remove()}},_fail:function(elem,message){$("html, body").animate({scrollTop:0},"slow");if(elem.next().is(".o-error")||elem.find("span.o-error").length>0||elem.siblings("span.o-error").length>0){return}elem.addClass("o-error");if(typeof elem.data("no-error")==="undefined"){if(elem.attr("type")=="checkbox"){$(elem).parent().append('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]">'+message+"</span>")}else if(elem.attr("type")=="text"||elem.attr("type")=="email"||elem.attr("type")=="number"){$('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]">'+message+"</span>").insertAfter(elem)}else{$('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]">'+message+"</span>").appendTo(elem)}}},_validate:function(condition,elem,messageType,cb){elem=$(elem);if(condition){this._success(elem);if(typeof cb=="function")cb(elem,true)}else{this._fail(elem,this._getErrorMsg(elem,messageType));if(typeof cb=="function")cb(elem,false)}return condition},required:function(elem,cb){if($(elem).hasClass("required")&&$(elem).attr("type")=="checkbox"){return this._validate($(elem).is(":checked")==true,elem,"text",cb)}else if($(elem).hasClass("required")){return this._validate($(elem).val()!="",elem,"text",cb)}return true},email:function(elem,cb){var pattern=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/gim;return this._validate(pattern.test($(elem).val()),elem,"email",cb)},min:function(elem,cb){var minValue=parseFloat($(elem).attr("min"));var elemValue=parseFloat($(elem).val());return this._validate(elemValue>=minValue,elem,"min",cb)},checkboxGroup:function(elem,cb){return this._validate($(elem).find(".js-checkbox:checked").length>0,elem,"checkboxGroup",cb)},Validate:function(elem,cb){var $elem=$(elem);var checkRequired=this.required(elem,cb);if(!checkRequired)return false;if($elem.attr("id")=="terms_of_use"||$elem.attr("type")=="checkbox"){return this.required(elem,cb)}if($elem.attr("id")=="email"||$elem.attr("type")=="email"){return this.email(elem,cb)}if($elem.is("[min]")){return this.min(elem,cb)}}};module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("highlight",function(window,$,app){"use strict";var module={},selector=".s-article";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);module.getIndex=function(array,id){return array.map(function(obj){return obj.id}).indexOf(id)};module.getArticleId=function(e){return $(e).parents(".s-article").data("id")};app.annotation={articleId:null};if($(".s-article__body").length){handlers.push({name:"_handleHightlight",handle:function(){var content=$(".s-article__body").annotator();var ann=content.data("annotator");Annotator.Plugin.StoreLogger=function(element){return{pluginInit:function(){this.annotator.subscribe("annotationCreated",function(annotation){var _a=annotation,articleId=module.getArticleId(_a.highlights);console.log("article id: ",articleId);if(typeof app.storage.highlights[articleId]==="undefined"||app.storage.highlights[articleId]===null){app.storage.highlights[articleId]=[]}_a.date_created=Date.now();app.storage.highlights[articleId].push(_a);app.ls.set("icg.highlights",app.storage.highlights)}).subscribe("annotationUpdated",function(annotation){var _a=annotation,articleId=module.getArticleId(_a.highlights),index=module.getIndex(app.storage.highlights[articleId],_a.id);console.log("article id: ",articleId);$.extend(true,app.storage.highlights[articleId][index],_a);app.ls.set("icg.highlights",app.storage.highlights)}).subscribe("annotationDeleted",function(annotation){var index,_a=annotation,articleId=app.annotation.articleId;if(!$(app.storage.highlights[articleId]).filter(function(i,n){return n.id===_a.id}).length){return}index=module.getIndex(app.storage.highlights[articleId],_a.id);app.storage.highlights[articleId].splice(index,1);if(app.storage.highlights[articleId].length==0){delete app.storage.highlights[articleId]}app.ls.set("icg.highlights",app.storage.highlights)}).subscribe("annotationViewerShown",function(viewer,annotations){app.annotation.articleId=module.getArticleId(annotations[0].highlights)}).subscribe("annotationEditorShown",function(editor,annotation){var _a=annotation;_a.articleId=module.getArticleId(_a.highlights);_a.$editor=editor.element;app.annotation.printObj=_a})}}};content.annotator("addPlugin","Offline");content.annotator("addPlugin","StoreLogger")}})}module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("listingSave",function(window,$,app){"use strict";var module={},selector=".js-save";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $saveBtn=$(selector);module.inStorage=function(arr,key,val){var obj=$(arr).filter(function(i,n){return n[key]===val});return $(obj).length};handlers.push({name:"_initListingHandler",handle:function(){var $ts=$(".js-toolbar--sticky");$.each($ts,function(index,value){var articleId=$(value).data("id"),inStorage=module.inStorage(app.storage.saved,"id",articleId),$btn=$(selector,'[data-id="'+articleId+'"]');if(inStorage){$btn.find(".o-label").text("Saved");$btn.find("use").attr("xlink:href","#saved")}})}});handlers.push({name:"_saveListingHandler",handle:function(){$saveBtn.on("click",function(e){app.cleanUpLocalStorage("saved");var el=app.preventDefault($(this),e),articleId=app.article.getId(el),title=$(".c-page-hero__title",'article[data-id="'+articleId+'"]').text(),gaLabel,inStorage=module.inStorage(app.storage.saved,"id",articleId),$btn=$(selector,'[data-id="'+articleId+'"]');if(!inStorage){app.storage.saved.push({id:articleId,date_created:Date.now()});app.ls.set("icg.saved",app.storage.saved);app.cleanUpLocalStorage("saved");$btn.find(".o-label").text("Remove");$btn.find("use").attr("xlink:href","#saved");gaLabel="Article Save Btn | "+title}else{var itemToRemove;$.each(app.storage.saved,function(index,value){if(value.id===articleId){itemToRemove=index;return}});app.storage.saved.splice(itemToRemove,1);app.ls.set("icg.saved",app.storage.saved);$btn.find(".o-label").text("Save");$btn.find("use").attr("xlink:href","#favorite");gaLabel="Article Remove Btn | "+title}})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("search",function(window,$,app){"use strict";var module={},selector=".js-search";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $searchBtn=$(selector),$searchCloseBtn=$(".js-modal--search__close"),$modal=$(".js-modal--search"),$searchBar=$(".js-modal--search__input"),$searchResults=$(".js-modal--search__results"),searchHrx=false;module.closeSearchModal=function(e){var $el=typeof e==="object"?app.preventDefault($(this),e):app.$doc,$overlay=app.showOverlay(app.$body,false);app.$body.removeClass("u-no-scroll");$searchBar.val("").blur();runInSequence([function(){$modal.removeClass("is-visible")},function(){$modal.removeClass("is-shown");$searchResults.removeClass("is-active");$searchResults.html("")}],350)};module.openSearchModal=function(e){var $el=app.preventDefault($(this),e),$overlay=app.showOverlay(app.$body,true);$overlay.addClass("is-search");app.$body.addClass("u-no-scroll");runInSequence([function(){$modal.addClass("is-shown")},function(){$modal.addClass("is-visible");$searchBar.val("").focus()}],350);$overlay.on("click",function(e){module.closeSearchModal(e);$overlay.off("click")})};module.handleSearch=function(obj){if(obj.keyCode==27){module.closeSearchModal()}if(obj.target!=="search"||obj.query.length<=0){$searchResults.removeClass("is-active");return}if(obj.keyCode==13){window.location.href="/global-search?text="+obj.query}else{var template=$("#searchResults").html();var rendered=Handlebars.compile(template);var searchApi=$modal.data("uri")+obj.query;if(typeof searchHrx=="object"){searchHrx.abort()}searchHrx=$.getJSON(searchApi).done(function(json){$searchResults.addClass("is-active");updateJsonObj(json.search_results,obj.query);$searchResults.html(rendered(json))})}var updateJsonObj=function(obj,query){for(var i=0;i<obj.length;i++){if(obj[i].is_location==="true"){obj[i].is_location=true}else{obj[i].is_location=false}obj[i].title=highlight(obj[i].title,query)}return obj};var highlight=function(data,search){var regex=new RegExp("("+search+")","gi");return data.replace(regex,"<b>$1</b>")}};handlers.push({name:"_searchModuleHandler",handle:function(){$searchBtn.on("click",module.openSearchModal);$searchCloseBtn.on("click",module.closeSearchModal);app.EventHandler.subscribe("EVENT_KEY_PRESS",module.handleSearch)}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("inputSearch",function(window,$,app){"use strict";var module={},selector=".js-inline-search";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var $searchInput=$(".js-input-search",$context);var $clearSearch=$(".js-reset-search",$context);module.searchShowClose=function(){if(!$searchInput.val()==""||!$searchInput.val()==null){$clearSearch.removeClass("u-dn").addClass("u-df")}else{module.searchHideClose()}};module.searchHideClose=function(){$clearSearch.addClass("u-dn").removeClass("u-df")};handlers.push({name:"_inputSearchClose",handle:function(){if(!$context){return}module.searchShowClose();$searchInput.on("keyup",function(){module.searchShowClose()});$clearSearch.on("click",function(e){$searchInput.val("").attr("value","");module.searchHideClose()})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("tooltip",function(window,$,app){"use strict";var module={},selector=".js-tooltip-toggle";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);app.attachTooltip=function(obj){var $tooltip=obj.next(".js-tooltip");obj.off("click").on("click",function(e){var $el=app.preventDefault($(this),e);$tooltip.hasClass("is-show")?$tooltip.removeClass("is-show"):$tooltip.addClass("is-show")});var hideTooltip=function(obj){if(!$tooltip.hasClass("o-tooltip--month")){$tooltip.removeClass("is-show")}};app.EventHandler.subscribe("EVENT_SCROLL_INSTANT",hideTooltip);app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",hideTooltip)};module.initTooltip=function($context){$context.each(function(index,val){app.attachTooltip($(val))})};module.stickyUnfocus=function(){$(window).on("click.stickytabletooltip",function(event){var $stickTooltip=$context.siblings(".o-tooltip");var $itemParent=$context.parent();if($stickTooltip.length!=0){if($itemParent.has(event.target).length==0&&!$itemParent.is(event.target)){$stickTooltip.removeClass("is-show")}}})};handlers.push({name:"_moduleTooltip",handle:function(){if(!$context.length){return}module.initTooltip($context);module.stickyUnfocus()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("timelineMax",function(window,$,app){"use strict";var module={},selector="body";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var breakpointHeight;var timelineItems=[];var $el={self:$context,item:$("body:not(.section-trigger-list) .js-timeline-max-item",$context)};module.openTimeline=function($elm){$elm.self.addClass("is-full");$elm.content.style.maxHeight=$elm.container.outerHeight(true)+"px"};module.closeTimeline=function($elm){$elm.self.removeClass("is-full");$elm.content.style.maxHeight=breakpointHeight+"px"};module.updateTimeline=function(){breakpointHeight=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)>=760?700:410;if(timelineItems.length>0){for(var i=0;i<timelineItems.length;i++){timelineItems[i].reInit()}}};module.createTimelineElement=function(item){var $el={self:$(item),content:$(item).find(".o-timeline__content")[0],container:$(item).find(".o-timeline__content__container"),viewMore:$(item).find(".o-timeline__view-more")};$el.self.addClass("is-full");if($el.self.hasClass("has-image")){var image=$("img",item);if(typeof image[0]!==undefined){image.on("load",function(){if(breakpointHeight<=$el.container.outerHeight(true)){module.closeTimeline($el)}})}}if(breakpointHeight<=$el.container.outerHeight(true)){module.closeTimeline($el)}$el.reInit=function(){if(breakpointHeight<=$el.container.outerHeight(true)){module.closeTimeline($el)}else{module.openTimeline($el)}};return $el};module.renderTimeline=function(){$(".js-timeline-max-item",$context).each(function(_,item){var $elm=module.createTimelineElement(item);$elm.viewMore.off("click").on("click",function(){module.openTimeline($elm)})})};handlers.push({name:"_triggerListHandler",handle:function(){module.updateTimeline();module.renderTimeline();app.EventHandler.subscribe("EVENT_RESIZE",module.updateTimeline)}});handlers.push({name:"_triggerListSeeMoreHandler",handle:function(){$context.on("click",".js-timeline-max-more",function(e){e.preventDefault();var $seeMoreBtn=$(this);var $timeline=$seeMoreBtn.closest(".o-container").find(".js-timeline-max");if(typeof $timeline!=="undefined"){$timeline.find(".js-timeline-max-item.u-dn").slice(0,15).removeClass("u-dn");module.renderTimeline();if($timeline.find(".js-timeline-max-item.u-dn").length===0){$seeMoreBtn.addClass("u-dn-imp")}}})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("socialSharing",function(window,$,app){"use strict";var module={},selector=".js-share";module.preInit=function(){return true};var handlers=[];var $shareBtn=$(selector);handlers.push({name:"_handleSocialSharing",handle:function(){var intentRegex=/twitter\.com\/intent\/(\w+)/,windowOptions="scrollbars=yes,resizable=yes,toolbar=no,location=yes",width=550,height=420,winHeight=screen.height,winWidth=screen.width;var handleTwitterShare=function(obj){var e=obj.evt||window.event;var target=e.target||e.srcElement,m,left,top;m=obj.url.match(intentRegex);if(m){left=Math.round(winWidth/2-width/2);top=0;if(winHeight>height){top=Math.round(winHeight/2-height/2)}window.open(obj.url,"twitterIntent",windowOptions+",width="+width+",height="+height+",left="+left+",top="+top);e.returnValue=false;e.preventDefault&&e.preventDefault()}};var handleFacebookShare=function(obj){if(obj.url!=""){var share_link="https://www.facebook.com/sharer.php?u="+obj.url;window.open(share_link,"_blank").focus()}};var socialSharing=function(e){var $el=app.preventDefault($(this),e);var shareObject={evt:e,url:$el.attr("href"),quote:$el.attr("data-fb-quote"),time:Date.now(),sharer:$el.data("sharer")||"FB"};app.EventHandler.publish("EVENT_SOCIAL_"+shareObject.sharer,shareObject);var gaLabel=shareObject.sharer=="FB"?"Facebook":"Twitter"};var handleTwitterActionLinks=function(){$(document).on("click",".js-tweet-action",function(e){e.preventDefault();var $el=$(this);var href=$el.attr("href");var left=Math.round(winWidth/2-width/2);var top=0;if(winHeight>height){top=Math.round(winHeight/2-height/2)}window.open(href,"twitteraction",windowOptions+",width="+width+",height="+height+",left="+left+",top="+top)})};$(document).on("click",selector,socialSharing);app.EventHandler.subscribe("EVENT_SOCIAL_FB",handleFacebookShare);app.EventHandler.subscribe("EVENT_SOCIAL_TW",handleTwitterShare);handleTwitterActionLinks()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("tweetList",function(window,$,app){"use strict";var module={},selector=".js-twitter-feed";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector),ajaxURL=" /ajax/twittercollection/",collectionID=$context.attr("data-collection-id"),endpointURL=ajaxURL+collectionID,narrowIndicator=".c-tweet-list--narrow",sliderSelector=".js-twitter-slider";var template=$("#tweets").html();var rendered=$("#tweets").length?Handlebars.compile(template):{};function createHumanDate(timestamp){var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var date=new Date(timestamp);var year=(""+date.getFullYear()).substr(2);return date.getDate()+" "+months[date.getMonth()]+" "+year}function replace_links(tweet){var pattern=/(http[s:\/a-zA-Z0-9\.\_]+)\b/gm;return tweet.replace(pattern,'<a href="$1" target="_blank">$1</a>')}function replace_mentions(tweet){var pattern=/(\@(.+?))\b/gm;var base_url="https://twitter.com/";return tweet.replace(pattern,'<a href="'+base_url+'$2" target="_blank">$1</a>')}function replace_hashtags(tweet){var pattern=/(\#(.+?))\b/gm;var base_url="https://twitter.com/hashtag/";return tweet.replace(pattern,'<a href="'+base_url+'$2" target="_blank">$1</a>')}function build_tweet(tweet){return replace_mentions(replace_hashtags(replace_links(tweet)))}handlers.push({name:"_handleTweetList",handle:function(){if(!$context.length){return}$.getJSON(endpointURL).done(function(rawJSON){var tweets=[],tweetsLarge=[],rawTweets=rawJSON.objects.tweets,rawUsers=rawJSON.objects.users,rawOrder=rawJSON.response.timeline;var cnt=0,cnt_large=0,cnt_large_threshhold=3,group=[],group_large=[],current_group=null;$.each(rawOrder,function(idx,timeTweet){var tweet=rawTweets[timeTweet.tweet.id];if(typeof tweet=="undefined"){return true}var user=rawUsers[tweet.user.id_str];if(typeof user=="undefined"){return true}tweet.text=build_tweet(tweet.text);tweet.created_at=createHumanDate(tweet.created_at);tweet.user=user;cnt++;cnt_large++;group.push(tweet);group_large.push(tweet);if(cnt>=1){tweets.push(group);cnt=0;group=[]}if($context.closest(narrowIndicator).length){cnt_large_threshhold=2}else{cnt_large_threshhold=3}if(cnt_large>=cnt_large_threshhold){tweetsLarge.push(group_large);cnt_large=0;group_large=[]}});if(group.length>0){tweets.push(group)}if(group_large.length>0){tweetsLarge.push(group_large)}var _renderTwitterSlider=function(){var _current_group=$.inArray(app.getCurrentBreakpoint(),["small","medium"])===-1?"default":"small";if(_current_group!=current_group){current_group=_current_group;var _tweets=current_group=="small"?tweets:tweetsLarge;$context.html("");$.each(_tweets,function(idx,obj){$context.append(rendered({tweets:obj}))});app.twitterSlider=new app.Slider(sliderSelector,{fadeItem:true,isStream:true,initPage:1,trackClass:".c-slider-track"})}};_renderTwitterSlider();app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",_renderTwitterSlider)})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("tweetEmbed",function(window,$,app){"use strict";var module={},selector=".js-tweet-embed";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var template=$("#tweet").html();var rendered=$("#tweets").length?Handlebars.compile(template):{};function createHumanDate(timestamp){var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var date=new Date(timestamp);var year=(""+date.getFullYear()).substr(2);return date.getDate()+" "+months[date.getMonth()]+" "+year}function replace_links(tweet){var pattern=/(http[s:\/a-zA-Z0-9\.\_]+)\b/gm;return tweet.replace(pattern,'<a href="$1" target="_blank">$1</a>')}function replace_mentions(tweet){var pattern=/(\@(.+?))\b/gm;var base_url="https://twitter.com/";return tweet.replace(pattern,'<a href="'+base_url+'$2" target="_blank">$1</a>')}function replace_hashtags(tweet){var pattern=/(\#(.+?))\b/gm;var base_url="https://twitter.com/hashtag/";return tweet.replace(pattern,'<a href="'+base_url+'$2" target="_blank">$1</a>')}function build_tweet(tweet){return replace_mentions(replace_hashtags(replace_links(tweet)))}handlers.push({name:"_handleTweetEmbed",handle:function(){$context.each(function(){var element=$(this);var ajaxURL=" /ajax/twitter-tweet/",tweetID=element.attr("data-twitter-embed-id"),endpointURL=ajaxURL+tweetID;$.getJSON(endpointURL).done(function(tweet){tweet.text=build_tweet(tweet.text);tweet.created_at=createHumanDate(tweet.created_at);element.html(rendered({tweet:tweet}));app.reCreateIframePrint=true})})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("crisisWatch",function(window,$,app){"use strict";var module={},selector=".page-crisiswatch, .page-node-type-crisis-watch";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $cw=$(selector);module.scrollTo=function(country){var target;target=$(country+"_");if(!country){country=location.hash}target=$(country);return target.length?$("html, body").stop().delay().animate({scrollTop:target.offset().top-80},600):false};module.entryTooltip=function(){var $entry=$cw.find(".o-state-entry");$entry.each(function(){var $this=$(this);$this.on("mouseenter touchstart",function(){$entry.removeClass("is-show");$this.addClass("is-show")}).on("mouseleave touchend",function(){$this.removeClass("is-show")})});app.$body.on("mouseenter touchstart",function(){$entry.removeClass("is-show")})};handlers.push({name:"_mapBoxHandler",handle:function(){var $mapbox=$(".c-mapbox",$cw),$cwHero=$(".c-mapbox__hero",$mapbox),$cwDetails=$(".c-mapbox__details",$mapbox),$header=$(".js-header",$cw),$cwLogo=$(".js-mapbox-logo",$cw),$expandBtn=$(".js-mapbox-expand",$mapbox),$closeBtn=$(".js-mapbox-close",$mapbox),$cwMapbox=$(".js-mapbox",$mapbox),$legendBtn=$(".js-legend-expand",$mapbox),$cwMapboxModal=$(".js-mapbox-modal",$mapbox);module.origWinHeight=window.innerHeight;var expandMap=function(e){var $btn=app.preventDefault($(this),e);runInSequence([function(){$(".js-mapbox-modal").addClass("u-dn");$("html, body").animate({scrollTop:0},300)},function(){app.$body.addClass("u-no-scroll-y");$header.addClass("has-mapbox");$mapbox.addClass("is-expanded")},function(){$cwDetails.addClass("u-invisible");$closeBtn.removeClass("u-dn");$cwLogo.removeClass("u-invisible");$cwMapbox.removeClass("u-is-disabled");$mapbox.find(".c-mapbox__footer-scroll-text").addClass("u-dn")}],150)};app.closeMap=function(e,cb){var $btn=typeof e==="object"?app.preventDefault($(this),e):app.$body;var closeSequence=[function(){$cwMapbox.removeClass("has-modal");app.cwMap.setZoom(3);runInSequence([function(){$cwMapboxModal.removeClass("is-shown");$cwMapboxModal.removeAttr("data-id");$cwMapboxModal.removeClass("is-truncated")},function(){$cwMapboxModal.html("").addClass("u-dn").removeClass("is-expanded");app.selectedCW=undefined}],300)},function(){$cwDetails.removeClass("u-invisible");app.$body.removeClass("u-no-scroll-y");$header.removeClass("has-mapbox");$mapbox.removeClass("is-expanded");$mapbox.find(".c-mapbox__footer-scroll-text").removeClass("u-dn");$closeBtn.addClass("u-dn");$cwLogo.addClass("u-invisible");$cwMapbox.addClass("u-is-disabled")},function(){app.cwMap.setView([15,0],3,{pan:{animate:true,duration:.5}})}];if(typeof cb==="function"){closeSequence.push(cb)}runInSequence(closeSequence,150)};var toggleLegend=function(e){var $btn=$(this),$legend=$(".c-mapbox__legend-list",$mapbox),$hasTooltip=$legend.hasClass("is-tooltip");if(typeof e==="object"){e.hasOwnProperty("icg")?$hasTooltip=true:e.preventDefault()}else{$hasTooltip=e}$hasTooltip?$legend.removeClass("is-tooltip"):$legend.addClass("is-tooltip")};$expandBtn.on("click",expandMap);$closeBtn.on("click",app.closeMap);$legendBtn.on("click",toggleLegend);app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",toggleLegend)}});handlers.push({name:"_pageScrollHandler",handle:function(){if(!$("[data-entry-country]").length){return}$(document).ready(function(){module.scrollTo()});$(".js-scrollTo").on("click",function(e){var country="#"+$(this).data("entryTarget");module.scrollTo(country)})}});handlers.push({name:"_entryTooltip",handle:function(){module.entryTooltip()}});module.startCrisisWatch=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));(function(window,$,app){"use strict";if(!$(".js-mapbox").length){return}app.selectedCW=undefined;app.EventHandler.subscribe("EVENT_FONT_LOADED");var mapInfo={api:{endpoint:"https://api.mapbox.com/v4/",access_token:"pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw"},maps:{dark:"daltonwb.map-6l170wq6",gray:"daltonwb.g67llj8f",colored:"daltonwb.gh5fna5b",crisiswatch:"daltonwb.7aae2343",global_operation:"daltonwb.e0cd550b"},styles:{minimap:"daltonwb/ciojyvwed004jcumb1aib0lav",global_operation:"daltonwb/ciojyvwed004jcumb1aib0lav",hero:"daltonwb/ciony5rl5000fe4nl7zfkpekn"},highlights:{deteriorated_situation:"#e67373",improved_situation:"#3db7a8",resolution_opportunity:"#3894e1",risk_alert:"#f0b300",unchanged:"#ccb8b4"}};var cwData=[];var cwID=$(".js-mapbox",$(".c-mapbox")).attr("data-crisiswatch-nid");var $mapboxModal=$(".js-mapbox-modal",$(".c-mapbox"));function closeModal(){runInSequence([function(){$(".js-mapbox-modal").removeClass("is-shown");$(".js-mapbox-modal").removeAttr("data-id")},function(){$(".js-mapbox").removeClass("has-modal");$(".js-mapbox-modal").html("").addClass("u-dn").removeClass("is-expanded");$(".js-mapbox-close").removeClass("u-dn");app.selectedCW=undefined}],300)}function expandCollapseModal(){if($mapboxModal.hasClass("is-expanded")){$mapboxModal.removeClass("is-expanded");$(".js-crisis-states__detail",$mapboxModal).dotdotdot({watch:true,callback:function(isTruncated,orgContent){$(".js-crisis-states__detail",$mapboxModal).addClass("is-dot");isTruncated?$(".js-crisis-states__detail",$mapboxModal).addClass("is-truncated"):$(".js-crisis-states__detail",$mapboxModal).removeClass("is-truncated")}});$(".c-crisiswatch-entry__cta",$mapboxModal).text("Expand")}else{$mapboxModal.addClass("is-expanded");$(".js-crisis-states__detail",$mapboxModal).trigger("destroy").addClass("is-expanded");$(".c-crisiswatch-entry__cta",$mapboxModal).text("Collapse")}}function openModal(guid,selectedHTML){var modalId=guid,modalHTML=selectedHTML;$(".js-mapbox").addClass("has-modal");if(app.$win.outerWidth()<app.breakpoints.MEDIUM){$("html, body").animate({scrollTop:0},300)}var checkModalSize=function(obj){if(obj.winWidth<app.breakpoints.MEDIUM){$(".js-crisis-states__detail",$mapboxModal).trigger("destroy").removeClass("is-dot").removeClass("is-truncated")}else{if($(".js-crisis-states__detail",$mapboxModal).hasClass("is-dot")){$(".js-crisis-states__detail",$mapboxModal).trigger("update")}else{$(".js-crisis-states__detail",$mapboxModal).dotdotdot({watch:true,callback:function(isTruncated,orgContent){$(".js-crisis-states__detail",$mapboxModal).addClass("is-dot");isTruncated?$(".js-crisis-states__detail",$mapboxModal).addClass("is-truncated"):$(".js-crisis-states__detail",$mapboxModal).removeClass("is-truncated")}})}}};var funcSequence=[function(){$mapboxModal.html(modalHTML).removeClass("u-dn").attr("data-id","modal-"+modalId)},function(){$mapboxModal.addClass("is-shown");checkModalSize({winWidth:app.$win.outerWidth()});app.EventHandler.subscribe("EVENT_RESIZE",checkModalSize)},function(){$(".js-crisis-states__detail",$mapboxModal).trigger("update");$(".c-crisiswatch-entry__close-btn",$mapboxModal).on("click",function(e){var $btn=app.preventDefault($(this),e);closeModal()});$(".c-crisiswatch-entry__cta",$mapboxModal).on("click",function(e){var $btn=app.preventDefault($(this),e);expandCollapseModal()})}];if(!$mapboxModal.hasClass("u-dn")){runInSequence([function(){$mapboxModal.removeClass("is-shown")},function(){$mapboxModal.removeClass("u-dn");runInSequence(funcSequence,300)}],300)}else{runInSequence(funcSequence,300)}}$.getJSON("/ajax/crisiswatch/"+cwID).done(function(json){$(".js-mapbox-expand").text("Browse Map").removeClass("u-is-disabled");cwData=json;var crisisWatch={countries:[],countriesGeoJson:{},geoJson:{},setCountriesGeoJson:function(data){this.countriesGeoJson=data},setCountries:function(data){this.countries=data;this.updateGeoJson()},updateGeoJson:function(){this.geoJson={type:"FeatureCollection",features:[]};var me=this;$.each(me.countries,function(idx,val){var item=$.grep(me.countriesGeoJson.features,function(cnt){var country=val.country;if(val.cw_country!=null){country=val.cw_country}return country.toLowerCase()==cnt.properties.name.toLowerCase()});if($.isArray(item)&&item.length>0){if(item[0].hasOwnProperty("properties")){item[0].properties.cw_status=val.status;me.geoJson.features.push(item[0])}}})}};var init=function(){app.cwModal=[];if(typeof L==="undefined"){console.log("Mapbox & Leaflet not loaded.");return}L.mapbox.accessToken=mapInfo.api.access_token;var countryGeoJsonDone=function(script,textStatus){crisisWatch.setCountriesGeoJson(countryGeoJson);crisisWatch.setCountries(cwData);onLoaded()};var countryGeoJsonFail=function(jqxhr,settings,exception){console.log("Error loading Country GeoJson data.")};if(typeof countryGeoJson==="undefined"){$.getScript("/themes/custom/icg_d9_admin/js/countries.js").done(countryGeoJsonDone).fail(countryGeoJsonFail)}else{onLoaded()}};var loadHero=function(){$(".js-mapbox").each(function(idx,el){var $el=$(el);var elId=guid();$el.attr("id",elId);var modalList=[];var conf=$.extend({lon:15,lat:0,zoom:3},$el.data());var bounds=[[85,-180],[-85,200]];var geocoder=new L.mapbox.geocoder("mapbox.places");var map=new L.mapbox.map(elId,"map",{minZoom:2,maxZoom:4,maxBounds:bounds}).setView([conf.lon,conf.lat],conf.zoom).addLayer(L.mapbox.styleLayer("mapbox://styles/daltonwb/ckg6hn5gl1ix019quowcpped2"));map.scrollWheelZoom.disable();map.keyboard.disable();map.doubleClickZoom.disable();var onEachFeature=function(feature,layer){var tooltip=false,modal=false,modalId=guid();var popupContent='<h3 class="u-df">';for(var stat in layer.feature.properties.cw_status){if(layer.feature.properties.cw_status.hasOwnProperty(stat)&&layer.feature.properties.cw_status[stat]!=undefined){popupContent+='<span class="o-icon u-mar-r5 u-dib"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+layer.feature.properties.cw_status[stat]+'"></use></svg></span>'}}var selectedCountry=feature.properties.name,selectedObject=$.grep(crisisWatch.countries,function(cts){if(cts.cw_country!=null){return selectedCountry.toLowerCase()==cts.cw_country.toLowerCase()}else{return selectedCountry.toLowerCase()==cts.country.toLowerCase()}});if(selectedObject.length>0&&selectedObject[0].country!=null){var selectedCountry=selectedObject[0].country}popupContent+='<p class="u-mar-t0 u-mar-b0 u-mar-r0 u-mar-l5 u-franklin u-ttu u-fs13 u-fwn">'+selectedCountry;popupContent+="</h3>";var highlightFeature=function(e){var latlng=e.latlng;var coordinates=layer.feature.geometry.coordinates;tooltip=L.popup({closeButton:false}).setLatLng(latlng).setContent(popupContent).openOn(app.cwMap)};var resetHighlight=function(e){app.cwMap.closePopup(tooltip)};var onCountryClick=function(e){var clickedName=e.target.feature.properties.name.toLowerCase();function clickEventHandler(){var selectedCountry=layer.feature.properties.name,selectedObject=$.grep(crisisWatch.countries,function(cts){if(cts.cw_country!=null){return selectedCountry.toLowerCase()==cts.cw_country.toLowerCase()}else{return selectedCountry.toLowerCase()==cts.country.toLowerCase()}}),selectedHTML=selectedObject[0];openModal(modalId,selectedHTML.html)}if(typeof app.selectedCW==="undefined"){app.selectedCW=clickedName;clickEventHandler()}else{if(clickedName!==app.selectedCW){closeModal();clickEventHandler()}app.selectedCW=clickedName}window.dataLayer.push({event:"crisiswatch_info_modal",title:e.target.feature.properties.name})};layer.on({mouseover:highlightFeature,mouseout:resetHighlight,click:onCountryClick})};L.geoJson(crisisWatch.geoJson,{style:function(feature){var _style={weight:2,opacity:1,color:"#ffffff",dashArray:"",fillOpacity:1,fillColor:"#ffffff"};if(feature.properties.cw_status.primary=="improved"){_style.fillColor="#3db7a8"}if(feature.properties.cw_status.primary=="deteriorated"){_style.fillColor="#e67373"}if(feature.properties.cw_status.primary=="unchanged"){_style.fillColor="#ccb8b4"}return _style},onEachFeature:onEachFeature}).addTo(map);var markers=L.markerClusterGroup({maxClusterRadius:60,iconCreateFunction:function(cluster){var markers=cluster.getAllChildMarkers();var childCount=cluster.getChildCount();return L.divIcon({html:markers.length,className:"icg-marker icg-marker-cluster",iconSize:L.point(40,40)})},spiderfyOnMaxZoom:false,showCoverageOnHover:false,zoomToBoundsOnClick:true});$.each(crisisWatch.countries,function(idx,item){if(item.status.secondary!==""&&item.status.secondary!=null){if(item.latlng!=null){var m=L.marker(item.latlng);var cname=item.status.secondary;if(Array.isArray(cname)){cname=cname.join("-").replace(" ","")}if(item.status.tertiary!==""&&item.status.tertiary!=null){cname+="-"+item.status.tertiary}m.setIcon(L.divIcon({className:"icg-marker icg-marker-"+cname}));m.number=idx;m.status=item.status;m.title=item.country;m.data=item.html;m.tooltip=false;m.modal=false;m.modalId=guid();m.popupContent='<h3 class="u-df">';for(var stat in m.status){if(m.status[stat]!==""&&m.status[stat]!=null){m.popupContent+='<span class="o-icon u-mar-r5 u-dib"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+m.status[stat]+'"></use></svg></span>'}}m.popupContent+='<p class="u-mar-t0 u-mar-b0 u-mar-r0 u-mar-l5 u-franklin u-ttu u-fs13 u-fwn">'+m.title;m.popupContent+="</h3>";m.on("mouseover",function(e){var latlng=e.latlng;m.tooltip=L.popup({closeButton:false}).setLatLng(latlng).setContent(m.popupContent).openOn(map)});m.on("mouseout",function(e){map.closePopup(m.tooltip)});m.on("click",function(e){var clickedName=e.target.title.toLowerCase();function clickEventHandler(){openModal(m.modalId,m.data)}if(typeof app.selectedCW==="undefined"){app.selectedCW=clickedName;clickEventHandler()}else{if(clickedName!==app.selectedCW){closeModal();clickEventHandler()}app.selectedCW=clickedName}});markers.addLayer(m)}app.cwModal.push(m)}});map.addLayer(markers);app.cwMap=map;app.cw=crisisWatch})};var onLoaded=function(){loadHero();app.crisisWatch.startCrisisWatch()};init()})})(window,jQuery,window.App);App.module.create("ellipsis",function(window,$,app){"use strict";var module={},selector=".js-ellipsis";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $selector=$(selector);handlers.push({name:"_handleEllipsis",handle:function(){if(!$selector){return}$(window).bind("load",function(){$selector.dotdotdot({watch:"window",ellipsis:"â€¦"}).css("overflow","visible")})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("payment",function(window,$,app){"use strict";var module={},selector=".js-payment",selectorDonate=".js-payment-donate",selectorEvent=".js-payment-event";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);module.card={};module.bitcoin={};module.plan={};var options={paymentButtonLabel:"Donate",paymentTitle:"International Crisis Group",paymentDescription:"Preventing War. Shaping Peace."};if(typeof Stripe==="undefined")return;var stripe=Stripe(app.settings.payment_key);var stripeElements=stripe.elements();var registeredElements=[];var additionalData={};var styles={base:{color:"#14262b",fontWeight:400,fontFamily:"franklin-gothic-urw, Helvetica, Arial, sans-serif",fontSize:"15px",fontSmoothing:"antialiased","::placeholder":{color:"#b6bec8"}},invalid:{color:"#14262b","::placeholder":{color:"#b6bec8"}}};var classes={focus:"is-focus",empty:"is-empty",invalid:"o-error"};var cc_number,cc_date,cc_cvc;var steps=[];var fields={plan_id:$('[name="plan_id"]',$context),amount:{currency:$('[name="currency"]',$context),value:$('[name="amount"]',$context)},fullname:$('[name="fullname"]',$context),email:$('[name="email"]',$context),comment:$('[name="comment"]',$context),anonymous:$('[name="anonymous"]',$context),monthly:$('[name="with_monthly"]',$context),honouree:{checkbox:$('[name="in_honour_for"]',$context),name:$('[name="honouree_name"]',$context),email:$('[name="honouree_email"]',$context)},send_mail:$('[name="send_mail"]',$context),address:{line1:$('[name="address"]',$context),city:$('[name="city"]',$context),postcode:$('[name="postcode"]',$context)},attendee:{fullname:$('[name="attendee_fullname"]',$context),email:$('[name="attendee_email"]',$context)},bitcoin:{label:$("#bitcoin_label",$context),input:$('[name="bitcoin"]',$context),wallet:$("#bitcoin_open_wallet",$context)},button:{$next:$('[name="next"]',$context),$back:$('[name="back"]',$context),$submit:$('[name="submit"]',$context)},recaptcha:$("#recaptcha",$context)};app.Stripe=stripe;var symbol=function(curr){var symbl="";switch(curr){case"usd":symbl="$";break;case"eur":symbl="â‚¬";break;case"gbp":symbl="Â£";break}return symbl};var decimal=function(value,places){return Number(value).toFixed(places)};var paymentOption=function(){var paymentOption=$(".js-payment-option");function show(value){$('[data-form-payment-value="'+value+'"]').addClass("u-db");setTimeout(function(){$('[data-form-payment-value="'+value+'"]').addClass("u-opacity")},200)}function hide(){var hasError=$("[data-form-payment-value]").find(".js-error");$("[data-form-payment-value").removeClass("u-opacity");setTimeout(function(){$("[data-form-payment-value").removeClass("u-db")},200);if(hasError.length>0){hasError.prev().removeClass("o-error");hasError.remove()}}if(paymentOption.is(":checked")){show("credit_card")}paymentOption.on("click",function(e){var $this=$(this);var val=$this.data("form-payment");hide();setTimeout(function(){show(val)},200)})};var hidePreloader=function(element){if(element.next(".o-preloader")){element.next(".o-preloader").addClass("u-dn")}};var showPreloader=function(element){if(element.next(".o-preloader")){element.next(".o-preloader").removeClass("u-dn")}};var showNotification=function(type,text){var $parent=fields.bitcoin.wallet.parent();var $pill=$('<span class="o-pill o-pill--'+type+'"><span class="o-icon"><svg><use xlink:href="#'+type+'"></use></svg></span>'+text+"</span>");$pill.appendTo($parent)};module.card.generate=function(){cc_number=stripeElements.create("cardNumber",{style:styles,classes:classes});cc_number.mount("#cc_number");cc_date=stripeElements.create("cardExpiry",{style:styles,classes:classes});cc_date.mount("#cc_date");cc_cvc=stripeElements.create("cardCvc",{style:styles,classes:classes});cc_cvc.mount("#cc_cvc");registeredElements.push(cc_number);registeredElements.push(cc_date);registeredElements.push(cc_cvc)};module.card.destroy=function(){cc_number.destroy();cc_date.destroy();cc_cvc.destroy();registeredElements=[]};module.card.token=function(){stripe.createPaymentMethod("card",cc_number).then(function(result){console.log(result);$("<input type='hidden' name='token' value='"+result.paymentMethod.id+"' />").appendTo($context);$("<input type='hidden' name='client_ip' value='' />").appendTo($context);if($context.hasClass("js-payment-event")){var $selectedLevel=$context.find(".js-payment-event-level:checked"),levelId=$selectedLevel.val(),code=$context.find('[name="level_code['+levelId+']"]').val(),title=$context.find('[name="level_title['+levelId+']"]').val(),amount=$context.find('[name="level_amount['+levelId+']"]').val(),goodsAndServices=$context.find('[name="level_goods_and_services['+levelId+']"]').val(),$quantity=$context.find('[name="level_quantity['+levelId+']"]');if($quantity.length>0){var quantity=$quantity.val();amount=amount*quantity;goodsAndServices=goodsAndServices*quantity}$("<input type='hidden' name='amount' value='"+amount+"' />").appendTo($context);$("<input type='hidden' name='event_donation_id' value='"+levelId+"' />").appendTo($context);$("<input type='hidden' name='event_donation_code' value='"+code+"' />").appendTo($context);$("<input type='hidden' name='event_donation_title' value='"+title+"' />").appendTo($context);$("<input type='hidden' name='event_goods_and_services' value='"+goodsAndServices+"' />").appendTo($context);if($quantity.length>0){$("<input type='hidden' name='event_donation_quantity' value='"+quantity+"' />").appendTo($context)}}}).then(function(){module.ajaxRequest()})};module.bitcoin.submit=function(data){if($(".o-pill")){$(".o-pill").remove()}module.wizard.load(2);fields.bitcoin.input.val(data.address);fields.bitcoin.label.html("Amount: <strong>"+data.amount+"</strong> ("+symbol(fields.amount.currency.val())+decimal(fields.amount.value.val(),2)+")");fields.bitcoin.wallet.attr("href","https://checkout.stripe.com/redirect/index.html?linkLabel=Need%20help%20choosing%20a%20wallet%3F&linkUrl=%2F-%2Fbitcoin-wallets&subtitle=If%20nothing%20happens%2C%20you%20may%20not%20have%20a%20wallet%20linked%20to%20your%20browser.&title=Redirecting%20to%20your%20Bitcoin%20wallet%E2%80%A6&url="+data.uri);hidePreloader(fields.button.$submit);showPreloader(fields.bitcoin.wallet);module.poll(data.donation_id)};module.bitcoin.token=function(){if($context.hasClass("js-payment-event")){var $selectedLevel=$context.find(".js-payment-event-level:checked"),levelId=$selectedLevel.val(),code=$context.find('[name="level_code['+levelId+']"]').val(),title=$context.find('[name="level_title['+levelId+']"]').val(),amount=$context.find('[name="level_amount['+levelId+']"]').val();$("<input type='hidden' name='amount' value='"+amount+"' />").appendTo($context);$("<input type='hidden' name='event_donation_id' value='"+levelId+"' />").appendTo($context);$("<input type='hidden' name='event_donation_code' value='"+code+"' />").appendTo($context);$("<input type='hidden' name='event_donation_title' value='"+title+"' />").appendTo($context)}module.ajaxRequest()};module.plan.cancel=function(){module.ajaxRequest()};module.ajaxRequest=function(){var form1=document.querySelector("form.js-payment");$.ajax({url:form1.getAttribute("action"),type:"POST",data:$(form1.elements).serialize(),success:function(data){if(data.type==="credit_card"){stripe.confirmCardPayment(data.payment_intent,{payment_method:{card:cc_number,billing_details:{name:data.fullname,email:data.email}}}).then(function(result){if(result.error&&result.error.payment_intent.status!="succeeded"){window.location.reload()}else if(result.paymentIntent&&result.paymentIntent.status==="succeeded"||result.paymentIntent&&result.paymentIntent.status==="processing"||result.error&&result.error.payment_intent.status==="succeeded"){window.location.href=window.location.origin+"/thank-you/"+data.donation_id}else{window.location.reload()}})}else if(data.type==="stripe_plan_cancel"){window.location.href=window.location.origin+"/thank-you/plan-canceled"}},error:function(xhr,status,data){console.error(xhr,status,data);fields.button.$submit.attr("disabled","");fields.button.$back.attr("disabled","");hidePreloader(fields.button.$submit)}})};module.poll=function(id,intv){var interval=intv||1e4;var intervalID=setInterval(function(){$.ajax({url:"/charge/status/"+id,type:"GET",success:function(data){console.log(data);if(data.donation_status=="succeeded"){fields.bitcoin.wallet.attr("disabled","");hidePreloader(fields.bitcoin.wallet);showNotification("check","Transaction complete!");setTimeout(function(){window.location.href=window.location.origin+"/thank-you/"+id},2e3)}else if(data.donation_status=="canceled"){$("#donate_expired").remove();$('<span class="u-db u-mar-t5 u-pad-l40 u-ptserif u-fs13 u-red--error" id="donate_expired">Your transaction has timed out. Please try again.</span>').appendTo($("#donate_bitcoin").parent());clearInterval(intervalID);hidePreloader(fields.bitcoin.wallet);showNotification("close","Your transaction has timed out. Please try again.");fields.button.$submit.removeAttr("disabled");fields.button.$back.removeAttr("disabled");setTimeout(function(){module.wizard.load(1)},2e3)}},error:function(xhr,status,data){console.error(xhr,status,data)}})},interval)};module.wizard=function(){$context.find("fieldset").each(function(idx,elem){elem.setAttribute("data-wizard",idx);elem.classList.add("not-complete");steps.push(elem)})};module.wizard.show=function(index){steps[index].classList.add("is-active");setTimeout(function(){$("html, body").animate({scrollTop:0},"slow");steps[index].classList.add("is-visible");if($("#donate_terms_of_use").length>0){$("#donate_terms_of_use").change(function(){var elem=$(this);elem.parent().find(".js-error").remove();if($(this).is(":checked")){elem.removeClass("is-empty");elem.removeClass("o-error")}else{elem.addClass("is-empty");elem.addClass("o-error");$('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]">This field is required.</span>').appendTo(elem.parent())}})}},200)};module.wizard.hide=function(){steps.forEach(function(step){step.classList.remove("is-visible");setTimeout(function(){step.classList.remove("is-active")},200)})};module.wizard.load=function(index){module.wizard.hide();setTimeout(function(){module.wizard.show(index)},200)};module.wizard.complete=function(){steps.each(function(idx,step){step.classList.remove("not-complete")})};window.recaptchaSuccess=function(){$('button[type="submit"]').removeAttr("disabled")};window.recaptchaExpired=function(){$('button[type="submit"]').attr("disabled","disabled")};var reCAPTCHAHandler=function(){var grecaptchaResponse=grecaptcha.getResponse();if(!grecaptchaResponse&&$("#recaptchaError").length<1){$('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]" id="recaptchaError">This field is required.</span>').appendTo(fields.recaptcha.parent())}else if($("#recaptchaError").length&&(grecaptchaResponse?true:false)){$("#recaptchaError").remove()}if(!grecaptchaResponse){$.ajax({url:"/verify/recaptcha",type:"POST",data:{response:grecaptchaResponse},success:function(data){if($("#recaptchaError").length&&data&&data.success){$("#recaptchaError").remove()}},error:function(error){if(error&&$("#recaptchaError").length<1){$('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]" id="recaptchaError">This field is required.</span>').appendTo(fields.recaptcha.parent())}}})}};var paymentDonateHandler=function(){var validateFirst=function(cb){app.form.Validation.Validate(fields.amount.value);app.form.Validation.required(fields.fullname);app.form.Validation.Validate(fields.email);if(fields.honouree.checkbox.is(":checked")){app.form.Validation.required(fields.honouree.name);app.form.Validation.Validate(fields.honouree.email)}if(fields.send_mail.is(":checked")){app.form.Validation.Validate(fields.address.line1);app.form.Validation.Validate(fields.address.city);app.form.Validation.Validate(fields.address.postcode)}var hasError=$(steps[0]).find(".js-error");if(hasError.length>0){return false}if(typeof cb!==typeof undefined&&typeof cb=="function"){cb.call()}};var validateSecond=function(cb){if($('[name="donate_type"]:checked').val()=="credit_card"){var $empty=$(".is-empty",$context);if($empty){$empty.addClass("o-error");if($empty.parent().find(".js-error")){$empty.parent().find(".js-error").remove()}$('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]">This field is required.</span>').appendTo($empty.parent())}else{$empty.removeClass("o-error");$empty.parent().find(".js-error").remove()}registeredElements.forEach(function(elm){var $parent=$(elm._parent).parent();elm.addEventListener("change",function(result){$parent.find(".js-error").remove();if(result.error){$('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]">'+result.error.message+"</span>").appendTo($parent)}})});var hasError=$(steps[1]).find(".js-error");if(hasError.length>0){return}}if(typeof cb!==typeof undefined&&typeof cb=="function"){cb.call()}};fields.amount.value.keypress(function(e){if(e.which!=8&&e.which!=0&&(e.which<46||e.which>57)){return false}});fields.button.$next.on("click",function(){validateFirst(function(){module.wizard.load(1);$('button[type="submit"]').text("Donate "+symbol(fields.amount.currency.val())+decimal(fields.amount.value.val(),2))})});fields.button.$back.on("click",function(){module.wizard.load(0)});$context.on("submit",function(e){e.preventDefault();reCAPTCHAHandler();validateSecond(function(){fields.button.$submit.attr("disabled","");fields.button.$back.attr("disabled","");showPreloader(fields.button.$submit);if($('[name="donate_type"]:checked').val()=="credit_card"){module.card.token()}else if($('[name="donate_type"]:checked').val()=="bitcoin"){module.bitcoin.token()}})})};var paymentEventHandler=function(){var validateFirst=function(cb){app.form.Validation.required(fields.attendee.fullname);app.form.Validation.Validate(fields.attendee.email);if(fields.send_mail.is(":checked")){app.form.Validation.Validate(fields.address.line1);app.form.Validation.Validate(fields.address.city);app.form.Validation.Validate(fields.address.postcode)}if(fields.honouree.checkbox.is(":checked")){app.form.Validation.required(fields.honouree.name);if(fields.honouree.email.val()){app.form.Validation.Validate(fields.honouree.email)}}var hasError=$(steps[0]).find(".js-error");if(hasError.length>0){return false}if(typeof cb!==typeof undefined&&typeof cb=="function"){cb.call()}};var validateSecond=function(cb){app.form.Validation.required(fields.fullname);app.form.Validation.Validate(fields.email);if($('[name="donate_type"]:checked').val()=="credit_card"){var $empty=$(".is-empty",$context);if($empty){$empty.addClass("o-error");if($empty.parent().find(".js-error")){$empty.parent().find(".js-error").remove()}$('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]">This field is required.</span>').appendTo($empty.parent())}else{$empty.removeClass("o-error");$empty.parent().find(".js-error").remove()}registeredElements.forEach(function(elm){var $parent=$(elm._parent).parent();elm.addEventListener("change",function(result){$parent.find(".js-error").remove();if(result.error){$('<span class="js-error o-error [ u-db u-mar-t5 u-mar-b20 ]">'+result.error.message+"</span>").appendTo($parent)}})});var hasError=$(steps[1]).find(".js-error");if(hasError.length>0){return}}if(typeof cb!==typeof undefined&&typeof cb=="function"){cb.call()}};var showSummary=function(){var id=$(".js-sponsorship-level input:checked").attr("id");var price=$("span."+id).text();var label=$("label[for*="+id+"]").text();$(".js-summary").text("You are paying for: "+label+" | "+price)};fields.button.$next.on("click",function(){showSummary();validateFirst(function(){module.wizard.load(1)})});fields.button.$back.on("click",function(){module.wizard.load(0)});$context.on("submit",function(e){e.preventDefault();reCAPTCHAHandler();validateSecond(function(){fields.button.$submit.attr("disabled","");fields.button.$back.attr("disabled","");showPreloader(fields.button.$submit);if($('[name="donate_type"]:checked').val()=="credit_card"){module.card.token()}else if($('[name="donate_type"]:checked').val()=="bitcoin"){module.bitcoin.token()}})})};var planCancelHandler=function(){var validate=function(cb){app.form.Validation.Validate(fields.plan_id);var hasError=$context.find(".js-error");if(hasError.length>0){return false}if(typeof cb!==typeof undefined&&typeof cb==="function"){cb.call()}};$context.on("submit",function(e){e.preventDefault();validate(function(){fields.button.$submit.attr("disabled","");showPreloader(fields.button.$submit);module.plan.cancel()})})};handlers.push({name:"_modulePayment",handle:function(){if($context.length==0){return}if($context.hasClass("js-payment-donate")){module.wizard();module.card.generate();paymentOption();paymentDonateHandler()}else if($context.hasClass("js-payment-event")){module.wizard();module.card.generate();paymentOption();paymentEventHandler()}else if($context.hasClass("js-plan-cancel")){planCancelHandler()}}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("print",function(window,$,app){"use strict";var module={},selector=".js-print";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $printBtn=$(selector);module.getIframeObj=function(id){return $('iframe.js-printf[data-id="'+id+'"]')};module.createIframe=function(){$("iframe.js-printf").remove();$(".s-article").each(function(key,val){var p={$article:$(val).clone(),articleId:$(val).data("id")};if(module.getIframeObj(p.articleId).length){return}$('<iframe class="js-printf u-pf u-opacity-0" data-id="'+p.articleId+'" />').appendTo(app.$body);p.$frame=module.getIframeObj(p.articleId);p.$frame.css({width:1080,height:"100vh",top:100,right:"100%",zIndex:-100});p.$frameContent=p.$frame.contents();p.hex=Math.floor(Math.random()*16777215).toString(16);p.$frameContent.find("head").append($("<link/>",{rel:"stylesheet",href:"/themes/custom/icg_d9/dist/css/main.css?"+p.hex,type:"text/css"}));p.svg=app.$body.find("div:first").clone();p.$logo=app.$body.find(".o-logo--sq:first").clone();p.$frameContent.find("body").html(p.svg);p.$frameContent.find("body").addClass("print");p.$article.find(".o-image").addClass("o-ar-16x9");p.$article.find(".c-page-hero__details").prepend(p.$logo);p.$article.find(".js-page-hero").removeClass("c-page-hero--full");p.$article.find(".c-page-hero__image").detach().insertAfter(p.$article.find(".c-page-hero__details"));p.$article.find(".c-inline-media:not(.js-video, .js-slideshow)").each(function(idx,val){var $media=$(val);if($(".js-tweet-embed",$media).length||$(".o-image",$media).length){return}$media.remove()});$.each(p.$article.find("picture"),function(idx,val){if(!$("source",val).length){return}var $picture=$(val),sourceAttr=$("img:first",val).hasClass("lazyload")?"data-srcset":"srcset",imgSrc=$("source:first",val).attr(sourceAttr);imgSrc=imgSrc?imgSrc.replace(" 1x",""):"";var $img=$("img:first",val).attr("src",imgSrc).clone();$picture.html($img)});p.$article.find(".c-tweet__actions").remove();p.$article.find(".c-tweet__timestamp").addClass("u-wbbw").each(function(){$(this).text($(this).attr("href"))});if($(val).hasClass("s-article-flashpoint")){p.$article.find(".s-article__sidebar").removeClass("s-article__sidebar");p.$article.find(".o-timeline .js-timeline-max-item").removeClass("u-dn");p.$article.find(".o-timeline .o-timeline__content").removeAttr("style")}p.$frameContent.find("body").append(p.$article)})};module.onScroll=function(obj){if($(".js-tweet-embed").length&&app.reCreateIframePrint){app.reCreateIframePrint=false;module.createIframe()}};module.annotation=function(from,obj){var p={headerTmpl:'<div class="c-page-hero"><div class="c-page-hero__details [ u-pr ] [ u-pad-t5 ]"><div class="c-page-hero__meta [ u-fs13 u-fwn u-ttu u-mar-b15 ]"></div><h1 class="c-page-hero__title [ u-fs36 u-fs50@l u-lh1 u-wbbw ]" dir="ltr" lang="en"></h1></div></div>',highlightTmpl:'<div class="c-annotation-listing u-ptserif u-gray u-border-after u-pad-t40 u-pad-b40"><blockquote class="u-mar-l0 u-pad-l20 u-fs15 u-b--gray-base"></blockquote><div class="u-fs15"></div></div>'};if(!$("iframe.js-ann-print").length){$('<iframe class="js-ann-print u-pf u-opacity-0" />').appendTo(app.$body)}p.$frame=$("iframe.js-ann-print");p.$frame.css({width:1080,height:"100vh",top:100,right:"100%",zIndex:-100});p.$frameContent=p.$frame.contents();p.$frameContent.find("body").html("");if(!$('[href*="main.css"]',p.$frameContent.find("head")).length){p.hex=Math.floor(Math.random()*16777215).toString(16);p.$frameContent.find("head").append($("<link/>",{rel:"stylesheet",href:"/themes/custom/icg_d9/dist/css/main.css?"+p.hex,type:"text/css"}))}if(!obj){return}p.svg=app.$body.find("div:first").clone();p.$logo=app.$body.find(".o-logo--sq:first").clone();p.$frameContent.find("body").html(p.svg);p.$header=$(p.headerTmpl);p.$header.find(".c-page-hero__details").prepend(p.$logo);if(from=="ann-editor"){p.$article=$('.s-article[data-id="'+obj.articleId+'"]');p.title=$(".c-page-hero__title",p.$article).text();p.meta=$(".c-page-hero__meta",p.$article).html();p.$annotation=$(p.highlightTmpl);$("blockquote",p.$annotation).text(obj.quote);$("div",p.$annotation).text($("textarea",obj.$editor).val());$(".js-tooltip",obj.$editor).removeClass("is-show")}else{$.extend(p,obj);p.$annotation.removeClass();p.$annotation.find(".o-icon--caret").remove();p.$annotation.find(".c-accordion__body, .c-accordion__content").removeClass();p.$annotation.find(".js-accordion__head, .u-fs21, .u-fs18").removeClass("u-fs21 u-fs18").addClass("u-fs15");p.$header.find(".c-page-hero__details").append(p.$annotation.find(".js-accordion__head"))}$(".c-page-hero__title",p.$header).text(p.title);$(".c-page-hero__meta",p.$header).html(p.meta);p.$frameContent.find("body").append(p.$header);p.$frameContent.find("body").append(p.$annotation);p.$frame.get(0).contentWindow.print()};module.notes=function($item){var obj={title:$(".js-title",$item).text(),meta:$(".js-meta",$item).html(),$annotation:$(".js-accordion__item",$item).clone()};module.annotation("recent-notes",obj)};handlers.push({name:"_printListingHandler",handle:function(){if(!$printBtn.length){return}module.createIframe();module.annotation();app.EventHandler.subscribe("EVENT_SCROLL_INSTANT",module.onScroll);$printBtn.on("click",function(e){var $el=app.preventDefault($(this),e),articleId=$el.parents(".c-toolbar").data("id");if(app.$body.hasClass("page-node-type-visual-explainer")){articleId=$(".s-article").data("id")}if($("body").hasClass("page-node-type-visual-explainer")){console.log("Special report print");window.print()}else{module.getIframeObj(articleId).get(0).contentWindow.print()}});$(".js-print-editor").on("click",function(e){var $el=app.preventDefault($(this),e);module.annotation("ann-editor",app.annotation.printObj)});$(document).on("keydown",function(e){if((e.ctrlKey||e.metaKey)&&(e.key==="p"||e.charCode===16||e.charCode===112||e.keyCode===80)){alert("Please use the Print button for a better rendering on the document");e.cancelBubble=true;e.preventDefault();el.stopImmediatePropagation()}})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("featuredWidget",function(window,$,app){"use strict";var module={},selector=".c-trigger-list__featured-banner";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);app.attachFeaturedWidget=function(obj){var triggerListInner=document.querySelector(".js-trigger-list-cover-inner");var featuredWidget=document.querySelector(selector);var toggleButton=featuredWidget.querySelector(".c-trigger-list__featured-banner__toggle");var toggleButtonSpan=toggleButton.querySelector("span");var widgetList=Array.from(featuredWidget.querySelectorAll(".c-trigger-list__featured-banner__link"));var activeSlide=0;function disablePointerEventsOnMobile(){if((/Android|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=375)&&featuredWidget.classList.contains("is-visible")&&!featuredWidget.classList.contains("is-hidden")){triggerListInner.style.pointerEvents="none"}else{triggerListInner.removeAttribute("style")}}window.addEventListener("load",function(e){disablePointerEventsOnMobile()});window.addEventListener("resize",function(e){disablePointerEventsOnMobile()});toggleButton.addEventListener("click",function(e){e.preventDefault();featuredWidget.classList.toggle("is-hidden");if(featuredWidget.classList.contains("is-hidden")){triggerListInner.removeAttribute("style");toggleButtonSpan.innerHTML="Show"}else{triggerListInner.style.pointerEvents="none";toggleButtonSpan.innerHTML="Hide"}});function changeSlide(){setTimeout(function(){var nextSlide=activeSlide+1<widgetList.length?activeSlide+1:0;widgetList[activeSlide].classList.remove("is-active");setTimeout(function(){widgetList[nextSlide].classList.add("is-active");activeSlide=nextSlide;changeSlide()},450)},3e3)}changeSlide()};module.initFeaturedWidget=function(obj){$context.each(function(index,val){app.attachFeaturedWidget($(val))})};handlers.push({name:"_moduleFeaturedWidget",handle:function(){if(!$context.length){return}module.initFeaturedWidget($context)}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("supporterCarousel",function(window,$,app){"use strict";var module={},selector=".c-supporters-carousel",$selector=$(selector);module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];module.loadSlider=function(){var toggleSlider=function(){$selector.each(function(){var $sponsors=$(".js--slider",this);if(!$sponsors.hasClass("slick-initialized")){$sponsors.slick({arrows:true,dots:false,infinite:true,mobileFirst:true,slidesToShow:1,slidesToScroll:1,adaptiveHeight:true,responsive:[{breakpoint:759,settings:{slidesToShow:2,slidesToScroll:2,adaptiveHeight:true}},{breakpoint:1079,settings:{slidesToShow:3,slidesToScroll:3,adaptiveHeight:true}},{breakpoint:1279,settings:{slidesToShow:4,slidesToScroll:4,adaptiveHeight:true}}]})}})};toggleSlider();app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",toggleSlider)};handlers.push({name:"_loadSlider",handle:function(){module.loadSlider()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));(function($){$("document").ready(function(){if($("#user-login-form").length>0){$("#user-login-form").prepend('<div class="o-form__item u-mar-b25"><h2 class="u-ttu">Login</h2></div>');$(".form-submit").addClass("o-btn");$(".form-actions").prepend('<div class="o-form__item"><a href="/user/password" class="u-fs13 u-fwl" title="Forgot Password?">Forgot Password?</a></div>')}if($("#user-pass").length>0){$("#user-pass").prepend('<div class="o-form__item u-mar-b25"><h2 class="u-ttu">Forgot Password</h2></div>');$(".form-submit").val("Email New Password");$(".form-submit").addClass("o-btn");$(".form-actions").prepend('<div class="o-form__item"><a href="/user/login" class="u-fs13 u-fwl" title="Go back to login page">Back to login</a></div>')}})})(jQuery);App.module.create("contributors",function(window,$,app){"use strict";var module={},selector=".js-contributors";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);handlers.push({name:"_contributorSlider",handle:function(){if(!$context.length){return}app.contribSlider=new app.Slider(selector)}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("inTheNews",function(window,$,app){"use strict";var module={},selector=".js-in-the-news";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);handlers.push({name:"_inTheNewsSlider",handle:function(){module.inTheNews=new app.Slider(selector)}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("timeline",function(window,$,app){"use strict";var module={},selector=".js-timeline";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector),triggerLoadyear=false,viewInstance="",currentYear=0,yearList=[],$timelineYears={};module.loadYear=function(year,slider){if(triggerLoadyear){currentYear=year;$(".js-timeline__year",$context).parent(".c-timeline__year").removeClass("is-active");$(".js-timeline__year[data-year="+year+"]",$context).parent(".c-timeline__year").addClass("is-active");module.fetchArticles($(selector).data("term-id"),year);if(typeof slider!=="undefined"){runInSequence([function(){},function(){slider.current=1;app.timelineSlider.recompute();module.checkTimelineYears()}],300)}}};app.renderHandlebars=function(templateName,json,container){var template=$(templateName).html(),rendered=Handlebars.compile(template),_cont=typeof container==="string"?$(container):container;app.EventHandler.subscribe("EVENT_TEMPLATE_READY",module.handleSearch);_cont.html(rendered(json))};module.fetchArticles=function(term_id,year){var templateId="#topicTimelines";$.ajax({async:false,type:"GET",url:window.location.origin+"/topic-timeline/"+term_id+"/"+year,dataType:"json",success:function(response){app.renderHandlebars(templateId,response,".topic-timeline-item-wrapper")}})};handlers.push({name:"_timelineSlider",handle:function(){$timelineYears=$(".c-timeline__years",$context);if($timelineYears.length){viewInstance=$(".c-slider__track--timeline",$context).data("viewInstance");currentYear=$timelineYears.data("current-year");yearList=$timelineYears.data("yearList").split(",");yearList=yearList.map(function(item){return parseInt(item,10)});triggerLoadyear=true}module.checkTimelineYears=function(){if(yearList.length>1){var prevYearIndex=yearList.indexOf(currentYear)-1;var nextYearIndex=yearList.indexOf(currentYear)+1;if(prevYearIndex<0){$(".c-slider__controls--left",$context).addClass("u-is-disabled")}else{$(".c-slider__controls--left",$context).removeClass("u-is-disabled")}if(nextYearIndex>=yearList.length){$(".c-slider__controls--right",$context).addClass("u-is-disabled")}else{$(".c-slider__controls--right",$context).removeClass("u-is-disabled")}}return yearList.length>1};app.timelineSlider=new app.Slider(selector,{fadeItem:false,isStream:true,perPage:{760:1,1080:2,max:3},initPage:1,onClickStart:function(slider){var nextYearIndex=yearList.indexOf(currentYear)-1;if(nextYearIndex>=0){module.loadYear(yearList[nextYearIndex],slider);currentYear=yearList[nextYearIndex];$timelineYears.attr("data-current-year",currentYear)}},onClickEnd:function(slider){var prevYearIndex=yearList.indexOf(currentYear)+1;if(prevYearIndex<=yearList.length){module.loadYear(yearList[prevYearIndex],slider);currentYear=yearList[prevYearIndex];$timelineYears.attr("data-current-year",currentYear)}},onChange:function(obj){module.checkTimelineYears()},onReachStart:function(obj){module.checkTimelineYears()},onReachEnd:function(obj){module.checkTimelineYears()},onResize:function(obj){obj.current=obj.lastPage;obj.reposition();module.checkTimelineYears()},onLoad:function(obj){obj.recompute()}});$context.on("click",".js-timeline__year",function(e){var $el=app.preventDefault($(this),e);currentYear=$el.data("year");module.loadYear(currentYear,app.timelineSlider);$timelineYears.attr("data-current-year",currentYear)})},attach:function(context,settings){$(".c-slider__track--timeline",context).once("recompute",function(){app.timelineSlider.recompute();$(".c-slider__item--timeline",$context).addClass("u-no-transition")});module.checkTimelineYears("attach")}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("readingList",function(window,$,app){"use strict";var module={},savedSelector=".js-list--saved",notesSelector=".js-list--notes",savedMoreLinkSelector=".js-more-link--saved",pageIdentifier=".recent-saves-page",notesMoreLinkSelector=".js-more-link--notes";module.preInit=function(){return document.querySelector(savedSelector)!==null||document.querySelector(notesSelector)!==null};var handlers=[];var $saveList=$(savedSelector),$noteList=$(notesSelector),$saveMoreLink=$(savedMoreLinkSelector),$noteMoreLink=$(notesMoreLinkSelector),$emptyAlert=$(".js-empty-reading-list-notif"),$pageIdentifier=$(pageIdentifier),savedCount=Object.size(app.storage.saved),highlightedCount=Object.size(app.storage.highlights);if(savedCount>0){$emptyAlert.addClass("u-dn")}app.renderHandlebars=function(templateName,json,container,activeClass,callback){var template=$(templateName).html(),rendered=Handlebars.compile(template),_cont=typeof container==="string"?$(container):container;app.EventHandler.subscribe("EVENT_TEMPLATE_READY",module.handleSearch);_cont.addClass(activeClass);_cont.html(rendered(json));var $saveBtn=_cont.find(".js-save");if(!$saveBtn.length){return}$saveBtn.on("click",function(e){var $el=app.preventDefault($(this),e);var itemToRemove;var $parentArticle=$(this).closest(".c-news-listing");app.cleanUpLocalStorage("saved");$.each(app.storage.saved,function(index,value){if(value.id===$parentArticle.data("nid")){itemToRemove=index;return}});app.storage.saved.splice(itemToRemove,1);app.ls.set("icg.saved",app.storage.saved);$parentArticle.slideUp(300,function(){$parentArticle.remove()})})};handlers.push({name:"_savedListingHandler",handle:function(){if(!$saveList.length){return}var templateId="#savedItems",savedItemsFromStorage=$pageIdentifier.length==0?app.storage.saved.slice(-3):app.storage.saved,savedIdsArr=savedItemsFromStorage.map(function(value,index){return value.id}),savedIds=savedIdsArr.join(","),endpointURL="/ajax/articles/"+savedIds;if(savedIdsArr.length>0){$saveList.closest(".c-recent-saves").removeClass("u-dn")}if(savedIdsArr.length>=3){$saveMoreLink.removeClass("u-dn-imp")}$.getJSON(endpointURL).done(function(json){app.renderHandlebars(templateId,json,$saveList,"has-content")}).always(function(){$saveList.find(".js-tooltip-toggle").each(function(index,val){app.attachTooltip($(val))});$saveList.find("[data-modal]").each(function(index,val){var $this=$(this).data("modal"),$modalTarget=$('[data-modal-value="'+$this+'"]');app.modalGlobal($(val),$modalTarget)});$saveList.find(".o-modal").each(function(index,val){$(".o-modal__close",$(this)).click(function(e){e.preventDefault();$(val).addClass("u-dn-imp");$(val).removeClass("u-df-imp");$(val).removeClass("is-open");$(".o-overlay.js-overlay").removeClass("u-is-visible");$(".o-overlay.js-overlay").removeClass("u-is-shown");$(".o-overlay.js-overlay").removeClass("u-is-uninteractive");$("body").removeClass("u-no-scroll")})})})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("globalOperations",function(window,$,app){"use strict";var module={},selector=".js-globaloperations";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var mapInfo={api:{endpoint:"https://api.mapbox.com/v4/",access_token:"pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw"},maps:{dark:"daltonwb.map-6l170wq6",gray:"daltonwb.g67llj8f",colored:"daltonwb.gh5fna5b",crisiswatch:"daltonwb.7aae2343",go:"daltonwb.e0cd550b"},styles:{minimap:"daltonwb/ciojyvwed004jcumb1aib0lav",global_operation:"daltonwb/ciojyvwed004jcumb1aib0lav",hero:"daltonwb/ciony5rl5000fe4nl7zfkpekn"},highlights:{deteriorated_situation:"#e67373",improved_situation:"#3db7a8",resolution_opportunity:"#3894e1",risk_alert:"#f0b300",unchanged:"#ccb8b4"}};var globalOperation={countries:[],countriesGeoJson:{},geoJson:{},gom:[],setCountriesGeoJson:function(data){this.countriesGeoJson=data},setCountries:function(data){this.countries=data;this.updateGeoJson()},updateGeoJson:function(){this.geoJson={type:"FeatureCollection",features:[]};var me=this;$.each(me.countries,function(idx,val){if(typeof me.gom[val.type]=="undefined"){me.gom[val.type]=[]}me.gom[val.type].push(val.name);var item=$.grep(me.countriesGeoJson.features,function(obj){if(val.type==="monitoring"||val.type==="covered"){return val.country.toLowerCase()==obj.properties.name.toLowerCase()}else{return val.name.toLowerCase()==obj.properties.name.toLowerCase()}});if($.isArray(item)&&item.length>0){if(item[0].hasOwnProperty("properties")){item[0].properties.type=val.type;me.geoJson.features.push(item[0])}}})}};var isLoaded=function(){var $go=$(".js-globaloperations"),goUID="go-"+guid(),conf={lon:0,lat:0,zoom:2};$go.attr("id",goUID);var bounds=[[85,-180],[-85,180]];var geocoder=new L.mapbox.geocoder("mapbox.places");var map=new L.mapbox.map(goUID,mapInfo.maps.go,{zoomControl:false,minZoom:2,maxZoom:6,maxBounds:bounds}).setView([conf.lon,conf.lat],conf.zoom);map.scrollWheelZoom.disable();map.keyboard.disable();var zoomControl=new L.Control.Zoom({position:"bottomright"});zoomControl.addTo(map);console.info("geoJSON");console.log(globalOperation.geoJson);console.info("countriesGeoJson");console.log(globalOperation.countriesGeoJson);L.geoJson(globalOperation.geoJson,{style:function(feat){var _style={weight:2,opacity:1,color:"#dddedf",dashArray:"",fillOpacity:1,fillColor:"#dddedf"};if(feat.properties.type.toLowerCase()=="covered"){_style.fillColor="#31b8a8"}if(feat.properties.type.toLowerCase()=="monitoring"){_style.fillColor="#9bd088"}if(feat.properties.type.toLowerCase()!="covered"&&feat.properties.type.toLowerCase()!="monitoring"){_style.fillColor="#dddedf"}return _style}}).addTo(map);var markers=L.markerClusterGroup({maxClusterRadius:5,iconCreateFunction:function(cluster){var markers=cluster.getAllChildMarkers();var childCount=cluster.getChildCount();return L.divIcon({html:markers.length,className:"icg-marker icg-marker-cluster",iconSize:L.point(40,40)})},spiderfyOnMaxZoom:false,showCoverageOnHover:false,zoomToBoundsOnClick:true});$.each(globalOperation.countries,function(idx,item){if(item.latlng!=null){var m=L.marker(item.latlng);m.setIcon(L.divIcon({className:"icg-marker icg-marker--go icg-marker-"+item.type}));m.number=idx;m.type=item.type;m.title=m.type==="monitoring"&&m.type==="covered"?item.country:item.name;m.tooltip=false;m.modalId=guid();m.popupContent='<h3 class="u-df">';for(var stat in m.status){m.popupContent+='<span class="o-icon u-mar-r5 u-dib"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#close"></use></svg></span>'}m.popupContent+='<p class="u-mar-t0 u-mar-b0 u-mar-r0 u-mar-l5 u-franklin u-ttu u-fs13 u-fwn">'+m.title;m.popupContent+="</h3>";if(m.type!=="monitoring"&&m.type!=="covered"){m.on("mouseover",function(e){var latlng=e.latlng;m.tooltip=L.popup({closeButton:false}).setLatLng(latlng).setContent(m.popupContent).openOn(map)});m.on("mouseout",function(e){map.closePopup(m.tooltip)});markers.addLayer(m)}}});map.addLayer(markers);var $tpl=$("#global-operations-mobile");if($tpl.length){var template=$tpl.html(),rendered=Handlebars.compile(template);$(".s-globaloperations .m-wrap").append(rendered({items:globalOperation.gom}));var $item=$(".s-globaloperations .m-wrap .js-accordion__item"),$head=$item.find(".js-accordion__head");$head.on("click",function(){App.accordion.toggleAccordion($(this))})}};module.globalOperationInit=function(goAjaxData){if(typeof L=="undefined"){console.log("Mapbox & Leaflet not loaded.");return}L.mapbox.accessToken=mapInfo.api.access_token;if(typeof countryGeoJson=="undefined"){$.getScript("/themes/custom/icg_d9_admin/js/countries.js").done(function(script,textStatus){globalOperation.setCountriesGeoJson(countryGeoJson);globalOperation.setCountries(goAjaxData);isLoaded()}).fail(function(jqxhr,settings,exception){console.log("Error loading Country GeoJson data.")})}else{isLoaded()}};handlers.push({name:"_handleGlobalOperations",handle:function(){$.getJSON("/ajax/global-operation").done(function(json){module.globalOperationInit(json)});var $goScope=$(".s-globaloperations");var $legendBtn=$(".js-legend-expand",$goScope);var toggleLegend=function(e){var $btn=$(this),$legend=$(".c-mapbox__legend-list",$goScope),$hasTooltip=$legend.hasClass("is-tooltip");if(typeof e==="object"){e.hasOwnProperty("icg")?$hasTooltip=true:e.preventDefault()}else{$hasTooltip=e}$hasTooltip?$legend.removeClass("is-tooltip"):$legend.addClass("is-tooltip")};$legendBtn.on("click",toggleLegend);app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",toggleLegend)}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("caption",function(window,$,app){"use strict";var module={},selector=".js-caption";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector),$captionToggle=$context.find($(".js-caption__toggle")),$activeClass="is-open";handlers.push({name:"_handleCaptions",handle:function(){$captionToggle.on("click",function(){$context.toggleClass($activeClass)})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,function(){"use strict";var e,i;function c(){return e.apply(null,arguments)}function o(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function u(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function l(e){return void 0===e}function d(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function h(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function f(e,t){var n,s=[];for(n=0;n<e.length;++n)s.push(t(e[n],n));return s}function m(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function _(e,t){for(var n in t)m(t,n)&&(e[n]=t[n]);return m(t,"toString")&&(e.toString=t.toString),m(t,"valueOf")&&(e.valueOf=t.valueOf),e}function y(e,t,n,s){return Ot(e,t,n,s,!0).utc()}function g(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function p(e){if(null==e._isValid){var t=g(e),n=i.call(t.parsedDateParts,function(e){return null!=e}),s=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(s=s&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return s;e._isValid=s}return e._isValid}function v(e){var t=y(NaN);return null!=e?_(g(t),e):g(t).userInvalidated=!0,t}i=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,s=0;s<n;s++)if(s in t&&e.call(this,t[s],s,t))return!0;return!1};var r=c.momentProperties=[];function w(e,t){var n,s,i;if(l(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),l(t._i)||(e._i=t._i),l(t._f)||(e._f=t._f),l(t._l)||(e._l=t._l),l(t._strict)||(e._strict=t._strict),l(t._tzm)||(e._tzm=t._tzm),l(t._isUTC)||(e._isUTC=t._isUTC),l(t._offset)||(e._offset=t._offset),l(t._pf)||(e._pf=g(t)),l(t._locale)||(e._locale=t._locale),0<r.length)for(n=0;n<r.length;n++)l(i=t[s=r[n]])||(e[s]=i);return e}var t=!1;function M(e){w(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===t&&(t=!0,c.updateOffset(this),t=!1)}function S(e){return e instanceof M||null!=e&&null!=e._isAMomentObject}function D(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function k(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=D(t)),n}function a(e,t,n){var s,i=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0;for(s=0;s<i;s++)(n&&e[s]!==t[s]||!n&&k(e[s])!==k(t[s]))&&a++;return a+r}function Y(e){!1===c.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function n(i,r){var a=!0;return _(function(){if(null!=c.deprecationHandler&&c.deprecationHandler(null,i),a){for(var e,t=[],n=0;n<arguments.length;n++){if(e="","object"==typeof arguments[n]){for(var s in e+="\n["+n+"] ",arguments[0])e+=s+": "+arguments[0][s]+", ";e=e.slice(0,-2)}else e=arguments[n];t.push(e)}Y(i+"\nArguments: "+Array.prototype.slice.call(t).join("")+"\n"+(new Error).stack),a=!1}return r.apply(this,arguments)},r)}var s,O={};function T(e,t){null!=c.deprecationHandler&&c.deprecationHandler(e,t),O[e]||(Y(t),O[e]=!0)}function x(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function b(e,t){var n,s=_({},e);for(n in t)m(t,n)&&(u(e[n])&&u(t[n])?(s[n]={},_(s[n],e[n]),_(s[n],t[n])):null!=t[n]?s[n]=t[n]:delete s[n]);for(n in e)m(e,n)&&!m(t,n)&&u(e[n])&&(s[n]=_({},s[n]));return s}function P(e){null!=e&&this.set(e)}c.suppressDeprecationWarnings=!1,c.deprecationHandler=null,s=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)m(e,t)&&n.push(t);return n};var W={};function H(e,t){var n=e.toLowerCase();W[n]=W[n+"s"]=W[t]=e}function R(e){return"string"==typeof e?W[e]||W[e.toLowerCase()]:void 0}function C(e){var t,n,s={};for(n in e)m(e,n)&&(t=R(n))&&(s[t]=e[n]);return s}var F={};function L(e,t){F[e]=t}function U(e,t,n){var s=""+Math.abs(e),i=t-s.length;return(0<=e?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+s}var N=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,G=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,V={},E={};function I(e,t,n,s){var i=s;"string"==typeof s&&(i=function(){return this[s]()}),e&&(E[e]=i),t&&(E[t[0]]=function(){return U(i.apply(this,arguments),t[1],t[2])}),n&&(E[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function A(e,t){return e.isValid()?(t=j(t,e.localeData()),V[t]=V[t]||function(s){var e,i,t,r=s.match(N);for(e=0,i=r.length;e<i;e++)E[r[e]]?r[e]=E[r[e]]:r[e]=(t=r[e]).match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"");return function(e){var t,n="";for(t=0;t<i;t++)n+=x(r[t])?r[t].call(e,s):r[t];return n}}(t),V[t](e)):e.localeData().invalidDate()}function j(e,t){var n=5;function s(e){return t.longDateFormat(e)||e}for(G.lastIndex=0;0<=n&&G.test(e);)e=e.replace(G,s),G.lastIndex=0,n-=1;return e}var Z=/\d/,z=/\d\d/,$=/\d{3}/,q=/\d{4}/,J=/[+-]?\d{6}/,B=/\d\d?/,Q=/\d\d\d\d?/,X=/\d\d\d\d\d\d?/,K=/\d{1,3}/,ee=/\d{1,4}/,te=/[+-]?\d{1,6}/,ne=/\d+/,se=/[+-]?\d+/,ie=/Z|[+-]\d\d:?\d\d/gi,re=/Z|[+-]\d\d(?::?\d\d)?/gi,ae=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,oe={};function ue(e,n,s){oe[e]=x(n)?n:function(e,t){return e&&s?s:n}}function le(e,t){return m(oe,e)?oe[e](t._strict,t._locale):new RegExp(de(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,s,i){return t||n||s||i})))}function de(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var he={};function ce(e,n){var t,s=n;for("string"==typeof e&&(e=[e]),d(n)&&(s=function(e,t){t[n]=k(e)}),t=0;t<e.length;t++)he[e[t]]=s}function fe(e,i){ce(e,function(e,t,n,s){n._w=n._w||{},i(e,n._w,n,s)})}var me=0,_e=1,ye=2,ge=3,pe=4,ve=5,we=6,Me=7,Se=8;function De(e){return ke(e)?366:365}function ke(e){return e%4==0&&e%100!=0||e%400==0}I("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),I(0,["YY",2],0,function(){return this.year()%100}),I(0,["YYYY",4],0,"year"),I(0,["YYYYY",5],0,"year"),I(0,["YYYYYY",6,!0],0,"year"),H("year","y"),L("year",1),ue("Y",se),ue("YY",B,z),ue("YYYY",ee,q),ue("YYYYY",te,J),ue("YYYYYY",te,J),ce(["YYYYY","YYYYYY"],me),ce("YYYY",function(e,t){t[me]=2===e.length?c.parseTwoDigitYear(e):k(e)}),ce("YY",function(e,t){t[me]=c.parseTwoDigitYear(e)}),ce("Y",function(e,t){t[me]=parseInt(e,10)}),c.parseTwoDigitYear=function(e){return k(e)+(68<k(e)?1900:2e3)};var Ye,Oe=Te("FullYear",!0);function Te(t,n){return function(e){return null!=e?(be(this,t,e),c.updateOffset(this,n),this):xe(this,t)}}function xe(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function be(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&ke(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),Pe(n,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](n))}function Pe(e,t){if(isNaN(e)||isNaN(t))return NaN;var n,s=(t%(n=12)+n)%n;return e+=(t-s)/12,1===s?ke(e)?29:28:31-s%7%2}Ye=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},I("M",["MM",2],"Mo",function(){return this.month()+1}),I("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),I("MMMM",0,0,function(e){return this.localeData().months(this,e)}),H("month","M"),L("month",8),ue("M",B),ue("MM",B,z),ue("MMM",function(e,t){return t.monthsShortRegex(e)}),ue("MMMM",function(e,t){return t.monthsRegex(e)}),ce(["M","MM"],function(e,t){t[_e]=k(e)-1}),ce(["MMM","MMMM"],function(e,t,n,s){var i=n._locale.monthsParse(e,s,n._strict);null!=i?t[_e]=i:g(n).invalidMonth=e});var We=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,He="January_February_March_April_May_June_July_August_September_October_November_December".split("_");var Re="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Ce(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=k(t);else if(!d(t=e.localeData().monthsParse(t)))return e;return n=Math.min(e.date(),Pe(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function Fe(e){return null!=e?(Ce(this,e),c.updateOffset(this,!0),this):xe(this,"Month")}var Le=ae;var Ue=ae;function Ne(){function e(e,t){return t.length-e.length}var t,n,s=[],i=[],r=[];for(t=0;t<12;t++)n=y([2e3,t]),s.push(this.monthsShort(n,"")),i.push(this.months(n,"")),r.push(this.months(n,"")),r.push(this.monthsShort(n,""));for(s.sort(e),i.sort(e),r.sort(e),t=0;t<12;t++)s[t]=de(s[t]),i[t]=de(i[t]);for(t=0;t<24;t++)r[t]=de(r[t]);this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Ge(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&0<=e&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function Ve(e,t,n){var s=7+t-n;return-((7+Ge(e,0,s).getUTCDay()-t)%7)+s-1}function Ee(e,t,n,s,i){var r,a,o=1+7*(t-1)+(7+n-s)%7+Ve(e,s,i);return o<=0?a=De(r=e-1)+o:o>De(e)?(r=e+1,a=o-De(e)):(r=e,a=o),{year:r,dayOfYear:a}}function Ie(e,t,n){var s,i,r=Ve(e.year(),t,n),a=Math.floor((e.dayOfYear()-r-1)/7)+1;return a<1?s=a+Ae(i=e.year()-1,t,n):a>Ae(e.year(),t,n)?(s=a-Ae(e.year(),t,n),i=e.year()+1):(i=e.year(),s=a),{week:s,year:i}}function Ae(e,t,n){var s=Ve(e,t,n),i=Ve(e+1,t,n);return(De(e)-s+i)/7}I("w",["ww",2],"wo","week"),I("W",["WW",2],"Wo","isoWeek"),H("week","w"),H("isoWeek","W"),L("week",5),L("isoWeek",5),ue("w",B),ue("ww",B,z),ue("W",B),ue("WW",B,z),fe(["w","ww","W","WW"],function(e,t,n,s){t[s.substr(0,1)]=k(e)});I("d",0,"do","day"),I("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),I("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),I("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),I("e",0,0,"weekday"),I("E",0,0,"isoWeekday"),H("day","d"),H("weekday","e"),H("isoWeekday","E"),L("day",11),L("weekday",11),L("isoWeekday",11),ue("d",B),ue("e",B),ue("E",B),ue("dd",function(e,t){return t.weekdaysMinRegex(e)}),ue("ddd",function(e,t){return t.weekdaysShortRegex(e)}),ue("dddd",function(e,t){return t.weekdaysRegex(e)}),fe(["dd","ddd","dddd"],function(e,t,n,s){var i=n._locale.weekdaysParse(e,s,n._strict);null!=i?t.d=i:g(n).invalidWeekday=e}),fe(["d","e","E"],function(e,t,n,s){t[s]=k(e)});var je="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");var Ze="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");var ze="Su_Mo_Tu_We_Th_Fr_Sa".split("_");var $e=ae;var qe=ae;var Je=ae;function Be(){function e(e,t){return t.length-e.length}var t,n,s,i,r,a=[],o=[],u=[],l=[];for(t=0;t<7;t++)n=y([2e3,1]).day(t),s=this.weekdaysMin(n,""),i=this.weekdaysShort(n,""),r=this.weekdays(n,""),a.push(s),o.push(i),u.push(r),l.push(s),l.push(i),l.push(r);for(a.sort(e),o.sort(e),u.sort(e),l.sort(e),t=0;t<7;t++)o[t]=de(o[t]),u[t]=de(u[t]),l[t]=de(l[t]);this._weekdaysRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function Qe(){return this.hours()%12||12}function Xe(e,t){I(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Ke(e,t){return t._meridiemParse}I("H",["HH",2],0,"hour"),I("h",["hh",2],0,Qe),I("k",["kk",2],0,function(){return this.hours()||24}),I("hmm",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)}),I("hmmss",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)+U(this.seconds(),2)}),I("Hmm",0,0,function(){return""+this.hours()+U(this.minutes(),2)}),I("Hmmss",0,0,function(){return""+this.hours()+U(this.minutes(),2)+U(this.seconds(),2)}),Xe("a",!0),Xe("A",!1),H("hour","h"),L("hour",13),ue("a",Ke),ue("A",Ke),ue("H",B),ue("h",B),ue("k",B),ue("HH",B,z),ue("hh",B,z),ue("kk",B,z),ue("hmm",Q),ue("hmmss",X),ue("Hmm",Q),ue("Hmmss",X),ce(["H","HH"],ge),ce(["k","kk"],function(e,t,n){var s=k(e);t[ge]=24===s?0:s}),ce(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),ce(["h","hh"],function(e,t,n){t[ge]=k(e),g(n).bigHour=!0}),ce("hmm",function(e,t,n){var s=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s)),g(n).bigHour=!0}),ce("hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s,2)),t[ve]=k(e.substr(i)),g(n).bigHour=!0}),ce("Hmm",function(e,t,n){var s=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s))}),ce("Hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s,2)),t[ve]=k(e.substr(i))});var et,tt=Te("Hours",!0),nt={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:He,monthsShort:Re,week:{dow:0,doy:6},weekdays:je,weekdaysMin:ze,weekdaysShort:Ze,meridiemParse:/[ap]\.?m?\.?/i},st={},it={};function rt(e){return e?e.toLowerCase().replace("_","-"):e}function at(e){var t=null;if(!st[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=et._abbr,require("./locale/"+e),ot(t)}catch(e){}return st[e]}function ot(e,t){var n;return e&&((n=l(t)?lt(e):ut(e,t))?et=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),et._abbr}function ut(e,t){if(null!==t){var n,s=nt;if(t.abbr=e,null!=st[e])T("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=st[e]._config;else if(null!=t.parentLocale)if(null!=st[t.parentLocale])s=st[t.parentLocale]._config;else{if(null==(n=at(t.parentLocale)))return it[t.parentLocale]||(it[t.parentLocale]=[]),it[t.parentLocale].push({name:e,config:t}),null;s=n._config}return st[e]=new P(b(s,t)),it[e]&&it[e].forEach(function(e){ut(e.name,e.config)}),ot(e),st[e]}return delete st[e],null}function lt(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return et;if(!o(e)){if(t=at(e))return t;e=[e]}return function(e){for(var t,n,s,i,r=0;r<e.length;){for(t=(i=rt(e[r]).split("-")).length,n=(n=rt(e[r+1]))?n.split("-"):null;0<t;){if(s=at(i.slice(0,t).join("-")))return s;if(n&&n.length>=t&&a(i,n,!0)>=t-1)break;t--}r++}return et}(e)}function dt(e){var t,n=e._a;return n&&-2===g(e).overflow&&(t=n[_e]<0||11<n[_e]?_e:n[ye]<1||n[ye]>Pe(n[me],n[_e])?ye:n[ge]<0||24<n[ge]||24===n[ge]&&(0!==n[pe]||0!==n[ve]||0!==n[we])?ge:n[pe]<0||59<n[pe]?pe:n[ve]<0||59<n[ve]?ve:n[we]<0||999<n[we]?we:-1,g(e)._overflowDayOfYear&&(t<me||ye<t)&&(t=ye),g(e)._overflowWeeks&&-1===t&&(t=Me),g(e)._overflowWeekday&&-1===t&&(t=Se),g(e).overflow=t),e}function ht(e,t,n){return null!=e?e:null!=t?t:n}function ct(e){var t,n,s,i,r,a=[];if(!e._d){var o,u;for(o=e,u=new Date(c.now()),s=o._useUTC?[u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()]:[u.getFullYear(),u.getMonth(),u.getDate()],e._w&&null==e._a[ye]&&null==e._a[_e]&&function(e){var t,n,s,i,r,a,o,u;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)r=1,a=4,n=ht(t.GG,e._a[me],Ie(Tt(),1,4).year),s=ht(t.W,1),((i=ht(t.E,1))<1||7<i)&&(u=!0);else{r=e._locale._week.dow,a=e._locale._week.doy;var l=Ie(Tt(),r,a);n=ht(t.gg,e._a[me],l.year),s=ht(t.w,l.week),null!=t.d?((i=t.d)<0||6<i)&&(u=!0):null!=t.e?(i=t.e+r,(t.e<0||6<t.e)&&(u=!0)):i=r}s<1||s>Ae(n,r,a)?g(e)._overflowWeeks=!0:null!=u?g(e)._overflowWeekday=!0:(o=Ee(n,s,i,r,a),e._a[me]=o.year,e._dayOfYear=o.dayOfYear)}(e),null!=e._dayOfYear&&(r=ht(e._a[me],s[me]),(e._dayOfYear>De(r)||0===e._dayOfYear)&&(g(e)._overflowDayOfYear=!0),n=Ge(r,0,e._dayOfYear),e._a[_e]=n.getUTCMonth(),e._a[ye]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=a[t]=s[t];for(;t<7;t++)e._a[t]=a[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[ge]&&0===e._a[pe]&&0===e._a[ve]&&0===e._a[we]&&(e._nextDay=!0,e._a[ge]=0),e._d=(e._useUTC?Ge:function(e,t,n,s,i,r,a){var o=new Date(e,t,n,s,i,r,a);return e<100&&0<=e&&isFinite(o.getFullYear())&&o.setFullYear(e),o}).apply(null,a),i=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[ge]=24),e._w&&void 0!==e._w.d&&e._w.d!==i&&(g(e).weekdayMismatch=!0)}}var ft=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,mt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,_t=/Z|[+-]\d\d(?::?\d\d)?/,yt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],gt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],pt=/^\/?Date\((\-?\d+)/i;function vt(e){var t,n,s,i,r,a,o=e._i,u=ft.exec(o)||mt.exec(o);if(u){for(g(e).iso=!0,t=0,n=yt.length;t<n;t++)if(yt[t][1].exec(u[1])){i=yt[t][0],s=!1!==yt[t][2];break}if(null==i)return void(e._isValid=!1);if(u[3]){for(t=0,n=gt.length;t<n;t++)if(gt[t][1].exec(u[3])){r=(u[2]||" ")+gt[t][0];break}if(null==r)return void(e._isValid=!1)}if(!s&&null!=r)return void(e._isValid=!1);if(u[4]){if(!_t.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(r||"")+(a||""),kt(e)}else e._isValid=!1}var wt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function Mt(e,t,n,s,i,r){var a=[function(e){var t=parseInt(e,10);{if(t<=49)return 2e3+t;if(t<=999)return 1900+t}return t}(e),Re.indexOf(t),parseInt(n,10),parseInt(s,10),parseInt(i,10)];return r&&a.push(parseInt(r,10)),a}var St={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Dt(e){var t,n,s,i=wt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim());if(i){var r=Mt(i[4],i[3],i[2],i[5],i[6],i[7]);if(t=i[1],n=r,s=e,t&&Ze.indexOf(t)!==new Date(n[0],n[1],n[2]).getDay()&&(g(s).weekdayMismatch=!0,!(s._isValid=!1)))return;e._a=r,e._tzm=function(e,t,n){if(e)return St[e];if(t)return 0;var s=parseInt(n,10),i=s%100;return(s-i)/100*60+i}(i[8],i[9],i[10]),e._d=Ge.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),g(e).rfc2822=!0}else e._isValid=!1}function kt(e){if(e._f!==c.ISO_8601)if(e._f!==c.RFC_2822){e._a=[],g(e).empty=!0;var t,n,s,i,r,a,o,u,l=""+e._i,d=l.length,h=0;for(s=j(e._f,e._locale).match(N)||[],t=0;t<s.length;t++)i=s[t],(n=(l.match(le(i,e))||[])[0])&&(0<(r=l.substr(0,l.indexOf(n))).length&&g(e).unusedInput.push(r),l=l.slice(l.indexOf(n)+n.length),h+=n.length),E[i]?(n?g(e).empty=!1:g(e).unusedTokens.push(i),a=i,u=e,null!=(o=n)&&m(he,a)&&he[a](o,u._a,u,a)):e._strict&&!n&&g(e).unusedTokens.push(i);g(e).charsLeftOver=d-h,0<l.length&&g(e).unusedInput.push(l),e._a[ge]<=12&&!0===g(e).bigHour&&0<e._a[ge]&&(g(e).bigHour=void 0),g(e).parsedDateParts=e._a.slice(0),g(e).meridiem=e._meridiem,e._a[ge]=function(e,t,n){var s;if(null==n)return t;return null!=e.meridiemHour?e.meridiemHour(t,n):(null!=e.isPM&&((s=e.isPM(n))&&t<12&&(t+=12),s||12!==t||(t=0)),t)}(e._locale,e._a[ge],e._meridiem),ct(e),dt(e)}else Dt(e);else vt(e)}function Yt(e){var t,n,s,i,r=e._i,a=e._f;return e._locale=e._locale||lt(e._l),null===r||void 0===a&&""===r?v({nullInput:!0}):("string"==typeof r&&(e._i=r=e._locale.preparse(r)),S(r)?new M(dt(r)):(h(r)?e._d=r:o(a)?function(e){var t,n,s,i,r;if(0===e._f.length)return g(e).invalidFormat=!0,e._d=new Date(NaN);for(i=0;i<e._f.length;i++)r=0,t=w({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],kt(t),p(t)&&(r+=g(t).charsLeftOver,r+=10*g(t).unusedTokens.length,g(t).score=r,(null==s||r<s)&&(s=r,n=t));_(e,n||t)}(e):a?kt(e):l(n=(t=e)._i)?t._d=new Date(c.now()):h(n)?t._d=new Date(n.valueOf()):"string"==typeof n?(s=t,null===(i=pt.exec(s._i))?(vt(s),!1===s._isValid&&(delete s._isValid,Dt(s),!1===s._isValid&&(delete s._isValid,c.createFromInputFallback(s)))):s._d=new Date(+i[1])):o(n)?(t._a=f(n.slice(0),function(e){return parseInt(e,10)}),ct(t)):u(n)?function(e){if(!e._d){var t=C(e._i);e._a=f([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ct(e)}}(t):d(n)?t._d=new Date(n):c.createFromInputFallback(t),p(e)||(e._d=null),e))}function Ot(e,t,n,s,i){var r,a={};return!0!==n&&!1!==n||(s=n,n=void 0),(u(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||o(e)&&0===e.length)&&(e=void 0),a._isAMomentObject=!0,a._useUTC=a._isUTC=i,a._l=n,a._i=e,a._f=t,a._strict=s,(r=new M(dt(Yt(a))))._nextDay&&(r.add(1,"d"),r._nextDay=void 0),r}function Tt(e,t,n,s){return Ot(e,t,n,s,!1)}c.createFromInputFallback=n("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),c.ISO_8601=function(){},c.RFC_2822=function(){};var xt=n("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:v()}),bt=n("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:v()});function Pt(e,t){var n,s;if(1===t.length&&o(t[0])&&(t=t[0]),!t.length)return Tt();for(n=t[0],s=1;s<t.length;++s)t[s].isValid()&&!t[s][e](n)||(n=t[s]);return n}var Wt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ht(e){var t=C(e),n=t.year||0,s=t.quarter||0,i=t.month||0,r=t.week||0,a=t.day||0,o=t.hour||0,u=t.minute||0,l=t.second||0,d=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===Ye.call(Wt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var n=!1,s=0;s<Wt.length;++s)if(e[Wt[s]]){if(n)return!1;parseFloat(e[Wt[s]])!==k(e[Wt[s]])&&(n=!0)}return!0}(t),this._milliseconds=+d+1e3*l+6e4*u+1e3*o*60*60,this._days=+a+7*r,this._months=+i+3*s+12*n,this._data={},this._locale=lt(),this._bubble()}function Rt(e){return e instanceof Ht}function Ct(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ft(e,n){I(e,0,0,function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+U(~~(e/60),2)+n+U(~~e%60,2)})}Ft("Z",":"),Ft("ZZ",""),ue("Z",re),ue("ZZ",re),ce(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Ut(re,e)});var Lt=/([\+\-]|\d\d)/gi;function Ut(e,t){var n=(t||"").match(e);if(null===n)return null;var s=((n[n.length-1]||[])+"").match(Lt)||["-",0,0],i=60*s[1]+k(s[2]);return 0===i?0:"+"===s[0]?i:-i}function Nt(e,t){var n,s;return t._isUTC?(n=t.clone(),s=(S(e)||h(e)?e.valueOf():Tt(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+s),c.updateOffset(n,!1),n):Tt(e).local()}function Gt(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Vt(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}c.updateOffset=function(){};var Et=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,It=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function At(e,t){var n,s,i,r=e,a=null;return Rt(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:d(e)?(r={},t?r[t]=e:r.milliseconds=e):(a=Et.exec(e))?(n="-"===a[1]?-1:1,r={y:0,d:k(a[ye])*n,h:k(a[ge])*n,m:k(a[pe])*n,s:k(a[ve])*n,ms:k(Ct(1e3*a[we]))*n}):(a=It.exec(e))?(n="-"===a[1]?-1:(a[1],1),r={y:jt(a[2],n),M:jt(a[3],n),w:jt(a[4],n),d:jt(a[5],n),h:jt(a[6],n),m:jt(a[7],n),s:jt(a[8],n)}):null==r?r={}:"object"==typeof r&&("from"in r||"to"in r)&&(i=function(e,t){var n;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=Nt(t,e),e.isBefore(t)?n=Zt(e,t):((n=Zt(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(Tt(r.from),Tt(r.to)),(r={}).ms=i.milliseconds,r.M=i.months),s=new Ht(r),Rt(e)&&m(e,"_locale")&&(s._locale=e._locale),s}function jt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Zt(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function zt(s,i){return function(e,t){var n;return null===t||isNaN(+t)||(T(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+i+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=e,e=t,t=n),$t(this,At(e="string"==typeof e?+e:e,t),s),this}}function $t(e,t,n,s){var i=t._milliseconds,r=Ct(t._days),a=Ct(t._months);e.isValid()&&(s=null==s||s,a&&Ce(e,xe(e,"Month")+a*n),r&&be(e,"Date",xe(e,"Date")+r*n),i&&e._d.setTime(e._d.valueOf()+i*n),s&&c.updateOffset(e,r||a))}At.fn=Ht.prototype,At.invalid=function(){return At(NaN)};var qt=zt(1,"add"),Jt=zt(-1,"subtract");function Bt(e,t){var n=12*(t.year()-e.year())+(t.month()-e.month()),s=e.clone().add(n,"months");return-(n+(t-s<0?(t-s)/(s-e.clone().add(n-1,"months")):(t-s)/(e.clone().add(n+1,"months")-s)))||0}function Qt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=lt(e))&&(this._locale=t),this)}c.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",c.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Xt=n("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function Kt(){return this._locale}function en(e,t){I(0,[e,e.length],0,t)}function tn(e,t,n,s,i){var r;return null==e?Ie(this,s,i).year:((r=Ae(e,s,i))<t&&(t=r),function(e,t,n,s,i){var r=Ee(e,t,n,s,i),a=Ge(r.year,0,r.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,n,s,i))}I(0,["gg",2],0,function(){return this.weekYear()%100}),I(0,["GG",2],0,function(){return this.isoWeekYear()%100}),en("gggg","weekYear"),en("ggggg","weekYear"),en("GGGG","isoWeekYear"),en("GGGGG","isoWeekYear"),H("weekYear","gg"),H("isoWeekYear","GG"),L("weekYear",1),L("isoWeekYear",1),ue("G",se),ue("g",se),ue("GG",B,z),ue("gg",B,z),ue("GGGG",ee,q),ue("gggg",ee,q),ue("GGGGG",te,J),ue("ggggg",te,J),fe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,s){t[s.substr(0,2)]=k(e)}),fe(["gg","GG"],function(e,t,n,s){t[s]=c.parseTwoDigitYear(e)}),I("Q",0,"Qo","quarter"),H("quarter","Q"),L("quarter",7),ue("Q",Z),ce("Q",function(e,t){t[_e]=3*(k(e)-1)}),I("D",["DD",2],"Do","date"),H("date","D"),L("date",9),ue("D",B),ue("DD",B,z),ue("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),ce(["D","DD"],ye),ce("Do",function(e,t){t[ye]=k(e.match(B)[0])});var nn=Te("Date",!0);I("DDD",["DDDD",3],"DDDo","dayOfYear"),H("dayOfYear","DDD"),L("dayOfYear",4),ue("DDD",K),ue("DDDD",$),ce(["DDD","DDDD"],function(e,t,n){n._dayOfYear=k(e)}),I("m",["mm",2],0,"minute"),H("minute","m"),L("minute",14),ue("m",B),ue("mm",B,z),ce(["m","mm"],pe);var sn=Te("Minutes",!1);I("s",["ss",2],0,"second"),H("second","s"),L("second",15),ue("s",B),ue("ss",B,z),ce(["s","ss"],ve);var rn,an=Te("Seconds",!1);for(I("S",0,0,function(){return~~(this.millisecond()/100)}),I(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),I(0,["SSS",3],0,"millisecond"),I(0,["SSSS",4],0,function(){return 10*this.millisecond()}),I(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),I(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),I(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),I(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),I(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),H("millisecond","ms"),L("millisecond",16),ue("S",K,Z),ue("SS",K,z),ue("SSS",K,$),rn="SSSS";rn.length<=9;rn+="S")ue(rn,ne);function on(e,t){t[we]=k(1e3*("0."+e))}for(rn="S";rn.length<=9;rn+="S")ce(rn,on);var un=Te("Milliseconds",!1);I("z",0,0,"zoneAbbr"),I("zz",0,0,"zoneName");var ln=M.prototype;function dn(e){return e}ln.add=qt,ln.calendar=function(e,t){var n=e||Tt(),s=Nt(n,this).startOf("day"),i=c.calendarFormat(this,s)||"sameElse",r=t&&(x(t[i])?t[i].call(this,n):t[i]);return this.format(r||this.localeData().calendar(i,this,Tt(n)))},ln.clone=function(){return new M(this)},ln.diff=function(e,t,n){var s,i,r;if(!this.isValid())return NaN;if(!(s=Nt(e,this)).isValid())return NaN;switch(i=6e4*(s.utcOffset()-this.utcOffset()),t=R(t)){case"year":r=Bt(this,s)/12;break;case"month":r=Bt(this,s);break;case"quarter":r=Bt(this,s)/3;break;case"second":r=(this-s)/1e3;break;case"minute":r=(this-s)/6e4;break;case"hour":r=(this-s)/36e5;break;case"day":r=(this-s-i)/864e5;break;case"week":r=(this-s-i)/6048e5;break;default:r=this-s}return n?r:D(r)},ln.endOf=function(e){return void 0===(e=R(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},ln.format=function(e){e||(e=this.isUtc()?c.defaultFormatUtc:c.defaultFormat);var t=A(this,e);return this.localeData().postformat(t)},ln.from=function(e,t){return this.isValid()&&(S(e)&&e.isValid()||Tt(e).isValid())?At({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.fromNow=function(e){return this.from(Tt(),e)},ln.to=function(e,t){return this.isValid()&&(S(e)&&e.isValid()||Tt(e).isValid())?At({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.toNow=function(e){return this.to(Tt(),e)},ln.get=function(e){return x(this[e=R(e)])?this[e]():this},ln.invalidAt=function(){return g(this).overflow},ln.isAfter=function(e,t){var n=S(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(l(t)?"millisecond":t))?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},ln.isBefore=function(e,t){var n=S(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(l(t)?"millisecond":t))?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},ln.isBetween=function(e,t,n,s){return("("===(s=s||"()")[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===s[1]?this.isBefore(t,n):!this.isAfter(t,n))},ln.isSame=function(e,t){var n,s=S(e)?e:Tt(e);return!(!this.isValid()||!s.isValid())&&("millisecond"===(t=R(t||"millisecond"))?this.valueOf()===s.valueOf():(n=s.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},ln.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},ln.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},ln.isValid=function(){return p(this)},ln.lang=Xt,ln.locale=Qt,ln.localeData=Kt,ln.max=bt,ln.min=xt,ln.parsingFlags=function(){return _({},g(this))},ln.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t=[];for(var n in e)t.push({unit:n,priority:F[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=C(e)),s=0;s<n.length;s++)this[n[s].unit](e[n[s].unit]);else if(x(this[e=R(e)]))return this[e](t);return this},ln.startOf=function(e){switch(e=R(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},ln.subtract=Jt,ln.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},ln.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},ln.toDate=function(){return new Date(this.valueOf())},ln.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||9999<n.year()?A(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):x(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",A(n,"Z")):A(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},ln.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var n="["+e+'("]',s=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i=t+'[")]';return this.format(n+s+"-MM-DD[T]HH:mm:ss.SSS"+i)},ln.toJSON=function(){return this.isValid()?this.toISOString():null},ln.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},ln.unix=function(){return Math.floor(this.valueOf()/1e3)},ln.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},ln.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},ln.year=Oe,ln.isLeapYear=function(){return ke(this.year())},ln.weekYear=function(e){return tn.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},ln.isoWeekYear=function(e){return tn.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},ln.quarter=ln.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},ln.month=Fe,ln.daysInMonth=function(){return Pe(this.year(),this.month())},ln.week=ln.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},ln.isoWeek=ln.isoWeeks=function(e){var t=Ie(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},ln.weeksInYear=function(){var e=this.localeData()._week;return Ae(this.year(),e.dow,e.doy)},ln.isoWeeksInYear=function(){return Ae(this.year(),1,4)},ln.date=nn,ln.day=ln.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,s=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=n.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-s,"d")):s},ln.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},ln.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=(n=e,s=this.localeData(),"string"==typeof n?s.weekdaysParse(n)%7||7:isNaN(n)?null:n);return this.day(this.day()%7?t:t-7)}return this.day()||7;var n,s},ln.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},ln.hour=ln.hours=tt,ln.minute=ln.minutes=sn,ln.second=ln.seconds=an,ln.millisecond=ln.milliseconds=un,ln.utcOffset=function(e,t,n){var s,i=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=Ut(re,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(s=Gt(this)),this._offset=e,this._isUTC=!0,null!=s&&this.add(s,"m"),i!==e&&(!t||this._changeInProgress?$t(this,At(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,c.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?i:Gt(this)},ln.utc=function(e){return this.utcOffset(0,e)},ln.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Gt(this),"m")),this},ln.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Ut(ie,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},ln.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Tt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},ln.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},ln.isLocal=function(){return!!this.isValid()&&!this._isUTC},ln.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},ln.isUtc=Vt,ln.isUTC=Vt,ln.zoneAbbr=function(){return this._isUTC?"UTC":""},ln.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},ln.dates=n("dates accessor is deprecated. Use date instead.",nn),ln.months=n("months accessor is deprecated. Use month instead",Fe),ln.years=n("years accessor is deprecated. Use year instead",Oe),ln.zone=n("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),ln.isDSTShifted=n("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!l(this._isDSTShifted))return this._isDSTShifted;var e={};if(w(e,this),(e=Yt(e))._a){var t=e._isUTC?y(e._a):Tt(e._a);this._isDSTShifted=this.isValid()&&0<a(e._a,t.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var hn=P.prototype;function cn(e,t,n,s){var i=lt(),r=y().set(s,t);return i[n](r,e)}function fn(e,t,n){if(d(e)&&(t=e,e=void 0),e=e||"",null!=t)return cn(e,t,n,"month");var s,i=[];for(s=0;s<12;s++)i[s]=cn(e,s,n,"month");return i}function mn(e,t,n,s){"boolean"==typeof e?d(t)&&(n=t,t=void 0):(t=e,e=!1,d(n=t)&&(n=t,t=void 0)),t=t||"";var i,r=lt(),a=e?r._week.dow:0;if(null!=n)return cn(t,(n+a)%7,s,"day");var o=[];for(i=0;i<7;i++)o[i]=cn(t,(i+a)%7,s,"day");return o}hn.calendar=function(e,t,n){var s=this._calendar[e]||this._calendar.sameElse;return x(s)?s.call(t,n):s},hn.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},hn.invalidDate=function(){return this._invalidDate},hn.ordinal=function(e){return this._ordinal.replace("%d",e)},hn.preparse=dn,hn.postformat=dn,hn.relativeTime=function(e,t,n,s){var i=this._relativeTime[n];return x(i)?i(e,t,n,s):i.replace(/%d/i,e)},hn.pastFuture=function(e,t){var n=this._relativeTime[0<e?"future":"past"];return x(n)?n(t):n.replace(/%s/i,t)},hn.set=function(e){var t,n;for(n in e)x(t=e[n])?this[n]=t:this["_"+n]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},hn.months=function(e,t){return e?o(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||We).test(t)?"format":"standalone"][e.month()]:o(this._months)?this._months:this._months.standalone},hn.monthsShort=function(e,t){return e?o(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[We.test(t)?"format":"standalone"][e.month()]:o(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},hn.monthsParse=function(e,t,n){var s,i,r;if(this._monthsParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)r=y([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:-1!==(i=Ye.call(this._shortMonthsParse,a))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(i=y([2e3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[s]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},hn.monthsRegex=function(e){return this._monthsParseExact?(m(this,"_monthsRegex")||Ne.call(this),e?this._monthsStrictRegex:this._monthsRegex):(m(this,"_monthsRegex")||(this._monthsRegex=Ue),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},hn.monthsShortRegex=function(e){return this._monthsParseExact?(m(this,"_monthsRegex")||Ne.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(m(this,"_monthsShortRegex")||(this._monthsShortRegex=Le),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},hn.week=function(e){return Ie(e,this._week.dow,this._week.doy).week},hn.firstDayOfYear=function(){return this._week.doy},hn.firstDayOfWeek=function(){return this._week.dow},hn.weekdays=function(e,t){return e?o(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]:o(this._weekdays)?this._weekdays:this._weekdays.standalone},hn.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},hn.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},hn.weekdaysParse=function(e,t,n){var s,i,r;if(this._weekdaysParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)r=y([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(i=y([2e3,1]).day(s),n&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(i,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(i,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(i,"").replace(".",".?")+"$","i")),this._weekdaysParse[s]||(r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[s]=new RegExp(r.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[s].test(e))return s;if(n&&"ddd"===t&&this._shortWeekdaysParse[s].test(e))return s;if(n&&"dd"===t&&this._minWeekdaysParse[s].test(e))return s;if(!n&&this._weekdaysParse[s].test(e))return s}},hn.weekdaysRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(m(this,"_weekdaysRegex")||(this._weekdaysRegex=$e),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},hn.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(m(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=qe),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},hn.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(m(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Je),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},hn.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},hn.meridiem=function(e,t,n){return 11<e?n?"pm":"PM":n?"am":"AM"},ot("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===k(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),c.lang=n("moment.lang is deprecated. Use moment.locale instead.",ot),c.langData=n("moment.langData is deprecated. Use moment.localeData instead.",lt);var _n=Math.abs;function yn(e,t,n,s){var i=At(t,n);return e._milliseconds+=s*i._milliseconds,e._days+=s*i._days,e._months+=s*i._months,e._bubble()}function gn(e){return e<0?Math.floor(e):Math.ceil(e)}function pn(e){return 4800*e/146097}function vn(e){return 146097*e/4800}function wn(e){return function(){return this.as(e)}}var Mn=wn("ms"),Sn=wn("s"),Dn=wn("m"),kn=wn("h"),Yn=wn("d"),On=wn("w"),Tn=wn("M"),xn=wn("y");function bn(e){return function(){return this.isValid()?this._data[e]:NaN}}var Pn=bn("milliseconds"),Wn=bn("seconds"),Hn=bn("minutes"),Rn=bn("hours"),Cn=bn("days"),Fn=bn("months"),Ln=bn("years");var Un=Math.round,Nn={ss:44,s:45,m:45,h:22,d:26,M:11};var Gn=Math.abs;function Vn(e){return(0<e)-(e<0)||+e}function En(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n=Gn(this._milliseconds)/1e3,s=Gn(this._days),i=Gn(this._months);t=D((e=D(n/60))/60),n%=60,e%=60;var r=D(i/12),a=i%=12,o=s,u=t,l=e,d=n?n.toFixed(3).replace(/\.?0+$/,""):"",h=this.asSeconds();if(!h)return"P0D";var c=h<0?"-":"",f=Vn(this._months)!==Vn(h)?"-":"",m=Vn(this._days)!==Vn(h)?"-":"",_=Vn(this._milliseconds)!==Vn(h)?"-":"";return c+"P"+(r?f+r+"Y":"")+(a?f+a+"M":"")+(o?m+o+"D":"")+(u||l||d?"T":"")+(u?_+u+"H":"")+(l?_+l+"M":"")+(d?_+d+"S":"")}var In=Ht.prototype;return In.isValid=function(){return this._isValid},In.abs=function(){var e=this._data;return this._milliseconds=_n(this._milliseconds),this._days=_n(this._days),this._months=_n(this._months),e.milliseconds=_n(e.milliseconds),e.seconds=_n(e.seconds),e.minutes=_n(e.minutes),e.hours=_n(e.hours),e.months=_n(e.months),e.years=_n(e.years),this},In.add=function(e,t){return yn(this,e,t,1)},In.subtract=function(e,t){return yn(this,e,t,-1)},In.as=function(e){if(!this.isValid())return NaN;var t,n,s=this._milliseconds;if("month"===(e=R(e))||"year"===e)return t=this._days+s/864e5,n=this._months+pn(t),"month"===e?n:n/12;switch(t=this._days+Math.round(vn(this._months)),e){case"week":return t/7+s/6048e5;case"day":return t+s/864e5;case"hour":return 24*t+s/36e5;case"minute":return 1440*t+s/6e4;case"second":return 86400*t+s/1e3;case"millisecond":return Math.floor(864e5*t)+s;default:throw new Error("Unknown unit "+e)}},In.asMilliseconds=Mn,In.asSeconds=Sn,In.asMinutes=Dn,In.asHours=kn,In.asDays=Yn,In.asWeeks=On,In.asMonths=Tn,In.asYears=xn,In.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*k(this._months/12):NaN},In._bubble=function(){var e,t,n,s,i,r=this._milliseconds,a=this._days,o=this._months,u=this._data;return 0<=r&&0<=a&&0<=o||r<=0&&a<=0&&o<=0||(r+=864e5*gn(vn(o)+a),o=a=0),u.milliseconds=r%1e3,e=D(r/1e3),u.seconds=e%60,t=D(e/60),u.minutes=t%60,n=D(t/60),u.hours=n%24,o+=i=D(pn(a+=D(n/24))),a-=gn(vn(i)),s=D(o/12),o%=12,u.days=a,u.months=o,u.years=s,this},In.clone=function(){return At(this)},In.get=function(e){return e=R(e),this.isValid()?this[e+"s"]():NaN},In.milliseconds=Pn,In.seconds=Wn,In.minutes=Hn,In.hours=Rn,In.days=Cn,In.weeks=function(){return D(this.days()/7)},In.months=Fn,In.years=Ln,In.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,n,s,i,r,a,o,u,l,d,h,c=this.localeData(),f=(n=!e,s=c,i=At(t=this).abs(),r=Un(i.as("s")),a=Un(i.as("m")),o=Un(i.as("h")),u=Un(i.as("d")),l=Un(i.as("M")),d=Un(i.as("y")),(h=r<=Nn.ss&&["s",r]||r<Nn.s&&["ss",r]||a<=1&&["m"]||a<Nn.m&&["mm",a]||o<=1&&["h"]||o<Nn.h&&["hh",o]||u<=1&&["d"]||u<Nn.d&&["dd",u]||l<=1&&["M"]||l<Nn.M&&["MM",l]||d<=1&&["y"]||["yy",d])[2]=n,h[3]=0<+t,h[4]=s,function(e,t,n,s,i){return i.relativeTime(t||1,!!n,e,s)}.apply(null,h));return e&&(f=c.pastFuture(+this,f)),c.postformat(f)},In.toISOString=En,In.toString=En,In.toJSON=En,In.locale=Qt,In.localeData=Kt,In.toIsoString=n("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",En),In.lang=Xt,I("X",0,0,"unix"),I("x",0,0,"valueOf"),ue("x",se),ue("X",/[+-]?\d+(\.\d{1,3})?/),ce("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),ce("x",function(e,t,n){n._d=new Date(k(e))}),c.version="2.22.1",e=Tt,c.fn=ln,c.min=function(){return Pt("isBefore",[].slice.call(arguments,0))},c.max=function(){return Pt("isAfter",[].slice.call(arguments,0))},c.now=function(){return Date.now?Date.now():+new Date},c.utc=y,c.unix=function(e){return Tt(1e3*e)},c.months=function(e,t){return fn(e,t,"months")},c.isDate=h,c.locale=ot,c.invalid=v,c.duration=At,c.isMoment=S,c.weekdays=function(e,t,n){return mn(e,t,n,"weekdays")},c.parseZone=function(){return Tt.apply(null,arguments).parseZone()},c.localeData=lt,c.isDuration=Rt,c.monthsShort=function(e,t){return fn(e,t,"monthsShort")},c.weekdaysMin=function(e,t,n){return mn(e,t,n,"weekdaysMin")},c.defineLocale=ut,c.updateLocale=function(e,t){if(null!=t){var n,s,i=nt;null!=(s=at(e))&&(i=s._config),(n=new P(t=b(i,t))).parentLocale=st[e],st[e]=n,ot(e)}else null!=st[e]&&(null!=st[e].parentLocale?st[e]=st[e].parentLocale:null!=st[e]&&delete st[e]);return st[e]},c.locales=function(){return s(st)},c.weekdaysShort=function(e,t,n){return mn(e,t,n,"weekdaysShort")},c.normalizeUnits=R,c.relativeTimeRounding=function(e){return void 0===e?Un:"function"==typeof e&&(Un=e,!0)},c.relativeTimeThreshold=function(e,t){return void 0!==Nn[e]&&(void 0===t?Nn[e]:(Nn[e]=t,"s"===e&&(Nn.ss=t-1),!0))},c.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},c.prototype=ln,c.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"},c});!function(t,e){"use strict";"object"==typeof module&&module.exports?module.exports=e(require("moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,function(s){"use strict";var e,i={},f={},u={},c={};s&&"string"==typeof s.version||A("Moment Timezone requires Moment.js. See https://momentjs.com/timezone/docs/#/use-it/browser/");var t=s.version.split("."),n=+t[0],o=+t[1];function a(t){return 96<t?t-87:64<t?t-29:t-48}function r(t){var e=0,n=t.split("."),o=n[0],r=n[1]||"",s=1,i=0,f=1;for(45===t.charCodeAt(0)&&(f=-(e=1));e<o.length;e++)i=60*i+a(o.charCodeAt(e));for(e=0;e<r.length;e++)s/=60,i+=a(r.charCodeAt(e))*s;return i*f}function l(t){for(var e=0;e<t.length;e++)t[e]=r(t[e])}function h(t,e){var n,o=[];for(n=0;n<e.length;n++)o[n]=t[e[n]];return o}function p(t){var e=t.split("|"),n=e[2].split(" "),o=e[3].split(""),r=e[4].split(" ");return l(n),l(o),l(r),function(t,e){for(var n=0;n<e;n++)t[n]=Math.round((t[n-1]||0)+6e4*t[n]);t[e-1]=1/0}(r,o.length),{name:e[0],abbrs:h(e[1].split(" "),o),offsets:h(n,o),untils:r,population:0|e[5]}}function m(t){t&&this._set(p(t))}function d(t){var e=t.toTimeString(),n=e.match(/\([a-z ]+\)/i);"GMT"===(n=n&&n[0]?(n=n[0].match(/[A-Z]/g))?n.join(""):void 0:(n=e.match(/[A-Z]{3,5}/g))?n[0]:void 0)&&(n=void 0),this.at=+t,this.abbr=n,this.offset=t.getTimezoneOffset()}function z(t){this.zone=t,this.offsetScore=0,this.abbrScore=0}function v(t,e){for(var n,o;o=6e4*((e.at-t.at)/12e4|0);)(n=new d(new Date(t.at+o))).offset===t.offset?t=n:e=n;return t}function b(t,e){return t.offsetScore!==e.offsetScore?t.offsetScore-e.offsetScore:t.abbrScore!==e.abbrScore?t.abbrScore-e.abbrScore:t.zone.population!==e.zone.population?e.zone.population-t.zone.population:e.zone.name.localeCompare(t.zone.name)}function g(t,e){var n,o;for(l(e),n=0;n<e.length;n++)o=e[n],c[o]=c[o]||{},c[o][t]=!0}function _(){try{var t=Intl.DateTimeFormat().resolvedOptions().timeZone;if(t&&3<t.length){var e=u[w(t)];if(e)return e;A("Moment Timezone found "+t+" from the Intl api, but did not have that data loaded.")}}catch(t){}var n,o,r,s=function(){var t,e,n,o=(new Date).getFullYear()-2,r=new d(new Date(o,0,1)),s=[r];for(n=1;n<48;n++)(e=new d(new Date(o,n,1))).offset!==r.offset&&(t=v(r,e),s.push(t),s.push(new d(new Date(t.at+6e4)))),r=e;for(n=0;n<4;n++)s.push(new d(new Date(o+n,0,1))),s.push(new d(new Date(o+n,6,1)));return s}(),i=s.length,f=function(t){var e,n,o,r=t.length,s={},i=[];for(e=0;e<r;e++)for(n in o=c[t[e].offset]||{})o.hasOwnProperty(n)&&(s[n]=!0);for(e in s)s.hasOwnProperty(e)&&i.push(u[e]);return i}(s),a=[];for(o=0;o<f.length;o++){for(n=new z(O(f[o]),i),r=0;r<i;r++)n.scoreOffsetAt(s[r]);a.push(n)}return a.sort(b),0<a.length?a[0].zone.name:void 0}function w(t){return(t||"").toLowerCase().replace(/\//g,"_")}function y(t){var e,n,o,r;for("string"==typeof t&&(t=[t]),e=0;e<t.length;e++)r=w(n=(o=t[e].split("|"))[0]),i[r]=t[e],u[r]=n,g(r,o[2].split(" "))}function O(t,e){t=w(t);var n,o=i[t];return o instanceof m?o:"string"==typeof o?(o=new m(o),i[t]=o):f[t]&&e!==O&&(n=O(f[t],O))?((o=i[t]=new m)._set(n),o.name=u[t],o):null}function S(t){var e,n,o,r;for("string"==typeof t&&(t=[t]),e=0;e<t.length;e++)o=w((n=t[e].split("|"))[0]),r=w(n[1]),f[o]=r,u[o]=n[0],f[r]=o,u[r]=n[1]}function M(t){var e="X"===t._f||"x"===t._f;return!(!t._a||void 0!==t._tzm||e)}function A(t){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t)}function j(t){var e=Array.prototype.slice.call(arguments,0,-1),n=arguments[arguments.length-1],o=O(n),r=s.utc.apply(null,e);return o&&!s.isMoment(t)&&M(r)&&r.add(o.parse(r),"minutes"),r.tz(n),r}(n<2||2==n&&o<6)&&A("Moment Timezone requires Moment.js >= 2.6.0. You are using Moment.js "+s.version+". See momentjs.com"),m.prototype={_set:function(t){this.name=t.name,this.abbrs=t.abbrs,this.untils=t.untils,this.offsets=t.offsets,this.population=t.population},_index:function(t){var e,n=+t,o=this.untils;for(e=0;e<o.length;e++)if(n<o[e])return e},parse:function(t){var e,n,o,r,s=+t,i=this.offsets,f=this.untils,a=f.length-1;for(r=0;r<a;r++)if(e=i[r],n=i[r+1],o=i[r?r-1:r],e<n&&j.moveAmbiguousForward?e=n:o<e&&j.moveInvalidForward&&(e=o),s<f[r]-6e4*e)return i[r];return i[a]},abbr:function(t){return this.abbrs[this._index(t)]},offset:function(t){return A("zone.offset has been deprecated in favor of zone.utcOffset"),this.offsets[this._index(t)]},utcOffset:function(t){return this.offsets[this._index(t)]}},z.prototype.scoreOffsetAt=function(t){this.offsetScore+=Math.abs(this.zone.utcOffset(t.at)-t.offset),this.zone.abbr(t.at).replace(/[^A-Z]/g,"")!==t.abbr&&this.abbrScore++},j.version="0.5.27",j.dataVersion="",j._zones=i,j._links=f,j._names=u,j.add=y,j.link=S,j.load=function(t){y(t.zones),S(t.links),j.dataVersion=t.version},j.zone=O,j.zoneExists=function t(e){return t.didShowError||(t.didShowError=!0,A("moment.tz.zoneExists('"+e+"') has been deprecated in favor of !moment.tz.zone('"+e+"')")),!!O(e)},j.guess=function(t){return e&&!t||(e=_()),e},j.names=function(){var t,e=[];for(t in u)u.hasOwnProperty(t)&&(i[t]||i[f[t]])&&u[t]&&e.push(u[t]);return e.sort()},j.Zone=m,j.unpack=p,j.unpackBase60=r,j.needsOffset=M,j.moveInvalidForward=!0,j.moveAmbiguousForward=!1;var T,D=s.fn;function x(t){return function(){return this._z?this._z.abbr(this):t.call(this)}}function Z(t){return function(){return this._z=null,t.apply(this,arguments)}}s.tz=j,s.defaultZone=null,s.updateOffset=function(t,e){var n,o=s.defaultZone;if(void 0===t._z&&(o&&M(t)&&!t._isUTC&&(t._d=s.utc(t._a)._d,t.utc().add(o.parse(t),"minutes")),t._z=o),t._z)if(n=t._z.utcOffset(t),Math.abs(n)<16&&(n/=60),void 0!==t.utcOffset){var r=t._z;t.utcOffset(-n,e),t._z=r}else t.zone(n,e)},D.tz=function(t,e){if(t){if("string"!=typeof t)throw new Error("Time zone name must be a string, got "+t+" ["+typeof t+"]");return this._z=O(t),this._z?s.updateOffset(this,e):A("Moment Timezone has no data for "+t+". See http://momentjs.com/timezone/docs/#/data-loading/."),this}if(this._z)return this._z.name},D.zoneName=x(D.zoneName),D.zoneAbbr=x(D.zoneAbbr),D.utc=Z(D.utc),D.local=Z(D.local),D.utcOffset=(T=D.utcOffset,function(){return 0<arguments.length&&(this._z=null),T.apply(this,arguments)}),s.tz.setDefault=function(t){return(n<2||2==n&&o<9)&&A("Moment Timezone setDefault() requires Moment.js >= 2.9.0. You are using Moment.js "+s.version+"."),s.defaultZone=t?O(t):null,s};var C=s.momentProperties;return"[object Array]"===Object.prototype.toString.call(C)?(C.push("_z"),C.push("_a")):C&&(C._z=null),s});App.module.create("bannerWidget",function(window,$,app){"use strict";var module={},selector="#banner-widget__counter";module.preInit=function(){return document.querySelector(selector)!==null};var $bannerWidgetCounter=$(selector);module.init=function(){moment().format();moment.tz.add("Europe/Brussels|WET CET CEST WEST|0 -10 -20 -10|0121212103030303030303030303030303030303030303030303212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121|-2ehc0 3zX0 11c0 1iO0 11A0 1o00 11A0 my0 Ic0 1qM0 Rc0 1EM0 UM0 1u00 10o0 1io0 1io0 17c0 1a00 1fA0 1cM0 1cM0 1io0 17c0 1fA0 1a00 1io0 1a30 1io0 17c0 1fA0 1a00 1io0 17c0 1cM0 1cM0 1a00 1io0 1cM0 1cM0 1a00 1fA0 1io0 17c0 1cM0 1cM0 1a00 1fA0 1io0 1qM0 Dc0 y00 5Wn0 WM0 1fA0 1cM0 16M0 1iM0 16M0 1C00 Uo0 1eeo0 1a00 1fA0 1cM0 1cM0 1cM0 1fA0 1a00 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1fA0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1fA0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1fA0 1o00 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00|21e5");var bannerWidgetOriginDate=moment.parseZone("2018-12-10T17:00:00+01:00");var bannerWidgetDuration=moment.duration(moment().tz("Europe/Brussels").diff(bannerWidgetOriginDate));var bannerWidgetDurationYears=Math.floor(bannerWidgetDuration.as("years"));var bannerWidgetDurationDays=Math.floor(bannerWidgetDuration.as("days")-365*bannerWidgetDurationYears)+1;var bannerWidgetSeparatorText=bannerWidgetDurationYears>=1?" and ":" ";var bannerWidgetYearText=bannerWidgetDurationYears>1?"Years":"Year";var bannerWidgetDayText=bannerWidgetDurationDays>1?"Days":"Day";$bannerWidgetCounter.html((bannerWidgetDurationYears>=1?bannerWidgetDurationYears+" "+bannerWidgetYearText:"")+""+bannerWidgetSeparatorText+""+bannerWidgetDurationDays+" "+bannerWidgetDayText)};return module}(window,jQuery,window.App));App.module.create("media-slider",function(window,$,app){"use strict";var module={},selector=".c-video-slider-component",$selector=$(selector);module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];console.log($selector);module.loadSlider=function(){var toggleSlider=function(){$selector.each(function(){var $slider=$(".js--slider-main",this);if(!$slider.hasClass("slick-initialized")){$slider.slick({fade:true,arrows:false,dots:false,infinite:true,mobileFirst:true})}var $thumbs=$(".js--slider-thumb",this);if(!$thumbs.hasClass("slick-initialized")){$thumbs.slick({arrows:true,dots:false,infinite:true,mobileFirst:true,slidesToShow:1,slidesToScroll:1,adaptiveHeight:true,responsive:[{breakpoint:759,settings:{slidesToShow:2,slidesToScroll:2,adaptiveHeight:true}},{breakpoint:1079,settings:{slidesToShow:3,slidesToScroll:3,adaptiveHeight:true}}]})}})};toggleSlider();app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",toggleSlider)};handlers.push({name:"_loadSlider",handle:function(){module.loadSlider()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("subscribePage",function(window,$,app){"use strict";var module={},selector=".subscribe-form-page";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var sampleFunction=function(){return false};handlers.push({name:"_handleSubscribePage",handle:function(){var $form=$(".subscribe-form-page > form");$(app.$doc).ajaxSuccess(function(event,request,settings){var url=settings.url.split("?");if(url[0]==$form.attr("action")){app.form.Validation.email("#subscribe-email");app.form.Validation.checkboxGroup(".js-checkboxes-1");app.form.Validation.checkboxGroup(".js-checkboxes-2");app.form.Validation.required("#subscribe_terms_of_use")}})},attach:function(context,settings){}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("highchartsGlobalOptions",function(window,$,app){"use strict";var module={},$selector=$(".s-data-package--main__graph, .s-data-package--main, .js-bar-graph, .stacked-column__elem, .js-line-graph, .c-radial-graph__chart");if(typeof Highcharts==="undefined")return;module.preInit=function(){return $selector!==null||window.Highcharts};var handlers=[];handlers.push({name:"_loadHighchartsGlobalOptions",handle:function(){var dataDownloadSVG,dataDownloadJPEG,dataDownloadPNG,dataPrintChart,dataZoom,dataFilterTo,dataFilterFrom;$selector.each(function(){dataDownloadSVG=$(this).attr("data-downloadsvg"),dataDownloadJPEG=$(this).attr("data-downloadjpeg"),dataDownloadPNG=$(this).attr("data-downloadpng"),dataPrintChart=$(this).attr("data-printchart");if($(".stacked-column__elem")[0]){var stackedcolumn=$(".stacked-column__elem");dataZoom=$(stackedcolumn).attr("data-zoom"),dataFilterTo=$(stackedcolumn).attr("data-filter-to"),dataFilterFrom=$(stackedcolumn).attr("data-filter-from")}});if($(".stacked-column__elem")[0]){Highcharts.setOptions({lang:{downloadJPEG:dataDownloadJPEG,downloadPNG:dataDownloadPNG,downloadSVG:dataDownloadSVG,printChart:dataPrintChart,rangeSelectorZoom:dataZoom,rangeSelectorTo:dataFilterTo,rangeSelectorFrom:dataFilterFrom}})}else{Highcharts.setOptions({lang:{downloadJPEG:dataDownloadJPEG,downloadPNG:dataDownloadPNG,downloadSVG:dataDownloadSVG,printChart:dataPrintChart}})}}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("barGraph",function(window,$,app){"use strict";var module={},selector1=".js-bar-graph",$graphs=$(selector1),selector2=".s-data-package--main",$dataPackageGraphs=$(".data-package-bar-graph");module.preInit=function(){return document.querySelector(selector1)!==null||document.querySelector(selector2)!==null};var handlers=[];module.loadBarCharts=function(){if(document.querySelector(selector1)!==null){$graphs.each(function(id){var $selector=$(this);var $module=$selector.closest(".module");var type=$selector.data("type");var paragraph_chart_id=$selector.data("paragraph-id");$.getJSON("/airtable/chart/"+type+"/"+paragraph_chart_id,function(data){var options={chart:{type:"bar",height:510,spacingLeft:30,spacingRight:30,spacingTop:30,spacingBottom:30,events:{load:function(){$module.addClass("loaded")}}},credits:{enabled:false},title:{useHTML:true,text:'<span class="c-bar-graph__title [ u-franklin ]">'+($selector.data("title")||"")+"</span>",style:{width:"inherit"}},subtitle:{useHTML:true,text:'<span class="c-bar-graph__subtitle [ u-franklin ]">'+($selector.data("subtitle")||"").toUpperCase()+"</span>"},legend:{useHTML:true,labelFormat:'<span class="[ u-franklin u-fs13 u-lh15p u-fwn u-ls-03neg u-gray ]">{name}</span>'},xAxis:{categories:data.categories,labels:{useHTML:true,format:'<span class="[ u-franklin u-fs13 u-lh15p u-ls-03neg u-gray--hc-label ]">{value}</span>'}},yAxis:{labels:{useHTML:true,format:'<span class="[ u-franklin u-fs13 u-lh15p u-ls-03neg u-gray--hc-label ]">{value}</span>'},min:0,title:{text:null}},plotOptions:{series:{stacking:"normal"}},series:data.series,tooltip:{useHTML:true,headerFormat:'<p style="margin: 0; font-size: 13px;">{point.key}</p>',pointFormat:'<p style="display: flex; margin-top: 5px; margin-bottom: 0; font-size: 13px;">'+'<span style="margin-right: 5px; color: {point.color};">â—</span>'+'<span style="white-space: pre-line;">{series.name}</span>'+'<strong style="margin-left: 5px;">{point.y}</strong>'+"<p/>",padding:10,backgroundColor:"#ffffff",borderColor:"#cecece",borderWidth:1},exporting:{sourceWidth:820,sourceHeight:510,buttons:{contextButton:{y:14,menuItems:["downloadPNG","downloadSVG","downloadJPEG","separator","printChart"]}}},responsive:{rules:[{condition:{maxWidth:433},chartOptions:{chart:{spacingLeft:20,spacingRight:20,spacingTop:30,spacingBottom:30},title:{margin:30},exporting:{buttons:{contextButton:{y:26,menuItems:["downloadPNG","downloadSVG","downloadJPG","separator","printChart"]}}}}}]}};if($(".s-main").hasClass("s-rtl")){options.legend.rtl=true}Highcharts.chart($selector.attr("id"),options)})})}if(document.querySelector(selector2)!==null){$dataPackageGraphs.each(function(){var $dataPackageSelector=$(this);var type=$dataPackageSelector.data("type");var paragraph_chart_id=$dataPackageSelector.data("paragraph-id");var title=$dataPackageSelector.data("title");var subtitle=$dataPackageSelector.data("subtitle");$.getJSON("/airtable/chart/"+type+"/"+paragraph_chart_id,function(data){var options={chart:{type:"bar",height:510,spacingLeft:30,spacingRight:30,spacingTop:30,spacingBottom:30,events:{load:function(){$dataPackageSelector.addClass("loaded")}}},credits:{enabled:false},title:{useHTML:true,text:'<span class="c-bar-graph__title [ u-franklin ]">'+($dataPackageSelector.data("title")||"")+"</span>",style:{width:"inherit"}},subtitle:{useHTML:true,text:'<span class="c-bar-graph__subtitle [ u-franklin ]">'+($dataPackageSelector.data("subtitle")||"").toUpperCase()+"</span>",style:{width:"inherit"}},legend:{useHTML:true,labelFormat:'<span class="[ u-franklin u-fs13 u-lh15p u-fwn u-ls-03neg u-gray ]">{name}</span>'},xAxis:{categories:data.categories,labels:{useHTML:true,format:'<span class="[ u-franklin u-fs13 u-lh15p u-ls-03neg u-gray--hc-label ]">{value}</span>'}},yAxis:{labels:{useHTML:true,format:'<span class="[ u-franklin u-fs13 u-lh15p u-ls-03neg u-gray--hc-label ]">{value}</span>'},min:0,title:{text:null}},exporting:{sourceWidth:820,sourceHeight:510,buttons:{contextButton:{y:14,menuItems:["downloadPNG","downloadSVG","downloadJPEG","separator","printChart"]}}},plotOptions:{series:{stacking:"normal"}},series:data.series,tooltip:{useHTML:true,headerFormat:'<p style="margin: 0; font-size: 13px;">{point.key}</p>',pointFormat:'<p style="display: flex; margin-top: 5px; margin-bottom: 0; font-size: 13px;">'+'<span style="margin-right: 5px; color: {point.color};">â—</span>'+'<span style="white-space: pre-line;">{series.name}</span>'+'<strong style="margin-left: 5px;">{point.y}</strong>'+"<p/>",padding:10,backgroundColor:"#ffffff",borderColor:"#cecece",borderWidth:1},responsive:{rules:[{condition:{maxWidth:433},chartOptions:{chart:{spacingLeft:20,spacingRight:20,spacingTop:30,spacingBottom:30}}}]}};if($(".s-main").hasClass("s-rtl")){options.legend.rtl=true}Highcharts.chart($dataPackageSelector.attr("id"),options)})})}};handlers.push({name:"_loadBarCharts",handle:function(){module.loadBarCharts()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("curtain",function(window,$,app){"use strict";var module={},selector=".js-hero-curtain",siblings=".hero--curtain__siblings",footer=".s-footer",overlayScrollGradient=".c-page-hero__opacity",imageOverlay=".c-page-hero__image picture",toolbar=".c-toolbar",oldScrollBtn=".js-hero-curtain-btn",scrollBtn=".c-scroll-down",latestTrends=".c-latest-trends",latestTrendsVisible="c-latest-trends--visible";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $el=$(selector);var $siblings=$(siblings);var $footer=$(footer);var $heroScrolloffset=1;var $opacityReduce=1;var $heroScrollGradient=$(overlayScrollGradient);var $heroImageOverlay=$(imageOverlay);var $toolbar=$(toolbar);var $scroller=$(scrollBtn);var $latestTrends=$(latestTrends);var $offsetValue=40;module.initCurtain=function(){$el.siblings().wrapAll('<div class="hero--curtain__siblings" />');$footer.addClass("has-curtain");module.resize();$el.on("click",oldScrollBtn,function(e){e.preventDefault();$("html, body").animate({scrollTop:$el.outerHeight(true)},700)});$el.on("click",scrollBtn,function(e){e.preventDefault();$("html, body").animate({scrollTop:$el.outerHeight(true)},700)});app.EventHandler.subscribe("EVENT_RESIZE",module.onScroll);app.EventHandler.subscribe("EVENT_SCROLL_INSTANT",module.onScroll)},module.onScroll=function(){module.resize();$heroScrolloffset=$(window).scrollTop()/$(".c-page-hero--full").height();var heroBottom=$el.position().top+$el.outerHeight(true);$opacityReduce=1-$heroScrolloffset;if(window.pageYOffset>heroBottom){$(".hero--curtain__siblings").css({marginTop:"100vh"});$(".hero--curtain__siblings").addClass("has-curtain");$(".hero--curtain__siblings").css({marginTop:"calc(100vh + "+($latestTrends.outerHeight(true)-$offsetValue)+"px)"});$(selector).addClass("has-curtain-on-top")}else{$(".hero--curtain__siblings").removeClass("has-curtain");$(".hero--curtain__siblings").css({marginTop:"0"});$(selector).removeClass("has-curtain-on-top");if($heroScrolloffset*100>50){$opacityReduce=$opacityReduce+.5}else{$opacityReduce=1}$el.css("opacity",$opacityReduce)}if(window.pageYOffset/2>$(window).innerHeight()+$(".s-footer").outerHeight()-50){$(".s-footer").removeClass("has-curtain");$(".s-footer").addClass("curtain-ended")}else{$(".s-footer").removeClass("curtain-ended");$(".s-footer").addClass("has-curtain");if($latestTrends.length){$(".s-footer.has-curtain").css({marginTop:"calc(100vh + "+($latestTrends.outerHeight(true)-$offsetValue)+"px)"})}else{$(".s-footer.has-curtain").css({marginTop:"calc(100vh)"})}}},module.resize=function(){if($latestTrends.length){$offsetValue=window.innerWidth>=761?90:40;$el.css({height:"calc(100vh + "+($latestTrends.outerHeight(true)-$offsetValue)+"px)"})}},handlers.push({name:"_triggerCurtain",handle:function(){module.initCurtain();$("html").addClass("special-report-no-fade")}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("dataTable",function(window,$,app){"use strict";var module={},selector=".js-data-table",$dataTables=$(selector);module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var tableContainer=$(".js-data-table > .data-table");module.getNumberOfColumns=function(tbody){var cols=$(tbody).find("> tr").eq(1).find("td");var hasHeader=$(tbody).find("> tr").eq(1).find("th").length>0;var count=0;for(var i=0;i<cols.length;i++){var colspan=cols.eq(i).attr("colspan");if(colspan&&colspan>1){count+=colspan}else{count++}}return hasHeader?++count:count};module.checkIfHeader=function(tbody){var firstCol=tbody.find("> tr").eq(1).find("th");if(firstCol.length){return true}return false};module.addDataTableClass=function(){$.each($dataTables,function(){var tableContainer=$(".data-table",this);var tableBody=$("table",this).find("tbody");var hasTableWidth=typeof $("table",this).attr("style")!=="undefined"?$("table",this).attr("style").indexOf("width")>-1:false;if(module.checkIfHeader(tableBody)){var nodesWithColspan=$("th[colspan]").not("[colspan=1]");tableContainer.removeAttr("class");tableContainer.addClass("data-table data-table--header");nodesWithColspan.css("opacity",1)}else if(hasTableWidth){tableContainer.removeAttr("class");tableContainer.addClass("data-table data-table--adjusted")}else if(module.getNumberOfColumns(tableBody)<6&&module.getNumberOfColumns(tableBody)>1){tableContainer.removeAttr("class");tableContainer.addClass("data-table data-table--minimum")}else{tableContainer.removeAttr("class");tableContainer.addClass("data-table data-table--default")}})};module.changeBeforeContent=function(){$.each($dataTables,function(){var thisTable=this;var headerNodes=$("table",this).find("thead tr th");headerNodes.removeAttr("data-before");var hasHeader=$(".data-table",this).attr("class").indexOf("data-table--header")>-1;headerNodes.each(function(i){var headerInnerHtml=$.trim($(this).html());var tdElements=$("table tbody td:nth-of-type("+(i+1)+")",thisTable);var header='<div class="data-table--mobile-header">'+headerInnerHtml+"</div>";if(hasHeader&&i===0){var thNodes=$("table tbody th:not([colspan])",thisTable);thNodes.prepend(header)}else{var tdNoColSpanElements=$("table tbody td:not([colspan]):nth-of-type("+(hasHeader?i:i+1)+")",thisTable);tdNoColSpanElements.prepend(header)}})})};module.tableOverFlowX=function(){tableContainer.css({overflowX:"auto"})};handlers.push({name:"_addDataTableClass",handle:function(){module.addDataTableClass()}});handlers.push({name:"_changeBeforeContent",handle:function(){module.changeBeforeContent()}});handlers.push({name:"_tableOverFlowX",handle:function(){module.tableOverFlowX()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("dataPackageTabs",function(window,$,app){"use strict";var module={},selector=".s-data-package--main__tab";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var $item;module.tabClick=function($item){var $this=$($item),$thisLinkParent=$this.closest(".s-data-package__tab-item"),$parent=$this.closest(".data-package-container");if(!$this.parent().hasClass("active")){app.classRemoveAdd($parent.find(".s-data-package__tab-item"),"","active");app.classAddRemove($thisLinkParent,"active");app.classRemoveAdd($parent.find(".s-data-package--main__tab-pane"),"","active");app.classRemoveAdd($parent.find(".s-article__inner-content"),"","active");app.classAddRemove($parent.find('[data-tab-pane="'+$this.data("tab-item")+'"]'),"active");app.classAddRemove($parent.find('[data-content-count="'+$this.data("tab-item")+'"]'),"active")}};module.giveActiveClass=function(){$(".data-package-container").each(function(){$(this).find(".s-data-package__tab-item").first().addClass("active");$(this).find(".s-data-package--main__tab-pane").first().addClass("active");$(this).find(".s-article__inner-content").first().addClass("active")})};handlers.push({name:"_dataPackageInit",handle:function(){module.giveActiveClass();$item=$context.find(".s-data-package__tab-item a");$item.on("click",function(e){module.tabClick($(this));e.preventDefault()})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("lineGraph",function(window,$,app){"use strict";var module={},selector1=".js-line-graph",$graphs=$(selector1),selector2=".s-data-package--main",$dataPackageGraphs=$(".data-package-line-graph");module.preInit=function(){return document.querySelector(selector1)!==null||document.querySelector(selector2)!==null};var handlers=[];var userAgentString=window.navigator.userAgent;var options={chart:{borderColor:"#cdcdcd",borderWidth:.5,spacingBottom:35,spacingLeft:30,spacingRight:30,spacingTop:30,height:480,style:{fontFamily:'"franklin-gothic-urw", Helvetica, Arial, sans-serif'}},credits:{style:{fontSize:"10px",letterSpacing:"0.3px",color:"#959595"}},title:{text:"",margin:40,style:{color:"#14272B",fontSize:"23px",lineHeight:"25px",letterSpacing:"-.4px"}},subtitle:{text:""},xAxis:{categories:[],labels:{style:{fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px",color:"#05363e"}}},yAxis:{title:{text:"",offset:60,style:{color:"#555555"}},labels:{style:{fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px",color:"#05363e"}}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",width:500,itemWidth:250,itemMarginBottom:15,itemStyle:{fontWeight:"normal",fontSize:"13px",color:"#555",letterSpacing:"0.3px",lineHeight:"15px"}},plotOptions:{series:{label:{enabled:false,connectorAllowed:false}}},annotations:[{labelOptions:{borderColor:"#cecece"}}],tooltip:{backgroundColor:"#ffffff",borderColor:"#cecece",shadow:false,headerFormat:'<span style="font-size: 13px;">{point.key}</span><br/>',style:{fontSize:"13px"}},responsive:{rules:[{condition:{maxWidth:761},chartOptions:{legend:{width:null,itemWidth:null}}}]},exporting:{sourceWidth:820,sourceHeight:510,buttons:{contextButton:{menuItems:["downloadPNG","downloadSVG","downloadJPEG","separator","printChart"]}}},series:[]};module.loadLineCharts=function(){if(document.querySelector(selector1)!==null){$graphs.each(function(id){var $selector=$(this);var type=$selector.data("type");var paragraph_chart_id=$selector.data("paragraph-id");$.getJSON("/airtable/chart/"+type+"/"+paragraph_chart_id,function(data){$.each(data.series,function(key,value){data.series[key].marker={symbol:["circle","square","diamond","triangle"][key]}});options.title.text=$selector.data("title");options.subtitle.text=$selector.data("subtitle");options.xAxis.categories=data.categories;options.series=data.series;if($(".s-main").hasClass("s-rtl")){options.legend.rtl=true}Highcharts.chart($selector.attr("id"),options);if(userAgentString.indexOf("Trident/7.0")>-1){$dataPackageSelector.find(".highcharts-background").attr("x",.35)}})})}if(document.querySelector(selector2)!==null){$dataPackageGraphs.each(function(){var $dataPackageSelector=$(this);var type=$dataPackageSelector.data("type");var paragraph_chart_id=$dataPackageSelector.data("paragraph-id");$.getJSON("/airtable/chart/"+type+"/"+paragraph_chart_id,function(data){$.each(data.series,function(key,value){data.series[key].marker={symbol:["circle","square","diamond","triangle"][key]}});options.title.text=$dataPackageSelector.data("title");options.subtitle.text=$dataPackageSelector.data("subtitle");options.xAxis.categories=data.categories;options.series=data.series;if($(".s-main").hasClass("s-rtl")){options.legend.rtl=true}Highcharts.chart($dataPackageSelector.attr("id"),options);if(userAgentString.indexOf("Trident/7.0")>-1){$dataPackageSelector.find(".highcharts-background").attr("x",.35)}})})}};handlers.push({name:"_lineGraphInit",handle:function(){module.loadLineCharts()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("parallax",function(window,$,app){"use strict";var module={},selector=".js-parallax";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $el=$(selector);var $container=$(".o-container",selector);var viewportHeight=$(window).height();var $el=$(selector);if(module.preInit()){var viewportHeight=$(window).height();var containerPosition=$el.offset().top;var startPoint=containerPosition-viewportHeight/2}module.initOpacity=function($el){var scrollY=$(document).scrollTop();var containerPosition=$el.offset().top;var containerHeight=$el.height();if(scrollY>=containerPosition-containerHeight){var initialPos=containerPosition-containerHeight;var maxPos=initialPos+containerHeight;var test=(maxPos-scrollY)/containerHeight*1.1;var testMove=(maxPos-scrollY)/containerHeight*10;var currentPercentage=1-test;if(test<0){currentPercentage=1-Math.abs(test)}$el.find(".o-container").css({opacity:currentPercentage});$el.css({"background-position":"50% "+(50+testMove*-1)+"%"})}};module.handleParallax=function(e){var parallaxJS=function(){$el.each(function(){module.initOpacity($(this))})};app.EventHandler.subscribe("EVENT_SCROLL_INSTANT",parallaxJS);$(window).resize(function(){viewportHeight=$(window).height()})};handlers.push({name:"_handleParallax",handle:function(){module.handleParallax()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("radialGraph",function(window,$,app){"use strict";var module={},selector1=".c-radial-graph__chart",selector2=".s-data-package--main",$graphs=$(selector1),$dataPackageGraphs=$(".data-package-radial-graph");module.preInit=function(){return document.querySelector(selector1)!==null||document.querySelector(selector2)!==null};var handlers=[];var charts=[];function getRandomHexColor(){return"#"+Math.floor(Math.random()*16777215).toString(16)}function loadRadialChart(items,$selector,isdataPackage,isMainGraph,isInset,isMultiGraph){var options={chart:{type:"pie",height:450,style:{fontFamily:'"franklin-gothic-urw", Helvetica, Arial, sans-serif'}},legend:{useHTML:true,align:"center",verticalAlign:"bottom",layout:"vertical",y:0,x:0,symbolRadius:0,itemMarginTop:8,itemMarginBottom:8,itemStyle:{lineHeight:"14px",fontSize:"13px",fontWeight:"normal",letterSpacing:"0.3px",color:"#555"},labelFormatter:function(){var words=this.name.split(/[\s]+/);var numWordsPerLine=3;var str=[];for(var i=0;i<words.length;i++){if(i>0&&i%numWordsPerLine==0){str.push("<br>")}str.push(words[i])}var label=str.join(" ");return label+", "+Highcharts.numberFormat(this.percentage,0)+"%"}},credits:{enabled:true},title:{useHTML:true,text:'<span class="c-radial-graph__title [ u-franklin ]">'+($selector.data("title")||"")+"</span>",style:{width:"inherit"}},subtitle:{useHTML:true,text:'<span class="c-radial-graph__subtitle [ u-franklin ]">'+($selector.data("subtitle")||"").toUpperCase()+"</span>",style:{width:"inherit"}},plotOptions:{pie:{shadow:false,center:["50%","50%"],borderColor:null,point:{events:{legendItemClick:function(){return false}}}}},tooltip:{formatter:function(){return"<strong>"+this.y+"</strong>"}},exporting:{sourceWidth:820,sourceHeight:510,buttons:{contextButton:{y:34,menuItems:["downloadPNG","downloadSVG","downloadJPEG","separator","printChart"]}}},navigation:{buttonOptions:{theme:{fill:"#FFFFFF"}},menuItemHoverStyle:{background:"#E6E6E6",color:"#9f9f9f"},menuItemStyle:{padding:"0.1em 0.5em",fontSize:"15px",color:"#9f9f9f"},menuStyle:{border:"1px solid #cecece",padding:"10px 6px 15px 6px"}},series:[{data:items||[],size:"90%",innerSize:"60%",showInLegend:true,dataLabels:{enabled:false}}]};if(isMainGraph){options.chart={type:"pie",height:510,spacingTop:40,spacingBottom:30,spacingLeft:30,spacingRight:30};options.credits={position:{y:-30,x:-30}};options.responsive={rules:[{condition:{minWidth:648},chartOptions:{legend:{align:"right",verticalAlign:"middle",layout:"vertical",x:-90,y:20},subtitle:{y:50},plotOptions:{pie:{center:["55%","50%"],borderColor:null}}}},{condition:{maxWidth:760},chartOptions:{chart:{spacingBottom:17,height:600},exporting:{buttons:{contextButton:{y:40}}},title:{margin:24},subtitle:{y:40},legend:{itemMarginBottom:25}}},{condition:{maxWidth:648},chartOptions:{chart:{spacingTop:20,spacingBottom:0,spacingLeft:0,spacingRight:0},exporting:{buttons:{contextButton:{y:10,x:-23}}},title:{y:45},subtitle:{y:80},legend:{itemMarginTop:8,itemMarginBottom:8,y:-25,width:169,labelFormatter:function(){var words=this.name.split(/[\s]+/);var numWordsPerLine=3;var str=[];for(var i=0;i<words.length;i++){if(i>0&&i%numWordsPerLine==0){str.push("<br>")}str.push(words[i])}var label=str.join(" ");return label+", "+Highcharts.numberFormat(this.percentage,0)+"%"}},credits:{position:{y:-20,x:-25}}}}]}}else if(isdataPackage){if(isMultiGraph){options.exporting.sourceWidth=390;options.exporting.sourceHeight=260;options.responsive={};options.chart.backgroundColor="transparent";options.credits.enabled=false;options.navigation.buttonOptions.theme.fill="transparent";options.title.y=null;options.legend.labelFormatter=function(){var labelText=this.name;return this.y+" "+labelText+", "+Highcharts.numberFormat(this.percentage,0)+"%"};if($(window).width()>=760){options.responsive={rules:[{condition:{maxWidth:1920},chartOptions:{plotOptions:{pie:{size:130}},legend:{x:20},series:{size:130}}},{condition:{minWidth:288},chartOptions:{chart:{height:320},legend:{align:$(window).width()<=760?"center":"right",verticalAlign:$(window).width()<=760?"bottom":"middle",layout:$(window).width()<=760?"horizontal":"vertical",y:16},title:{y:$selector.data("subtitle")[0]?10:33},subtitle:{y:60},exporting:{buttons:{contextButton:{y:15,x:10}}},plotOptions:{pie:{center:[39,"50%"],borderColor:null}}}},{condition:{minWidth:446},chartOptions:{chart:{height:240},title:{y:15},subtitle:{y:45},plotOptions:{pie:{size:130}}}},{condition:{maxWidth:320},chartOptions:{series:{size:110},legend:{x:5,y:$selector.data("subtitle")[0]?20:7},plotOptions:{pie:{size:110,center:[26,"50%"]}}}},{condition:{maxWidth:287},chartOptions:{legend:{x:-10,y:15,layout:$(window).width()<=760?"horizontal":"vertical"},chart:{height:220},series:{size:110},plotOptions:{pie:{center:["50%","50%"],borderColor:null}}}},{condition:{maxWidth:287},chartOptions:{legend:{x:-10,y:45},chart:{height:550,backgroundColor:"#ffffff"},series:{size:218}}}]}}else{options.responsive={rules:[{condition:{maxWidth:760},chartOptions:{chart:{height:551,backgroundColor:"#ffffff",spacingTop:$selector.data("subtitle")[0]?47:60,spacingBottom:0,spacingLeft:0,spacingRight:0},credits:{enabled:true,position:{y:-17,x:-13}},exporting:{buttons:{contextButton:{y:$selector.data("subtitle")[0]?48:10,x:-10}}},title:{y:null},subtitle:{y:null},legend:{itemMarginTop:8,itemMarginBottom:8,y:-50}}},{condition:{maxWidth:342},chartOptions:{subtitle:{y:70}}}]}}}else{options.title.y=16;options.responsive={rules:[{condition:{minWidth:648},chartOptions:{legend:{align:"right",verticalAlign:"middle",layout:"vertical",x:-90,y:20},subtitle:{y:50},plotOptions:{pie:{center:["55%","50%"],borderColor:null}}}},{condition:{minWidth:1081},chartOptions:{legend:{x:-350,layout:"vertical"}}},{condition:{maxWidth:760},chartOptions:{chart:{spacingBottom:17,height:540},exporting:{buttons:{contextButton:{y:40}}},title:{margin:24},subtitle:{y:40},legend:{itemMarginBottom:25}}},{condition:{maxWidth:648},chartOptions:{chart:{spacingTop:20,spacingBottom:0,spacingLeft:0,spacingRight:0},exporting:{buttons:{contextButton:{y:10,x:-23}}},title:{y:45},subtitle:{y:100},legend:{itemMarginTop:8,itemMarginBottom:8,y:-25,width:169,labelFormatter:function(){var words=this.name.split(/[\s]+/);var numWordsPerLine=3;var str=[];for(var i=0;i<words.length;i++){if(i>0&&i%numWordsPerLine==0){str.push("<br>")}str.push(words[i])}var label=str.join(" ");return label+", "+Highcharts.numberFormat(this.percentage,0)+"%"}},credits:{position:{y:-20,x:-25}}}}]}}}else if(isInset){options.title.y=16;options.responsive={rules:[{condition:{minWidth:1020},chartOptions:{legend:{x:-210,y:20}}},{condition:{minWidth:1081},chartOptions:{legend:{x:-350,layout:"vertical"}}},{condition:{maxWidth:760},chartOptions:{chart:{spacingBottom:17,height:540},exporting:{buttons:{contextButton:{y:40}}},title:{margin:10},subtitle:{y:60},legend:{itemMarginBottom:25}}},{condition:{minWidth:558},chartOptions:{chart:{height:470},legend:{align:"right",verticalAlign:"middle",layout:"vertical",x:-50,y:20},subtitle:{y:50},plotOptions:{pie:{center:["55%","50%"],borderColor:null}}}},{condition:{maxWidth:557},chartOptions:{chart:{spacingTop:15,spacingBottom:0,spacingLeft:0,spacingRight:0,height:540},exporting:{buttons:{contextButton:{y:48,x:-10}}},title:{y:25},subtitle:{y:68},legend:{itemMarginTop:8,itemMarginBottom:8,y:-50,labelFormatter:function(){var words=this.name.split(/[\s]+/);var numWordsPerLine=3;var str=[];for(var i=0;i<words.length;i++){if(i>0&&i%numWordsPerLine==0){str.push("<br>")}str.push(words[i])}var label=str.join(" ");return label+", "+Highcharts.numberFormat(this.percentage,0)+"%"}},credits:{position:{y:-17,x:-13}}}},{condition:{maxWidth:342},chartOptions:{subtitle:{y:70}}}]}}else{options.title.y=16;options.responsive={rules:[{condition:{minWidth:648},chartOptions:{legend:{align:"right",verticalAlign:"middle",layout:"vertical",x:-90,y:20},subtitle:{y:50},plotOptions:{pie:{center:["55%","50%"],borderColor:null}}}},{condition:{minWidth:1020},chartOptions:{legend:{x:-210,y:20}}},{condition:{minWidth:1081},chartOptions:{legend:{x:-350,layout:"vertical"}}},{condition:{maxWidth:760},chartOptions:{chart:{spacingBottom:17,height:540},exporting:{buttons:{contextButton:{y:40}}},title:{margin:10},subtitle:{y:60},legend:{itemMarginBottom:25}}},{condition:{maxWidth:648},chartOptions:{chart:{spacingTop:15,spacingBottom:0,spacingLeft:0,spacingRight:0,height:540},exporting:{buttons:{contextButton:{y:48,x:-10}}},title:{y:25},subtitle:{y:68},legend:{itemMarginTop:8,itemMarginBottom:8,y:-50,labelFormatter:function(){var words=this.name.split(/[\s]+/);var numWordsPerLine=3;var str=[];for(var i=0;i<words.length;i++){if(i>0&&i%numWordsPerLine==0){str.push("<br>")}str.push(words[i])}var label=str.join(" ");return label+", "+Highcharts.numberFormat(this.percentage,0)+"%"}},credits:{position:{y:-17,x:-13}}}},{condition:{maxWidth:342},chartOptions:{subtitle:{y:70}}}]}}if($(".s-main").hasClass("s-rtl")){options.legend.rtl=true}var id=$selector.attr("id");charts[id]=new Highcharts.Chart($selector[0],options)}module.createRadialCharts=function(){if(document.querySelector(selector1)!==null){$graphs.each(function(){var $selector=$(this);var paragraph_chart_id=$selector.data("paragraph-id");if($selector.data("inputType")=="airtable"||$selector.data("type")=="airtable"){return $.getJSON("/airtable/chart/radial/"+paragraph_chart_id).then(function(data){var isdataPackage=false,isMainGraph=false,isInset=false;isMultiGraph=false;var dataItems=data.series;var items=dataItems.map(function(item,i){return{name:item.name,y:item.data[0],color:item.color||getRandomHexColor()}});if($selector.closest(".data-package-radial-graph")[0]){isdataPackage=true}if($selector.hasClass("s-data-package--main__graph")){isMainGraph=true}if($selector.hasClass("is-multi-graph")){isMultiGraph=true}if($selector.closest(".c-radial-graph").hasClass("c-radial-graph--inset")){isInset=true}loadRadialChart(items,$selector,isdataPackage,isMainGraph,isInset,isMultiGraph)})}else{var isdataPackage=false,isMainGraph=false,isInset=false,isMultiGraph=false;var dataItems=$selector.data("items");var items="";if(typeof dataItems!=="undefined"){items=dataItems.map(function(item,i){return{name:item.label,y:parseFloat(item.value),color:item.color||getRandomHexColor()}})}if($selector.closest(".data-package-radial-graph")[0]){isdataPackage=true}if($selector.hasClass("s-data-package--main__graph")){isMainGraph=true}if($selector.hasClass("is-multi-graph")){isMultiGraph=true}if($selector.closest(".c-radial-graph").hasClass("c-radial-graph--inset")){isInset=true}loadRadialChart(items,$selector,isdataPackage,isMainGraph,isInset,isMultiGraph)}})}if(document.querySelector(selector2)!==null){$dataPackageGraphs.each(function(){var $selector=$(this);var paragraph_chart_id=$selector.data("paragraph-id");var radialType=$selector.data("inputType");if(radialType=="airtable"||$selector.data("type")=="airtable"){$selector;return $.getJSON("/airtable/chart/radial/"+paragraph_chart_id).then(function(data){var isdataPackage=false,isMainGraph=false,isInset=false,isMultiGraph=false;var dataItems=data.series;var items=dataItems.map(function(item,i){return{name:item.name,y:item.data[0],color:item.color||getRandomHexColor()}});if($selector.closest(".data-package-radial-graph")[0]){isdataPackage=true}if($selector.hasClass("s-data-package--main__graph")){isMainGraph=true}if($selector.hasClass("is-multi-graph")){isMultiGraph=true}if($selector.closest(".c-radial-graph").hasClass("c-radial-graph--inset")){isInset=true}loadRadialChart(items,$selector,isdataPackage,isMainGraph,isInset,isMultiGraph)})}else{var isdataPackage=false,isMainGraph=false,isInset=false,isMultiGraph=false;var dataItems=$selector.data("items");var items="";if(typeof dataItems!=="undefined"){items=dataItems.map(function(item,i){return{name:item.label,y:parseFloat(item.value),color:item.color||getRandomHexColor()}})}if($selector.closest(".data-package-radial-graph")[0]){isdataPackage=true}if($selector.hasClass("s-data-package--main__graph")){isMainGraph=true}if($selector.hasClass("is-multi-graph")){isMultiGraph=true}if($selector.closest(".c-radial-graph").hasClass("c-radial-graph--inset")){isInset=true}loadRadialChart(items,$selector,isdataPackage,isMainGraph,isInset,isMultiGraph)}})}};handlers.push({name:"_radialGraph",handle:function(){module.createRadialCharts()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}})};return module}(window,jQuery,window.App));App.module.create("stackedColumn",function(window,$,app){"use strict";var module={},selector1=".stacked-column__elem",selector2=".s-data-package--main",$graphs=$(selector1),$dataPackageGraphs=$(".data-package-stacked-graph");module.preInit=function(){return document.querySelector(selector1)!==null||document.querySelector(selector2)!==null};var handlers=[];function getChartMonthFromValue($value){var monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var labelMonth=new Date($value);return monthNames[labelMonth.getMonth()]}var $inlineStackedColumn=$(".stacked-column--inline");var $insetStackedColumn=$(".stacked-column--inset");module.addMissingMonths=function(series){var _monthsName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];$.each(series,function(item){var itemData=series[item].data;var _tmpDates={};var _dataDates=[];$.each(itemData,function(dataItem){var getDataDate=new Date(itemData[dataItem][0]);var getDataMonth=_monthsName[getDataDate.getMonth()];var getDataYear=getDataDate.getFullYear();if(!_tmpDates[getDataYear]){_tmpDates[getDataYear]=[]}if(_tmpDates[getDataYear].indexOf(getDataMonth)===-1){_tmpDates[getDataYear].push(getDataMonth)}});$.each(_tmpDates,function(itemYear){var _missingMonth=$.grep(_monthsName,function(n,i){if(_tmpDates[itemYear].indexOf(n)===-1){return n}});_dataDates=_missingMonth.map(function(dateItem){if(dateItem=="Feb"){var dateDay="28"}else{var dateDay="30"}return new Date(dateItem+" "+dateDay+", "+itemYear).getTime()})});$.each(_dataDates,function(dateItems){itemData.push([_dataDates[dateItems],0])});var sortedDates=itemData.sort(function(a,b){if(a[0]>b[0]){return 1}else if(a[0]==b[0]){return 0}else{return-1}});series[item].data=sortedDates});return series};module.createStackedColumns=function(){if(document.querySelector(selector1)!==null){$graphs.each(function(){var $selector=$(this);var type=$selector.data("type");var paragraph_chart_id=$selector.data("paragraph-id");var title=$selector.data("title");var subtitle=$selector.data("subtitle");if(type=="stack"){type="stacked"}$.getJSON("/airtable/chart/"+type+"/"+paragraph_chart_id,function(data){var series=module.addMissingMonths(data);var $option={chart:{type:"column",borderColor:"#cdcdcd",borderWidth:.5,spacingBottom:35,spacingLeft:38,spacingRight:38,spacingTop:30,height:650,style:{fontFamily:'"franklin-gothic-urw", Helvetica, Arial, sans-serif'},events:{load:function(){$selector.addClass("loaded")}}},credits:{style:{fontSize:"10px",letterSpacing:"0.3px",color:"#959595"}},exporting:{sourceWidth:860,sourceHeight:700,buttons:{contextButton:{symbolFill:"#05363e",symbolStroke:"#05363e",y:42,menuItems:["downloadPNG","downloadSVG","downloadJPEG","separator","printChart"]}}},title:{text:title||"",margin:40,style:{color:"#14272b",fontSize:"23px",lineHeight:"25px",letterSpacing:"-.4px"}},subtitle:{useHTML:true,text:'<span class="c-stacked-graph__subtitle [ u-franklin ]">'+($selector.data("subtitle")||"").toUpperCase()+"</span>",style:{color:"#05363e",fontSize:"15px",lineHeight:"17px",letterSpacing:"0.8px"},y:50},xAxis:{stackLabels:{enabled:false},labels:{formatter:function(){return getChartMonthFromValue(this.value)},style:{fontSize:"13px",lineHeight:"15px",color:"#05363e",letterSpacing:"0.3px"}}},legend:{enabled:true,layout:"horizontal",align:"center",verticalAlign:"bottom",width:500,itemWidth:250,itemMarginBottom:15,itemStyle:{fontWeight:"normal",lineHeight:"15px",fontSize:"13px",color:"#555555",letterSpacing:"0.3px"}},tooltip:{backgroundColor:"#ffffff",borderRadius:0,borderWidth:1,borderColor:"#cecece",padding:15,shadow:false,split:false,shared:true,crosshairs:true,followPointer:true,followTouchMove:true,useHTML:true,formatter:function(){var s='<div class="highcharts-tooltip-table__elem">';s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col highcharts-tooltip-table__heading">'+Highcharts.dateFormat("%b %Y",this.x)+"</div></div>";$.each(this.points,function(index){s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col">'+this.series.name+"</div>";s+='<div class="highcharts-tooltip-table__col">'+this.y+"</div></div>"});s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col"><b>TOTAL</b></div> <div class="highcharts-tooltip-table__col"><b>'+this.points[0].total+"</b></div></div>";s+="</div>";return s}},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:false,color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white",style:{textShadow:"0 0 3px black, 0 0 3px black"}},dataGrouping:{enabled:true,forced:true,units:[["month",[1]]]},showInNavigator:true}},series:series,navigator:{maskFill:"rgba(5, 54, 62, 0.16)",handles:{symbols:["circle","circle"],lineWidth:1,width:9,height:9,borderColor:"#004e55"},xAxis:{labels:{style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"}}},series:{type:"column",lineWidth:2,fillOpacity:.05,stacking:"normal",dataGrouping:{enabled:true,forced:true,units:[["month"]]},marker:{enabled:false}}},rangeSelector:{selected:5,inputBoxBorderColor:"#cecece",inputBoxWidth:90,inputBoxHeight:26,buttonTheme:{r:0,padding:5,width:39,verticalAlign:"middle",style:{borderRadius:0,color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"},states:{select:{fill:"#dbdbdb",style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px",fontWeight:"normal"}}}},inputStyle:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"},labelStyle:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px",height:"26px",width:35},inputBoxStyle:{borderWidth:1,fontSize:"13px",spacingTop:"10px"}},navigation:{menuItemHoverStyle:{background:"#E6E6E6",color:"#9f9f9f"},menuItemStyle:{padding:"0.1em 0.5em",fontSize:"15px",color:"#9f9f9f"},menuStyle:{border:"1px solid #cecece",padding:"10px 6px 15px 6px"}},responsive:{rules:[{condition:{maxWidth:1079},chartOptions:{chart:{height:700,spacingLeft:30,spacingRight:30}}},{condition:{maxWidth:710},chartOptions:{title:{margin:40,style:{color:"#12282B",fontSize:"22px"}},rangeSelector:{buttonTheme:{width:25,style:{fontSize:"12px"}},labelStyle:{fontSize:"12px"},inputStyle:{fontSize:"13px"}}}},{condition:{maxWidth:617},chartOptions:{chart:{height:970,spacingLeft:30,spacingRight:30},title:{margin:40,style:{color:"#12282B",fontSize:"22px"}},legend:{width:null,itemWidth:null},rangeSelector:{buttonTheme:{width:25,style:{fontSize:"12px"}},inputStyle:{fontSize:"11px"},buttonPosition:{align:"center",x:-65,y:10},inputPosition:{align:"center"}}}}]}};if($(".s-main").hasClass("s-rtl")){$option.legend.rtl=true}new Highcharts.stockChart($selector.attr("id"),$option)})})}if(document.querySelector(selector2)!==null){$dataPackageGraphs.each(function(){var $selector=$(this);var type=$selector.data("type");var paragraph_chart_id=$selector.data("paragraph-id");var title=$selector.data("title");var subtitle=$selector.data("subtitle");if(type=="stack"){type="stacked"}$.getJSON("/airtable/chart/"+type+"/"+paragraph_chart_id,function(data){var series=module.addMissingMonths(data);var $option3={chart:{type:"column",borderColor:"#cdcdcd",borderWidth:.5,spacingBottom:35,spacingLeft:38,spacingRight:38,spacingTop:30,height:650,style:{fontFamily:'"franklin-gothic-urw", Helvetica, Arial, sans-serif'},events:{load:function(){$selector.addClass("loaded")}}},credits:{style:{fontSize:"10px",letterSpacing:"0.3px",color:"#959595"}},exporting:{sourceWidth:860,sourceHeight:700,buttons:{contextButton:{symbolFill:"#05363e",symbolStroke:"#05363e",y:45,menuItems:["downloadPNG","downloadSVG","downloadJPEG","separator","printChart"]}}},title:{text:title||"",margin:40,style:{color:"#14272b",fontSize:"23px",lineHeight:"25px",letterSpacing:"-.4px"}},subtitle:{text:subtitle||"",style:{color:"#05363e",fontSize:"15px",lineHeight:"17px",letterSpacing:"0.8px"},y:50},xAxis:{stackLabels:{enabled:false},labels:{formatter:function(){return getChartMonthFromValue(this.value)},style:{fontSize:"13px",lineHeight:"15px",color:"#05363e",letterSpacing:"0.3px"}}},legend:{enabled:true,layout:"horizontal",align:"center",verticalAlign:"bottom",width:500,itemWidth:250,itemMarginBottom:15,itemStyle:{fontWeight:"normal",lineHeight:"15px",fontSize:"13px",color:"#555555",letterSpacing:"0.3px"}},tooltip:{backgroundColor:"#ffffff",borderRadius:0,borderWidth:1,borderColor:"#cecece",padding:15,shadow:false,split:false,shared:true,crosshairs:true,followPointer:true,followTouchMove:true,useHTML:true,formatter:function(){var s='<div class="highcharts-tooltip-table__elem">';s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col highcharts-tooltip-table__heading">'+Highcharts.dateFormat("%b %Y",this.x)+"</div></div>";$.each(this.points,function(index){s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col">'+this.series.name+"</div>";s+='<div class="highcharts-tooltip-table__col">'+this.y+"</div></div>"});s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col"><b>TOTAL</b></div> <div class="highcharts-tooltip-table__col"><b>'+this.points[0].total+"</b></div></div>";s+="</div>";return s}},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:false,color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white",style:{textShadow:"0 0 3px black, 0 0 3px black"}},dataGrouping:{enabled:true,forced:true,units:[["month",[1]]]},showInNavigator:true}},series:series,navigator:{maskFill:"rgba(5, 54, 62, 0.16)",handles:{symbols:["circle","circle"],lineWidth:1,width:9,height:9,borderColor:"#004e55"},xAxis:{labels:{style:{color:"#195156",fontSize:"15px"}}},series:{type:"column",lineWidth:2,fillOpacity:.05,stacking:"normal",dataGrouping:{enabled:true,forced:true,units:[["month"]]},marker:{enabled:false}}},rangeSelector:{selected:5,inputBoxBorderColor:"#cecece",inputBoxWidth:90,inputBoxHeight:26,buttonTheme:{r:0,padding:5,width:39,verticalAlign:"middle",style:{borderRadius:0,color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"},states:{select:{fill:"#dbdbdb",style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px",fontWeight:"normal"}}}},inputStyle:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"},labelStyle:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px",height:"26px",width:35},inputBoxStyle:{borderWidth:1,fontSize:"13px",spacingTop:"10px"}},navigation:{menuItemHoverStyle:{background:"#E6E6E6",color:"#9f9f9f"},menuItemStyle:{padding:"0.1em 0.5em",fontSize:"15px",color:"#9f9f9f"},menuStyle:{border:"1px solid #cecece",padding:"10px 6px 15px 6px"}},responsive:{rules:[{condition:{maxWidth:1079},chartOptions:{chart:{height:700,spacingLeft:30,spacingRight:30}}},{condition:{maxWidth:710},chartOptions:{title:{margin:40,style:{color:"#12282B",fontSize:"22px"}},rangeSelector:{buttonTheme:{width:25,style:{fontSize:"12px"}},labelStyle:{fontSize:"12px"},inputStyle:{fontSize:"13px"}}}},{condition:{maxWidth:617},chartOptions:{chart:{height:970,spacingLeft:30,spacingRight:30},legend:{width:null,itemWidth:null},rangeSelector:{buttonPosition:{align:"center",x:-65,y:10},inputPosition:{align:"center"}}}}]}};if($(".s-main").hasClass("s-rtl")){$option.legend.rtl=true}new Highcharts.stockChart($selector.attr("id"),$option3)})})}};handlers.push({name:"_stackedColumnInit",handle:function(){module.createStackedColumns()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("specialReportMap",function(window,$,app){"use strict";var module={},selector=".js-map",mapContainer="map-base";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];if(module.preInit()){var dataCasualtyIn=$(selector).attr("data-casualty-in").toLowerCase(),dataCasualtyLabel=$(selector).attr("data-title").toLowerCase(),dataUnder=$(selector).attr("data-under").toLowerCase(),dataFrom=$(selector).attr("data-from").toLowerCase(),dataCasualtyFrom=$(selector).attr("data-casualty-from").toLowerCase(),dataCasualtySame=$(selector).attr("data-casualty-same").toLowerCase(),dataNoData=$(selector).attr("data-nodata"),dataReadMore=$(selector).attr("data-readmore"),dataAll=$(selector).attr("data-all"),dataApply=$(selector).attr("data-apply"),dataCancel=$(selector).attr("data-cancel"),dataSelect=$(selector).attr("data-select"),dataTotal=$(selector).attr("data-total"),dataDestination=$(selector).attr("data-destination"),dataTotalDeaths=$(selector).attr("data-total-deaths"),dataShowAnnotation=$(selector).attr("data-annotation-display");var $el=$(selector);var _mapbox_token="pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw";var _mapBaseStyle="mapbox://styles/daltonwb/ck3ehyzfj4s6g1cpuiskvb5i3";var _global_startDate=0;var _global_endDate=0;var _globalStop=[];var _globalRadius=[];var _globalMerged=[];var _slideTriggerred=false;var _defaultStart=0;var _defaultEnd=0;var _globalRegions=null;var _hoveredRegion=null;var _hoveredBubble=null;mapboxgl.accessToken=_mapbox_token;var _maps=$.makeArray($(selector));var _mapParents=[];var _mapCollection=[];var ctr=1;_maps.forEach(function(a){var _container=a.dataset.map;var _long=a.dataset.longitude,_lat=a.dataset.latitude,_zoom=a.dataset.zoom;var map=new mapboxgl.Map({container:_container,style:_mapBaseStyle,center:[_long,_lat],zoom:_zoom});map.scrollZoom.disable();var nav=new mapboxgl.NavigationControl({showCompass:false});map.addControl(nav,"bottom-left");window["map"+ctr]=map;_mapCollection.push(map);_mapParents.push(a.dataset.parent);ctr++});var hoverPop=new mapboxgl.Popup({className:"mapboxgl--popup-hover",closeButton:false,closeOnClick:false,offset:20});var clickPop=new mapboxgl.Popup({className:"mapboxgl--popup-click",offset:20,closeButton:false});var connectPop=new mapboxgl.Popup({className:"mapboxgl--popup-connect",offset:20,closeButton:false,closeOnClick:false});var connectOrigin=new mapboxgl.Popup({className:"mapboxgl--popup-connectOrigin",offset:20,closeButton:false,closeOnClick:false});var connectDestination=new mapboxgl.Popup({className:"mapboxgl--popup-connectSame",offset:20,closeButton:false,closeOnClick:false});var markerPop=new mapboxgl.Popup({className:"mapboxgl--popup-marker",offset:0,closeButton:false,closeOnClick:false});var notationPop=new mapboxgl.Popup({className:"mapboxgl--popup-annotation",offset:0,closeButton:true,closeOnClick:true});var hometownPop=new mapboxgl.Popup({className:"mapboxgl--popup-hometown",offset:0,closeButton:false,closeOnClick:false});var hometownName=new mapboxgl.Popup({className:"mapboxgl--popup-hometown",offset:0,closeButton:false,closeOnClick:true})}module.addMissingMonths=function(arr){var dataArray=arr;var additionalData={};var locationList=$.map(dataArray,function(itemData){return itemData.properties.name}).filter(function(el,index,arr){return index===arr.indexOf(el)});$.each(locationList,function(idx){var filteredLocation=$.grep(dataArray,function(filteredData){return filteredData.properties.name==locationList[idx]});var dataYears=$.map(filteredLocation,function(filteredLocationData){return new Date(filteredLocationData.properties.date*1e3).getFullYear()}).filter(function(el,index,arr){return index===arr.indexOf(el)}).sort();$.each(dataYears,function(yrsidx,yrsvalue){var currentyear=yrsvalue;additionalData.properties={};var _monthsName={0:"Januray",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"};var yearlyItem=$.grep(filteredLocation,function(yearlyitemData){return new Date(yearlyitemData.properties.date*1e3).getFullYear()==dataYears[yrsidx]});var itemMonths=$.map(yearlyItem,function(monthsitemData){return new Date(monthsitemData.properties.date*1e3).getMonth()}).filter(function(el,index,arr){return index===arr.indexOf(el)});$.each(itemMonths,function(mtnhsidx,itmvalue){delete _monthsName[itmvalue]});$.each(_monthsName,function(eamnthsidx,mssvalue){var idNum=0;if(mssvalue=="February"){var dateDay="28"}else{var dateDay="30"}additionalData.id=0;additionalData.type=filteredLocation[0].type;additionalData.geometry=filteredLocation[0].geometry;additionalData.properties.category_color=filteredLocation[0].properties.category_color;additionalData.properties.category_name=filteredLocation[0].properties.category_name;additionalData.properties.center=filteredLocation[0].properties.center;additionalData.properties.code=filteredLocation[0].properties.code;additionalData.properties.count=0;additionalData.properties.date=new Date(mssvalue+" "+dateDay+", "+currentyear).getTime()/1e3;additionalData.properties.group=filteredLocation[0].properties.group;additionalData.properties.name=filteredLocation[0].properties.name;additionalData.properties.origin_center=filteredLocation[0].properties.origin_center;additionalData.properties.origin_center=filteredLocation[0].properties.origin_code;additionalData.properties.origin_name=filteredLocation[0].properties.origin_name;additionalData.properties.type=filteredLocation[0].properties.type;additionalData.properties.processed=true;dataArray.push(additionalData)});additionalData={}})});return dataArray};module.handleMap=function(){_mapCollection.forEach(function(map,i){var $parent=$("."+_mapParents[i]),_requestBubble=module.handleURLRequests($parent.data("airtable")),_regionFill=module.handleURLRequests($parent.data("geojson")),_isRTL=$parent.data("rtl");module.handleGenerateRegions(_requestBubble,null,null,map,_mapParents[i],_isRTL,_regionFill);module.handleGenerateBubble(_requestBubble,map,_mapParents[i],_isRTL);module.handleGenerateSlider(_requestBubble,_regionFill,i,map);module.handleDropdownBehavior(_mapParents[i]);module.handleDropdownFilter(_requestBubble,undefined,undefined,"."+_mapParents[i],map,"initial",_regionFill);module.handleDatePicker(_requestBubble,_regionFill,_mapParents[i],map);var _annotated=$parent.data("annotations");if(_annotated){var _annotations=module.handleURLRequests($parent.data("annotations"));module.handleAnnotation(_annotations,map)}$(".js-reset").click(function(){$(this).attr("disabled",true);module.handleReset(_mapParents[i],_requestBubble,map,_regionFill);module.removeLineConnection(map);$("."+_mapParents[i]+" .region-marker").remove()});$(".reset--connection","."+_mapParents[i]).click(function(e){e.preventDefault();module.removeLineConnection(map);$("."+_mapParents[i]+" .region-marker").remove()})});$(".map--overlay").click(function(){clickPop.remove();$(this).removeClass("is-shown")})};module.handleReset=function(_parent,_requestBubble,_map,_region){var _selector=$("."+_parent);$.when(_requestBubble).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);module.updateMapContents(_minDate,_maxDate,_requestBubble.responseText,_region.responseText,_requestResult,_map,_selector,"reset",[]);module.handleDropdownFilter(_requestBubble,undefined,undefined,"."+_parent,_map,"initial",_region);module.buildDatePicker("."+_parent,_minDate,_maxDate,_requestBubble,_region,_map);$(".map--slider",_selector).dateRangeSlider("destroy");module.mapSlider(_selector,_minDate,_maxDate,_minDate,_maxDate)})};module.buildDatePicker=function(_selector,_minDate,_maxDate,_requestData,_regionFill,_map){$('input[name="daterange"]',_selector).daterangepicker({opens:"left",timePicker:false,showDropdowns:true,linkedCalendars:false,startDate:_minDate,endDate:_maxDate,minYear:_minDate.getFullYear()-1,maxYear:_maxDate.getFullYear()+1,locale:{cancelLabel:dataCancel,applyLabel:dataApply}},function(start,end,label){_slideTriggerred=true;_global_startDate=start;_global_endDate=end;module.updateMapContents(new Date(start),new Date(end),_requestData.responseText,_regionFill.responseText,_requestData,_map,_selector,"update",[]);$(".js-reset").attr("disabled",false);$(".map--slider",$(_selector)).dateRangeSlider("destroy");module.mapSlider(_selector,_minDate,_maxDate,new Date(start),new Date(end));module.removeLineConnection(_map);$(_selector+" .region-marker").remove()})};module.handleAnnotation=function(_request,_theMap){$.when(_request).done(function(_requestResult){var _annotations=_requestResult;if(typeof _requestResult!="object"){_annotations=JSON.parse(_requestResult)}var _features=_annotations.features;var _annocation_counter=0;var _annotations=[];var _mapLoaded=_theMap.once("load",function(){return true});var _dataLoaded=_theMap.once("data",function(){return true});if(_mapLoaded&&_dataLoaded){_features.forEach(function(a){var _title=a.properties.title;var _desc=a.properties.description;var _html="";_html+='<div class="annotation--wrapper [ u-franklin u-fsn u-fwn ]">';_html+="<h3>"+_title+"</h3>";_html+="<p>"+_desc+"</p>";if(typeof a.properties.url!=="undefined"){_html+='<a href="'+a.properties.url+'">'+dataReadMore+"</a>"}_html+="</div>";var _popInstance_class="mapboxgl--popup-annotation annotation--"+_annocation_counter;_popInstance_class+=dataShowAnnotation!=="off"?" open":"";var _popInstance=new mapboxgl.Popup({className:_popInstance_class,offset:0,closeButton:true,closeOnClick:false}).setLngLat(a.geometry.coordinates).setHTML(_html).addTo(_theMap);_annotations.push(_popInstance);var el=document.createElement("div");var _class="marker--annotation annotation--"+_annocation_counter;el.className=_class;el.setAttribute("data-id",_annocation_counter);new mapboxgl.Marker(el).setLngLat(a.geometry.coordinates).addTo(_theMap);_annocation_counter++})}$(".marker--annotation").click(function(){var _id=$(this).data("id");_id=parseInt(_id);var $annotation=$(".annotation--"+_id);_annotations[_id].addTo(_theMap);if($annotation.hasClass("open")){$annotation.removeClass("open")}else{$annotation.addClass("open")}});var resizeTimer;$(window).on("load resize",function(e){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){var _windowWidth=$(window).innerWidth();if(_windowWidth<760){_annotations.forEach(function(a){a.remove()})}else if(dataShowAnnotation==="off"&&_windowWidth>760){_annotations.forEach(function(a){a.remove()})}else{_annotations.forEach(function(a){a.addTo(_theMap)})}},250)})})};module.handleCasualtiesRegion=function(_request,_min,_max,_category,selector){var _regionContainer=$(".js-legends__region--sizes",$(selector));var _countMax=0;var _stops=[];$.when(_request).done(function(_requestResult){var _request=_requestResult;if(typeof _requestResult!="object"){_request=JSON.parse(_requestResult)}var _data=_request.features;var _minDate=module.handleMinDate(_requestResult);var _maxDate=module.handleMaxDate(_requestResult);if(_min||_max){var _allData=[];var _mapType=$(selector).data("type");var _blockGroup="region";var _blockType="destination";_allData=$.grep(_data,function(a){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){_allData=$.grep(_data,function(a){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&$.inArray(a.properties.category_name,_category)>=0})}var _allRegions=$.unique($.map(_allData,function(a){return a.properties.code}).sort());var _groupRegionCount=[];_allRegions.forEach(function(a){var _countAll=0;_allData.forEach(function(b){if(a===b.properties.code){_countAll+=b.properties.count}});_groupRegionCount.push(_countAll)});_countMax=Math.max.apply(null,_groupRegionCount);var _portions=_countMax/5;var _region1=Math.round(_portions);var _region2=Math.round(_portions*2);var _region3=Math.round(_portions*3);var _region4=Math.round(_portions*4);var _region5=_countMax;_regionContainer.html("");var _html="";var _display=_region1===0?_countMax:_region1;_stops.push([_display,"#f2e5ab"]);_html+='<span><i class="region-1"></i> 1-'+_display+"</span>";if(_region1+1<_region2){_display=_region2===0?_countMax:_region2;_stops.push([_region1+1,"#ffb842"]);_html+='<span><i class="region-2"></i> '+(_region1+1)+"-"+_display+"</span>"}if(_region2+1<_region3){_display=_region3===0?_countMax:_region3;_stops.push([_region2+1,"#ff8800"]);_html+='<span><i class="region-3"></i> '+(_region2+1)+"-"+_display+"</span>"}if(_region3+1<_region4){_display=_region4===0?_countMax:_region4;_stops.push([_region3+1,"#ff5800"]);_html+='<span><i class="region-4"></i> '+(_region3+1)+"-"+_display+"</span>"}if(_region4+1<_region5){_display=_region5===0?_countMax:_region5;_stops.push([_region4+1,"#bb0000"]);_html+='<span><i class="region-5"></i> '+(_region4+1)+"-"+_display+"</span>"}if(_countMax===0){_html=dataNoData}_regionContainer.append(_html)}});_globalStop=_stops;return _stops};module.handleCasualtiesLocation=function(_request,_min,_max,_category,selector){var _radiusContainer=$(".js-legends__bubble--sizes",$(selector));var _countMax=0;var _stops=[];$.when(_request).done(function(_requestResult){var _request=_requestResult;if(typeof _requestResult!="object"){_request=JSON.parse(_requestResult)}var _data=_request.features;var _minDate=module.handleMinDate(_requestResult);var _maxDate=module.handleMaxDate(_requestResult);if(_min||_max){var _allData=[];var _mapType=$(selector).data("type");var _blockGroup="city";var _blockType=_mapType==="connection"||_mapType==="hometown"?"origin":"destination";_allData=$.grep(_data,function(a){if(_mapType==="hometown"){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&a.properties.show_in_hometown===1}else{return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType}});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){_allData=$.grep(_data,function(a){if(_mapType==="hometown"){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&$.inArray(a.properties.category_name,_category)>=0&&a.properties.show_in_hometown===1}else{return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&$.inArray(a.properties.category_name,_category)>=0}})}var _allCities=$.unique($.map(_allData,function(a){return a.properties.code}).sort());var _groupRegionCount=[];_allCities.forEach(function(a){var _countAll=0;_allData.forEach(function(b){if(a===b.properties.code){_countAll+=b.properties.count}});_groupRegionCount.push(_countAll)});_countMax=Math.max.apply(null,_groupRegionCount);var _group1=Math.round(_countMax/3);var _group2=Math.round(_group1+1);var _group3=Math.round(_group1+_group2+1);_radiusContainer.html("");var _html="";var _html='<div class="labels"><span class="label-left"><i class="radius-l"></i></span><span class="label-right"><i class="radius-label">'+_group3+"-"+_countMax+"</i></span></div>";_html+='<div class="labels"><span class="label-left"><i class="radius-m"></i></span><span class="label-right"><i class="radius-label">'+_group2+"-"+(_group3-1)+"</i></span></div>";_html+='<div class="labels"><span class="label-left"><i class="radius-s"></i></span><span class="label-right"><i class="radius-label"> 1-'+(_group2-1)+"</i></span></div>";_radiusContainer.append(_html);_stops.push([0,5]);_stops.push([_group2,10]);_stops.push([_group3,15])}});_globalRadius=_stops;return _stops};module.handleDropdownBehavior=function(_parent){var parent="."+_parent;$(".js--label",$(parent)).click(function(){$(".map-filter--dropdown",$(parent)).toggleClass("is-open")})};module.handleDropdownFilter=function(_request,_min,_max,_parent,_theMap,_status,_region){var _req=_request;var selector=_parent;$.when(_request).done(function(_requestResult){var _request=_requestResult;if(typeof _requestResult!="object"){_request=JSON.parse(_requestResult)}var _categories=_request.features;var _minDate=module.handleMinDate(_requestResult);var _maxDate=module.handleMaxDate(_requestResult);var _mapType=$(selector).data("type");var _blockGroup="city";var _blockType="destination";if(_min||_max){_categories=$.grep(_request.features,function(a){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.type==_blockType});_minDate=_min;_maxDate=_max}else{_categories=$.grep(_request.features,function(a){return a.properties.type==_blockType})}if(_mapType==="hometown"){_categories=$.grep(_categories,function(a){return a.properties.show_in_hometown===1})}var _allCategories=$.unique($.map(_categories,function(a){return a.properties.category_name}).sort());var _filterContainer=$(".js--option",$(selector));var _filterLabel=$(".js--label",$(selector));var _html="";var _default='<label><input type="checkbox" name="filter-option" class="option-trigger option-all" value="all" checked="checked" />'+dataAll+"</label>";if(_allCategories.length===0){_default="";_filterLabel.text(dataNoData)}else{_filterLabel.text(dataAll)}_filterContainer.html(_default);_allCategories.forEach(function(a){_html+='<label><input type="checkbox" name="filter-option" class="option-trigger" value="'+a+'" />'+a+"</label>"});_html+='<div class="option-buttons">';_html+='  <input type="submit" class="option-submit" value="'+dataApply+'">';_html+='  <input type="reset" class="option-reset" value="'+dataCancel+'">';_html+="</div>";_filterContainer.append(_html);$(".option-reset",$(selector)).click(function(){var _text="";$(".option-trigger",$(selector)).prop("checked",false);$(".option-all").prop("checked",true);_text=dataSelect;_filterLabel.text(_text);$(".map-filter--dropdown",$(selector)).removeClass("is-open")});$(".option-trigger",$(selector)).click(function(){var _value=$(this).attr("value");var _text="";if(_value==="all"){$(".option-trigger",$(selector)).prop("checked",false);$(this).prop("checked",true);_text=dataAll}else{$(".option-all",$(selector)).prop("checked",false);if($(".option-trigger:checked",$(selector)).length===1){var $checked=$(".option-trigger:checked",$(selector));_text=$checked.attr("value")}else if($(".option-trigger:checked",$(selector)).length>1){_text=$(".option-trigger:checked",$(selector)).length+" options selected"}else{_text=dataSelect}}_filterLabel.text(_text)});$(".option-submit",$(selector)).click(function(){module.removeLineConnection(_theMap);$(selector+" .region-marker").remove();clickPop.remove();$(".js-reset").attr("disabled",false);$(".map-filter--dropdown",$(selector)).removeClass("is-open");var _filter=["in","category_name"];var _cats=[];$(".option-trigger:checked",$(selector)).each(function(){_filter.push($(this).attr("value"));_cats.push($(this).attr("value"))});if($(".option-trigger:checked",$(selector)).attr("value")==="all"||$(".option-trigger:checked",$(selector)).length<1){_filter=["!in","category_name","all"]}var filters=["all",[">=","date",_minDate],["<=","date",_maxDate],_filter];module.handleCasualtiesRegion(_req,_minDate,_maxDate,_cats);module.handleCasualtiesLocation(_req,_minDate,_maxDate,_cats);if(_mapType!=="hometown"){module.updateMapContents(new Date(_minDate*1e3),new Date(_maxDate*1e3),_req.responseText,_region.responseText,_req,_theMap,selector,"update",_cats);var _filteredLayer=_theMap.queryRenderedFeatures({layers:["layerRegionCenter"]});var _filteredRegions=$.grep(_filteredLayer,function(a){if(a.properties.date>=_minDate&&a.properties.date<=_maxDate&&_cats.includes(a.properties.category_name)){return a}});var _showMarker=$(selector).data("markers");if(_showMarker==="on"){module.handlePlotMarkers(_filteredRegions,_theMap,"update",_blockGroup)}}})})};module.handlePlotMarkers=function(_arraySource,_theMap,_status,_mapGroup){if(_status!=="initial"||_status==="reset"){$(".region-center-marker").remove()}if(_mapGroup!=="city"||_mapGroup===undefined){_arraySource.forEach(function(a){var el=document.createElement("div");el.className="region-center-marker "+_status;new mapboxgl.Marker(el).setLngLat(eval(a.properties.center)).addTo(_theMap)})}};module.handleDatePicker=function(_request,_region,_parent,_theMap){var selector="."+_parent;$.when(_request).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);module.buildDatePicker(selector,_minDate,_maxDate,_request,_region,_theMap)})};module.mapSlider=function(selector,_minDate,_maxDate,start,end){$(".map--slider",$(selector)).dateRangeSlider({bounds:{min:new Date(_minDate.getFullYear(),_minDate.getMonth(),1),max:_maxDate},defaultValues:{min:start,max:end},valueLabels:"change",durationIn:1e3,durationOut:1e3})};module.updateMapContents=function(_min,_max,_requestResponseText,_regionResponseText,_request,_theMap,_selector,_status,_category){_global_startDate=Date.parse(_min)/1e3;_global_endDate=Date.parse(_max)/1e3;var filters=["all",[">=","date",_global_startDate],["<=","date",_global_endDate]];var _mapType=$(_selector).data("type");var _blockGroup="region";var _blockType="destination";var _json=_requestResponseText;if(typeof _requestResponseText!="object"){_json=JSON.parse(_requestResponseText)}var _merge=$.grep(_json.features,function(a){if(_category.length>0&&_category[0]!=="all"){return a.properties.group===_blockGroup&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate&&_category.includes(a.properties.category_name)}else{return a.properties.group===_blockGroup&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate}});var _regions=[];if(typeof _requestResponseText!="object"){_regions=JSON.parse(_regionResponseText).features}else{_regions=_regionResponseText.features}_merge.forEach(function(a){_regions.forEach(function(b){if(a.properties.code===b.code){a.geometry=b.geometry}})});var _allRegion=$.unique($.map(_merge,function(a){return a.properties.code}).sort());var _newRegion=[];var _newRegionMarker=[];var _newCount=[];var obj={};var _centerMarker={};_allRegion.forEach(function(a){var count=0;_merge.forEach(function(b){if(a===b.properties.code){count+=b.properties.count;obj=b;_centerMarker={id:b.properties.id,type:"Feature",geometry:{type:"Point",coordinates:b.properties.center},properties:{name:b.properties.name,category_name:b.properties.category_name,date:b.properties.date,center:b.properties.center}}}});_newCount.push(count);_newRegion.push(obj);_newRegionMarker.push(_centerMarker)});var i=0;var _regionClone=_newRegion.slice(0);_regionClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});var _showMarker=$(_selector).data("markers");if(_showMarker==="on"){module.handlePlotMarkers(_regionClone,_theMap,_status,_blockGroup)}_theMap.getSource("_regionSource").setData({type:"FeatureCollection",features:_newRegion});_theMap.getSource("_regionCenter").setData({type:"FeatureCollection",features:_newRegionMarker});var _merge=$.grep(_json.features,function(a){if(_mapType==="hometown"){return a.properties.group==="city"&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate&&a.properties.show_in_hometown===1}else{return a.properties.group==="city"&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate}});var _cities=[];if(typeof _requestResponseText!="object"){_cities=JSON.parse(_regionResponseText).features}else{_cities=_regionResponseText.features}var _allCities=$.unique($.map(_merge,function(a){return a.properties.code}).sort());var _newCity=[];var _newCount=[];var obj={};_allCities.forEach(function(a){var count=0;_merge.forEach(function(b){if(a===b.properties.code){count+=b.properties.count;obj=b}});_newCount.push(count);_newCity.push(obj)});var i=0;var _cityClone=_newCity.slice(0);_cityClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});_theMap.getSource("_regionBubbles").setData({type:"FeatureCollection",features:_newCity});module.handleCasualtiesRegion(_request,_global_startDate,_global_endDate,null,_selector);module.handleCasualtiesLocation(_request,_global_startDate,_global_endDate,null,_selector);var _stopsStyle={property:"count",type:"interval",stops:_globalStop};var _stopsRadius={property:"count",type:"interval",stops:_globalRadius};_theMap.setPaintProperty("layerRegion","fill-color",_stopsStyle);_theMap.setPaintProperty("layerBubble","circle-radius",_stopsRadius)};module.handleGenerateSlider=function(_request,_region,i,_theMap){var loadRegion=setInterval(function(){var _region=_theMap.getLayer("layerRegion");var _bubble=_theMap.getLayer("layerBubble");if(_region!==undefined&&_bubble!==undefined){_theMap.moveLayer("layerBubble");clearInterval(loadRegion)}},100);var selector="."+_mapParents[i];$.when(_request).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"];module.mapSlider(selector,_minDate,_maxDate,_minDate,_maxDate);if(typeof _requestResult!="object"){_requestResult=JSON.parse(_requestResult)}var _allDates=$.unique($.map(_requestResult.features,function(a){var date=new Date(a.properties.date*1e3);if(!isNaN(date.getFullYear())){return date.getFullYear()}})).sort();var _years="";_allDates=$.unique(_allDates);_allDates.forEach(function(a){_years+='<span class="year--marking">'+a+"</span>";if(_allDates.length<4){_years+="<span>0000</span><span>0000</span><span>0000</span>"}else{_years+="<span>0000</span>"}});$(".map--slider__years",$(selector)).append(_years);var _minLabel=_minDate.getMonth()+1+"/"+_minDate.getDate()+"/"+_minDate.getFullYear();var _maxLabel=_maxDate.getMonth()+1+"/"+_maxDate.getDate()+"/"+_maxDate.getFullYear();var _dateLabel='<p class="date--start">'+_minLabel+"</p>";_dateLabel+='<p class="date--end">'+_maxLabel+"</p>";$(".map--slider__marking",$(selector)).append(_dateLabel);$(".map--slider",$(selector)).on("valuesChanging",function(e,data){$(".js-reset").attr("disabled",false);clickPop.remove();_slideTriggerred=true;var _min=data.values.min;var _max=data.values.max;module.buildDatePicker(selector,_minDate,_maxDate,_request,_region,_theMap);module.updateMapContents(_min,_max,_request.responseText,_region.responseText,_request,_theMap,selector,"update",[]);module.removeLineConnection(_theMap);$(selector+" .region-marker").remove()})})};module.handleGenerateBubble=function(_request,_theMap,_parent,_isRTL){var _bubbles=_request;$.when(_bubbles).done(function(_bubbleData){var _parentSelector="."+_parent;var _mapType=$(_parentSelector).data("type");var _mapGroup=$(_parentSelector).data("group");var _blockGroup="city";var _blockType=_mapType==="connection"?"origin":"destination";var startDate=module.handleMinDate(_bubbleData);var endDate=module.handleMaxDate(_bubbleData);var _merged=module.handleProcessRequest(_bubbleData,_blockType,_blockGroup);_merged=$.grep(_merged,function(a){if(_mapType==="hometown"){return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.show_in_hometown===1}else{return a.properties.date>=startDate&&a.properties.date<=endDate}});var _mergeClone=$.grep(JSON.parse(_bubbleData).features,function(a){if(_mapType==="hometown"){return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.group==="city"&&a.properties.show_in_hometown===1&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.group==="city"&&a.properties.type==="destination"}});var _allCity=$.unique($.map(_merged,function(a){return a.properties.code}).sort());var _newCity=[];var _newCount=[];var obj={};_allCity.forEach(function(a){var count=0;_merged.forEach(function(b){if(a===b.properties.code){count+=b.properties.count;obj=b}});_newCount.push(count);_newCity.push(obj)});var i=0;var _cityClone=_newCity.slice(0);_cityClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});var myGeoJSON={};myGeoJSON.type="FeatureCollection";myGeoJSON.features=_cityClone;var _stops=module.handleCasualtiesLocation(_bubbles,startDate,endDate,null,"."+_parent);var _mapLoaded=false;var _dataLoaded=false;_mapLoaded=_theMap.once("load",function(){return true});_dataLoaded=_theMap.once("data",function(){return true});if(_mapLoaded&&_dataLoaded){var _hoveredBubble=false;_theMap.addSource("_regionBubbles",{type:"geojson",data:myGeoJSON});var _opacity=.7;var _opacityHover=1;var _visibilty="visible";if(_mapType==="connection"&&_mapGroup==="region"){_opacity=0;_visibilty="none"}var preload_bubble_layer=setInterval(function(){if(_theMap.loaded()){_theMap.addLayer({id:"layerBubble",type:"circle",source:"_regionBubbles",layout:{visibility:_visibilty},paint:{"circle-color":"#730000","circle-stroke-color":"white","circle-stroke-width":2,"circle-radius":{base:1,property:"count",type:"interval",stops:_stops},"circle-opacity":["case",["boolean",["feature-state","hover"],false],_opacityHover,_opacity]}});clearInterval(preload_bubble_layer)}},300);var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerBubble",function(e){if(e.features.length>0){if(_hoveredBubble){_theMap.setFeatureState({source:"_regionBubbles",id:_hoveredBubble},{hover:false})}_hoveredBubble=e.features[0].id;_theMap.setFeatureState({source:"_regionBubbles",id:_hoveredBubble},{hover:true})}});_theMap.on("mouseleave","layerBubble",function(){if(_hoveredBubble){_theMap.setFeatureState({source:"_regionBubbles",id:_hoveredBubble},{hover:false})}_hoveredBubble=null});module.handleMapEvents("layerBubble",myGeoJSON,startDate,endDate,_theMap,_parent,_mergeClone,_isRTL);$(".map--preloader").addClass("is--loaded")}})};module.handleGenerateRegions=function(_request,_min,_max,_theMap,_parent,_isRTL,_regionFill){var _regions=_request;$.when(_regions).done(function(_regionData){var startDate=module.handleMinDate(_regionData);var endDate=module.handleMaxDate(_regionData);if(_min||_max){startDate=_min;endDate=_max;_global_startDate=startDate;_global_endDate=endDate}var _parentSelector="."+_parent;var _mapType=$(_parentSelector).data("type");var _mapGroup=$(_parentSelector).data("group");var _blockGroup="region";var _blockType=_mapType==="connection"?"origin":"destination";var _merged=module.handleProcessRequest(_regionData,_blockType,_blockGroup);_merged=$.grep(_merged,function(a){return a.properties.date>=startDate&&a.properties.date<=endDate});var _mergeClone=$.grep(JSON.parse(_regionData).features,function(a){return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.group==="region"&&a.properties.type==="destination"});var _allRegion=$.unique($.map(_merged,function(a){return a.properties.code}).sort());var _newRegion=[];var _newRegionMarker=[];var _newCount=[];var obj={};var _centerMarker={};_allRegion.forEach(function(a){var count=0;_merged.forEach(function(b){if(a===b.properties.code){count+=b.properties.count;obj=b;_centerMarker={id:b.properties.id,type:"Feature",geometry:{type:"Point",coordinates:b.properties.center},properties:{name:b.properties.name,category_name:b.properties.category_name,date:b.properties.date,center:b.properties.center}}}});_newCount.push(count);_newRegion.push(obj);_newRegionMarker.push(_centerMarker)});var i=0;var _regionClone=_newRegion.slice(0);_regionClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});var myGeoJSON={};myGeoJSON.type="FeatureCollection";myGeoJSON.features=_newRegion;var myCenterJSON={};myCenterJSON.type="FeatureCollection";myCenterJSON.features=_newRegionMarker;var geoJSONModal={};geoJSONModal.type="FeatureCollection";geoJSONModal.features=_merged;var _stops=module.handleCasualtiesRegion(_regions,startDate,endDate,null,"."+_parent);$.when(_regionFill).done(function(_fillData){var _fill=_fillData;if(typeof _fillData!="object"){_fill=JSON.parse(_fillData)}myGeoJSON.features.forEach(function(a){_fill.features.forEach(function(b){if(a.properties.code===b.code){a.geometry=b.geometry;a.properties.fill=b.properties.fill}})});var _mapLoaded=false;var _dataLoaded=false;_mapLoaded=_theMap.once("load",function(){return true});_dataLoaded=_theMap.once("data",function(){return true});if(_mapLoaded&&_dataLoaded){var _hoveredRegion=false;_theMap.addSource("_regionSource",{type:"geojson",data:myGeoJSON});_theMap.addSource("_regionCenter",{type:"geojson",data:myCenterJSON});var _opacityHover=1;var _opacityNormal=.75;var _visibilty="visible";if((_mapType==="connection"||_mapType==="hometown")&&_mapGroup==="city"){_opacityHover=0;_opacityNormal=0;_visibilty="none"}var preload_region_layer=setInterval(function(){if(_theMap.loaded()){_theMap.addLayer({id:"layerRegion",type:"fill",source:"_regionSource",layout:{visibility:_visibilty},paint:{"fill-color":{property:"count",type:"interval",stops:_stops},"fill-opacity":["case",["boolean",["feature-state","hover"],false],_opacityHover,_opacityNormal]},filter:["all",[">=","date",startDate],["<=","date",endDate]]});_theMap.addLayer({id:"layerRegionOutline",type:"line",source:"_regionSource",layout:{visibility:_visibilty},paint:{"line-color":"white","line-width":2}});var _showMarker=$(_parentSelector).data("markers");var _centerVisibility="none";if(_showMarker==="on"){_centerVisibility="visible"}_theMap.addLayer({id:"layerRegionCenter",type:"circle",source:"_regionCenter",layout:{visibility:_centerVisibility},paint:{"circle-color":"red","circle-radius":10,"circle-opacity":0}});if(_showMarker==="on"){module.handlePlotMarkers(_regionClone,_theMap,"initial",_mapGroup)}clearInterval(preload_region_layer)}$(".map--preloader").addClass("is--loaded")},100);var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerRegion",function(e){if(e.features.length>0){if(_hoveredRegion){_theMap.setFeatureState({source:"_regionSource",id:_hoveredRegion},{hover:false})}_hoveredRegion=e.features[0].id;_theMap.setFeatureState({source:"_regionSource",id:_hoveredRegion},{hover:true})}});_theMap.on("mouseleave","layerRegion",function(){if(_hoveredRegion){_theMap.setFeatureState({source:"_regionSource",id:_hoveredRegion},{hover:false})}_hoveredRegion=null});module.handleMapEvents("layerRegion",myGeoJSON,startDate,endDate,_theMap,_parent,_mergeClone,_isRTL)}})})};module.handleMapEvents=function(_type,_source,_min,_max,_theMap,_selector,_originalSource,_isRTL){var _parentSelector="."+_selector;var _event=module.isMobileSafari()?"touchstart":"click";_theMap.on(_event,_type,function(e){var filters=_theMap.getFilter(_type);var _startDate=_min;var _endDate=_max;var _sourceType="_regionBubbles";if(_type==="layerRegion"){_sourceType="_regionSource"}var _category=[];$("."+_selector).find(".option-trigger:checked").each(function(){_category.push($(this).attr("value"))});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){var _originalSourceFiltered=$.grep(_originalSource,function(a){return $.inArray(a.properties.category_name,_category)>=0})}else{var _originalSourceFiltered=_originalSource}var _originalSourceAddedMissingMonths=module.addMissingMonths(_originalSourceFiltered);var _mapSource=_theMap.getSource(_sourceType);var _mapType=$(_parentSelector).data("type");var _blockGroup=_type=="layerRegion"?"region":"city";var _blockType=_mapType==="connection"?"origin":"destination";var _all_data_source={};_all_data_source.type="FeatureCollection";_all_data_source.features=_originalSourceFiltered;if(_blockGroup==="region"){}var _sourceArray=$.grep(_all_data_source.features,function(a){return a.properties.code===e.features[0].properties.code&&a.properties.group===_blockGroup&&a.properties.type===_blockType});if(_slideTriggerred){_startDate=_global_startDate;_endDate=_global_endDate}var _count=0;var _city=$.grep(_sourceArray,function(a){return a.properties.code===e.features[0].properties.code&&a.properties.date>=_startDate&&a.properties.date<=_endDate});var _cityData=$.grep(_sourceArray,function(a){return a.properties.code===e.features[0].properties.code&&a.properties.date>=_startDate&&a.properties.date<=_endDate});_city.forEach(function(a){_count+=a.properties.count});var _series=[];var _allDatesx=$.unique($.map(_city,function(a){var _date=new Date(a.properties.date*1e3);if(a.properties.code===e.features[0].properties.code){return _date.getFullYear()}}).sort());var _allDates=[];_allDatesx.forEach(function(year){for(var i=0;i<12;i++){_allDates.push(year+"-"+i+"-"+1)}});var _addDatesLabel=$.map(_allDates,function(a){var _monthsName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var _str=a.split("-");return _monthsName[_str[1]]+"<span class='spacer [ u-fwn u-fsn u-franklin ]'><br></span>"+_str[0]});var _allCategories=$.unique($.map(_city,function(a){return a.properties.category_name}).sort());var _series=[];var _obj={};_allCategories.forEach(function(a){_obj={};var _dates=[];_cityData.forEach(function(b){var _date=[];if(a===b.properties.category_name){_obj.name=b.properties.category_name;_date.push(b.properties.date*1e3);_date.push(b.properties.count)}_dates.push(_date)});var _monthsName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var _dateSort=$.grep(_dates,function(n){return n.length!==0}).sort(function(a,b){if(new Date(a)>new Date(b)){return 1}else if(new Date(a)<new Date(b)){return-1}else{return 0}});var _years=$.unique($.map(_dates,function(a){if(a.length!==0){var _y=new Date(a[0]).getFullYear();var _d=new Date(a[0]).getMonth();return _y+"-"+_monthsName[_d]+"-1"}}).sort());var _arr=[];_allDates.forEach(function(year){var _c=0;var _ar=[];_dateSort.forEach(function(item){var _compare=new Date(item[0]).getFullYear()+"-"+new Date(item[0]).getMonth()+"-1";if(year===_compare){_c+=item[1]}});_arr.push([_c])});_obj.data=_arr;_series.push(_obj)});if(_mapType!=="hometown"){var _html="";_html='<div class="mapboxgl--graph__wrapper"><span class="mapboxgl--graph__visual-close">&times;</span>';_html+='<div class="mapboxgl--graph__visual" id="js-visual">';_html+="</div>";_html+='<div class="mapboxgl--graph__summary">';_html+='<p class="mapboxgl--graph__summary--highlight [ u-fwn u-fsn u-franklin ] ">'+_count+"</p>";_html+='<p class="[ u-fwn u-fsn u-franklin u-ttu ]">'+dataTotalDeaths+'</p><a href="https://www.highcharts.com/" class="highcharts-credits [ u-franklin ]">Highcharts.com</a>';_html+="</div>";_html+="</div>";clickPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap);Highcharts.chart("js-visual",{chart:{type:"column",height:400,style:{fontFamily:'"franklin-gothic-urw", Helvetica, Arial, sans-serif'}},title:{rtl:_isRTL,text:e.features[0].properties.name+'<br><span class="mapbox-graph__subtitle">'+dataCasualtyLabel+"</span>",style:{color:"#14272b",fontSize:"23px",lineHeight:"25px",letterSpacing:"-.4px",marginBottom:"10px"}},credits:{enabled:false},xAxis:{categories:_addDatesLabel,labels:{style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"}}},yAxis:{min:0,title:{text:null},labels:{style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"}}},exporting:{enabled:false},tooltip:{shadow:false,rtl:_isRTL,useHTML:true,headerFormat:'<p class="tooltip-header [ u-fwn u-fsn u-franklin ]" style="margin: 0; font-size: 13px; text-align: center;">{point.key}</p>',pointFormat:'<p style="display: flex; justify-content: space-between; margin-top: 5px; margin-bottom: 0; font-size: 13px;">'+"<span>{series.name}</span>"+'<strong style="margin-left: 5px;">{point.y}</strong>'+"<p/>",footerFormat:'<p style="font-weight: 700; display: flex; justify-content: space-between" class="[ u-fwn u-fsn u-franklin ]"><span>'+dataTotal+"</span><span>{point.total}</span></p>",padding:15,backgroundColor:"#ffffff",borderColor:"#cecece",borderRadius:0,borderWidth:1,shared:true,formatter:function(){var s='<div class="highcharts-tooltip-table__elem">';s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col highcharts-tooltip-table__heading [ u-fwn u-fsn u-franklin ]" style="color: #05363e">'+this.x.replace("/<brs*/?>/gi"," ")+"</div></div>";$.each(this.points,function(index){s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col series--name [ u-fwn u-fsn u-franklin ]">'+this.series.name+"</div>";s+='<div class="highcharts-tooltip-table__col series--value [ u-fwn u-fsn u-franklin ]">'+this.y+"</div></div>"});s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col  series--total [ u-fwn u-fsn u-franklin ]"><b style="text-transform:uppercase;">'+dataTotal+'</b></div> <div class="highcharts-tooltip-table__col series--total--value"><b>'+this.points[0].total+"</b></div></div>";s+="</div>";return s}},plotOptions:{column:{stacking:"normal"}},legend:{rtl:_isRTL,enabled:true,verticalAlign:"bottom",itemMarginBottom:8,itemStyle:{fontWeight:"normal",lineHeight:"15px",fontSize:"13px",color:"#555555",letterSpacing:"0.3px"}},series:_series});window.dispatchEvent(new Event("resize"))}$(".map--overlay").addClass("is-shown");$(".mapboxgl--graph__visual-close").click(function(){clickPop.remove();$(".map--overlay").removeClass("is-shown")});if(_mapType==="connection"||_mapType==="hometown"){var _origin={code:e.features[0].properties.code,date:e.features[0].properties.date,from:e.features[0].properties.origin_code};var _mapType={type:_blockType,group:_blockGroup,map:_mapType};var _overAllCount=_count;module.handleDrawConnection(e,_theMap,_sourceArray,_source,_origin,_cityData,_mapType,_overAllCount,_parentSelector)}});var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,_type,function(e){var _startDate=_min;var _endDate=_max;var _sourceType="_regionBubbles";if(_type==="layerRegion"){_sourceType="_regionSource"}var _mapSource=_theMap.getSource(_sourceType);var _category=[];$("."+_selector).find(".option-trigger:checked").each(function(){_category.push($(this).attr("value"))});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){var _originalSourceFiltered=$.grep(_originalSource,function(a){return $.inArray(a.properties.category_name,_category)>=0})}else{var _originalSourceFiltered=_originalSource}var _sourceArray=_source.features;var _all_data_source={};_all_data_source.type="FeatureCollection";_all_data_source.features=_originalSourceFiltered;var _mapType=$(_parentSelector).data("type");var _blockGroup=_type=="layerRegion"?"region":"city";var _blockType=_mapType==="connection"?"origin":"destination";var _sourceArray=$.grep(_all_data_source.features,function(a){return a.properties.code===e.features[0].properties.code&&a.properties.group===_blockGroup&&a.properties.type===_blockType&&a.properties.date>=_startDate&&a.properties.date<=_endDate});if(_slideTriggerred){_startDate=_global_startDate;_endDate=_global_endDate}var _count=0;var _city=$.grep(_sourceArray,function(a){return a.properties.code===e.features[0].properties.code&&a.properties.date>=_startDate&&a.properties.date<=_endDate});_city.forEach(function(a){_count+=a.properties.count});var _html="";var _mapType=$(_parentSelector).data("type");_html+='<div class="mapboxgl--hover__data"><p class="[ u-franklin u-fsn u-fwn ]">';_html+="<b>"+_count+"</b>";_html+="<span>&nbsp;"+dataCasualtyIn+"&nbsp;</span>";_html+="<b>"+e.features[0].properties.name+"</b>";_html+="</p></div>";markerPop.remove();if(_mapType!=="connection"){hoverPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}});var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerRegionCenter",function(e){var _html="";_html+='<div class="mapboxgl--hover__data"><p class="[ u-franklin u-fsn u-fwn ]">';_html+=e.features[0].properties.name;_html+="</p></div>";hoverPop.remove();var _mapType=$(_parentSelector).data("type");if(_mapType==="simple"){markerPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}});_theMap.on("mouseleave",_type,function(e){hoverPop.remove();markerPop.remove()});_theMap.on("layerRegionCenter",_type,function(e){hoverPop.remove();markerPop.remove()})};module.handleDrawConnection=function(_e,_theMap,_sourceArray,_sourceAll,_origin,_originalSource,_mapType,_overAll,_parentSelector){var mapLayer=_theMap.getLayer("layerPoints");var _isCenter="false";if(typeof mapLayer!=="undefined"){_theMap.removeLayer("layerPoints").removeSource("_pointsOrigin");_theMap.removeLayer("layerString").removeSource("_pointsString");try{$(_parentSelector+" .region-marker").remove()}catch(e){console.log(e);console.log("No marker was intantiated.")}}var _centerCode=_e.features[0].properties.code;var _centerName=_e.features[0].properties.name;var _center=eval(_e.features[0].properties.center);if(_mapType.map==="connection"){var _points=$.map(_sourceArray,function(a){var _groupClass=_mapType.group;_isCenter="false";if(_centerCode===a.properties.origin_code){_groupClass+=" region-marker-"+_groupClass+"-center center-center";_isCenter="true"}var el=document.createElement("div");var _class="region-marker region-marker-"+_groupClass;el.className=_class;if(a.properties.origin_center){new mapboxgl.Marker(el).setLngLat(a.properties.origin_center).addTo(_theMap);return{type:"Feature",properties:{name:a.properties.origin_name,is_center:_isCenter,origin_code:a.properties.origin_code,code:a.properties.code},geometry:{type:"Point",coordinates:a.properties.origin_center}}}});if(_centerName===_e.features[0].properties.name&&_centerCode!==_e.features[0].properties.origin_code){_isCenter="center-only";var el=document.createElement("div");el.className="region-marker region-marker-city-center-only";new mapboxgl.Marker(el).setLngLat(_center).addTo(_theMap)}var _centerObj={type:"Feature",properties:{name:_e.features[0].properties.name,is_center:_isCenter,origin_code:_e.features[0].properties.origin_code,code:_e.features[0].properties.code},geometry:{type:"Point",coordinates:eval(_center)}};_points.push(_centerObj);var _lineString=$.map(_sourceArray,function(a){if(a.properties.origin_name){var _ob={type:"Feature",properties:{name:a.properties.origin_name,category_color:a.properties.category_color,category_name:a.properties.category_name},geometry:{type:"LineString",coordinates:[eval(_center),a.properties.origin_center]}};return _ob}});var myGeoJSONString={};myGeoJSONString.type="FeatureCollection";myGeoJSONString.features=_lineString;_theMap.addSource("_pointsString",{type:"geojson",lineMetrics:true,data:myGeoJSONString});_theMap.addLayer({id:"layerString",type:"line",source:"_pointsString",paint:{"line-color":"black","line-opacity":1,"line-width":3,"line-gradient":["interpolate",["linear"],["line-progress"],0,"#1ca404",.5,"#56a0f9",1,"#1a3bc2"]},layout:{"line-cap":"round","line-join":"round"}});var myGeoJSON={};myGeoJSON.type="FeatureCollection";myGeoJSON.features=_points;_theMap.addSource("_pointsOrigin",{type:"geojson",data:myGeoJSON});_theMap.addLayer({id:"layerPoints",type:"circle",source:"_pointsOrigin",paint:{"circle-color":"#ffffff","circle-opacity":0,"circle-radius":5}});hoverPop.remove();_theMap.on("mouseenter","layerPoints",function(e){var _deathPlace=_origin.code;var _deathDate=_origin.date;var _deathOrigin=e.features[0].properties.origin_code;var _type=_mapType.group;var _count=0;var _newSource=$.grep(_originalSource,function(a){return a.properties.code===_deathPlace&&a.properties.origin_code===_deathOrigin&&a.properties.type==="destination"&&a.properties.group===_type});if(_newSource.length>0){_newSource.forEach(function(a){_count+=a.properties.count})}var _html="";var _context="";var _isOrigin=false;var _isSame=false;if(_mapType.group==="city"||_mapType.group==="region"&&_mapType){if(e.features[0].properties.is_center==="true"){_context="";_context+='<div class="casualty-count-to [ u-franklin u-fsn u-fwn ]">';_context+="<b>"+_overAll+"</b>";_context+=" "+dataCasualtyIn+" ";_context+="<b>"+e.features[0].properties.name+"</b>";_context+="</div>";_context+='<div class="casualty-count-from [ u-franklin u-fsn u-fwn ]">';_context+="<b>"+_count+"</b>";_context+=" "+dataCasualtySame+" ";_context+="<b>"+e.features[0].properties.name+"</b>";_context+="</div>";_isSame=true}else if(e.features[0].properties.is_center==="center-only"){_context="";_context+='<div class="casualty-count">';_context+="<p class='[ u-franklin u-fsn u-fwn ]'>";_context+=e.features[0].properties.name+"</p>";_context+="</div>";_isSame=false}else{_context="";_context+='<div class="casualty-count">';_context+="<p class='[ u-franklin u-fsn u-fwn ]'><b>"+_count+"</b>";_context+=" "+dataCasualtyFrom+" ";_context+="<b>"+e.features[0].properties.name+"</b></p>";_context+="</div>";_isOrigin=true;_isSame=false}}_html+='<div class="mapboxgl--hover__data">';_html+=_context;_html+="</div>";hoverPop.remove();markerPop.remove();if(_isOrigin){connectOrigin.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}else{if(_isSame){connectDestination.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}else{connectPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}}});_theMap.on("mouseleave","layerPoints",function(e){connectPop.remove();connectOrigin.remove();connectDestination.remove();hoverPop.remove();markerPop.remove()});$(".region-marker").hover(function(){$(".map-route--same").removeClass("is-shown");if($(this).hasClass("center-center")){$(".map-route--same").addClass("is-shown")}},function(){$(".map-route--same").removeClass("is-shown")})}else{var _dateChanged=_global_startDate!==0||_global_endDate!==0?true:false;if(_dateChanged){_sourceArray=$.grep(_sourceArray,function(a){return a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate&&a.id!==0})}var _allCities=$.unique($.map(_sourceArray,function(a){return a.properties.origin_name}).sort());var _allLines=[];_allCities.forEach(function(a){var _rec=$.unique($.map(_sourceArray,function(b){if(a===b.properties.origin_name){return b.properties.category_name}})).sort();_allLines[a]=_rec});var _categoriesColor=$.unique($.map(_sourceArray,function(a){return a.properties.category_name+"|"+a.properties.category_color}).sort());var _hometownLegend=$(".hometown--legend",_parentSelector);var _html="";_categoriesColor.forEach(function(category){_html+='<p><span style="background-color: '+category.substring(category.indexOf("#"))+'"></span>'+category.substring(0,category.indexOf("|"))+"</p>"});_html+='<p><span style="background-color: #428cf4;"></span> '+dataDestination+"</p>";_hometownLegend.html(_html);$(".js-hometown-route",_parentSelector).addClass("is-shown");var _lineString=[];for(var key in _allLines){var _obj={};if(_allLines.hasOwnProperty(key)){var _color=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.category_color}).sort());_color=_color[0];var _category=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.category_name}).sort());_category=_category[0];if(_allLines[key].length>1){var _color=$.unique($.map(_sourceArray,function(a){return a.properties.category_color}).sort());var _category=$.unique($.map(_sourceArray,function(a){return a.properties.category_name}).sort())}var _origin_center=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.origin_center}).sort());var _origin_code=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.origin_code}).sort());var _code=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.code}).sort());var _origin_center_array=eval("["+_origin_code[0]+"]").reverse();_obj={type:"Feature",properties:{name:key,category_color:_color,category_name:_category,origin_code:_origin_code[0],origin_center:_origin_code[0],code:_code[0]},geometry:{type:"LineString",coordinates:[eval(_center),_origin_center_array]}};_lineString.push(_obj)}}var _singleCategory=$.map(_lineString,function(_record){if(!Array.isArray(_record.properties.category_color)){return _record}});var _multipleCategory=$.map(_lineString,function(_record){if(Array.isArray(_record.properties.category_color)){return _record}});try{$(_parentSelector+" .region-marker").remove()}catch(e){console.log(e);console.log("No marker was intantiated.")}var _maxTotal=0;_sourceArray.forEach(function(a){_maxTotal+=a.properties.count});var _range1=_maxTotal/3;var _range2=_range1+1;var _range3=_range1*2+1;var _center={geometry:{type:"Point",coordinates:eval(_e.features[0].properties.center)},properties:{name:_centerName,code:_centerCode}};var _groupClass=_mapType.group;var el=document.createElement("div");var _class="region-marker region-marker-hometown hometown-center region-marker-"+_groupClass;el.className=_class;new mapboxgl.Marker(el).setLngLat(_center.geometry.coordinates).addTo(_theMap);if(_singleCategory.length>0){module.generateLineString(_theMap,_singleCategory,"single");_singleCategory.forEach(function(_category){var _deathCount=0;_sourceArray.forEach(function(rec){if(rec.properties.origin_code===_category.properties.origin_code){_deathCount+=rec.properties.count}});var _sizeClass="";if(_deathCount<_range1){_sizeClass=" size--small"}else if(_deathCount>=_range2&&_deathCount<_range3){_sizeClass=" size--medium"}else if(_deathCount>=_range3&&_deathCount<=_maxTotal){_sizeClass=" size--large"}var _groupClass=_mapType.group;var el=document.createElement("div");var _class="region-marker region-marker-hometown region-marker-"+_groupClass;el.className=_class;el.style.backgroundColor=_category.properties.category_color;var _origin_array=eval("["+_category.properties.origin_center+"]").reverse();new mapboxgl.Marker(el).setLngLat(_origin_array).addTo(_theMap)})}if(_multipleCategory.length>0){module.generateLineString(_theMap,_multipleCategory,"multiple");_multipleCategory.forEach(function(_category){var _deathCount=0;_sourceArray.forEach(function(rec){if(rec.properties.origin_code===_category.properties.origin_code){_deathCount+=rec.properties.count}});var _sizeClass="";if(_deathCount<_range1){_sizeClass=" size--small"}else if(_deathCount>=_range2&&_deathCount<_range3){_sizeClass=" size--medium"}else if(_deathCount>=_range3&&_deathCount<=_maxTotal){_sizeClass=" size--large"}var _groupClass=_mapType.group;var el=document.createElement("div");var _class="region-marker region-marker-hometown region-marker-"+_groupClass;el.className=_class;el.style.background="linear-gradient(to right, "+_multipleCategory[0].properties.category_color[1]+" 50%, "+_multipleCategory[0].properties.category_color[0]+" 50%)";var _origin_array=eval("["+_category.properties.origin_center+"]").reverse();new mapboxgl.Marker(el).setLngLat(_origin_array).addTo(_theMap)})}var _linePoints=$.map(_lineString,function(_line){var _object={geometry:{type:"Point",coordinates:_line.geometry.coordinates[1]},properties:{name:_line.properties.name,code:_line.properties.code,origin_code:_line.properties.origin_code,date:_line.properties.date}};return _object});_linePoints.push(_center);module.generateLineStringPoints(_theMap,_linePoints,_sourceArray)}};module.generateLineStringPoints=function(_theMap,_points,_sourceArray){$(".reset--connection","#"+_theMap._canvasContainer.offsetParent.id).addClass("is-shown");var mapHomeTownPoints=_theMap.getLayer("layerHometowns");if(typeof mapHomeTownPoints!=="undefined"){_theMap.removeLayer("layerHometowns").removeSource("_hometownsBubble")}var _hometowns={};_hometowns.type="FeatureCollection";_hometowns.features=_points;_theMap.addSource("_hometownsBubble",{type:"geojson",lineMetrics:true,data:_hometowns});_theMap.addLayer({id:"layerHometowns",type:"circle",source:"_hometownsBubble",paint:{"circle-color":"red","circle-radius":20,"circle-opacity":0}});var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerHometowns",function(e){_theMap.moveLayer("layerBubble","layerHometowns");var _referencePoint=e.features[0].properties.origin_code?e.features[0].properties.origin_code:e.features[0].properties.code;var _name=$.unique($.map(_sourceArray,function(a){if(_referencePoint===a.properties.origin_code){return a.properties.origin_name}}).sort());var _allCategories=$.unique($.map(_sourceArray,function(a){if(_referencePoint===a.properties.origin_code){return a.properties.category_name}}).sort());var _html="";_html+='<div class="mapboxgl--hover__hometown  mapboxgl--hover__data">';_html+='<div class="hometown--details">';var _hasRecord=false;_allCategories.forEach(function(category){var _count=0;if(_global_startDate!==0){_sourceArray.forEach(function(a){if(_referencePoint===a.properties.origin_code&&category===a.properties.category_name&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate){_count+=a.properties.count}})}else{_sourceArray.forEach(function(a){if(_referencePoint===a.properties.origin_code&&category===a.properties.category_name){_count+=a.properties.count}})}_html+="<div>"+_count+" "+category+"</div>";_hasRecord=true});if(_hasRecord){_html+="<div>"+dataFrom+" "+_name+"</div>"}else{_html+=e.features[0].properties.name}_html+="</div>";_html+="</div>";hoverPop.remove();hometownPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)});_theMap.on("mouseleave","layerHometowns",function(e){hoverPop.remove();hometownPop.remove()})};module.removeLineConnection=function(_theMap){$(".reset--connection","#"+_theMap._canvasContainer.offsetParent.id).removeClass("is-shown");var mapLayerSingleString=_theMap.getLayer("layerSingleString");var mapLayerMultipleString=_theMap.getLayer("layerMultipleString");if(typeof mapLayerSingleString!=="undefined"){_theMap.removeLayer("layerSingleString").removeSource("_singleStrings")}if(typeof mapLayerMultipleString!=="undefined"){_theMap.removeLayer("layerMultipleString").removeSource("_multipleStrings")}var mapLayerHome=_theMap.getLayer("layerHometowns");if(typeof mapLayerHome!=="undefined"){_theMap.removeLayer("layerHometowns").removeSource("_hometownsBubble")}};module.generateLineString=function(_theMap,_stringSource,_type){module.removeLineConnection(_theMap);var _singleCategoryString={};_singleCategoryString.type="FeatureCollection";_singleCategoryString.features=_stringSource;var _layerSource="_singleStrings";var _layerId="layerSingleString";if("multiple"===_type){_layerSource="_multipleStrings";_layerId="layerMultipleString"}_theMap.addSource(_layerSource,{type:"geojson",lineMetrics:true,data:_singleCategoryString});if("single"===_type){var preloadConnectionString=setInterval(function(){if(_theMap.loaded()){_theMap.addLayer({id:_layerId,type:"line",source:_layerSource,paint:{"line-color":["get","category_color"],"line-width":3},layout:{"line-cap":"round","line-join":"round"}});clearInterval(preloadConnectionString)}},300)}else{var preloadConnectionString=setInterval(function(){if(_theMap.loaded()){_theMap.addLayer({id:_layerId,type:"line",source:_layerSource,paint:{"line-color":"black","line-width":3,"line-gradient":["interpolate",["linear"],["line-progress"],0,_stringSource[0].properties.category_color[1],.5,_stringSource[0].properties.category_color[1],.51,_stringSource[0].properties.category_color[0],1,_stringSource[0].properties.category_color[0]]},layout:{"line-cap":"round","line-join":"round"}});clearInterval(preloadConnectionString)}},300)}};module.handleURLRequests=function(_url){var _request=$.ajax({url:_url,dataType:"Text",success:function(){},error:function(xhr){console.log("An error occured while retrieving GeoJson for Bubbles files")}});return _request};module.handleProcessRequest=function(_request,_type,_group){var processed_data=_request;if(typeof _request!="object"){processed_data=JSON.parse(_request)}var processed_clone=Object.assign(processed_data);var type=_type===null||_type===undefined?"destination":_type;var group=_group===null||_group===undefined?"city":_group;var arr=$.grep(processed_clone.features,function(a){return a.properties.type===type&&a.properties.group===group});return arr};module.handleMinDate=function(_request){var getMin=_request;if(typeof _request!="object"){getMin=JSON.parse(_request)}var _startDate=Math.min.apply(null,$.map(getMin.features,function(a){return a.properties.date}));return _startDate};module.handleMaxDate=function(_request){var getMin=_request;if(typeof _request!="object"){getMin=JSON.parse(_request)}var _endDate=Math.max.apply(null,$.map(getMin.features,function(a){return a.properties.date}));return _endDate};module.isMobileSafari=function(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)};handlers.push({name:"_handleMapInit",handle:function(){module.handleMap()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("mapLayerBubble",function($){"use strict";var module={};var handlers=[];var selector=".js-map-layer-bubble";var els=Array.from(document.querySelectorAll(selector));function isMobileSafari(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)}function updateBubble(el){var startDate=el.dateRange[0];var endDate=el.dateRange[1];var categories=el.categories;var mapType=el.core.dataset.type;var blockGroup="city";var blockType="destination";var data=JSON.parse(JSON.stringify(el.airTableData));var filteredFeatures=[];if(categories.length===1&&categories[0]==="all"){data.features.forEach(function(feature){if(feature.properties.date>=startDate&&feature.properties.date<=endDate&&feature.properties.group===blockGroup&&feature.properties.type===blockType){filteredFeatures.push(feature)}})}else{data.features.forEach(function(feature){if(feature.properties.date>=startDate&&feature.properties.date<=endDate&&feature.properties.group===blockGroup&&feature.properties.type===blockType&&categories.includes(feature.properties.category_name)){filteredFeatures.push(feature)}})}if(mapType==="hometown"){var homeTownFiltered=[];filteredFeatures.forEach(function(feature){if(feature.properties.shown_in_hometown==="1"){homeTownFiltered.push(feature)}});filteredFeatures=homeTownFiltered}var sectors=[];var incidentCountArray=[];var objCollectionOfAllSectors=[];var obj={};filteredFeatures.forEach(function(feature){if(!sectors.includes(feature.properties.name)){sectors.push(feature.properties.name)}});sectors.sort();sectors.forEach(function(sector){var count=0;filteredFeatures.forEach(function(feature){if(sector===feature.properties.name){count+=feature.properties.count;obj=feature}});incidentCountArray.push(count);objCollectionOfAllSectors.push(obj)});objCollectionOfAllSectors.forEach(function(sector,i){sector.properties.count=incidentCountArray[i]});el.mapBox.getSource("bubbleSource").setData({type:"FeatureCollection",features:objCollectionOfAllSectors})}function getStops(data,counts,dateRange,categories,el){var startDate=dateRange[0];var endDate=dateRange[1];var filteredFeatures=[];data.features.forEach(function(feature){if(feature.properties.date>=startDate&&feature.properties.date<=endDate){filteredFeatures.push(feature)}});if(categories.length>0&&categories[0]!=="all"){var categoryFiltered=[];filteredFeatures.forEach(function(feature){if(categories.includes(feature.properties.category_name)){categoryFiltered.push(feature)}});filteredFeatures=categoryFiltered}var highestCount=Math.max.apply(null,counts);var group1=Math.round(highestCount/3);var group2=Math.round(group1+1);var group3=Math.round(group1+group2+1);var bubbleLegendContainer=el.core.querySelector(".js-legends__bubble--sizes");var html='<div class="labels"><span class="label-left"><i class="radius-l"></i></span><span class="label-right"><i class="radius-label">'+group3+"-"+highestCount+"</i></span></div>"+'<div class="labels"><span class="label-left"><i class="radius-m"></i></span><span class="label-right"><i class="radius-label">'+group2+"-"+(group3-1)+"</i></span></div>"+'<div class="labels"><span class="label-left"><i class="radius-s"></i></span><span class="label-right"><i class="radius-label"> 1-'+(group2-1)+"</i></span></div>";bubbleLegendContainer.innerHTML=html;return[[0,5],[group2,10],[group3,15]]}function getMinMaxDate(data){var dates=[];data.features.forEach(function(feature){dates.push(feature.properties.date)});var min=Math.min.apply(null,dates);var max=Math.max.apply(null,dates);return[min,max]}function setMouseEvents(el,popup,layers){el.mapBox.on("mousemove",function(e){var features=el.mapBox.queryRenderedFeatures(e.point,{layers:layers});if(!features.length){popup.remove();return}var feature=features[0];var name="";var html="";var count=0;var dataCasualtyLabel=el.core.dataset.title.toLowerCase();if(feature.layer.id==="layerBubble"){name=feature.properties.name||feature.properties.Name;count=feature.properties.count;html='<div class="mapboxgl--hover__data"><p class="[ u-franklin u-fsn u-fwn ]"><b>'+count+"</b> "+dataCasualtyLabel+" in "+name+"</p></div>"}else{if(typeof feature.properties.name!=="undefined"||typeof feature.properties.name_eng!=="undefined"){name=feature.properties.name||feature.properties.name_eng}else if(typeof feature.properties.Name!=="undefined"||typeof feature.properties.Name!=="undefined"){name=feature.properties.Name||feature.properties.Name_eng}html='<div class="mapboxgl--hover__data"><p class="[ u-franklin u-fsn u-fwn ]">'+name+"</p></div>"}popup.setLngLat(e.lngLat).setHTML(html).addTo(el.mapBox)})}function generateCategoryFilter(el,data,dateRange,elIndex){var filteredFeatures=[];var startDate=dateRange[0];var endDate=dateRange[1];var mapType=el.core.dataset.type;var dataNoData=el.core.dataset.nodata;var dataAll=el.core.dataset.all;var dataApply=el.core.dataset.apply;var dataCancel=el.core.dataset.cancel;var dataSelect=el.core.dataset.select;var categories=[];data.features.forEach(function(feature){if(feature.properties.date>=startDate&&feature.properties.date<=endDate&&feature.properties.type==="destination"){filteredFeatures.push(feature)}});if(mapType==="hometown"){var homeTownFiltered=[];filteredFeatures.forEach(function(feature){if(feature.properties.shown_in_hometown==="1"){homeTownFiltered.push(feature)}});filteredFeatures=homeTownFiltered}filteredFeatures.forEach(function(feature){if(!categories.includes(feature.properties.category_name)){categories.push(feature.properties.category_name)}});categories.sort();var filterContainer=el.core.querySelector(".js--option");var filterLabel=el.core.querySelector(".js--label");var dropdown=el.core.querySelector(".map-filter--dropdown");var html="";var def='<label><input type="checkbox" name="filter-option" class="option-trigger option-all" value="all" checked="checked" />'+dataAll+"</label>";if(categories.length===0){def="";filterLabel.innerHTML=dataNoData}else{filterLabel.innerHTML=dataAll}filterContainer.innerHTML=def;categories.forEach(function(category){html+='<label><input type="checkbox" name="filter-option" class="option-trigger" value="'+category+'" />'+category+"</label>"});html+='<div class="option-buttons"><input type="submit" class="option-submit" value="'+dataApply+'"><input type="reset" class="option-reset" value="'+dataCancel+'"></div>';filterContainer.innerHTML+=html;filterLabel.addEventListener("click",function(){dropdown.classList.toggle("is-open")});var resetBtn=el.core.querySelector(".option-reset");var triggerBtn=Array.from(el.core.querySelectorAll(".option-trigger"));var submitBtn=el.core.querySelector(".option-submit");var optionAll=el.core.querySelector(".option-all");resetBtn.addEventListener("click",function(){triggerBtn.forEach(function(btn){btn.checked=false});optionAll.checked=true;filterLabel.innerHTML=dataAll;dropdown.classList.remove("is-open");els[elIndex].categories=["all"];updateBubble(els[elIndex])});triggerBtn.forEach(function(btn){btn.addEventListener("click",function(){var value=btn.value;var text="";if(value==="all"){triggerBtn.forEach(function(btn){btn.checked=false});btn.checked=true;text=dataAll}else{optionAll.checked=false;var checked=Array.from(el.core.querySelectorAll(".option-trigger:checked"));if(checked.length===1){text=checked[0].getAttribute("value")}else if(checked.length>1){text=checked.length+" options selected"}else{text=dataSelect}}filterLabel.innerHTML=text})});submitBtn.addEventListener("click",function(){var markers=Array.from(el.core.querySelectorAll(".region-marker"));var resetBtn=el.core.querySelector(".js-reset");var selected=Array.from(el.core.querySelectorAll(".option-trigger:checked"));var categories=[];selected.forEach(function(checkbox){categories.push(checkbox.value)});els[elIndex].categories=categories;updateBubble(els[elIndex]);markers.forEach(function(marker){marker.remove()});resetBtn.removeAttribute("disabled");dropdown.classList.remove("is-open")})}function generateDatePicker(el,elIndex,dateRange){var startDate=new Date(dateRange[0]*1e3);var endDate=new Date(dateRange[1]*1e3);var resetBtn=el.core.querySelector(".js-reset");var dataCancel=el.core.dataset.cancel;var dataApply=el.core.dataset.apply;$('input[name="daterange"]',$(el.core)).daterangepicker({opens:"left",timePicker:false,showDropdowns:true,linkedCalendars:false,startDate:startDate,endDate:endDate,minYear:startDate.getFullYear()-1,maxYear:endDate.getFullYear()+1,locale:{cancelLabel:dataCancel,applyLabel:dataApply}},function(start,end){els[elIndex].dateRange=[new Date(start)/1e3,new Date(end)/1e3];resetBtn.removeAttribute("disabled");$(".map--slider",$(el.core)).dateRangeSlider("destroy");mapSlider(el,startDate,endDate,new Date(start),new Date(end),elIndex);updateBubble(els[elIndex]);var regionMarker=Array.from(el.core.querySelectorAll(".region-marker"));regionMarker.forEach(function(marker){marker.remove()})})}function mapSlider(el,min,max,start,end,elIndex){$(".map--slider",$(el.core)).dateRangeSlider({bounds:{min:new Date(min.getFullYear(),min.getMonth(),1),max:max},defaultValues:{min:start,max:end},valueLabels:"change",durationIn:1e3,durationOut:1e3}).on("valuesChanging",function(e,data){var resetBtn=el.core.querySelector(".js-reset");resetBtn.removeAttribute("disabled");var min=data.values.min;var max=data.values.max;var startDate=new Date(min);var endDate=new Date(max);$('input[name="daterange"]',$(el.core)).data("daterangepicker").setStartDate(startDate);$('input[name="daterange"]',$(el.core)).data("daterangepicker").setEndDate(endDate);els[elIndex].dateRange=[startDate/1e3,endDate/1e3];var markers=Array.from(el.core.querySelectorAll(".region-marker"));markers.forEach(function(marker){marker.remove()});updateBubble(els[elIndex])})}function generateSlider(el,data,dateRange,elIndex){var startDate=new Date(dateRange[0]*1e3);var endDate=new Date(dateRange[1]*1e3);var years="";var yearSlider=el.core.querySelector(".map--slider__years");var sliderMarking=el.core.querySelector(".map--slider__marking");mapSlider(el,startDate,endDate,startDate,endDate,elIndex);var allYears=[];data.features.forEach(function(feature){var date=new Date(feature.properties.date*1e3);var year=date.getFullYear();if(!isNaN(year)&&!allYears.includes(year)){allYears.push(year)}});allYears.sort();allYears.forEach(function(year){years+='<span class="year--marking">'+year+"</span>";if(allYears.length<4){years+="<span>0000</span><span>0000</span><span>0000</span>"}else{years+="<span>0000</span>"}});yearSlider.innerHTML+=years;var minLabel=startDate.getMonth()+1+"/"+startDate.getDate()+"/"+startDate.getFullYear();var maxLabel=endDate.getMonth()+1+"/"+endDate.getDate()+"/"+endDate.getFullYear();var dateLabel='<p class="date--start">'+minLabel+'</p><p class="date--end">'+maxLabel+"</p>";sliderMarking.innerHTML+=dateLabel}function reset(elIndex){var el=els[elIndex];var dataAll=el.core.dataset.all;var options=Array.from(el.core.querySelectorAll(".option-trigger"));var allOption=el.core.querySelector(".option-all");var filterLabel=el.core.querySelector(".js--label");var dropdown=el.core.querySelector(".map-filter--dropdown");options.forEach(function(option){option.checked=false});allOption.checked=true;filterLabel.innerHTML=dataAll;dropdown.classList.remove("is-open");var dateRange=el.originalDateRange;var startDate=new Date(dateRange[0]*1e3);var endDate=new Date(dateRange[1]*1e3);$('input[name="daterange"]',$(el.core)).data("daterangepicker").setStartDate(startDate);$('input[name="daterange"]',$(el.core)).data("daterangepicker").setEndDate(endDate);$(".map--slider",$(el.core)).dateRangeSlider("values",startDate,endDate);var markers=Array.from(el.core.querySelectorAll(".region-marker"));markers.forEach(function(marker){marker.remove()});els[elIndex].dateRange=dateRange;els[elIndex].categories=["all"];updateBubble(els[elIndex])}module.generateLayers=function(data,mapBox){var generatedLayers=[];if(data.features&&data.features.length>0){data.features.forEach(function(feature,i){var type=feature.geometry.type.toLowerCase();if(["multipolygon","polygon"].includes(type)){var polygonLayer="polygon-layer-"+i;var polygonOutlineLayer="polygon-outline-layer-"+i;mapBox.addLayer({id:polygonLayer,type:"fill",source:{type:"geojson",data:feature},paint:{"fill-color":{type:"identity",property:"fill"},"fill-opacity":{type:"identity",property:"fill-opacity"}}});mapBox.addLayer({id:polygonOutlineLayer,type:"line",source:{type:"geojson",data:feature},paint:{"line-color":{type:"identity",property:"stroke"},"line-width":{type:"identity",property:"stroke-width"},"line-opacity":{type:"identity",property:"stroke-opacity"}}});generatedLayers.push(polygonLayer,polygonOutlineLayer)}else if(["multilinestring","linestring"].includes(type)){var lineLayer="linestring-layer-"+i;mapBox.addLayer({id:lineLayer,type:"line",source:{type:"geojson",data:feature},paint:{"line-color":{type:"identity",property:"stroke"},"line-width":{type:"identity",property:"stroke-width"},"line-opacity":{type:"identity",property:"stroke-opacity"}}});generatedLayers.push(lineLayer)}})}return generatedLayers};module.generateBubbles=function(raw,mapBox,generatedLayers,el){var data=JSON.parse(JSON.stringify(raw));var clonedData=JSON.parse(JSON.stringify(raw));var dateRange=getMinMaxDate(data);var sectors=[];var event=isMobileSafari()?"touchmove":"mousemove";var hoveredBubble=false;var mapType=el.core.hasAttribute("data-type")?el.core.getAttribute("data-type"):"simple";var mergeClone=$.grep(data.features,function(a){if(mapType==="hometown"){return a.properties.date>=dateRange[0]&&a.properties.date<=dateRange[1]&&a.properties.group==="city"&&a.properties.type==="destination"&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=dateRange[0]&&a.properties.date<=dateRange[1]&&a.properties.group==="city"&&a.properties.type==="destination"}});data.features.forEach(function(feature){if(!sectors.includes(feature.properties.name)){sectors.push(feature.properties.name)}});sectors.sort();var incidentCountArray=[];var objCollectionOfAllSectors=[];var obj={};sectors.forEach(function(sector){var count=0;data.features.forEach(function(feature){if(sector===feature.properties.name){count+=feature.properties.count;obj=feature}});incidentCountArray.push(count);objCollectionOfAllSectors.push(obj)});objCollectionOfAllSectors.forEach(function(sector,i){sector.properties.count=incidentCountArray[i]});var stops=getStops(data,incidentCountArray,dateRange,[],el);var bubbleData={type:"FeatureCollection",features:objCollectionOfAllSectors};mapBox.addSource("bubbleSource",{type:"geojson",data:bubbleData});mapBox.addLayer({id:"layerBubble",type:"circle",source:"bubbleSource",layout:{visibility:"visible"},paint:{"circle-color":"#730000","circle-stroke-color":"white","circle-stroke-width":2,"circle-radius":{base:1,property:"count",type:"interval",stops:stops},"circle-opacity":["case",["boolean",["feature-state","hover"],false],1,.7]}});generatedLayers.forEach(function(layer){mapBox.moveLayer("layerBubble",layer)});mapBox.on(event,"layerBubble",function(e){if(e.features.length>0){if(hoveredBubble){mapBox.setFeatureState({source:"bubbleSource",id:hoveredBubble},{hover:false})}hoveredBubble=e.features[0].id;mapBox.setFeatureState({source:"bubbleSource",id:hoveredBubble},{hover:true})}});mapBox.on("mouseleave","layerBubble",function(){if(hoveredBubble){mapBox.setFeatureState({source:"bubbleSource",id:hoveredBubble},{hover:false})}hoveredBubble=false});module.handleMapEvents(clonedData,mapBox,el,mapType);return["layerBubble"]};module.preInit=function(){return document.querySelector(selector)!==null};if(module.preInit()){var mapBoxToken="pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw";var mapBaseStyle="mapbox://styles/daltonwb/ck3ehyzfj4s6g1cpuiskvb5i3";mapboxgl.accessToken=mapBoxToken;els.forEach(function(el,i){var container=el.dataset.map;var lng=el.dataset.longitude;var lat=el.dataset.latitude;var zoom=el.dataset.zoom;var mapBox=new mapboxgl.Map({container:container,style:mapBaseStyle,center:[lng,lat],zoom:zoom});mapBox.scrollZoom.disable();var mapBoxNav=new mapboxgl.NavigationControl({showCompass:false});mapBox.addControl(mapBoxNav,"bottom-left");var preloader=el.querySelector(".map--preloader");preloader.classList.remove("is--loaded");els[i]={core:el,mapBox:mapBox}});var hoverPop=new mapboxgl.Popup({className:"mapboxgl--popup-hover",closeButton:false,closeOnClick:false,offset:20});var clickPop=new mapboxgl.Popup({className:"mapboxgl--popup-click",offset:20,closeButton:false})}module.handleMap=function(){els.forEach(function(el,i){var airTableURL=el.core.dataset.airtable;var geoJsonURL=el.core.dataset.geojson;el.mapBox.once("load",function(){Promise.all([fetch(airTableURL).then(function(res){return res.json()}),fetch(geoJsonURL).then(function(res){return res.json()})]).then(function(response){var generatedGeoJsonLayers=module.generateLayers(response[1],el.mapBox);var generatedBubbleLayers=module.generateBubbles(response[0],el.mapBox,generatedGeoJsonLayers,el);setMouseEvents(el,hoverPop,generatedGeoJsonLayers.concat(generatedBubbleLayers));var dateRange=getMinMaxDate(response[0]);generateCategoryFilter(el,response[0],dateRange,i);generateDatePicker(el,i,dateRange);generateSlider(el,response[0],dateRange,i);els[i]["airTableData"]=JSON.parse(JSON.stringify(response[0]));els[i]["geoJsonData"]=response[1];els[i]["originalDateRange"]=dateRange;els[i]["dateRange"]=dateRange;els[i]["categories"]=["all"];var resetBtn=el.core.querySelector(".js-reset");var preloader=el.core.querySelector(".map--preloader");var submitBtn=el.core.querySelector(".option-submit");submitBtn.click();resetBtn.addEventListener("click",function(){resetBtn.setAttribute("disabled",true);reset(i)});preloader.classList.add("is--loaded")})})})};module.handleMapEvents=function(clonedData,mapBox,el,mapType){var event=isMobileSafari()?"touchstart":"click";var monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var dataCasualtyLabel=el.core.dataset.title.toLowerCase();var dataTotal=el.core.dataset.total;var dataTotalDeaths=el.core.dataset.totalDeaths;mapBox.on(event,"layerBubble",function(e){var blockGroup="city";var blockType="destination";var category=[];var dateRange=el.dateRange;$(el.core).find(".option-trigger:checked").each(function(){category.push($(this).attr("value"))});if($.inArray("all",category)>=0){category=null}var originalSourceFiltered=clonedData.features;if(category!==null){var originalSourceFiltered=$.grep(clonedData.features,function(a){return $.inArray(a.properties.category_name,category)>=0})}var allDataSource={type:"FeatureCollection",features:originalSourceFiltered};var sourceArray=$.grep(allDataSource.features,function(a){return a.properties.code===e.features[0].properties.code&&a.properties.group===blockGroup&&a.properties.type===blockType});var city=$.grep(sourceArray,function(a){return a.properties.code===e.features[0].properties.code&&a.properties.date>=dateRange[0],a.properties.date<=dateRange[1]});var cityData=$.grep(sourceArray,function(a){return a.properties.code===e.features[0].properties.code&&a.properties.date>=dateRange[0]&&a.properties.date<=dateRange[1]});var count=0;city.forEach(function(a){count+=a.properties.count});var series=[];var allDatesX=$.unique($.map(city,function(a){var date=new Date(a.properties.date*1e3);if(a.properties.code===e.features[0].properties.code){return date.getFullYear()}}).sort());var allDates=[];allDatesX.forEach(function(year){for(var i=0;i<12;i++){allDates.push(year+"-"+i+"-"+1)}});var addDatesLabel=$.map(allDates,function(a){var str=a.split("-");return monthNames[str[1]]+"<span class='spacer [ u-fwn u-fsn u-franklin ]'><br></span>"+str[0]});var allCategories=$.unique($.map(city,function(a){return a.properties.category_name}).sort());var series=[];var obj={};allCategories.forEach(function(a){obj={};var dates=[];cityData.forEach(function(b){var date=[];if(a===b.properties.category_name){obj.name=b.properties.category_name;date.push(b.properties.date*1e3);date.push(b.properties.count)}dates.push(date)});var dateSort=$.grep(dates,function(n){return n.length!==0}).sort(function(a,b){if(new Date(a)>new Date(b)){return 1}else if(new Date(a)<new Date(b)){return-1}else{return 0}});var arr=[];allDates.forEach(function(year){var c=0;dateSort.forEach(function(item){var compare=new Date(item[0]).getFullYear()+"-"+new Date(item[0]).getMonth()+"-1";if(year===compare){c+=item[1]}});arr.push([c])});obj.data=arr;series.push(obj)});if(mapType!=="hometown"){var html='<div class="mapboxgl--graph__wrapper"><span class="mapboxgl--graph__visual-close">&times;</span>'+'<div class="mapboxgl--graph__visual" id="js-visual">'+"</div>"+'<div class="mapboxgl--graph__summary">'+'<p class="mapboxgl--graph__summary--highlight [ u-fwn u-fsn u-franklin ] ">'+count+"</p>"+'<p class="[ u-fwn u-fsn u-franklin u-ttu ]">'+dataTotalDeaths+'</p><a href="https://www.highcharts.com/" class="highcharts-credits [ u-franklin ]">Highcharts.com</a>'+"</div>"+"</div>";clickPop.setLngLat(e.lngLat).setHTML(html).addTo(mapBox);Highcharts.chart("js-visual",{chart:{type:"column",height:400,style:{fontFamily:'"franklin-gothic-urw", Helvetica, Arial, sans-serif'}},title:{text:e.features[0].properties.name+'<br><span class="mapbox-graph__subtitle">'+dataCasualtyLabel+"</span>",style:{color:"#14272b",fontSize:"23px",lineHeight:"25px",letterSpacing:"-.4px",marginBottom:"10px"}},credits:{enabled:false},xAxis:{categories:addDatesLabel,labels:{style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"}}},yAxis:{min:0,title:{text:null},labels:{style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"}}},exporting:{enabled:false},tooltip:{shadow:false,useHTML:true,headerFormat:'<p class="tooltip-header [ u-fwn u-fsn u-franklin ]" style="margin: 0; font-size: 13px; text-align: center;">{point.key}</p>',pointFormat:'<p style="display: flex; justify-content: space-between; margin-top: 5px; margin-bottom: 0; font-size: 13px;">'+"<span>{series.name}</span>"+'<strong style="margin-left: 5px;">{point.y}</strong>'+"<p/>",footerFormat:'<p style="font-weight: 700; display: flex; justify-content: space-between" class="[ u-fwn u-fsn u-franklin ]"><span>'+dataTotal+"</span><span>{point.total}</span></p>",padding:15,backgroundColor:"#ffffff",borderColor:"#cecece",borderRadius:0,borderWidth:1,shared:true,formatter:function(){var s='<div class="highcharts-tooltip-table__elem">'+'<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col highcharts-tooltip-table__heading [ u-fwn u-fsn u-franklin ]" style="color: #05363e">'+this.x.replace("/<brs*/?>/gi"," ")+"</div></div>";$.each(this.points,function(index){s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col series--name [ u-fwn u-fsn u-franklin ]">'+this.series.name+"</div>";s+='<div class="highcharts-tooltip-table__col series--value [ u-fwn u-fsn u-franklin ]">'+this.y+"</div></div>"});s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col  series--total [ u-fwn u-fsn u-franklin ]"><b style="text-transform:uppercase;">'+dataTotal+'</b></div> <div class="highcharts-tooltip-table__col series--total--value"><b>'+this.points[0].total+"</b></div></div>";s+="</div>";return s}},plotOptions:{column:{stacking:"normal"}},legend:{enabled:true,verticalAlign:"bottom",itemMarginBottom:8,itemStyle:{fontWeight:"normal",lineHeight:"15px",fontSize:"13px",color:"#555555",letterSpacing:"0.3px"}},series:series});window.dispatchEvent(new Event("resize"))}$(".map--overlay").addClass("is-shown");$(".mapboxgl--graph__visual-close").click(function(){clickPop.remove();$(".map--overlay").removeClass("is-shown")})})};handlers.push({name:"_handleMapInit",handle:function(){module.handleMap()}});module.init=function(){handlers.forEach(function(handler){if(typeof handler.handle==="function"){handler.handle()}if(typeof handler.attach==="function"){Drupal.behaviors[handler.name]=handler}})};return module}(jQuery));App.module.create("layerMap",function(window,$,app){"use strict";var module={},selector=".js-layer-map",mapContainer="map-base";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];if(module.preInit()){var dataCasualtyIn=$(selector).attr("data-casualty-in").toLowerCase(),dataCasualtyLabel=$(selector).attr("data-title").toLowerCase(),dataUnder=$(selector).attr("data-under").toLowerCase(),dataFrom=$(selector).attr("data-from").toLowerCase(),dataCasualtyFrom=$(selector).attr("data-casualty-from").toLowerCase(),dataCasualtySame=$(selector).attr("data-casualty-same").toLowerCase(),dataNoData=$(selector).attr("data-nodata"),dataReadMore=$(selector).attr("data-readmore"),dataAll=$(selector).attr("data-all"),dataApply=$(selector).attr("data-apply"),dataCancel=$(selector).attr("data-cancel"),dataSelect=$(selector).attr("data-select"),dataTotal=$(selector).attr("data-total"),dataDestination=$(selector).attr("data-destination"),dataTotalDeaths=$(selector).attr("data-total-deaths"),dataShowAnnotation=$(selector).attr("data-annotation-display");var $el=$(selector);var _mapbox_token="pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw";var _mapBaseStyle="mapbox://styles/daltonwb/ck3ehyzfj4s6g1cpuiskvb5i3";var _global_startDate=0;var _global_endDate=0;var _globalStop=[];var _globalRadius=[];var _globalMerged=[];var _slideTriggerred=false;var _defaultStart=0;var _defaultEnd=0;var _globalRegions=null;var _hoveredRegion=null;var _hoveredBubble=null;mapboxgl.accessToken=_mapbox_token;var _maps=$.makeArray($(selector));var _mapParents=[];var _mapCollection=[];var ctr=1;_maps.forEach(function(a){var _container=a.dataset.map;var _long=a.dataset.longitude,_lat=a.dataset.latitude,_zoom=a.dataset.zoom;var map=new mapboxgl.Map({container:_container,style:_mapBaseStyle,center:[_long,_lat],zoom:_zoom});map.scrollZoom.disable();var nav=new mapboxgl.NavigationControl({showCompass:false});map.addControl(nav,"bottom-left");window["map"+ctr]=map;_mapCollection.push(map);_mapParents.push(a.dataset.parent);ctr++});var hoverPop=new mapboxgl.Popup({className:"mapboxgl--popup-hover",closeButton:false,closeOnClick:false,offset:20});var clickPop=new mapboxgl.Popup({className:"mapboxgl--popup-click",offset:20,closeButton:false});var connectPop=new mapboxgl.Popup({className:"mapboxgl--popup-connect",offset:20,closeButton:false,closeOnClick:false});var connectOrigin=new mapboxgl.Popup({className:"mapboxgl--popup-connectOrigin",offset:20,closeButton:false,closeOnClick:false});var connectDestination=new mapboxgl.Popup({className:"mapboxgl--popup-connectSame",offset:20,closeButton:false,closeOnClick:false});var markerPop=new mapboxgl.Popup({className:"mapboxgl--popup-marker",offset:0,closeButton:false,closeOnClick:false});var notationPop=new mapboxgl.Popup({className:"mapboxgl--popup-annotation",offset:0,closeButton:true,closeOnClick:true});var hometownPop=new mapboxgl.Popup({className:"mapboxgl--popup-hometown",offset:0,closeButton:false,closeOnClick:false});var hometownName=new mapboxgl.Popup({className:"mapboxgl--popup-hometown",offset:0,closeButton:false,closeOnClick:true})}module.addMissingMonths=function(arr){var dataArray=arr;var additionalData={};var locationList=$.map(dataArray,function(itemData){return itemData.properties.name}).filter(function(el,index,arr){return index===arr.indexOf(el)});$.each(locationList,function(idx){var filteredLocation=$.grep(dataArray,function(filteredData){return filteredData.properties.name==locationList[idx]});var dataYears=$.map(filteredLocation,function(filteredLocationData){return new Date(filteredLocationData.properties.date*1e3).getFullYear()}).filter(function(el,index,arr){return index===arr.indexOf(el)}).sort();$.each(dataYears,function(yrsidx,yrsvalue){var currentyear=yrsvalue;additionalData.properties={};var _monthsName={0:"Januray",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"};var yearlyItem=$.grep(filteredLocation,function(yearlyitemData){return new Date(yearlyitemData.properties.date*1e3).getFullYear()==dataYears[yrsidx]});var itemMonths=$.map(yearlyItem,function(monthsitemData){return new Date(monthsitemData.properties.date*1e3).getMonth()}).filter(function(el,index,arr){return index===arr.indexOf(el)});$.each(itemMonths,function(mtnhsidx,itmvalue){delete _monthsName[itmvalue]});$.each(_monthsName,function(eamnthsidx,mssvalue){var idNum=0;if(mssvalue=="February"){var dateDay="28"}else{var dateDay="30"}additionalData.id=0;additionalData.type=filteredLocation[0].type;additionalData.geometry=filteredLocation[0].geometry;additionalData.properties.category_color=filteredLocation[0].properties.category_color;additionalData.properties.category_name=filteredLocation[0].properties.category_name;additionalData.properties.center=filteredLocation[0].properties.center;additionalData.properties.code=filteredLocation[0].properties.code;additionalData.properties.count=0;additionalData.properties.date=new Date(mssvalue+" "+dateDay+", "+currentyear).getTime()/1e3;additionalData.properties.group=filteredLocation[0].properties.group;additionalData.properties.name=filteredLocation[0].properties.name;additionalData.properties.origin_center=filteredLocation[0].properties.origin_center;additionalData.properties.origin_center=filteredLocation[0].properties.origin_code;additionalData.properties.origin_name=filteredLocation[0].properties.origin_name;additionalData.properties.type=filteredLocation[0].properties.type;additionalData.properties.processed=true;dataArray.push(additionalData)});additionalData={}})});return dataArray};module.handleMap=function(){_mapCollection.forEach(function(map,i){var $parent=$("."+_mapParents[i]),_requestBubble=module.handleURLRequests($parent.data("airtable")),_regionFill=module.handleURLRequests($parent.data("geojson")),_isRTL=$parent.data("rtl");module.handleGenerateRegions(_requestBubble,null,null,map,_mapParents[i],_isRTL,_regionFill);module.handleGenerateBubble(_requestBubble,map,_mapParents[i],_isRTL);module.handleGenerateSlider(_requestBubble,_regionFill,i,map);module.handleDropdownBehavior(_mapParents[i]);module.handleDropdownFilter(_requestBubble,undefined,undefined,"."+_mapParents[i],map,"initial",_regionFill);module.handleDatePicker(_requestBubble,_regionFill,_mapParents[i],map);var _annotated=$parent.data("annotations");if(_annotated){var _annotations=module.handleURLRequests($parent.data("annotations"));module.handleAnnotation(_annotations,map)}$(".js-reset").click(function(){$(this).attr("disabled",true);module.handleReset(_mapParents[i],_requestBubble,map,_regionFill);module.removeLineConnection(map);$("."+_mapParents[i]+" .region-marker").remove()});$(".reset--connection","."+_mapParents[i]).click(function(e){e.preventDefault();module.removeLineConnection(map);$("."+_mapParents[i]+" .region-marker").remove()})});$(".map--overlay").click(function(){clickPop.remove();$(this).removeClass("is-shown")})};module.handleReset=function(_parent,_requestBubble,_map,_region){var _selector=$("."+_parent);$.when(_requestBubble).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);module.updateMapContents(_minDate,_maxDate,_requestBubble.responseText,_region.responseText,_requestResult,_map,_selector,"reset",[]);module.handleDropdownFilter(_requestBubble,undefined,undefined,"."+_parent,_map,"initial",_region);module.buildDatePicker("."+_parent,_minDate,_maxDate,_requestBubble,_region,_map);$(".map--slider",_selector).dateRangeSlider("destroy");module.mapSlider(_selector,_minDate,_maxDate,_minDate,_maxDate)})};module.buildDatePicker=function(_selector,_minDate,_maxDate,_requestData,_regionFill,_map){$('input[name="daterange"]',_selector).daterangepicker({opens:"left",timePicker:false,showDropdowns:true,linkedCalendars:false,startDate:_minDate,endDate:_maxDate,minYear:_minDate.getFullYear()-1,maxYear:_maxDate.getFullYear()+1,locale:{cancelLabel:dataCancel,applyLabel:dataApply}},function(start,end,label){_slideTriggerred=true;_global_startDate=start;_global_endDate=end;module.updateMapContents(new Date(start),new Date(end),_requestData.responseText,_regionFill.responseText,_requestData,_map,_selector,"update",[]);$(".js-reset").attr("disabled",false);$(".map--slider",$(_selector)).dateRangeSlider("destroy");module.mapSlider(_selector,_minDate,_maxDate,new Date(start),new Date(end));module.removeLineConnection(_map);$(_selector+" .region-marker").remove()})};module.handleAnnotation=function(_request,_theMap){$.when(_request).done(function(_requestResult){var _annotations=_requestResult;if(typeof _requestResult!="object"){_annotations=JSON.parse(_requestResult)}var _features=_annotations.features;var _annocation_counter=0;var _annotations=[];var _mapLoaded=_theMap.once("load",function(){return true});var _dataLoaded=_theMap.once("data",function(){return true});if(_mapLoaded&&_dataLoaded){_features.forEach(function(a){var _title=a.properties.title;var _desc=a.properties.description;var _html="";_html+='<div class="annotation--wrapper [ u-franklin u-fsn u-fwn ]">';_html+="<h3>"+_title+"</h3>";_html+="<p>"+_desc+"</p>";if(typeof a.properties.url!=="undefined"){_html+='<a href="'+a.properties.url+'">'+dataReadMore+"</a>"}_html+="</div>";var _popInstance_class="mapboxgl--popup-annotation annotation--"+_annocation_counter;_popInstance_class+=dataShowAnnotation!=="off"?" open":"";var _popInstance=new mapboxgl.Popup({className:_popInstance_class,offset:0,closeButton:true,closeOnClick:false}).setLngLat(a.geometry.coordinates).setHTML(_html).addTo(_theMap);_annotations.push(_popInstance);var el=document.createElement("div");var _class="marker--annotation annotation--"+_annocation_counter;el.className=_class;el.setAttribute("data-id",_annocation_counter);new mapboxgl.Marker(el).setLngLat(a.geometry.coordinates).addTo(_theMap);_annocation_counter++})}$(".marker--annotation").click(function(){var _id=$(this).data("id");_id=parseInt(_id);var $annotation=$(".annotation--"+_id);_annotations[_id].addTo(_theMap);if($annotation.hasClass("open")){$annotation.removeClass("open")}else{$annotation.addClass("open")}});var resizeTimer;$(window).on("load resize",function(e){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){var _windowWidth=$(window).innerWidth();if(_windowWidth<760){_annotations.forEach(function(a){a.remove()})}else if(dataShowAnnotation==="off"&&_windowWidth>760){_annotations.forEach(function(a){a.remove()})}else{_annotations.forEach(function(a){a.addTo(_theMap)})}},250)})})};module.handleCasualtiesRegion=function(_request,_min,_max,_category,selector){var _regionContainer=$(".js-legends__region--sizes",$(selector));var _countMax=0;var _stops=[];$.when(_request).done(function(_requestResult){var _request=_requestResult;if(typeof _requestResult!="object"){_request=JSON.parse(_requestResult)}var _data=_request.features;var _minDate=module.handleMinDate(_requestResult);var _maxDate=module.handleMaxDate(_requestResult);if(_min||_max){var _allData=[];var _mapType=$(selector).data("type");var _blockGroup="region";var _blockType="destination";_allData=$.grep(_data,function(a){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){_allData=$.grep(_data,function(a){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&$.inArray(a.properties.category_name,_category)>=0})}var _allRegions=$.unique($.map(_allData,function(a){return a.properties.name}).sort());var _groupRegionCount=[];_allRegions.forEach(function(a){var _countAll=0;_allData.forEach(function(b){if(a===b.properties.name){_countAll+=b.properties.count}});_groupRegionCount.push(_countAll)});_countMax=Math.max.apply(null,_groupRegionCount);var _portions=_countMax/5;var _region1=Math.round(_portions);var _region2=Math.round(_portions*2);var _region3=Math.round(_portions*3);var _region4=Math.round(_portions*4);var _region5=_countMax;_regionContainer.html("");var _html="";var _display=_region1===0?_countMax:_region1;_stops.push([_display,"#f2e5ab"]);_html+='<span><i class="region-1"></i> 1-'+_display+"</span>";if(_region1+1<_region2){_display=_region2===0?_countMax:_region2;_stops.push([_region1+1,"#ffb842"]);_html+='<span><i class="region-2"></i> '+(_region1+1)+"-"+_display+"</span>"}if(_region2+1<_region3){_display=_region3===0?_countMax:_region3;_stops.push([_region2+1,"#ff8800"]);_html+='<span><i class="region-3"></i> '+(_region2+1)+"-"+_display+"</span>"}if(_region3+1<_region4){_display=_region4===0?_countMax:_region4;_stops.push([_region3+1,"#ff5800"]);_html+='<span><i class="region-4"></i> '+(_region3+1)+"-"+_display+"</span>"}if(_region4+1<_region5){_display=_region5===0?_countMax:_region5;_stops.push([_region4+1,"#bb0000"]);_html+='<span><i class="region-5"></i> '+(_region4+1)+"-"+_display+"</span>"}if(_countMax===0){_html=dataNoData}_regionContainer.append(_html)}});_globalStop=_stops;return _stops};module.handleCasualtiesLocation=function(_request,_min,_max,_category,selector){var _radiusContainer=$(".js-legends__bubble--sizes",$(selector));var _countMax=0;var _stops=[];$.when(_request).done(function(_requestResult){var _request=_requestResult;if(typeof _requestResult!="object"){_request=JSON.parse(_requestResult)}var _data=_request.features;var _minDate=module.handleMinDate(_requestResult);var _maxDate=module.handleMaxDate(_requestResult);if(_min||_max){var _allData=[];var _mapType=$(selector).data("type");var _blockGroup="city";var _blockType="destination";_allData=$.grep(_data,function(a){if(_mapType==="hometown"){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType}});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){_allData=$.grep(_data,function(a){if(_mapType==="hometown"){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&$.inArray(a.properties.category_name,_category)>=0&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&$.inArray(a.properties.category_name,_category)>=0}})}var _allCities=$.unique($.map(_allData,function(a){return a.properties.code}).sort());var _groupRegionCount=[];_allCities.forEach(function(a){var _countAll=0;_allData.forEach(function(b){if(a===b.properties.code){_countAll+=b.properties.count}});_groupRegionCount.push(_countAll)});_countMax=Math.max.apply(null,_groupRegionCount);var _group1=Math.round(_countMax/3);var _group2=Math.round(_group1+1);var _group3=Math.round(_group1+_group2+1);_radiusContainer.html("");var _html="";var _html='<div class="labels"><span class="label-left"><i class="radius-l"></i></span><span class="label-right"><i class="radius-label">'+_group3+"-"+_countMax+"</i></span></div>";_html+='<div class="labels"><span class="label-left"><i class="radius-m"></i></span><span class="label-right"><i class="radius-label">'+_group2+"-"+(_group3-1)+"</i></span></div>";_html+='<div class="labels"><span class="label-left"><i class="radius-s"></i></span><span class="label-right"><i class="radius-label"> 1-'+(_group2-1)+"</i></span></div>";_radiusContainer.append(_html);_stops.push([0,5]);_stops.push([_group2,10]);_stops.push([_group3,15])}});_globalRadius=_stops;return _stops};module.handleDropdownBehavior=function(_parent){var parent="."+_parent;$(".js--label",$(parent)).click(function(){$(".map-filter--dropdown",$(parent)).toggleClass("is-open")})};module.handleDropdownFilter=function(_request,_min,_max,_parent,_theMap,_status,_region){var _req=_request;var selector=_parent;$.when(_request).done(function(_requestResult){var _request=_requestResult;if(typeof _requestResult!="object"){_request=JSON.parse(_requestResult)}var _categories=_request.features;var _minDate=module.handleMinDate(_requestResult);var _maxDate=module.handleMaxDate(_requestResult);var _mapType=$(selector).data("type");var _blockGroup="city";var _blockType="destination";if(_min||_max){_categories=$.grep(_request.features,function(a){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.type==_blockType});_minDate=_min;_maxDate=_max}else{_categories=$.grep(_request.features,function(a){return a.properties.type==_blockType})}if(_mapType==="hometown"){_categories=$.grep(_categories,function(a){return a.properties.show_in_hometown==="1"})}var _allCategories=$.unique($.map(_categories,function(a){return a.properties.category_name}).sort());var _filterContainer=$(".js--option",$(selector));var _filterLabel=$(".js--label",$(selector));var _html="";var _default='<label><input type="checkbox" name="filter-option" class="option-trigger option-all" value="all" checked="checked" />'+dataAll+"</label>";if(_allCategories.length===0){_default="";_filterLabel.text(dataNoData)}else{_filterLabel.text(dataAll)}_filterContainer.html(_default);_allCategories.forEach(function(a){_html+='<label><input type="checkbox" name="filter-option" class="option-trigger" value="'+a+'" />'+a+"</label>"});_html+='<div class="option-buttons">';_html+='  <input type="submit" class="option-submit" value="'+dataApply+'">';_html+='  <input type="reset" class="option-reset" value="'+dataCancel+'">';_html+="</div>";_filterContainer.append(_html);$(".option-reset",$(selector)).click(function(){var _text="";$(".option-trigger",$(selector)).prop("checked",false);$(".option-all").prop("checked",true);_text=dataSelect;_filterLabel.text(_text);$(".map-filter--dropdown",$(selector)).removeClass("is-open")});$(".option-trigger",$(selector)).click(function(){var _value=$(this).attr("value");var _text="";if(_value==="all"){$(".option-trigger",$(selector)).prop("checked",false);$(this).prop("checked",true);_text=dataAll}else{$(".option-all",$(selector)).prop("checked",false);if($(".option-trigger:checked",$(selector)).length===1){var $checked=$(".option-trigger:checked",$(selector));_text=$checked.attr("value")}else if($(".option-trigger:checked",$(selector)).length>1){_text=$(".option-trigger:checked",$(selector)).length+" options selected"}else{_text=dataSelect}}_filterLabel.text(_text)});$(".option-submit",$(selector)).click(function(){module.removeLineConnection(_theMap);$(selector+" .region-marker").remove();clickPop.remove();$(".js-reset").attr("disabled",false);$(".map-filter--dropdown",$(selector)).removeClass("is-open");var _filter=["in","category_name"];var _cats=[];$(".option-trigger:checked",$(selector)).each(function(){_filter.push($(this).attr("value"));_cats.push($(this).attr("value"))});if($(".option-trigger:checked",$(selector)).attr("value")==="all"||$(".option-trigger:checked",$(selector)).length<1){_filter=["!in","category_name","all"]}var filters=["all",[">=","date",_minDate],["<=","date",_maxDate],_filter];module.handleCasualtiesRegion(_req,_minDate,_maxDate,_cats);module.handleCasualtiesLocation(_req,_minDate,_maxDate,_cats);if(_mapType!=="hometown"){module.updateMapContents(new Date(_minDate*1e3),new Date(_maxDate*1e3),_req.responseText,_region.responseText,_req,_theMap,selector,"update",_cats);var _filteredLayer=_theMap.queryRenderedFeatures({layers:["layerRegionCenter"]});var _filteredRegions=$.grep(_filteredLayer,function(a){if(a.properties.date>=_minDate&&a.properties.date<=_maxDate&&_cats.includes(a.properties.category_name)){return a}});var _showMarker=$(selector).data("markers");if(_showMarker==="on"){module.handlePlotMarkers(_filteredRegions,_theMap,"update",_blockGroup)}}})})};module.handlePlotMarkers=function(_arraySource,_theMap,_status,_mapGroup){if(_status!=="initial"||_status==="reset"){$(".region-center-marker").remove()}if(_mapGroup!=="city"||_mapGroup===undefined){_arraySource.forEach(function(a){var el=document.createElement("div");el.className="region-center-marker "+_status;new mapboxgl.Marker(el).setLngLat(eval(a.properties.center)).addTo(_theMap)})}};module.handleDatePicker=function(_request,_region,_parent,_theMap){var selector="."+_parent;$.when(_request).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);module.buildDatePicker(selector,_minDate,_maxDate,_request,_region,_theMap)})};module.mapSlider=function(selector,_minDate,_maxDate,start,end){$(".map--slider",$(selector)).dateRangeSlider({bounds:{min:new Date(_minDate.getFullYear(),_minDate.getMonth(),1),max:_maxDate},defaultValues:{min:start,max:end},valueLabels:"change",durationIn:1e3,durationOut:1e3})};module.updateMapContents=function(_min,_max,_requestResponseText,_regionResponseText,_request,_theMap,_selector,_status,_category){_global_startDate=Date.parse(_min)/1e3;_global_endDate=Date.parse(_max)/1e3;var filters=["all",[">=","date",_global_startDate],["<=","date",_global_endDate]];var _mapType=$(_selector).data("type");var _blockGroup="region";var _blockType="destination";var _json=_requestResponseText;if(typeof _requestResponseText!="object"){_json=JSON.parse(_requestResponseText)}var _merge=$.grep(_json.features,function(a){if(_category.length>0&&_category[0]!=="all"){return a.properties.group===_blockGroup&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate&&_category.includes(a.properties.category_name)}else{return a.properties.group===_blockGroup&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate}});var _regions=[];if(typeof _requestResponseText!="object"){_regions=JSON.parse(_regionResponseText).features}else{_regions=_regionResponseText.features}_merge.forEach(function(a){_regions.forEach(function(b){if(a.properties.name.toLowerCase()===b.properties.name_ua.toLowerCase()){a.geometry=b.geometry}})});var _allRegion=$.unique($.map(_merge,function(a){return a.properties.name}).sort());var _newRegion=[];var _newRegionMarker=[];var _newCount=[];var obj={};var _centerMarker={};_allRegion.forEach(function(a){var count=0;_merge.forEach(function(b){if(a===b.properties.name){count+=b.properties.count;obj=b;_centerMarker={id:b.properties.id,type:"Feature",geometry:{type:"Point",coordinates:b.properties.center},properties:{name:b.properties.name,category_name:b.properties.category_name,date:b.properties.date,center:b.properties.center}}}});_newCount.push(count);_newRegion.push(obj);_newRegionMarker.push(_centerMarker)});var i=0;var _regionClone=_newRegion.slice(0);_regionClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});var _showMarker=$(_selector).data("markers");if(_showMarker==="on"){module.handlePlotMarkers(_regionClone,_theMap,_status,_blockGroup)}_theMap.getSource("_regionSource").setData({type:"FeatureCollection",features:_newRegion});_theMap.getSource("_regionCenter").setData({type:"FeatureCollection",features:_newRegionMarker});var _merge=$.grep(_json.features,function(a){if(_mapType==="hometown"){return a.properties.group==="city"&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.group==="city"&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate}});var _cities=[];if(typeof _requestResponseText!="object"){_cities=JSON.parse(_regionResponseText).features}else{_cities=_regionResponseText.features}var _allCities=$.unique($.map(_merge,function(a){return a.properties.name}).sort());var _newCity=[];var _newCount=[];var obj={};_allCities.forEach(function(a){var count=0;_merge.forEach(function(b){if(a===b.properties.name){count+=b.properties.count;obj=b}});_newCount.push(count);_newCity.push(obj)});var i=0;var _cityClone=_newCity.slice(0);_cityClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});_theMap.getSource("_regionBubbles").setData({type:"FeatureCollection",features:_newCity});module.handleCasualtiesRegion(_request,_global_startDate,_global_endDate,null,_selector);module.handleCasualtiesLocation(_request,_global_startDate,_global_endDate,null,_selector);var _stopsStyle={property:"count",type:"interval",stops:_globalStop};_theMap.setPaintProperty("layerRegion","fill-color",_stopsStyle)};module.handleGenerateSlider=function(_request,_region,i,_theMap){var loadRegion=setInterval(function(){var _region=_theMap.getLayer("layerRegion");var _bubble=_theMap.getLayer("layerBubble");if(_region!==undefined&&_bubble!==undefined){_theMap.moveLayer("layerBubble");clearInterval(loadRegion)}},100);var selector="."+_mapParents[i];$.when(_request).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"];module.mapSlider(selector,_minDate,_maxDate,_minDate,_maxDate);if(typeof _requestResult!="object"){_requestResult=JSON.parse(_requestResult)}var _allDates=$.unique($.map(_requestResult.features,function(a){var date=new Date(a.properties.date*1e3);if(!isNaN(date.getFullYear())){return date.getFullYear()}})).sort();var _years="";_allDates=$.unique(_allDates);_allDates.forEach(function(a){_years+='<span class="year--marking">'+a+"</span>";if(_allDates.length<4){_years+="<span>0000</span><span>0000</span><span>0000</span>"}else{_years+="<span>0000</span>"}});$(".map--slider__years",$(selector)).append(_years);var _minLabel=_minDate.getMonth()+1+"/"+_minDate.getDate()+"/"+_minDate.getFullYear();var _maxLabel=_maxDate.getMonth()+1+"/"+_maxDate.getDate()+"/"+_maxDate.getFullYear();var _dateLabel='<p class="date--start">'+_minLabel+"</p>";_dateLabel+='<p class="date--end">'+_maxLabel+"</p>";$(".map--slider__marking",$(selector)).append(_dateLabel);$(".map--slider",$(selector)).on("valuesChanging",function(e,data){$(".js-reset").attr("disabled",false);clickPop.remove();_slideTriggerred=true;var _min=data.values.min;var _max=data.values.max;module.buildDatePicker(selector,_minDate,_maxDate,_request,_region,_theMap);module.updateMapContents(_min,_max,_request.responseText,_region.responseText,_request,_theMap,selector,"update",[]);module.removeLineConnection(_theMap);$(selector+" .region-marker").remove()})})};module.handleGenerateBubble=function(_request,_theMap,_parent,_isRTL){var _bubbles=_request;$.when(_bubbles).done(function(_bubbleData){var _parentSelector="."+_parent;var _mapType=$(_parentSelector).data("type");var _mapGroup=$(_parentSelector).data("group");var _blockGroup="city";var _blockType="destination";var startDate=module.handleMinDate(_bubbleData);var endDate=module.handleMaxDate(_bubbleData);var _merged=module.handleProcessRequest(_bubbleData,_blockType,_blockGroup);_merged=$.grep(_merged,function(a){if(_mapType==="hometown"){return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=startDate&&a.properties.date<=endDate}});var _mergeClone=$.grep(JSON.parse(_bubbleData).features,function(a){if(_mapType==="hometown"){return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.group==="city"&&a.properties.type==="destination"&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.group==="city"&&a.properties.type==="destination"}});var _allCity=$.unique($.map(_merged,function(a){return a.properties.code}).sort());var _newCity=[];var _newCount=[];var obj={};_allCity.forEach(function(a){var count=0;_merged.forEach(function(b){if(a===b.properties.code){count+=b.properties.count;obj=b}});_newCount.push(count);_newCity.push(obj)});var i=0;var _cityClone=_newCity.slice(0);_cityClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});var myGeoJSON={};myGeoJSON.type="FeatureCollection";myGeoJSON.features=_cityClone;var _stops=module.handleCasualtiesLocation(_bubbles,startDate,endDate,null,"."+_parent);var _mapLoaded=false;var _dataLoaded=false;_dataLoaded=_theMap.once("data",function(){return true});_mapLoaded=_theMap.once("load",function(){var load_geojson=setInterval(function(){if(_dataLoaded){_theMap.addSource("_regionBubbles",{type:"geojson",data:myGeoJSON});clearInterval(load_geojson)}},100);return true});if(_mapLoaded&&_dataLoaded){var _hoveredBubble=false;var _opacity=.7;var _opacityHover=1;var _visibilty="visible";if(_mapType==="connection"&&_mapGroup==="region"){_opacity=0;_visibilty="none"}var preload_bubble_layer=setInterval(function(){if(_theMap.loaded()){clearInterval(preload_bubble_layer)}},300);var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerBubble",function(e){if(e.features.length>0){if(_hoveredBubble){_theMap.setFeatureState({source:"_regionBubbles",id:_hoveredBubble},{hover:false})}_hoveredBubble=e.features[0].id;_theMap.setFeatureState({source:"_regionBubbles",id:_hoveredBubble},{hover:true})}});_theMap.on("mouseleave","layerBubble",function(){if(_hoveredBubble){_theMap.setFeatureState({source:"_regionBubbles",id:_hoveredBubble},{hover:false})}_hoveredBubble=null});module.handleMapEvents("layerBubble",myGeoJSON,startDate,endDate,_theMap,_parent,_mergeClone,_isRTL);$(".map--preloader").addClass("is--loaded")}})};module.handleGenerateRegions=function(_request,_min,_max,_theMap,_parent,_isRTL,_regionFill){var _regions=_request;$.when(_regions).done(function(_regionData){var startDate=module.handleMinDate(_regionData);var endDate=module.handleMaxDate(_regionData);if(_min||_max){startDate=_min;endDate=_max;_global_startDate=startDate;_global_endDate=endDate}var _parentSelector="."+_parent;var _mapType=$(_parentSelector).data("type");var _mapGroup=$(_parentSelector).data("group");var _blockGroup="region";var _blockType="destination";var _merged=module.handleProcessRequest(_regionData,_blockType,_blockGroup);_merged=$.grep(_merged,function(a){return a.properties.date>=startDate&&a.properties.date<=endDate});var _mergeClone=$.grep(JSON.parse(_regionData).features,function(a){return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.group==="region"&&a.properties.type==="destination"});var _allRegion=$.unique($.map(_merged,function(a){return a.properties.name}).sort());var _newRegion=[];var _newRegionMarker=[];var _newCount=[];var obj={};var _centerMarker={};_allRegion.forEach(function(a){var count=0;_merged.forEach(function(b){if(a===b.properties.name){count+=b.properties.count;obj=b;_centerMarker={id:b.properties.id,type:"Feature",geometry:{type:"Point",coordinates:b.properties.center},properties:{name:b.properties.name,category_name:b.properties.category_name,date:b.properties.date,center:b.properties.center}}}});_newCount.push(count);_newRegion.push(obj);_newRegionMarker.push(_centerMarker)});var i=0;var _regionClone=_newRegion.slice(0);_regionClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});var myGeoJSON={};myGeoJSON.type="FeatureCollection";myGeoJSON.features=_newRegion;var myCenterJSON={};myCenterJSON.type="FeatureCollection";myCenterJSON.features=_newRegionMarker;var geoJSONModal={};geoJSONModal.type="FeatureCollection";geoJSONModal.features=_merged;var _stops=module.handleCasualtiesRegion(_regions,startDate,endDate,null,"."+_parent);$.when(_regionFill).done(function(_fillData){var _fill=_fillData;if(typeof _fillData!="object"){_fill=JSON.parse(_fillData)}myGeoJSON.features.forEach(function(a){_fill.features.forEach(function(b){if(a.properties.name.toLowerCase()===b.properties.name_ua.toLowerCase()){a.geometry=b.geometry;a.properties.fill=b.properties.fill}})});var _mapLoaded=false;var _dataLoaded=false;_dataLoaded=_theMap.once("data",function(){return true});_mapLoaded=_theMap.once("load",function(){return true});if(_mapLoaded&&_dataLoaded){var _hoveredRegion=false;_theMap.addSource("_regionSource",{type:"geojson",data:myGeoJSON});_theMap.addSource("_regionCenter",{type:"geojson",data:myCenterJSON});var _opacityHover=1;var _opacityNormal=.75;var _visibilty="visible";if((_mapType==="connection"||_mapType==="hometown")&&_mapGroup==="city"){_opacityHover=0;_opacityNormal=0;_visibilty="none"}var preload_region_layer=setInterval(function(){if(_theMap.loaded()&&_stops.length!==0){_theMap.addLayer({id:"layerRegion",type:"fill",source:"_regionSource",layout:{visibility:_visibilty},paint:{"fill-color":{property:"count",type:"interval",stops:_stops},"fill-opacity":["case",["boolean",["feature-state","hover"],false],_opacityHover,_opacityNormal]},filter:["all",[">=","date",startDate],["<=","date",endDate]]});window.windowMap=_theMap;_theMap.addLayer({id:"layerRegionOutline",type:"line",source:"_regionSource",layout:{visibility:_visibilty},paint:{"line-color":"white","line-width":2}});var _showMarker=$(_parentSelector).data("markers");var _centerVisibility="none";if(_showMarker==="on"){_centerVisibility="visible"}_theMap.addLayer({id:"layerRegionCenter",type:"circle",source:"_regionCenter",layout:{visibility:_centerVisibility},paint:{"circle-color":"red","circle-radius":10,"circle-opacity":0}});if(_showMarker==="on"){module.handlePlotMarkers(_regionClone,_theMap,"initial",_mapGroup)}clearInterval(preload_region_layer)}$(".map--preloader").addClass("is--loaded")},100);var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerRegion",function(e){if(e.features.length>0){if(_hoveredRegion){_theMap.setFeatureState({source:"_regionSource",id:_hoveredRegion},{hover:false})}_hoveredRegion=e.features[0].id;_theMap.setFeatureState({source:"_regionSource",id:_hoveredRegion},{hover:true})}});_theMap.on("mouseleave","layerRegion",function(){if(_hoveredRegion){_theMap.setFeatureState({source:"_regionSource",id:_hoveredRegion},{hover:false})}_hoveredRegion=null});module.handleMapEvents("layerRegion",myGeoJSON,startDate,endDate,_theMap,_parent,_mergeClone,_isRTL)}})})};module.handleMapEvents=function(_type,_source,_min,_max,_theMap,_selector,_originalSource,_isRTL){var _parentSelector="."+_selector;var _event=module.isMobileSafari()?"touchstart":"click";_theMap.on(_event,_type,function(e){var filters=_theMap.getFilter(_type);var _startDate=_min;var _endDate=_max;var _sourceType="_regionBubbles";if(_type==="layerRegion"){_sourceType="_regionSource"}var _category=[];$("."+_selector).find(".option-trigger:checked").each(function(){_category.push($(this).attr("value"))});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){var _originalSourceFiltered=$.grep(_originalSource,function(a){return $.inArray(a.properties.category_name,_category)>=0})}else{var _originalSourceFiltered=_originalSource}var _originalSourceAddedMissingMonths=module.addMissingMonths(_originalSourceFiltered);var _mapSource=_theMap.getSource(_sourceType);var _mapType=$(_parentSelector).data("type");var _blockGroup=_type=="layerRegion"?"region":"city";var _blockType="destination";var _all_data_source={};_all_data_source.type="FeatureCollection";_all_data_source.features=_originalSourceFiltered;if(_blockGroup==="region"){}var _sourceArray=$.grep(_all_data_source.features,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.group===_blockGroup&&a.properties.type===_blockType});if(_slideTriggerred){_startDate=_global_startDate;_endDate=_global_endDate}var _count=0;var _city=$.grep(_sourceArray,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.date>=_startDate&&a.properties.date<=_endDate});var _cityData=$.grep(_sourceArray,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.date>=_startDate&&a.properties.date<=_endDate});_city.forEach(function(a){_count+=a.properties.count});var _series=[];var _allDatesx=$.unique($.map(_city,function(a){var _date=new Date(a.properties.date*1e3);if(a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()){return _date.getFullYear()}}).sort());var _allDates=[];_allDatesx.forEach(function(year){for(var i=0;i<12;i++){_allDates.push(year+"-"+i+"-"+1)}});var _addDatesLabel=$.map(_allDates,function(a){var _monthsName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var _str=a.split("-");return _monthsName[_str[1]]+"<span class='spacer [ u-fwn u-fsn u-franklin ]'><br></span>"+_str[0]});var _allCategories=$.unique($.map(_city,function(a){return a.properties.category_name}).sort());var _series=[];var _obj={};_allCategories.forEach(function(a){_obj={};var _dates=[];_cityData.forEach(function(b){var _date=[];if(a===b.properties.category_name){_obj.name=b.properties.category_name;_date.push(b.properties.date*1e3);_date.push(b.properties.count)}_dates.push(_date)});var _monthsName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var _dateSort=$.grep(_dates,function(n){return n.length!==0}).sort(function(a,b){if(new Date(a)>new Date(b)){return 1}else if(new Date(a)<new Date(b)){return-1}else{return 0}});var _years=$.unique($.map(_dates,function(a){if(a.length!==0){var _y=new Date(a[0]).getFullYear();var _d=new Date(a[0]).getMonth();return _y+"-"+_monthsName[_d]+"-1"}}).sort());var _arr=[];_allDates.forEach(function(year){var _c=0;var _ar=[];_dateSort.forEach(function(item){var _compare=new Date(item[0]).getFullYear()+"-"+new Date(item[0]).getMonth()+"-1";if(year===_compare){_c+=item[1]}});_arr.push([_c])});_obj.data=_arr;_series.push(_obj)});if(_mapType!=="hometown"){var _html="";_html='<div class="mapboxgl--graph__wrapper"><span class="mapboxgl--graph__visual-close">&times;</span>';_html+='<div class="mapboxgl--graph__visual" id="js-visual">';_html+="</div>";_html+='<div class="mapboxgl--graph__summary">';_html+='<p class="mapboxgl--graph__summary--highlight [ u-fwn u-fsn u-franklin ] ">'+_count+"</p>";_html+='<p class="[ u-fwn u-fsn u-franklin u-ttu ]">'+$(_parentSelector).data("total-deaths")+'</p><a href="https://www.highcharts.com/" class="highcharts-credits [ u-franklin ]">Highcharts.com</a>';_html+="</div>";_html+="</div>";clickPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap);Highcharts.chart("js-visual",{chart:{type:"column",height:400,style:{fontFamily:'"franklin-gothic-urw", Helvetica, Arial, sans-serif'}},title:{rtl:_isRTL,text:e.features[0].properties.name+'<br><span class="mapbox-graph__subtitle">'+$(_parentSelector).data("title")+"</span>",style:{color:"#14272b",fontSize:"23px",lineHeight:"25px",letterSpacing:"-.4px",marginBottom:"10px"}},credits:{enabled:false},xAxis:{categories:_addDatesLabel,labels:{style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"}}},yAxis:{min:0,title:{text:null},labels:{style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"}}},exporting:{enabled:false},tooltip:{shadow:false,rtl:_isRTL,useHTML:true,headerFormat:'<p class="tooltip-header [ u-fwn u-fsn u-franklin ]" style="margin: 0; font-size: 13px; text-align: center;">{point.key}</p>',pointFormat:'<p style="display: flex; justify-content: space-between; margin-top: 5px; margin-bottom: 0; font-size: 13px;">'+"<span>{series.name}</span>"+'<strong style="margin-left: 5px;">{point.y}</strong>'+"<p/>",footerFormat:'<p style="font-weight: 700; display: flex; justify-content: space-between" class="[ u-fwn u-fsn u-franklin ]"><span>'+dataTotal+"</span><span>{point.total}</span></p>",padding:15,backgroundColor:"#ffffff",borderColor:"#cecece",borderRadius:0,borderWidth:1,shared:true,formatter:function(){var s='<div class="highcharts-tooltip-table__elem">';s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col highcharts-tooltip-table__heading [ u-fwn u-fsn u-franklin ]" style="color: #05363e">'+this.x.replace("/<brs*/?>/gi"," ")+"</div></div>";$.each(this.points,function(index){s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col series--name [ u-fwn u-fsn u-franklin ]">'+this.series.name+"</div>";s+='<div class="highcharts-tooltip-table__col series--value [ u-fwn u-fsn u-franklin ]">'+this.y+"</div></div>"});s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col  series--total [ u-fwn u-fsn u-franklin ]"><b style="text-transform:uppercase;">'+dataTotal+'</b></div> <div class="highcharts-tooltip-table__col series--total--value"><b>'+this.points[0].total+"</b></div></div>";s+="</div>";return s}},plotOptions:{column:{stacking:"normal"}},legend:{rtl:_isRTL,enabled:true,verticalAlign:"bottom",itemMarginBottom:8,itemStyle:{fontWeight:"normal",lineHeight:"15px",fontSize:"13px",color:"#555555",letterSpacing:"0.3px"}},series:_series});window.dispatchEvent(new Event("resize"))}$(".map--overlay").addClass("is-shown");$(".mapboxgl--graph__visual-close").click(function(){clickPop.remove();$(".map--overlay").removeClass("is-shown")});if(_mapType==="connection"||_mapType==="hometown"){var _origin={code:e.features[0].properties.code,date:e.features[0].properties.date,from:e.features[0].properties.origin_code};var _mapType={type:_blockType,group:_blockGroup,map:_mapType};var _overAllCount=_count;module.handleDrawConnection(e,_theMap,_sourceArray,_source,_origin,_cityData,_mapType,_overAllCount,_parentSelector)}});var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,_type,function(e){var _startDate=_min;var _endDate=_max;var _sourceType="_regionBubbles";if(_type==="layerRegion"){_sourceType="_regionSource"}var _mapSource=_theMap.getSource(_sourceType);var _category=[];$("."+_selector).find(".option-trigger:checked").each(function(){_category.push($(this).attr("value"))});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){var _originalSourceFiltered=$.grep(_originalSource,function(a){return $.inArray(a.properties.category_name,_category)>=0})}else{var _originalSourceFiltered=_originalSource}var _sourceArray=_source.features;var _all_data_source={};_all_data_source.type="FeatureCollection";_all_data_source.features=_originalSourceFiltered;var _mapType=$(_parentSelector).data("type");var _blockGroup=_type=="layerRegion"?"region":"city";var _blockType="destination";var _sourceArray=$.grep(_all_data_source.features,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.group===_blockGroup&&a.properties.type===_blockType&&a.properties.date>=_startDate&&a.properties.date<=_endDate});if(_slideTriggerred){_startDate=_global_startDate;_endDate=_global_endDate}var _count=0;var _city=$.grep(_sourceArray,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.date>=_startDate&&a.properties.date<=_endDate});_city.forEach(function(a){_count+=a.properties.count});var _html="";var _mapType=$(_parentSelector).data("type");_html+='<div class="mapboxgl--hover__data"><p class="[ u-franklin u-fsn u-fwn ]">';_html+="<b>"+_count+"</b>";_html+="<span>&nbsp;"+$(_parentSelector).data("casualty-in").toLowerCase()+"&nbsp;</span>";_html+="<b>"+e.features[0].properties.name+"</b>";_html+="</p></div>";markerPop.remove();if(_mapType!=="connection"){hoverPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}});var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerRegionCenter",function(e){var _html="";_html+='<div class="mapboxgl--hover__data"><p class="[ u-franklin u-fsn u-fwn ]">';_html+=e.features[0].properties.name;_html+="</p></div>";hoverPop.remove();var _mapType=$(_parentSelector).data("type");if(_mapType==="simple"){markerPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}});_theMap.on("mouseleave",_type,function(e){hoverPop.remove();markerPop.remove()});_theMap.on("layerRegionCenter",_type,function(e){hoverPop.remove();markerPop.remove()})};module.handleDrawConnection=function(_e,_theMap,_sourceArray,_sourceAll,_origin,_originalSource,_mapType,_overAll,_parentSelector){var mapLayer=_theMap.getLayer("layerPoints");var _isCenter="false";if(typeof mapLayer!=="undefined"){_theMap.removeLayer("layerPoints").removeSource("_pointsOrigin");_theMap.removeLayer("layerString").removeSource("_pointsString");try{$(_parentSelector+" .region-marker").remove()}catch(e){console.log(e);console.log("No marker was intantiated.")}}var _centerCode=_e.features[0].properties.code;var _centerName=_e.features[0].properties.name;var _center=eval(_e.features[0].properties.center);if(_mapType.map==="connection"){var _points=$.map(_sourceArray,function(a){var _groupClass=_mapType.group;_isCenter="false";if(_centerCode===a.properties.origin_code){_groupClass+=" region-marker-"+_groupClass+"-center center-center";_isCenter="true"}var el=document.createElement("div");var _class="region-marker region-marker-"+_groupClass;el.className=_class;if(a.properties.origin_center){new mapboxgl.Marker(el).setLngLat(a.properties.origin_center).addTo(_theMap);return{type:"Feature",properties:{name:a.properties.origin_name,is_center:_isCenter,origin_code:a.properties.origin_code,code:a.properties.code},geometry:{type:"Point",coordinates:a.properties.origin_center}}}});if(_centerName===_e.features[0].properties.name&&_centerCode!==_e.features[0].properties.origin_code){_isCenter="center-only";var el=document.createElement("div");el.className="region-marker region-marker-city-center-only";new mapboxgl.Marker(el).setLngLat(_center).addTo(_theMap)}var _centerObj={type:"Feature",properties:{name:_e.features[0].properties.name,is_center:_isCenter,origin_code:_e.features[0].properties.origin_code,code:_e.features[0].properties.code},geometry:{type:"Point",coordinates:eval(_center)}};_points.push(_centerObj);var _lineString=$.map(_sourceArray,function(a){if(a.properties.origin_name){var _ob={type:"Feature",properties:{name:a.properties.origin_name,category_color:a.properties.category_color,category_name:a.properties.category_name},geometry:{type:"LineString",coordinates:[eval(_center),a.properties.origin_center]}};return _ob}});var myGeoJSONString={};myGeoJSONString.type="FeatureCollection";myGeoJSONString.features=_lineString;_theMap.addSource("_pointsString",{type:"geojson",lineMetrics:true,data:myGeoJSONString});_theMap.addLayer({id:"layerString",type:"line",source:"_pointsString",paint:{"line-color":"black","line-opacity":1,"line-width":3,"line-gradient":["interpolate",["linear"],["line-progress"],0,"#1ca404",.5,"#56a0f9",1,"#1a3bc2"]},layout:{"line-cap":"round","line-join":"round"}});var myGeoJSON={};myGeoJSON.type="FeatureCollection";myGeoJSON.features=_points;_theMap.addSource("_pointsOrigin",{type:"geojson",data:myGeoJSON});_theMap.addLayer({id:"layerPoints",type:"circle",source:"_pointsOrigin",paint:{"circle-color":"#ffffff","circle-opacity":0,"circle-radius":5}});hoverPop.remove();_theMap.on("mouseenter","layerPoints",function(e){var _deathPlace=_origin.code;var _deathDate=_origin.date;var _deathOrigin=e.features[0].properties.origin_code;var _type=_mapType.group;var _count=0;var _newSource=$.grep(_originalSource,function(a){return a.properties.code===_deathPlace&&a.properties.origin_code===_deathOrigin&&a.properties.type==="destination"&&a.properties.group===_type});if(_newSource.length>0){_newSource.forEach(function(a){_count+=a.properties.count})}var _html="";var _context="";var _isOrigin=false;var _isSame=false;if(_mapType.group==="city"||_mapType.group==="region"&&_mapType){if(e.features[0].properties.is_center==="true"){_context="";_context+='<div class="casualty-count-to [ u-franklin u-fsn u-fwn ]">';_context+="<b>"+_overAll+"</b>";_context+=" "+dataCasualtyIn+" ";_context+="<b>"+e.features[0].properties.name+"</b>";_context+="</div>";_context+='<div class="casualty-count-from [ u-franklin u-fsn u-fwn ]">';_context+="<b>"+_count+"</b>";_context+=" "+dataCasualtySame+" ";_context+="<b>"+e.features[0].properties.name+"</b>";_context+="</div>";_isSame=true}else if(e.features[0].properties.is_center==="center-only"){_context="";_context+='<div class="casualty-count">';_context+="<p class='[ u-franklin u-fsn u-fwn ]'>";_context+=e.features[0].properties.name+"</p>";_context+="</div>";_isSame=false}else{_context="";_context+='<div class="casualty-count">';_context+="<p class='[ u-franklin u-fsn u-fwn ]'><b>"+_count+"</b>";_context+=" "+dataCasualtyFrom+" ";_context+="<b>"+e.features[0].properties.name+"</b></p>";_context+="</div>";_isOrigin=true;_isSame=false}}_html+='<div class="mapboxgl--hover__data">';_html+=_context;_html+="</div>";hoverPop.remove();markerPop.remove();if(_isOrigin){connectOrigin.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}else{if(_isSame){connectDestination.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}else{connectPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}}});_theMap.on("mouseleave","layerPoints",function(e){connectPop.remove();connectOrigin.remove();connectDestination.remove();hoverPop.remove();markerPop.remove()});$(".region-marker").hover(function(){$(".map-route--same").removeClass("is-shown");if($(this).hasClass("center-center")){$(".map-route--same").addClass("is-shown")}},function(){$(".map-route--same").removeClass("is-shown")})}else{var _dateChanged=_global_startDate!==0||_global_endDate!==0?true:false;if(_dateChanged){_sourceArray=$.grep(_sourceArray,function(a){return a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate&&a.id!==0})}var _allCities=$.unique($.map(_sourceArray,function(a){return a.properties.origin_name}).sort());var _allLines=[];_allCities.forEach(function(a){var _rec=$.unique($.map(_sourceArray,function(b){if(a===b.properties.origin_name){return b.properties.category_name}})).sort();_allLines[a]=_rec});var _categoriesColor=$.unique($.map(_sourceArray,function(a){return a.properties.category_name+"|"+a.properties.category_color}).sort());var _hometownLegend=$(".hometown--legend",_parentSelector);var _html="";_categoriesColor.forEach(function(category){_html+='<p><span style="background-color: '+category.substring(category.indexOf("#"))+'"></span>'+category.substring(0,category.indexOf("|"))+"</p>"});_html+='<p><span style="background-color: #428cf4;"></span> '+dataDestination+"</p>";_hometownLegend.html(_html);$(".js-hometown-route",_parentSelector).addClass("is-shown");var _lineString=[];for(var key in _allLines){var _obj={};if(_allLines.hasOwnProperty(key)){var _color=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.category_color}).sort());_color=_color[0];var _category=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.category_name}).sort());_category=_category[0];if(_allLines[key].length>1){var _color=$.unique($.map(_sourceArray,function(a){return a.properties.category_color}).sort());var _category=$.unique($.map(_sourceArray,function(a){return a.properties.category_name}).sort())}var _origin_center=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.origin_center}).sort());var _origin_code=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.origin_code}).sort());var _code=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.code}).sort());var _origin_center_array=eval("["+_origin_code[0]+"]").reverse();_obj={type:"Feature",properties:{name:key,category_color:_color,category_name:_category,origin_code:_origin_code[0],origin_center:_origin_code[0],code:_code[0]},geometry:{type:"LineString",coordinates:[eval(_center),_origin_center_array]}};_lineString.push(_obj)}}var _singleCategory=$.map(_lineString,function(_record){if(!Array.isArray(_record.properties.category_color)){return _record}});var _multipleCategory=$.map(_lineString,function(_record){if(Array.isArray(_record.properties.category_color)){return _record}});try{$(_parentSelector+" .region-marker").remove()}catch(e){console.log(e);console.log("No marker was intantiated.")}var _maxTotal=0;_sourceArray.forEach(function(a){_maxTotal+=a.properties.count});var _range1=_maxTotal/3;var _range2=_range1+1;var _range3=_range1*2+1;var _center={geometry:{type:"Point",coordinates:eval(_e.features[0].properties.center)},properties:{name:_centerName,code:_centerCode}};var _groupClass=_mapType.group;var el=document.createElement("div");var _class="region-marker region-marker-hometown hometown-center region-marker-"+_groupClass;el.className=_class;new mapboxgl.Marker(el).setLngLat(_center.geometry.coordinates).addTo(_theMap);if(_singleCategory.length>0){module.generateLineString(_theMap,_singleCategory,"single");_singleCategory.forEach(function(_category){var _deathCount=0;_sourceArray.forEach(function(rec){if(rec.properties.origin_code===_category.properties.origin_code){_deathCount+=rec.properties.count}});var _sizeClass="";if(_deathCount<_range1){_sizeClass=" size--small"}else if(_deathCount>=_range2&&_deathCount<_range3){_sizeClass=" size--medium"}else if(_deathCount>=_range3&&_deathCount<=_maxTotal){_sizeClass=" size--large"}var _groupClass=_mapType.group;var el=document.createElement("div");var _class="region-marker region-marker-hometown region-marker-"+_groupClass;el.className=_class;el.style.backgroundColor=_category.properties.category_color;var _origin_array=eval("["+_category.properties.origin_center+"]").reverse();new mapboxgl.Marker(el).setLngLat(_origin_array).addTo(_theMap)})}if(_multipleCategory.length>0){module.generateLineString(_theMap,_multipleCategory,"multiple");_multipleCategory.forEach(function(_category){var _deathCount=0;_sourceArray.forEach(function(rec){if(rec.properties.origin_code===_category.properties.origin_code){_deathCount+=rec.properties.count}});var _sizeClass="";if(_deathCount<_range1){_sizeClass=" size--small"}else if(_deathCount>=_range2&&_deathCount<_range3){_sizeClass=" size--medium"}else if(_deathCount>=_range3&&_deathCount<=_maxTotal){_sizeClass=" size--large"}var _groupClass=_mapType.group;var el=document.createElement("div");var _class="region-marker region-marker-hometown region-marker-"+_groupClass;el.className=_class;el.style.background="linear-gradient(to right, "+_multipleCategory[0].properties.category_color[1]+" 50%, "+_multipleCategory[0].properties.category_color[0]+" 50%)";var _origin_array=eval("["+_category.properties.origin_center+"]").reverse();new mapboxgl.Marker(el).setLngLat(_origin_array).addTo(_theMap)})}var _linePoints=$.map(_lineString,function(_line){var _object={geometry:{type:"Point",coordinates:_line.geometry.coordinates[1]},properties:{name:_line.properties.name,code:_line.properties.code,origin_code:_line.properties.origin_code,date:_line.properties.date}};return _object});_linePoints.push(_center);module.generateLineStringPoints(_theMap,_linePoints,_sourceArray)}};module.generateLineStringPoints=function(_theMap,_points,_sourceArray){$(".reset--connection","#"+_theMap._canvasContainer.offsetParent.id).addClass("is-shown");var mapHomeTownPoints=_theMap.getLayer("layerHometowns");if(typeof mapHomeTownPoints!=="undefined"){_theMap.removeLayer("layerHometowns").removeSource("_hometownsBubble")}var _hometowns={};_hometowns.type="FeatureCollection";_hometowns.features=_points;_theMap.addSource("_hometownsBubble",{type:"geojson",lineMetrics:true,data:_hometowns});_theMap.addLayer({id:"layerHometowns",type:"circle",source:"_hometownsBubble",paint:{"circle-color":"red","circle-radius":20,"circle-opacity":0}});var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerHometowns",function(e){_theMap.moveLayer("layerBubble","layerHometowns");var _referencePoint=e.features[0].properties.origin_code?e.features[0].properties.origin_code:e.features[0].properties.code;var _name=$.unique($.map(_sourceArray,function(a){if(_referencePoint===a.properties.origin_code){return a.properties.origin_name}}).sort());var _allCategories=$.unique($.map(_sourceArray,function(a){if(_referencePoint===a.properties.origin_code){return a.properties.category_name}}).sort());var _html="";_html+='<div class="mapboxgl--hover__hometown  mapboxgl--hover__data">';_html+='<div class="hometown--details">';var _hasRecord=false;_allCategories.forEach(function(category){var _count=0;if(_global_startDate!==0){_sourceArray.forEach(function(a){if(_referencePoint===a.properties.origin_code&&category===a.properties.category_name&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate){_count+=a.properties.count}})}else{_sourceArray.forEach(function(a){if(_referencePoint===a.properties.origin_code&&category===a.properties.category_name){_count+=a.properties.count}})}_html+="<div>"+_count+" "+category+"</div>";_hasRecord=true});if(_hasRecord){_html+="<div>"+dataFrom+" "+_name+"</div>"}else{_html+=e.features[0].properties.name}_html+="</div>";_html+="</div>";hoverPop.remove();hometownPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)});_theMap.on("mouseleave","layerHometowns",function(e){hoverPop.remove();hometownPop.remove()})};module.removeLineConnection=function(_theMap){$(".reset--connection","#"+_theMap._canvasContainer.offsetParent.id).removeClass("is-shown");var mapLayerSingleString=_theMap.getLayer("layerSingleString");var mapLayerMultipleString=_theMap.getLayer("layerMultipleString");if(typeof mapLayerSingleString!=="undefined"){_theMap.removeLayer("layerSingleString").removeSource("_singleStrings")}if(typeof mapLayerMultipleString!=="undefined"){_theMap.removeLayer("layerMultipleString").removeSource("_multipleStrings")}var mapLayerHome=_theMap.getLayer("layerHometowns");if(typeof mapLayerHome!=="undefined"){_theMap.removeLayer("layerHometowns").removeSource("_hometownsBubble")}};module.generateLineString=function(_theMap,_stringSource,_type){module.removeLineConnection(_theMap);var _singleCategoryString={};_singleCategoryString.type="FeatureCollection";_singleCategoryString.features=_stringSource;var _layerSource="_singleStrings";var _layerId="layerSingleString";if("multiple"===_type){_layerSource="_multipleStrings";_layerId="layerMultipleString"}_theMap.addSource(_layerSource,{type:"geojson",lineMetrics:true,data:_singleCategoryString});if("single"===_type){var preloadConnectionString=setInterval(function(){if(_theMap.loaded()){_theMap.addLayer({id:_layerId,type:"line",source:_layerSource,paint:{"line-color":["get","category_color"],"line-width":3},layout:{"line-cap":"round","line-join":"round"}});clearInterval(preloadConnectionString)}},300)}else{var preloadConnectionString=setInterval(function(){if(_theMap.loaded()){_theMap.addLayer({id:_layerId,type:"line",source:_layerSource,paint:{"line-color":"black","line-width":3,"line-gradient":["interpolate",["linear"],["line-progress"],0,_stringSource[0].properties.category_color[1],.5,_stringSource[0].properties.category_color[1],.51,_stringSource[0].properties.category_color[0],1,_stringSource[0].properties.category_color[0]]},layout:{"line-cap":"round","line-join":"round"}});clearInterval(preloadConnectionString)}},300)}};module.handleURLRequests=function(_url){var _request=$.ajax({url:_url,dataType:"Text",error:function(xhr){console.log("An error occured while retrieving GeoJson for Bubbles files")}});return _request};module.handleProcessRequest=function(_request,_type,_group){var processed_data=_request;if(typeof _request!="object"){processed_data=JSON.parse(_request)}var processed_clone=Object.assign(processed_data);var type=_type===null||_type===undefined?"destination":_type;var group=_group===null||_group===undefined?"city":_group;var arr=$.grep(processed_clone.features,function(a){return a.properties.type===type&&a.properties.group===group});return arr};module.handleMinDate=function(_request){var getMin=_request;if(typeof _request!="object"){getMin=JSON.parse(_request)}var _startDate=Math.min.apply(null,$.map(getMin.features,function(a){return a.properties.date}));return _startDate};module.handleMaxDate=function(_request){var getMin=_request;if(typeof _request!="object"){getMin=JSON.parse(_request)}var _endDate=Math.max.apply(null,$.map(getMin.features,function(a){return a.properties.date}));return _endDate};module.isMobileSafari=function(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)};handlers.push({name:"_handleMapInit",handle:function(){module.handleMap()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("stickyGallery",function(window,$,app){"use strict";var module={},selector=".js-sticky-gallery",item=".js-sticky-gallery-item",content=".js-sticky-gallery-content",image=".js-sticky-gallery-image",headerContainer=".js-header-container",$selectors=$(selector);module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var lastItem={};module.loadModule=function(){var onScroll=function(){var $header=$(".js-header");if(window.innerWidth<760){$(item,$selectors).removeClass("active");$(image,$selectors).removeAttr("style");return false}$selectors.each(function(){var $component=$(this),$headerContainer=$(headerContainer),$items=$component.find(item),$images=$items.find(image),trigger=app.$win.scrollTop()+app.$win.height()/2,viewportTop=app.$win.scrollTop()+$headerContainer.height()+60,componentTop=$component.offset().top,componentHeight=$component.height();var $item=$items.filter(function(){return trigger>=$(this).offset().top}).last();if($item.length==0)$item=$items.first();if(!$item.is(lastItem)){$items.removeClass("active");$images.removeAttr("style");$item.addClass("active");lastItem=$item}var $image=$(image,$item),$content=$(content,$item),spaceBetween=window.innerWidth>=1080?60:45,addGutterTablet=window.innerWidth<1080?12:0,imgHeight=$image.height(),imgProps={position:"absolute",left:$content.width()+spaceBetween+addGutterTablet};if(viewportTop<componentTop){imgProps.top=0}else if(viewportTop>=componentTop+componentHeight-imgHeight){imgProps.top=$component.height()-imgHeight}else{if(navigator.userAgent.indexOf("Trident")||navigator.userAgent.indexOf("Edge")){imgProps={position:"fixed",left:$component.offset().left+$content.width()+spaceBetween+addGutterTablet,top:$header.height()+20}}else{imgProps.top=viewportTop-$component.offset().top}}$images.css(imgProps)})};app.EventHandler.subscribe("EVENT_RESIZE",onScroll);app.EventHandler.subscribe("EVENT_SCROLL_INSTANT",onScroll)};handlers.push({name:"_loadModule",handle:function(){module.loadModule()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("visualPlatformNavigation",function(window,$,app){"use strict";var module={},selector=".s-header-visual-platform";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var $item,$itemParent,$itemSibling;module.languageToggle=function($item,$action){var $this=$($item),$sibling=$this.siblings(".c-nav-top__language-drop-down");if($action=="hide"){$item.removeClass("dropdown-show")}else{$sibling.toggleClass("dropdown-show").focus()}};handlers.push({name:"_visualPlatformHeaderInit",handle:function(){$item=$context.find(".c-nav-top__language-link");$itemParent=$item.parent();$itemSibling=$item.siblings(".c-nav-top__language-drop-down");$item.on("click",function(e){module.languageToggle($(this));e.preventDefault()});$(window).on("click.headertooltip",function(event){if($item.length!=0){if($itemParent.has(event.target).length==0&&!$itemParent.is(event.target)){module.languageToggle($itemSibling,"hide")}}});if($(".c-latest-trends").length>0){$(".js-hero-curtain.c-page-hero--curtain .c-toolbar .c-toolbar__scroll-down a").hide()}}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("stickyTableOfContents",function(window,$,app){"use strict";var module={},selector=".c-sec",megaMenu=".c-mega-menu",stickyToolbar=".special-report-toolbar",navMenu=".c-visual-platform-menu",megaMenuLT=".js-mega-menu-lt",ltArticle=".c-lt-article",ltClose=".js-lt-close",headerVisualPlatform=".s-header-visual-platform",main=".s-main";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var currentTop;var $sections;var elemTop;var elemBottom;var secId;module.latestTrendsClick=function(){$(megaMenu).on("click",megaMenuLT,function(e){e.preventDefault();if(!$(megaMenu).hasClass("show-latest-trends")){module.hideStickyTableOfContents();$(megaMenu).addClass("show-latest-trends");$(ltArticle).addClass("c-lt-article--visible");$("body").css({overflowY:"hidden"});module.onResize()}});$(headerVisualPlatform).on("click",ltClose,function(e){e.preventDefault();$("body").css({overflowY:"auto"});module.showStickyTableOfContents();if(window.innerWidth>=1080){module.hideStickyTableOfContents()}})};module.showStickyTableOfContents=function(){$("body").addClass("is-sticky--expanded");$(megaMenu).removeClass("is-hidden");$(megaMenu).removeClass("show-latest-trends");$(ltArticle).removeClass("c-lt-article--visible")};module.hideStickyTableOfContents=function(){$("body").removeClass("is-sticky--expanded");$(megaMenu).addClass("is-hidden")};module.onResize=function(){if($(megaMenuLT).length&&$(megaMenu).hasClass("show-latest-trends")){if(window.innerWidth>=761){$(megaMenu).removeClass("is-hidden")}else{$(megaMenu).addClass("is-hidden")}}};module.scrollSpy=function(){currentTop=$(window).scrollTop();$sections=$(selector);$sections.each(function(index){elemTop=$(this).offset().top-$(window).height()*.45;elemBottom=elemTop+$(this).height();if(currentTop>=elemTop&&currentTop<=elemBottom){secId=$(this).data("section");$(navMenu).find("li").removeClass("active");$(navMenu).find('[data-section="'+secId+'"]').addClass("active")}})};module.smoothScroll=function(){$(navMenu).find("a").on("click",function(event){var target=$(this.hash);if(target.length){$("html, body").animate({scrollTop:target.offset().top-30},800);event.preventDefault()}})};module.stickyTableOfContentsVisibility=function(){var stickyScroll=function(){if($(window).scrollTop()>=230){$("body").addClass("is-sticky-table-shown");$(megaMenu).addClass("is-scrolled");$(stickyToolbar).addClass("is-scrolled");$(stickyToolbar).removeClass("is-show")}else{$(megaMenu).removeClass("is-scrolled");$(stickyToolbar).removeClass("is-scrolled");$("body").removeClass("is-sticky-table-shown");$("body").removeClass("is-sticky--expanded")}};app.EventHandler.subscribe("EVENT_SCROLL_INSTANT",stickyScroll)};module.stickyTableofContentsOnHover=function(){if($(window).width()>=1025){$(megaMenu).on("mouseover ",function(){if(!$(megaMenu).hasClass("show-latest-trends")){module.showStickyTableOfContents()}});$(megaMenu).on("mouseout",function(){if(!$(megaMenu).hasClass("show-latest-trends")){module.hideStickyTableOfContents()}});$(megaMenu).on("mouseleave",function(){if($(".s-header-visual-platform .c-toolbar .o-tooltip.is-show")[0]&&!$(megaMenu).hasClass("show-latest-trends")){$(".s-header-visual-platform .c-toolbar .o-list .o-btn").click()}})}else{document.addEventListener("click",function(evt){var flyoutElement=document.querySelector(megaMenu),targetElement=evt.target;do{if(targetElement==flyoutElement){module.showStickyTableOfContents();return}targetElement=targetElement.parentNode}while(targetElement)});$(document).on("touchstart",function(event){if(!$(event.target).closest(megaMenu).length){module.hideStickyTableOfContents();if($(".s-header-visual-platform .c-toolbar .o-tooltip.is-show")[0]){$(".s-header-visual-platform .c-toolbar .o-list .o-btn").click()}}});$(".c-visual-platform-menu-overlay").on("click",function(){module.showStickyTableOfContents()})}};handlers.push({name:"_stickyTableOfContentsInit",handle:function(){var secCount=1;$(navMenu).find("li").not(".c-visual-platform-sub-menu-item").each(function(){if($(this).find("a").attr("href").toString()!=="#"){$(this).attr("data-section",secCount);var link="#"+$(this).find("a").attr("href").slice(1).toString();if($(main).find(link)[0]){$(main).find(link).attr("data-section",secCount)}secCount++}});module.latestTrendsClick();module.stickyTableOfContentsVisibility();module.stickyTableofContentsOnHover();module.onResize();module.scrollSpy();module.smoothScroll();var scrollSpy=function(){module.scrollSpy()};var onResize=function(){module.onResize()};app.EventHandler.subscribe("EVENT_RESIZE",onResize);app.EventHandler.subscribe("EVENT_SCROLL_INSTANT",scrollSpy)}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("horizontalTimeline",function(window,$,app){"use strict";var module={},selector=".s-horizontal-timeline",articleWrap=".s-horizontal-timeline__article",articleMain=".s-horizontal-timeline__article-main",gallerySlidePrev=".js-gallery-prev",gallerySlideNext=".js-gallery-next",mobilegallerySlidePrev=".js-mobile-gallery-prev",mobilegallerySlideNext=".js-mobile-gallery-next",galleryMain=".s-horizontal-timeline__media",galleryWrap=".s-horizontal-timeline__gallery-wrap",galleryNav=".s-horizontal-timeline__gallery-nav",slideArticle=".s-horizontal-timeline__article-slide",slideMedia=".s-horizontal-timeline__media-slide",horizontalNavigationMain=".s-horizontal-timeline__main",horizontalNavigation=".s-horizontal-timeline__navigation",horizontalNavigationItem=".s-horizontal-timeline__navigation-item",horizontalNavigationLink=".s-horizontal-timeline__navigation-link",horizontalTimelineScroll=".s-horizontal-timeline__navigation-scroll",horizontalNavigationReadMore=".s-horizontal-timeline__read-more a";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var $context=$(selector);var $navigationItem;var $navigation;var $horizontalTimelineNavigation;var $totalTimelineWidthArray={};var $totalScrolledArray={};var $totalOffsetArray={};var $timelineId;var $totalOffset=0;var $offsetDistance=0;var $firstItemMargin=0;var $slideOptions;module.navigationDrag=function($elem){var $totalTimelineWidth=0;$timelineId=$elem.data("timeline");$navigationItem=$elem.find(horizontalNavigationItem);$totalScrolledArray[$timelineId]=0;$navigationItem.each(function(){$totalTimelineWidth+=$(this).outerWidth()});$totalTimelineWidthArray[$timelineId]=$totalTimelineWidth;$totalOffsetArray[$timelineId]=$totalTimelineWidthArray[$timelineId]+224-$(window).width();if($totalOffsetArray[$timelineId]>-150){$horizontalTimelineNavigation=new Hammer($elem.find(horizontalTimelineScroll)[0]);$horizontalTimelineNavigation.add(new Hammer.Pan({threshold:0,pointers:0}));$horizontalTimelineNavigation.on("panmove",function(e){module.calculateScroll(e,$elem,$totalOffset)});$horizontalTimelineNavigation.on("panstart",function(e){$elem.find(horizontalNavigation).addClass("dragging")});$horizontalTimelineNavigation.on("pancancel",function(e){$totalScrolledArray[$timelineId]=$offsetDistance;$elem.find(horizontalNavigation).removeClass("dragging")});$horizontalTimelineNavigation.on("panend",function(e){$totalScrolledArray[$timelineId]=$offsetDistance;$elem.find(horizontalNavigation).removeClass("dragging")})}};module.calculateScroll=function(event,$elem){$firstItemMargin=parseInt($elem.find(".s-horizontal-timeline__navigation-item").first().css("margin-left"));$timelineId=$elem.data("timeline");if(event.deltaX<0){$offsetDistance=$totalScrolledArray[$timelineId]+event.deltaX;if($offsetDistance<($totalOffset=$totalOffsetArray[$timelineId]+$firstItemMargin*2)*-1){$offsetDistance=($totalOffset=$totalOffsetArray[$timelineId]+$firstItemMargin*2)*-1}$elem.find(horizontalNavigation).css({transform:"translateX("+$offsetDistance+"px)"})}else{$offsetDistance=$totalScrolledArray[$timelineId]+event.deltaX;if($offsetDistance>0){$offsetDistance=0}$elem.find(horizontalNavigation).css({transform:"translateX("+$offsetDistance+"px)"})}};module.galleryInit=function($elem){$slideOptions={arrows:false,infinite:false,adaptiveHeight:true};var $gallerySlider=$elem.find(galleryWrap);$gallerySlider.each(function(){var $gallerySlide;var $this=$(this);$this.parent().removeClass("hidden");$this.slick($slideOptions);$this.siblings(galleryNav).find(gallerySlidePrev).on("click",function(e){$gallerySlide=$(this).closest(galleryNav).siblings(galleryWrap);$gallerySlide.slick("slickPrev")});$this.siblings(galleryNav).find(gallerySlideNext).on("click",function(){$gallerySlide=$(this).closest(galleryNav).siblings(galleryWrap);$gallerySlide.slick("slickNext")})})};module.mainContentSlideInit=function($elem){$slideOptions={arrows:false,infinite:false,adaptiveHeight:true,draggable:false,fade:true,cssEase:"linear",swipe:false};var $articleMainSlider=$elem.find(slideArticle);$articleMainSlider.each(function(){var $this=$(this);var $articleItems=$this.find(articleMain);var mediaCount=0;$articleItems.each(function(){$(this).attr("data-article",mediaCount);mediaCount++})});var $galleryMainSlider=$elem.find(slideMedia);$galleryMainSlider.each(function(){var $this=$(this);var $galleryItems=$this.find(galleryMain);var mediaCount=0;$galleryItems.each(function(){$(this).attr("data-article",mediaCount);mediaCount++})});$articleMainSlider.slick({arrows:false,infinite:false,draggable:false,fade:true,cssEase:"linear",swipe:false});$galleryMainSlider.slick({arrows:false,infinite:false,draggable:false,fade:true,cssEase:"linear",swipe:false});$galleryMainSlider.on("beforeChange",function(event,slick,currentSlide,nextSlide){$elem.find(horizontalNavigationItem).removeClass("active");$elem.find("[data-timeline-item="+nextSlide+"]").parent().addClass("active")});$articleMainSlider.on("beforeChange",function(event,slick,currentSlide,nextSlide){$elem.find(horizontalNavigationItem).removeClass("active");$elem.find("[data-timeline-item="+nextSlide+"]").parent().addClass("active")})};module.timelineNavigate=function($elem){var $this=$elem;var linkCount=0;var $navigationLink=$this.find(horizontalNavigationLink);var $mobileNavNext=$this.find(mobilegallerySlideNext);var $mobileNavPrev=$this.find(mobilegallerySlidePrev);var $galleryNavNext=$this.find(gallerySlideNext);var $galleryNavPrev=$this.find(gallerySlidePrev);var $tooltipReadMore=$this.find(horizontalNavigationReadMore);var $articleSlideNavigation;var $mediaSlideNavigation;$navigationLink.each(function(){$(this).attr("data-timeline-item",linkCount);linkCount++});$navigationLink.on("click",function(e){$articleSlideNavigation=$(this).closest(horizontalNavigationMain).siblings(articleWrap).find(slideArticle);$mediaSlideNavigation=$(this).closest(horizontalNavigationMain).siblings(slideMedia);var timelineItemNum=$(this).data("timeline-item");$(this).closest(horizontalNavigation).find(horizontalNavigationItem).removeClass("active");$(this).parent().addClass("active");$articleSlideNavigation.slick("slickGoTo",timelineItemNum);$mediaSlideNavigation.slick("slickGoTo",timelineItemNum);e.preventDefault()});$($mobileNavNext).add($galleryNavNext).on("click",function(e){$elem.find(slideArticle).slick("slickNext");$elem.find(slideMedia).slick("slickNext");e.preventDefault()});$($mobileNavPrev).add($galleryNavPrev).on("click",function(e){$elem.find(slideArticle).slick("slickPrev");$elem.find(slideMedia).slick("slickPrev");e.preventDefault()});$tooltipReadMore.on("click",function(e){var tooltipLink=$(this).closest(".s-horizontal-timeline__tooltip").siblings(horizontalNavigationLink);tooltipLink.click();e.preventDefault()})};handlers.push({name:"_horizontalTimelineInit",handle:function(){var $timelineCount=1;$context.each(function(){$(this).attr("data-timeline",$timelineCount);module.navigationDrag($(this));module.mainContentSlideInit($(this));module.timelineNavigate($(this));$timelineCount++})}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("keyFigures",function(window,$,app){"use strict";var module={},selector=".js-key-figures",$selector=$(selector);module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];var components=[];module.loadSlider=function(){var toggleSlider=function(){$selector.each(function(){var $slider=$(".s-key-figures__slides",this);if(!$slider.hasClass("slick-initialized")){var _component=$slider.slick({arrows:false,dots:true,infinite:false,adaptiveHeight:true,mobileFirst:true,responsive:[{breakpoint:760,settings:"unslick"}]});components.push({id:this.dataset.id,target:_component})}})};toggleSlider();app.EventHandler.subscribe("EVENT_RESIZE_INSTANT",toggleSlider)};module.animateCount=function(){var a=0;$(window).scroll(function(){var oTop=$(".js-key-figures").offset().top-(window.innerHeight-200);if(a==0&&$(window).scrollTop()>oTop){$(".js-count").each(function(){var $this=$(this),countTo=$this.attr("data-count");$({countNum:0}).animate({countNum:countTo},{duration:2e3,easing:"swing",step:function(){$this.text(module.numberWithCommas(Math.floor(this.countNum)))},complete:function(){$this.text(module.numberWithCommas(this.countNum))}})});a=1}})};module.numberWithCommas=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};handlers.push({name:"_loadSlider",handle:function(){module.loadSlider();module.animateCount()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("nagornoKarabakhMap",function(window,$,app){"use strict";var module={},selector=".js-nk-map";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];if(module.preInit()){var dataCasualtyIn=$(selector).attr("data-casualty-in").toLowerCase(),dataCasualtyLabel=$(selector).attr("data-title").toLowerCase(),dataFrom=$(selector).attr("data-from").toLowerCase(),dataCasualtyFrom=$(selector).attr("data-casualty-from").toLowerCase(),dataCasualtySame=$(selector).attr("data-casualty-same").toLowerCase(),dataNoData=$(selector).attr("data-nodata"),dataReadMore=$(selector).attr("data-readmore"),dataAll=$(selector).attr("data-all"),dataApply=$(selector).attr("data-apply"),dataCancel=$(selector).attr("data-cancel"),dataSelect=$(selector).attr("data-select"),dataTotal=$(selector).attr("data-total"),dataDestination=$(selector).attr("data-destination"),dataTotalDeaths=$(selector).attr("data-total-deaths"),dataShowAnnotation=$(selector).attr("data-annotation-display");var $el=$(selector);var _mapbox_token="pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw";var _mapBaseStyle="mapbox://styles/daltonwb/ck3ehyzfj4s6g1cpuiskvb5i3";var _global_startDate=0;var _global_endDate=0;var _globalStop=[];var _globalRadius=[];var _globalMerged=[];var _slideTriggerred=false;var _defaultStart=0;var _defaultEnd=0;var _globalRegions=null;var _hoveredRegion=null;var _hoveredBubble=null;mapboxgl.accessToken=_mapbox_token;var _maps=$.makeArray($(selector));var _mapParents=[];var _mapCollection=[];var ctr=1;_maps.forEach(function(mapElem){var container=mapElem.dataset.map;var longitude=mapElem.dataset.longitude,latitude=mapElem.dataset.latitude,zoom=mapElem.dataset.zoom;var map=new mapboxgl.Map({container:container,style:_mapBaseStyle,center:[longitude,latitude],zoom:zoom});map.scrollZoom.disable();var nav=new mapboxgl.NavigationControl({showCompass:false});map.addControl(nav,"bottom-left");window["map"+ctr]=map;_mapCollection.push(map);_mapParents.push(mapElem.dataset.parent);ctr++});var popup=new mapboxgl.Popup({className:"mapboxgl--popup-hover",closeButton:false,closeOnClick:false,offset:20});var clickPop=new mapboxgl.Popup({className:"mapboxgl--popup-click",offset:20,closeButton:false})}module.handleMap=function(){_mapCollection.forEach(function(theMap,i){var regionLayers=[];var $parent=$("."+_mapParents[i]);var airtableURL=$parent.data("airtable");var geojsonURL=$parent.data("geojson");var isRTL=$parent.data("rtl");var requestBubbles=module.handleURLRequests(airtableURL),requestRegionFill=module.handleURLRequests(geojsonURL);theMap.once("load",function(){module.handleGenerateLayers(requestBubbles,null,null,theMap,$parent,isRTL,requestRegionFill,regionLayers);module.handleMouseEvents(theMap,regionLayers);var annotations=$parent.data("annotations");if(typeof annotations!=="undefined"){annotations=module.handleURLRequests(annotations);module.handleGenerateAnnotations(annotations,theMap)}})})};module.handleGenerateAnnotations=function(request,theMap){$.when(request).done(function(data){var annotations=data;if(typeof annotations!=="object"){annotations=JSON.parse(annotations)}var features=annotations.features;var _annocation_counter=0;var annotations=[];var _mapLoaded=theMap.once("load",function(){return true});var _dataLoaded=theMap.once("data",function(){return true});if(_mapLoaded&&_dataLoaded){features.forEach(function(a){var _title=a.properties.title;var _desc=a.properties.description;var _html="";_html+='<div class="annotation--wrapper [ u-franklin u-fsn u-fwn ]">';_html+="<h3>"+_title+"</h3>";_html+="<p>"+_desc+"</p>";if(typeof a.properties.url!=="undefined"){_html+='<a href="'+a.properties.url+'">'+dataReadMore+"</a>"}_html+="</div>";var _popInstance_class="mapboxgl--popup-annotation annotation--"+_annocation_counter;_popInstance_class+=dataShowAnnotation!=="off"?" open":"";var _popInstance=new mapboxgl.Popup({className:_popInstance_class,offset:0,closeButton:true,closeOnClick:false}).setLngLat(a.geometry.coordinates).setHTML(_html).addTo(theMap);annotations.push(_popInstance);var el=document.createElement("div");var _class="marker--annotation annotation--"+_annocation_counter;el.className=_class;el.setAttribute("data-id",_annocation_counter);new mapboxgl.Marker(el).setLngLat(a.geometry.coordinates).addTo(theMap);_annocation_counter++})}$(".marker--annotation").click(function(){var _id=$(this).data("id");_id=parseInt(_id);var $annotation=$(".annotation--"+_id);annotations[_id].addTo(theMap);if($annotation.hasClass("open")){$annotation.removeClass("open")}else{$annotation.addClass("open")}});var resizeTimer;$(window).on("load resize",function(e){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){var _windowWidth=$(window).innerWidth();if(_windowWidth<760){annotations.forEach(function(a){a.remove()})}else if(dataShowAnnotation==="off"&&_windowWidth>760){annotations.forEach(function(a){a.remove()})}else{annotations.forEach(function(a){a.addTo(theMap)})}},250)})})};module.handleGenerateLayers=function(requestBubbles,min,max,theMap,parent,isRTL,requestRegionFill,regionLayers){$.when(requestRegionFill).done(function(regionFillData){var geoJSONdata=regionFillData;if(typeof regionFillData!=="object"){geoJSONdata=JSON.parse(regionFillData)}geoJSONdata.features.forEach(function(feature,i){if(feature.geometry.type==="Polygon"){theMap.addLayer({id:"polygon-layer-"+i,type:"fill",source:{type:"geojson",data:feature},paint:{"fill-color":{type:"identity",property:"fill"},"fill-opacity":{type:"identity",property:"fill-opacity"}}});regionLayers.push("polygon-layer-"+i);theMap.addLayer({id:"polygon-outline-layer-"+i,type:"line",source:{type:"geojson",data:feature},paint:{"line-color":{type:"identity",property:"stroke"},"line-width":{type:"identity",property:"stroke-width"},"line-opacity":{type:"identity",property:"stroke-opacity"}}})}else if(feature.geometry.type==="LineString"){theMap.addLayer({id:"linestring-layer-"+i,type:"line",source:{type:"geojson",data:feature},paint:{"line-color":{type:"identity",property:"stroke"},"line-width":{type:"identity",property:"stroke-width"},"line-opacity":{type:"identity",property:"stroke-opacity"}}})}});$(".map--preloader").addClass("is--loaded")})};module.handleMouseEvents=function(theMap,regionLayers){theMap.on("mousemove",function(e){var features=theMap.queryRenderedFeatures(e.point,{layers:regionLayers});if(!features.length){popup.remove();return}var feature=features[0];var name="Sample Text";if(typeof feature.properties.name!=="undefined"){name=feature.properties.name}else if(typeof feature.properties.Name!=="undefined"){name=feature.properties.Name}var html="";html+='<div class="mapboxgl--hover__data"><p class="[ u-franklin u-fsn u-fwn ]">';html+=name;html+="</p></div>";popup.setLngLat(e.lngLat).setHTML(html).addTo(theMap)})};module.handleGenerateLegends=function(geojson,$parent,regionLayers){var legendsContainer=$(".map-legend",$parent[0]);$.when(geojson).done(function(data){var properties=[];if(typeof data!=="object"){data=JSON.parse(data)}data.features.forEach(function(feature){var obj={};if(typeof feature.properties.Name!=="undefined"){obj.name=feature.properties.Name}else if(typeof feature.properties.name!=="undefined"){obj.name=feature.properties.name}else{obj.name="Sample Text"}obj.color="#000";if(typeof feature.properties.fill!=="undefined"){obj.type="polygon";obj.color=feature.properties.fill.toLowerCase()}else{obj.type="line";obj.color=feature.properties.stroke.toLowerCase()}properties.push(obj)});if(properties.length!==0){properties.forEach(function(prop,i){var html="";var newClass="";if(i>3){newClass="second_row"}html+="<div class='map-legend__item "+newClass+"'> <div class='map-legend__square' style='background:"+prop.color+"'></div>";html+="<div class='map-legend__text'>"+prop.name+"</div>";html+="</div>";legendsContainer.append(html)})}})};module.handleReset=function(parent,requestBubble,map,region){var selector=$("."+parent);$.when(requestBubble).done(function(requestResult){var minDate=new Date(module.handleMinDate(requestResult)*1e3);var maxDate=new Date(module.handleMaxDate(requestResult)*1e3);module.updateMapContents(minDate,maxDate,requestBubble.responseText,region.responseText,requestResult,map,selector,"reset",[]);module.handleDropdownFilter(requestBubble,undefined,undefined,"."+parent,map,"initial",region);module.buildDatePicker("."+parent,minDate,maxDate,requestBubble,region,map);$(".map--slider",selector).dateRangeSlider("destroy");module.mapSlider(selector,minDate,maxDate,minDate,maxDate)})};module.handleMinDate=function(request){var getMin=request;if(typeof request!="object"){getMin=JSON.parse(request)}var startDate=Math.min.apply(null,$.map(getMin.features,function(feature){return feature.properties.date}));return startDate};module.handleMaxDate=function(request){var getMax=request;if(typeof request!="object"){getMax=JSON.parse(request)}var endDate=Math.max.apply(null,$.map(getMax.features,function(feature){return feature.properties.date}));return endDate};module.handleGenerateBubbles=function(requestBubbles,theMap,parent,isRTL){$.when(requestBubbles).done(function(bubbleData){var clonedBubbleData=Object.assign(bubbleData);var startDate=module.handleMinDate(clonedBubbleData);var endDate=module.handleMaxDate(clonedBubbleData);var allSectors=$.unique($.map(clonedBubbleData.features,function(bubbleItem){return bubbleItem.properties.name}).sort());var bubbleFeatures=[];var incidentCountArray=[];var pointMarker={};var obj={};var objCollectionOfAllSectors=[];allSectors.forEach(function(sector){var count=0;clonedBubbleData.features.forEach(function(bubbleItem){if(sector===bubbleItem.properties.name){count+=bubbleItem.properties.incident_count;obj=bubbleItem}});incidentCountArray.push(count);objCollectionOfAllSectors.push(obj)});objCollectionOfAllSectors.forEach(function(sector,i){sector.properties.incident_count=incidentCountArray[i]});var isMapLoaded=false;var isDataLoaded=false;var stops=module.handleUpdateCasualtiesLocationLegend(requestBubbles,startDate,endDate,null,parent);isMapLoaded=theMap.once("load",function(){return true});isDataLoaded=theMap.once("data",function(){return true});if(isMapLoaded&&isDataLoaded){var geoJSONBubbles={};geoJSONBubbles.type="FeatureCollection";geoJSONBubbles.features=objCollectionOfAllSectors;theMap.addSource("regionBubbles",{type:"geojson",data:geoJSONBubbles});var opacity=.7;var opacityHover=1;var preload_bubble_layer=setInterval(function(){if(theMap.loaded()){theMap.addLayer({id:"layerBubble",type:"circle",source:"regionBubbles",layout:{visibility:"visible"},paint:{"circle-color":"#730000","circle-stroke-color":"white","circle-stroke-width":2,"circle-radius":{base:1,property:"incident_count",type:"interval",stops:stops},"circle-opacity":["case",["boolean",["feature-state","hover"],false],opacityHover,opacity]}});clearInterval(preload_bubble_layer)}},300);var event=module.isMobileSafari()?"touchmove":"mousemove";var hoveredBubble=false;theMap.on(event,"layerBubble",function(e){if(e.features.length>0){if(hoveredBubble){theMap.setFeatureState({source:"regionBubbles",id:hoveredBubble},{hover:false})}hoveredBubble=e.features[0].id;theMap.setFeatureState({source:"regionBubbles",id:hoveredBubble},{hover:true})}});theMap.on("mouseleave","layerBubble",function(){if(hoveredBubble){theMap.setFeatureState({source:"regionBubbles",id:hoveredBubble},{hover:false})}hoveredBubble=null});$(".map--preloader").addClass("is--loaded")}})};module.handleMapEvents=function(type,source,min,max,theMap,selector,originalSource,isRTL){var event=module.isMobileSafari()?"touchmove":"mousemove";theMap.on(event,type,function(e){var starDate=min;var endDate=max;var sourceType="regionBubbles";var mapSource=theMap.getSource(sourceType)})};module.isMobileSafari=function(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)};module.mapSlider=function(selector,_minDate,_maxDate,start,end){$(".map--slider",$(selector)).dateRangeSlider({bounds:{min:new Date(_minDate.getFullYear(),_minDate.getMonth(),1),max:_maxDate},defaultValues:{min:start,max:end},valueLabels:"change",durationIn:1e3,durationOut:1e3})};module.buildDatePicker=function(selector,minDate,maxDate,requestData,regionFill,_map){$('input[name="daterange"]',selector).daterangepicker({opens:"left",timePicker:false,showDropdowns:true,linkedCalendars:false,startDate:minDate,endDate:maxDate,minYear:minDate.getFullYear()-1,maxYear:maxDate.getFullYear()+1,locale:{cancelLabel:dataCancel,applyLabel:dataApply}},function(start,end,label){_slideTriggerred=true;_global_startDate=start;_global_endDate=end;module.updateMapContents(new Date(start),new Date(end),requestData.responseText,regionFill.responseText,requestData,_map,selector,"update",[]);$(".js-reset").attr("disabled",false);$(".map--slider",$(selector)).dateRangeSlider("destroy");module.mapSlider(selector,minDate,maxDate,new Date(start),new Date(end))})};module.handleDropdownBehavior=function(_parent){var parent="."+_parent;$(".js--label",$(parent)).click(function(){$(".map-filter--dropdown",$(parent)).toggleClass("is-open")})};module.handleDropdownFilter=function(bubbleRequest,min,max,parent,theMap,status,regionRequest){var bubble=bubbleRequest;var region=regionRequest;var selector=parent;$.when(bubble).done(function(bubbleResult){var result=bubbleResult;if(typeof result!=="object"){result=JSON.parse(result)}var features=result.features;var minDate=module.handleMinDate(result);var maxDate=module.handleMaxDate(result);var filteredFeatures=$.grep(features,function(feature){return feature.properties.date>=minDate&&feature.properties.date<=maxDate});var allCategories=$.unique($.map(filteredFeatures,function(feature){return feature.properties.cat_name}).sort());var filterContainer=$(".js--option",$(selector));var filterLabel=$(".js--label",$(selector));var html="";var defaultSelect='<label><input type="checkbox" name="filter-option" class="option-trigger option-all" value="all" checked="checked" />'+dataAll+"</label>";if(allCategories.length===0){defaultSelect="";filterLabel.text(dataNoData)}else{filterLabel.text(dataAll)}filterContainer.html(defaultSelect);allCategories.forEach(function(category){html+='<label><input type="checkbox" name="filter-option" class="option-trigger" value="'+category+'" />'+category+"</label>"});html+='<div class="option-buttons">';html+='  <input type="submit" class="option-submit" value="'+dataApply+'">';html+='  <input type="reset" class="option-reset" value="'+dataCancel+'">';html+="</div>";filterContainer.append(html);$(".option-reset",$(selector)).click(function(){var text="";$(".option-trigger",$(selector)).prop("checked",false);$(".option-all").prop("checked",true);text=dataSelect;filterLabel.text(text);$(".map-filter--dropdown",$(selector)).removeClass("is-open")});$(".option-trigger",$(selector)).click(function(){var value=$(this).attr("value");var text="";if(value==="all"){$(".option-trigger",$(selector)).prop("checked",false);$(this).prop("checked",true);text=dataAll}else{$(".option-all",$(selector)).prop("checked",false);if($(".option-trigger:checked",$(selector)).length===1){var $checked=$(".option-trigger:checked",$(selector));text=$checked.attr("value")}else if($(".option-trigger:checked",$(selector)).length>1){text=$(".option-trigger:checked",$(selector)).length+" options selected"}else{text=dataSelect}}filterLabel.text(text)});$(".option-submit",$(selector)).click(function(e){e.preventDefault();clickPop.remove();$(".js-reset").attr("disabled",false);$(".map-filter--dropdown",$(selector)).removeClass("is-open");var selectedCategories=[];$(".option-trigger:checked",$(selector)).each(function(category){selectedCategories.push($(this).attr("value"))});module.handleUpdateCasualtiesLocationLegend(bubble,minDate,maxDate,allCategories);module.updateMapContents(new Date(minDate*1e3),new Date(maxDate*1e3),bubble.responseText,region.responseText,bubbleRequest,theMap,selector,"update",selectedCategories)})})};module.handleUpdateCasualtiesLocationLegend=function(bubbleRequest,min,max,category,selector){var radiusContainer=$(".js-legends__bubble--sizes",$(selector));var countMax=0;var stops=[];$.when(bubbleRequest).done(function(result){if(typeof result!=="object"){result=JSON.parse(result)}var features=result.features;if(min||max){var filteredFeatures=[];filteredFeatures=$.grep(features,function(feature){return feature.properties.date>=min&&feature.properties.date<=max});if($.inArray("all",category)!==-1){category=null}if(category!==null){filteredFeatures=$.grep(features,function(feature){return feature.properties.date>=min&&feature.properties.date<=max&&$.inArray(feature.properties.cat_name,category)!==-1})}var allSectors=$.unique($.map(filteredFeatures,function(feature){return feature.properties.name}).sort());var groupedSectorsIncidentCount=[];allSectors.forEach(function(sector){var incidentCount=0;filteredFeatures.forEach(function(feature){if(sector===feature.properties.name){incidentCount+=feature.properties.incident_count}});groupedSectorsIncidentCount.push(incidentCount)});countMax=Math.max.apply(null,groupedSectorsIncidentCount);var group1=Math.round(countMax/3);var group2=Math.round(group1+1);var group3=Math.round(group1+group2+1);radiusContainer.html("");var html="";var html='<div class="labels"><span class="label-left"><i class="radius-l"></i></span><span class="label-right"><i class="radius-label">'+group3+"-"+countMax+"</i></span></div>";html+='<div class="labels"><span class="label-left"><i class="radius-m"></i></span><span class="label-right"><i class="radius-label">'+group2+"-"+(group3-1)+"</i></span></div>";html+='<div class="labels"><span class="label-left"><i class="radius-s"></i></span><span class="label-right"><i class="radius-label"> 1-'+(group2-1)+"</i></span></div>";radiusContainer.append(html);stops.push([0,5]);stops.push([group2,10]);stops.push([group3,15])}});_globalRadius=stops;return stops};module.updateMapContents=function(minDate,maxDate,bubbleResponseText,regionResponseText,request,theMap,selector,status,category){_global_startDate=Date.parse(minDate)/1e3;_global_endDate=Date.parse(maxDate)/1e3;var bubbleJSON=bubbleResponseText;if(typeof bubbleJSON!=="object"){bubbleJSON=JSON.parse(bubbleJSON)}var filteredJSON=$.grep(bubbleJSON.features,function(feature){if(category.length>0&&category[0]!=="all"){return feature.properties.date>=_global_startDate&&feature.properties.date<=_global_endDate&&category.includes(feature.properties.cat_name)}else{return feature.properties.date>=_global_startDate&&feature.properties.date<=_global_endDate}});var allSectors=$.unique($.map(filteredJSON,function(featureObj){return featureObj.properties.name}).sort());var newCountArray=[];var newSectorArray=[];var obj={};allSectors.forEach(function(sector){var count=0;filteredJSON.forEach(function(featureObj){if(sector===featureObj.properties.name){count+=featureObj.properties.incident_count;obj=featureObj}});newCountArray.push(count);newSectorArray.push(obj)});var newSectorArrayClone=newSectorArray.slice(0);newSectorArrayClone.forEach(function(sector,index){sector.properties.incident_count=newCountArray[index]});theMap.getSource("regionBubbles").setData({type:"FeatureCollection",features:newSectorArrayClone});module.handleUpdateCasualtiesLocationLegend(bubbleResponseText,_global_startDate,_global_endDate,null,selector)};module.handleDatePicker=function(request,region,parent,theMap){var selector="."+parent;$.when(request).done(function(requestResult){var _minDate=new Date(module.handleMinDate(requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(requestResult)*1e3);module.buildDatePicker(selector,_minDate,_maxDate,request,region,theMap)})};module.handleGenerateSlider=function(_request,_region,i,_theMap){var loadRegion=setInterval(function(){var _region=_theMap.getLayer("countryLayer");var _bubble=_theMap.getLayer("layerBubble");if(_region!==undefined&&_bubble!==undefined){_theMap.moveLayer("layerBubble");clearInterval(loadRegion)}},100);var selector="."+_mapParents[i];$.when(_request).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"];module.mapSlider(selector,_minDate,_maxDate,_minDate,_maxDate);if(typeof _requestResult!="object"){_requestResult=JSON.parse(_requestResult)}var _allDates=$.unique($.map(_requestResult.features,function(a){var date=new Date(a.properties.date*1e3);if(!isNaN(date.getFullYear())){return date.getFullYear()}})).sort();var _years="";_allDates=$.unique(_allDates);_allDates.forEach(function(a){_years+='<span class="year--marking">'+a+"</span>";if(_allDates.length<4){_years+="<span>0000</span><span>0000</span><span>0000</span>"}else{_years+="<span>0000</span>"}});$(".map--slider__years",$(selector)).append(_years);var _minLabel=_minDate.getMonth()+1+"/"+_minDate.getDate()+"/"+_minDate.getFullYear();var _maxLabel=_maxDate.getMonth()+1+"/"+_maxDate.getDate()+"/"+_maxDate.getFullYear();var _dateLabel='<p class="date--start">'+_minLabel+"</p>";_dateLabel+='<p class="date--end">'+_maxLabel+"</p>";$(".map--slider__marking",$(selector)).append(_dateLabel);$(".map--slider",$(selector)).on("valuesChanging",function(e,data){$(".js-reset").attr("disabled",false);clickPop.remove();_slideTriggerred=true;var _min=data.values.min;var _max=data.values.max;module.buildDatePicker(selector,_minDate,_maxDate,_request,_region,_theMap);module.updateMapContents(_min,_max,_request.responseText,_region.responseText,_request,_theMap,selector,"update",[]);$(selector+" .region-marker").remove()})})};module.handleURLRequests=function(_url){var _request=$.ajax({url:_url,dataType:"Text",error:function(xhr){console.log("An error occured while retrieving GeoJson for Bubbles files")}});return _request};module.isMobileSafari=function(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)};handlers.push({name:"_handleMapInit",handle:function(){module.handleMap()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));App.module.create("layerMap",function(window,$,app){"use strict";var module={},selector=".js-layer-map",mapContainer="map-base";module.preInit=function(){return document.querySelector(selector)!==null};var handlers=[];if(module.preInit()){var dataCasualtyIn=$(selector).attr("data-casualty-in").toLowerCase(),dataCasualtyLabel=$(selector).attr("data-title").toLowerCase(),dataUnder=$(selector).attr("data-under").toLowerCase(),dataFrom=$(selector).attr("data-from").toLowerCase(),dataCasualtyFrom=$(selector).attr("data-casualty-from").toLowerCase(),dataCasualtySame=$(selector).attr("data-casualty-same").toLowerCase(),dataNoData=$(selector).attr("data-nodata"),dataReadMore=$(selector).attr("data-readmore"),dataAll=$(selector).attr("data-all"),dataApply=$(selector).attr("data-apply"),dataCancel=$(selector).attr("data-cancel"),dataSelect=$(selector).attr("data-select"),dataTotal=$(selector).attr("data-total"),dataDestination=$(selector).attr("data-destination"),dataTotalDeaths=$(selector).attr("data-total-deaths"),dataShowAnnotation=$(selector).attr("data-annotation-display");var $el=$(selector);var _mapbox_token="pk.eyJ1IjoiZGFsdG9ud2IiLCJhIjoiOWdSSXFQSSJ9.HZyjh4g3TAAOAncwelv9Vw";var _mapBaseStyle="mapbox://styles/daltonwb/ck3ehyzfj4s6g1cpuiskvb5i3";var _global_startDate=0;var _global_endDate=0;var _globalStop=[];var _globalRadius=[];var _globalMerged=[];var _slideTriggerred=false;var _defaultStart=0;var _defaultEnd=0;var _globalRegions=null;var _hoveredRegion=null;var _hoveredBubble=null;mapboxgl.accessToken=_mapbox_token;var _maps=$.makeArray($(selector));var _mapParents=[];var _mapCollection=[];var ctr=1;_maps.forEach(function(a){var _container=a.dataset.map;var _long=a.dataset.longitude,_lat=a.dataset.latitude,_zoom=a.dataset.zoom;var map=new mapboxgl.Map({container:_container,style:_mapBaseStyle,center:[_long,_lat],zoom:_zoom});map.scrollZoom.disable();var nav=new mapboxgl.NavigationControl({showCompass:false});map.addControl(nav,"bottom-left");window["map"+ctr]=map;_mapCollection.push(map);_mapParents.push(a.dataset.parent);ctr++});var hoverPop=new mapboxgl.Popup({className:"mapboxgl--popup-hover",closeButton:false,closeOnClick:false,offset:20});var clickPop=new mapboxgl.Popup({className:"mapboxgl--popup-click",offset:20,closeButton:false});var connectPop=new mapboxgl.Popup({className:"mapboxgl--popup-connect",offset:20,closeButton:false,closeOnClick:false});var connectOrigin=new mapboxgl.Popup({className:"mapboxgl--popup-connectOrigin",offset:20,closeButton:false,closeOnClick:false});var connectDestination=new mapboxgl.Popup({className:"mapboxgl--popup-connectSame",offset:20,closeButton:false,closeOnClick:false});var markerPop=new mapboxgl.Popup({className:"mapboxgl--popup-marker",offset:0,closeButton:false,closeOnClick:false});var notationPop=new mapboxgl.Popup({className:"mapboxgl--popup-annotation",offset:0,closeButton:true,closeOnClick:true});var hometownPop=new mapboxgl.Popup({className:"mapboxgl--popup-hometown",offset:0,closeButton:false,closeOnClick:false});var hometownName=new mapboxgl.Popup({className:"mapboxgl--popup-hometown",offset:0,closeButton:false,closeOnClick:true})}module.addMissingMonths=function(arr){var dataArray=arr;var additionalData={};var locationList=$.map(dataArray,function(itemData){return itemData.properties.name}).filter(function(el,index,arr){return index===arr.indexOf(el)});$.each(locationList,function(idx){var filteredLocation=$.grep(dataArray,function(filteredData){return filteredData.properties.name==locationList[idx]});var dataYears=$.map(filteredLocation,function(filteredLocationData){return new Date(filteredLocationData.properties.date*1e3).getFullYear()}).filter(function(el,index,arr){return index===arr.indexOf(el)}).sort();$.each(dataYears,function(yrsidx,yrsvalue){var currentyear=yrsvalue;additionalData.properties={};var _monthsName={0:"Januray",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"};var yearlyItem=$.grep(filteredLocation,function(yearlyitemData){return new Date(yearlyitemData.properties.date*1e3).getFullYear()==dataYears[yrsidx]});var itemMonths=$.map(yearlyItem,function(monthsitemData){return new Date(monthsitemData.properties.date*1e3).getMonth()}).filter(function(el,index,arr){return index===arr.indexOf(el)});$.each(itemMonths,function(mtnhsidx,itmvalue){delete _monthsName[itmvalue]});$.each(_monthsName,function(eamnthsidx,mssvalue){var idNum=0;if(mssvalue=="February"){var dateDay="28"}else{var dateDay="30"}additionalData.id=0;additionalData.type=filteredLocation[0].type;additionalData.geometry=filteredLocation[0].geometry;additionalData.properties.category_color=filteredLocation[0].properties.category_color;additionalData.properties.category_name=filteredLocation[0].properties.category_name;additionalData.properties.center=filteredLocation[0].properties.center;additionalData.properties.code=filteredLocation[0].properties.code;additionalData.properties.count=0;additionalData.properties.date=new Date(mssvalue+" "+dateDay+", "+currentyear).getTime()/1e3;additionalData.properties.group=filteredLocation[0].properties.group;additionalData.properties.name=filteredLocation[0].properties.name;additionalData.properties.origin_center=filteredLocation[0].properties.origin_center;additionalData.properties.origin_center=filteredLocation[0].properties.origin_code;additionalData.properties.origin_name=filteredLocation[0].properties.origin_name;additionalData.properties.type=filteredLocation[0].properties.type;additionalData.properties.processed=true;dataArray.push(additionalData)});additionalData={}})});return dataArray};module.handleMap=function(){_mapCollection.forEach(function(map,i){var $parent=$("."+_mapParents[i]),_requestBubble=module.handleURLRequests($parent.data("airtable")),_regionFill=module.handleURLRequests($parent.data("geojson")),_isRTL=$parent.data("rtl");module.handleGenerateRegions(_requestBubble,null,null,map,_mapParents[i],_isRTL,_regionFill);module.handleGenerateBubble(_requestBubble,map,_mapParents[i],_isRTL);module.handleGenerateSlider(_requestBubble,_regionFill,i,map);module.handleDropdownBehavior(_mapParents[i]);module.handleDropdownFilter(_requestBubble,undefined,undefined,"."+_mapParents[i],map,"initial",_regionFill);module.handleDatePicker(_requestBubble,_regionFill,_mapParents[i],map);var _annotated=$parent.data("annotations");if(_annotated){var _annotations=module.handleURLRequests($parent.data("annotations"));module.handleAnnotation(_annotations,map)}$(".js-reset").click(function(){$(this).attr("disabled",true);module.handleReset(_mapParents[i],_requestBubble,map,_regionFill);module.removeLineConnection(map);$("."+_mapParents[i]+" .region-marker").remove()});$(".reset--connection","."+_mapParents[i]).click(function(e){e.preventDefault();module.removeLineConnection(map);$("."+_mapParents[i]+" .region-marker").remove()})});$(".map--overlay").click(function(){clickPop.remove();$(this).removeClass("is-shown")})};module.handleReset=function(_parent,_requestBubble,_map,_region){var _selector=$("."+_parent);$.when(_requestBubble).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);module.updateMapContents(_minDate,_maxDate,_requestBubble.responseText,_region.responseText,_requestResult,_map,_selector,"reset",[]);module.handleDropdownFilter(_requestBubble,undefined,undefined,"."+_parent,_map,"initial",_region);module.buildDatePicker("."+_parent,_minDate,_maxDate,_requestBubble,_region,_map);$(".map--slider",_selector).dateRangeSlider("destroy");module.mapSlider(_selector,_minDate,_maxDate,_minDate,_maxDate)})};module.buildDatePicker=function(_selector,_minDate,_maxDate,_requestData,_regionFill,_map){$('input[name="daterange"]',_selector).daterangepicker({opens:"left",timePicker:false,showDropdowns:true,linkedCalendars:false,startDate:_minDate,endDate:_maxDate,minYear:_minDate.getFullYear()-1,maxYear:_maxDate.getFullYear()+1,locale:{cancelLabel:dataCancel,applyLabel:dataApply}},function(start,end,label){_slideTriggerred=true;_global_startDate=start;_global_endDate=end;module.updateMapContents(new Date(start),new Date(end),_requestData.responseText,_regionFill.responseText,_requestData,_map,_selector,"update",[]);$(".js-reset").attr("disabled",false);$(".map--slider",$(_selector)).dateRangeSlider("destroy");module.mapSlider(_selector,_minDate,_maxDate,new Date(start),new Date(end));module.removeLineConnection(_map);$(_selector+" .region-marker").remove()})};module.handleAnnotation=function(_request,_theMap){$.when(_request).done(function(_requestResult){var _annotations=_requestResult;if(typeof _requestResult!="object"){_annotations=JSON.parse(_requestResult)}var _features=_annotations.features;var _annocation_counter=0;var _annotations=[];var _mapLoaded=_theMap.once("load",function(){return true});var _dataLoaded=_theMap.once("data",function(){return true});if(_mapLoaded&&_dataLoaded){_features.forEach(function(a){var _title=a.properties.title;var _desc=a.properties.description;var _html="";_html+='<div class="annotation--wrapper [ u-franklin u-fsn u-fwn ]">';_html+="<h3>"+_title+"</h3>";_html+="<p>"+_desc+"</p>";if(typeof a.properties.url!=="undefined"){_html+='<a href="'+a.properties.url+'">'+dataReadMore+"</a>"}_html+="</div>";var _popInstance_class="mapboxgl--popup-annotation annotation--"+_annocation_counter;_popInstance_class+=dataShowAnnotation!=="off"?" open":"";var _popInstance=new mapboxgl.Popup({className:_popInstance_class,offset:0,closeButton:true,closeOnClick:false}).setLngLat(a.geometry.coordinates).setHTML(_html).addTo(_theMap);_annotations.push(_popInstance);var el=document.createElement("div");var _class="marker--annotation annotation--"+_annocation_counter;el.className=_class;el.setAttribute("data-id",_annocation_counter);new mapboxgl.Marker(el).setLngLat(a.geometry.coordinates).addTo(_theMap);_annocation_counter++})}$(".marker--annotation").click(function(){var _id=$(this).data("id");_id=parseInt(_id);var $annotation=$(".annotation--"+_id);_annotations[_id].addTo(_theMap);if($annotation.hasClass("open")){$annotation.removeClass("open")}else{$annotation.addClass("open")}});var resizeTimer;$(window).on("load resize",function(e){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){var _windowWidth=$(window).innerWidth();if(_windowWidth<760){_annotations.forEach(function(a){a.remove()})}else if(dataShowAnnotation==="off"&&_windowWidth>760){_annotations.forEach(function(a){a.remove()})}else{_annotations.forEach(function(a){a.addTo(_theMap)})}},250)})})};module.handleCasualtiesRegion=function(_request,_min,_max,_category,selector){var _regionContainer=$(".js-legends__region--sizes",$(selector));var _countMax=0;var _stops=[];$.when(_request).done(function(_requestResult){var _request=_requestResult;if(typeof _requestResult!="object"){_request=JSON.parse(_requestResult)}var _data=_request.features;var _minDate=module.handleMinDate(_requestResult);var _maxDate=module.handleMaxDate(_requestResult);if(_min||_max){var _allData=[];var _mapType=$(selector).data("type");var _blockGroup="region";var _blockType="destination";_allData=$.grep(_data,function(a){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){_allData=$.grep(_data,function(a){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&$.inArray(a.properties.category_name,_category)>=0})}var _allRegions=$.unique($.map(_allData,function(a){return a.properties.name}).sort());var _groupRegionCount=[];_allRegions.forEach(function(a){var _countAll=0;_allData.forEach(function(b){if(a===b.properties.name){_countAll+=b.properties.count}});_groupRegionCount.push(_countAll)});_countMax=Math.max.apply(null,_groupRegionCount);var _portions=_countMax/5;var _region1=Math.round(_portions);var _region2=Math.round(_portions*2);var _region3=Math.round(_portions*3);var _region4=Math.round(_portions*4);var _region5=_countMax;_regionContainer.html("");var _html="";var _display=_region1===0?_countMax:_region1;_stops.push([_display,"#f2e5ab"]);_html+='<span><i class="region-1"></i> 1-'+_display+"</span>";if(_region1+1<_region2){_display=_region2===0?_countMax:_region2;_stops.push([_region1+1,"#ffb842"]);_html+='<span><i class="region-2"></i> '+(_region1+1)+"-"+_display+"</span>"}if(_region2+1<_region3){_display=_region3===0?_countMax:_region3;_stops.push([_region2+1,"#ff8800"]);_html+='<span><i class="region-3"></i> '+(_region2+1)+"-"+_display+"</span>"}if(_region3+1<_region4){_display=_region4===0?_countMax:_region4;_stops.push([_region3+1,"#ff5800"]);_html+='<span><i class="region-4"></i> '+(_region3+1)+"-"+_display+"</span>"}if(_region4+1<_region5){_display=_region5===0?_countMax:_region5;_stops.push([_region4+1,"#bb0000"]);_html+='<span><i class="region-5"></i> '+(_region4+1)+"-"+_display+"</span>"}if(_countMax===0){_html=dataNoData}_regionContainer.append(_html)}});_globalStop=_stops;return _stops};module.handleCasualtiesLocation=function(_request,_min,_max,_category,selector){var _radiusContainer=$(".js-legends__bubble--sizes",$(selector));var _countMax=0;var _stops=[];$.when(_request).done(function(_requestResult){var _request=_requestResult;if(typeof _requestResult!="object"){_request=JSON.parse(_requestResult)}var _data=_request.features;var _minDate=module.handleMinDate(_requestResult);var _maxDate=module.handleMaxDate(_requestResult);if(_min||_max){var _allData=[];var _mapType=$(selector).data("type");var _blockGroup="city";var _blockType="destination";_allData=$.grep(_data,function(a){if(_mapType==="hometown"){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType}});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){_allData=$.grep(_data,function(a){if(_mapType==="hometown"){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&$.inArray(a.properties.category_name,_category)>=0&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.group==_blockGroup&&a.properties.type==_blockType&&$.inArray(a.properties.category_name,_category)>=0}})}var _allCities=$.unique($.map(_allData,function(a){return a.properties.code}).sort());var _groupRegionCount=[];_allCities.forEach(function(a){var _countAll=0;_allData.forEach(function(b){if(a===b.properties.code){_countAll+=b.properties.count}});_groupRegionCount.push(_countAll)});_countMax=Math.max.apply(null,_groupRegionCount);var _group1=Math.round(_countMax/3);var _group2=Math.round(_group1+1);var _group3=Math.round(_group1+_group2+1);_radiusContainer.html("");var _html="";var _html='<div class="labels"><span class="label-left"><i class="radius-l"></i></span><span class="label-right"><i class="radius-label">'+_group3+"-"+_countMax+"</i></span></div>";_html+='<div class="labels"><span class="label-left"><i class="radius-m"></i></span><span class="label-right"><i class="radius-label">'+_group2+"-"+(_group3-1)+"</i></span></div>";_html+='<div class="labels"><span class="label-left"><i class="radius-s"></i></span><span class="label-right"><i class="radius-label"> 1-'+(_group2-1)+"</i></span></div>";_radiusContainer.append(_html);_stops.push([0,5]);_stops.push([_group2,10]);_stops.push([_group3,15])}});_globalRadius=_stops;return _stops};module.handleDropdownBehavior=function(_parent){var parent="."+_parent;$(".js--label",$(parent)).click(function(){$(".map-filter--dropdown",$(parent)).toggleClass("is-open")})};module.handleDropdownFilter=function(_request,_min,_max,_parent,_theMap,_status,_region){var _req=_request;var selector=_parent;$.when(_request).done(function(_requestResult){var _request=_requestResult;if(typeof _requestResult!="object"){_request=JSON.parse(_requestResult)}var _categories=_request.features;var _minDate=module.handleMinDate(_requestResult);var _maxDate=module.handleMaxDate(_requestResult);var _mapType=$(selector).data("type");var _blockGroup="city";var _blockType="destination";if(_min||_max){_categories=$.grep(_request.features,function(a){return a.properties.date>=_min&&a.properties.date<=_max&&a.properties.type==_blockType});_minDate=_min;_maxDate=_max}else{_categories=$.grep(_request.features,function(a){return a.properties.type==_blockType})}if(_mapType==="hometown"){_categories=$.grep(_categories,function(a){return a.properties.show_in_hometown==="1"})}var _allCategories=$.unique($.map(_categories,function(a){return a.properties.category_name}).sort());var _filterContainer=$(".js--option",$(selector));var _filterLabel=$(".js--label",$(selector));var _html="";var _default='<label><input type="checkbox" name="filter-option" class="option-trigger option-all" value="all" checked="checked" />'+dataAll+"</label>";if(_allCategories.length===0){_default="";_filterLabel.text(dataNoData)}else{_filterLabel.text(dataAll)}_filterContainer.html(_default);_allCategories.forEach(function(a){_html+='<label><input type="checkbox" name="filter-option" class="option-trigger" value="'+a+'" />'+a+"</label>"});_html+='<div class="option-buttons">';_html+='  <input type="submit" class="option-submit" value="'+dataApply+'">';_html+='  <input type="reset" class="option-reset" value="'+dataCancel+'">';_html+="</div>";_filterContainer.append(_html);$(".option-reset",$(selector)).click(function(){var _text="";$(".option-trigger",$(selector)).prop("checked",false);$(".option-all").prop("checked",true);_text=dataSelect;_filterLabel.text(_text);$(".map-filter--dropdown",$(selector)).removeClass("is-open")});$(".option-trigger",$(selector)).click(function(){var _value=$(this).attr("value");var _text="";if(_value==="all"){$(".option-trigger",$(selector)).prop("checked",false);$(this).prop("checked",true);_text=dataAll}else{$(".option-all",$(selector)).prop("checked",false);if($(".option-trigger:checked",$(selector)).length===1){var $checked=$(".option-trigger:checked",$(selector));_text=$checked.attr("value")}else if($(".option-trigger:checked",$(selector)).length>1){_text=$(".option-trigger:checked",$(selector)).length+" options selected"}else{_text=dataSelect}}_filterLabel.text(_text)});$(".option-submit",$(selector)).click(function(){module.removeLineConnection(_theMap);$(selector+" .region-marker").remove();clickPop.remove();$(".js-reset").attr("disabled",false);$(".map-filter--dropdown",$(selector)).removeClass("is-open");var _filter=["in","category_name"];var _cats=[];$(".option-trigger:checked",$(selector)).each(function(){_filter.push($(this).attr("value"));_cats.push($(this).attr("value"))});if($(".option-trigger:checked",$(selector)).attr("value")==="all"||$(".option-trigger:checked",$(selector)).length<1){_filter=["!in","category_name","all"]}var filters=["all",[">=","date",_minDate],["<=","date",_maxDate],_filter];module.handleCasualtiesRegion(_req,_minDate,_maxDate,_cats);module.handleCasualtiesLocation(_req,_minDate,_maxDate,_cats);if(_mapType!=="hometown"){module.updateMapContents(new Date(_minDate*1e3),new Date(_maxDate*1e3),_req.responseText,_region.responseText,_req,_theMap,selector,"update",_cats);var _filteredLayer=_theMap.queryRenderedFeatures({layers:["layerRegionCenter"]});var _filteredRegions=$.grep(_filteredLayer,function(a){if(a.properties.date>=_minDate&&a.properties.date<=_maxDate&&_cats.includes(a.properties.category_name)){return a}});var _showMarker=$(selector).data("markers");if(_showMarker==="on"){module.handlePlotMarkers(_filteredRegions,_theMap,"update",_blockGroup)}}})})};module.handlePlotMarkers=function(_arraySource,_theMap,_status,_mapGroup){if(_status!=="initial"||_status==="reset"){$(".region-center-marker").remove()}if(_mapGroup!=="city"||_mapGroup===undefined){_arraySource.forEach(function(a){var el=document.createElement("div");el.className="region-center-marker "+_status;new mapboxgl.Marker(el).setLngLat(eval(a.properties.center)).addTo(_theMap)})}};module.handleDatePicker=function(_request,_region,_parent,_theMap){var selector="."+_parent;$.when(_request).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);module.buildDatePicker(selector,_minDate,_maxDate,_request,_region,_theMap)})};module.mapSlider=function(selector,_minDate,_maxDate,start,end){$(".map--slider",$(selector)).dateRangeSlider({bounds:{min:new Date(_minDate.getFullYear(),_minDate.getMonth(),1),max:_maxDate},defaultValues:{min:start,max:end},valueLabels:"change",durationIn:1e3,durationOut:1e3})};module.updateMapContents=function(_min,_max,_requestResponseText,_regionResponseText,_request,_theMap,_selector,_status,_category){_global_startDate=Date.parse(_min)/1e3;_global_endDate=Date.parse(_max)/1e3;var filters=["all",[">=","date",_global_startDate],["<=","date",_global_endDate]];var _mapType=$(_selector).data("type");var _blockGroup="region";var _blockType="destination";var _json=_requestResponseText;if(typeof _requestResponseText!="object"){_json=JSON.parse(_requestResponseText)}var _merge=$.grep(_json.features,function(a){if(_category.length>0&&_category[0]!=="all"){return a.properties.group===_blockGroup&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate&&_category.includes(a.properties.category_name)}else{return a.properties.group===_blockGroup&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate}});var _regions=[];if(typeof _requestResponseText!="object"){_regions=JSON.parse(_regionResponseText).features}else{_regions=_regionResponseText.features}_merge.forEach(function(a){_regions.forEach(function(b){if(a.properties.name.toLowerCase()===b.properties.name_ua.toLowerCase()){a.geometry=b.geometry}})});var _allRegion=$.unique($.map(_merge,function(a){return a.properties.name}).sort());var _newRegion=[];var _newRegionMarker=[];var _newCount=[];var obj={};var _centerMarker={};_allRegion.forEach(function(a){var count=0;_merge.forEach(function(b){if(a===b.properties.name){count+=b.properties.count;obj=b;_centerMarker={id:b.properties.id,type:"Feature",geometry:{type:"Point",coordinates:b.properties.center},properties:{name:b.properties.name,category_name:b.properties.category_name,date:b.properties.date,center:b.properties.center}}}});_newCount.push(count);_newRegion.push(obj);_newRegionMarker.push(_centerMarker)});var i=0;var _regionClone=_newRegion.slice(0);_regionClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});var _showMarker=$(_selector).data("markers");if(_showMarker==="on"){module.handlePlotMarkers(_regionClone,_theMap,_status,_blockGroup)}_theMap.getSource("_regionSource").setData({type:"FeatureCollection",features:_newRegion});_theMap.getSource("_regionCenter").setData({type:"FeatureCollection",features:_newRegionMarker});var _merge=$.grep(_json.features,function(a){if(_mapType==="hometown"){return a.properties.group==="city"&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.group==="city"&&a.properties.type===_blockType&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate}});var _cities=[];if(typeof _requestResponseText!="object"){_cities=JSON.parse(_regionResponseText).features}else{_cities=_regionResponseText.features}var _allCities=$.unique($.map(_merge,function(a){return a.properties.name}).sort());var _newCity=[];var _newCount=[];var obj={};_allCities.forEach(function(a){var count=0;_merge.forEach(function(b){if(a===b.properties.name){count+=b.properties.count;obj=b}});_newCount.push(count);_newCity.push(obj)});var i=0;var _cityClone=_newCity.slice(0);_cityClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});_theMap.getSource("_regionBubbles").setData({type:"FeatureCollection",features:_newCity});module.handleCasualtiesRegion(_request,_global_startDate,_global_endDate,null,_selector);module.handleCasualtiesLocation(_request,_global_startDate,_global_endDate,null,_selector);var _stopsStyle={property:"count",type:"interval",stops:_globalStop};_theMap.setPaintProperty("layerRegion","fill-color",_stopsStyle)};module.handleGenerateSlider=function(_request,_region,i,_theMap){var loadRegion=setInterval(function(){var _region=_theMap.getLayer("layerRegion");var _bubble=_theMap.getLayer("layerBubble");if(_region!==undefined&&_bubble!==undefined){_theMap.moveLayer("layerBubble");clearInterval(loadRegion)}},100);var selector="."+_mapParents[i];$.when(_request).done(function(_requestResult){var _minDate=new Date(module.handleMinDate(_requestResult)*1e3);var _maxDate=new Date(module.handleMaxDate(_requestResult)*1e3);var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"];module.mapSlider(selector,_minDate,_maxDate,_minDate,_maxDate);if(typeof _requestResult!="object"){_requestResult=JSON.parse(_requestResult)}var _allDates=$.unique($.map(_requestResult.features,function(a){var date=new Date(a.properties.date*1e3);if(!isNaN(date.getFullYear())){return date.getFullYear()}})).sort();var _years="";_allDates=$.unique(_allDates);_allDates.forEach(function(a){_years+='<span class="year--marking">'+a+"</span>";if(_allDates.length<4){_years+="<span>0000</span><span>0000</span><span>0000</span>"}else{_years+="<span>0000</span>"}});$(".map--slider__years",$(selector)).append(_years);var _minLabel=_minDate.getMonth()+1+"/"+_minDate.getDate()+"/"+_minDate.getFullYear();var _maxLabel=_maxDate.getMonth()+1+"/"+_maxDate.getDate()+"/"+_maxDate.getFullYear();var _dateLabel='<p class="date--start">'+_minLabel+"</p>";_dateLabel+='<p class="date--end">'+_maxLabel+"</p>";$(".map--slider__marking",$(selector)).append(_dateLabel);$(".map--slider",$(selector)).on("valuesChanging",function(e,data){$(".js-reset").attr("disabled",false);clickPop.remove();_slideTriggerred=true;var _min=data.values.min;var _max=data.values.max;module.buildDatePicker(selector,_minDate,_maxDate,_request,_region,_theMap);module.updateMapContents(_min,_max,_request.responseText,_region.responseText,_request,_theMap,selector,"update",[]);module.removeLineConnection(_theMap);$(selector+" .region-marker").remove()})})};module.handleGenerateBubble=function(_request,_theMap,_parent,_isRTL){var _bubbles=_request;$.when(_bubbles).done(function(_bubbleData){var _parentSelector="."+_parent;var _mapType=$(_parentSelector).data("type");var _mapGroup=$(_parentSelector).data("group");var _blockGroup="city";var _blockType="destination";var startDate=module.handleMinDate(_bubbleData);var endDate=module.handleMaxDate(_bubbleData);var _merged=module.handleProcessRequest(_bubbleData,_blockType,_blockGroup);_merged=$.grep(_merged,function(a){if(_mapType==="hometown"){return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=startDate&&a.properties.date<=endDate}});var _mergeClone=$.grep(JSON.parse(_bubbleData).features,function(a){if(_mapType==="hometown"){return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.group==="city"&&a.properties.type==="destination"&&a.properties.show_in_hometown==="1"&&a.properties.hasOwnProperty("origin_code")}else{return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.group==="city"&&a.properties.type==="destination"}});var _allCity=$.unique($.map(_merged,function(a){return a.properties.code}).sort());var _newCity=[];var _newCount=[];var obj={};_allCity.forEach(function(a){var count=0;_merged.forEach(function(b){if(a===b.properties.code){count+=b.properties.count;obj=b}});_newCount.push(count);_newCity.push(obj)});var i=0;var _cityClone=_newCity.slice(0);_cityClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});var myGeoJSON={};myGeoJSON.type="FeatureCollection";myGeoJSON.features=_cityClone;var _stops=module.handleCasualtiesLocation(_bubbles,startDate,endDate,null,"."+_parent);var _mapLoaded=false;var _dataLoaded=false;_dataLoaded=_theMap.once("data",function(){return true});_mapLoaded=_theMap.once("load",function(){var load_geojson=setInterval(function(){if(_dataLoaded){_theMap.addSource("_regionBubbles",{type:"geojson",data:myGeoJSON});clearInterval(load_geojson)}},100);return true});if(_mapLoaded&&_dataLoaded){var _hoveredBubble=false;var _opacity=.7;var _opacityHover=1;var _visibilty="visible";if(_mapType==="connection"&&_mapGroup==="region"){_opacity=0;_visibilty="none"}var preload_bubble_layer=setInterval(function(){if(_theMap.loaded()){clearInterval(preload_bubble_layer)}},300);var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerBubble",function(e){if(e.features.length>0){if(_hoveredBubble){_theMap.setFeatureState({source:"_regionBubbles",id:_hoveredBubble},{hover:false})}_hoveredBubble=e.features[0].id;_theMap.setFeatureState({source:"_regionBubbles",id:_hoveredBubble},{hover:true})}});_theMap.on("mouseleave","layerBubble",function(){if(_hoveredBubble){_theMap.setFeatureState({source:"_regionBubbles",id:_hoveredBubble},{hover:false})}_hoveredBubble=null});module.handleMapEvents("layerBubble",myGeoJSON,startDate,endDate,_theMap,_parent,_mergeClone,_isRTL);$(".map--preloader").addClass("is--loaded")}})};module.handleGenerateRegions=function(_request,_min,_max,_theMap,_parent,_isRTL,_regionFill){var _regions=_request;$.when(_regions).done(function(_regionData){var startDate=module.handleMinDate(_regionData);var endDate=module.handleMaxDate(_regionData);if(_min||_max){startDate=_min;endDate=_max;_global_startDate=startDate;_global_endDate=endDate}var _parentSelector="."+_parent;var _mapType=$(_parentSelector).data("type");var _mapGroup=$(_parentSelector).data("group");var _blockGroup="region";var _blockType="destination";var _merged=module.handleProcessRequest(_regionData,_blockType,_blockGroup);_merged=$.grep(_merged,function(a){return a.properties.date>=startDate&&a.properties.date<=endDate});var _mergeClone=$.grep(JSON.parse(_regionData).features,function(a){return a.properties.date>=startDate&&a.properties.date<=endDate&&a.properties.group==="region"&&a.properties.type==="destination"});var _allRegion=$.unique($.map(_merged,function(a){return a.properties.name}).sort());var _newRegion=[];var _newRegionMarker=[];var _newCount=[];var obj={};var _centerMarker={};_allRegion.forEach(function(a){var count=0;_merged.forEach(function(b){if(a===b.properties.name){count+=b.properties.count;obj=b;_centerMarker={id:b.properties.id,type:"Feature",geometry:{type:"Point",coordinates:b.properties.center},properties:{name:b.properties.name,category_name:b.properties.category_name,date:b.properties.date,center:b.properties.center}}}});_newCount.push(count);_newRegion.push(obj);_newRegionMarker.push(_centerMarker)});var i=0;var _regionClone=_newRegion.slice(0);_regionClone.forEach(function(a,i){a.properties.count=_newCount[i];i++});var myGeoJSON={};myGeoJSON.type="FeatureCollection";myGeoJSON.features=_newRegion;var myCenterJSON={};myCenterJSON.type="FeatureCollection";myCenterJSON.features=_newRegionMarker;var geoJSONModal={};geoJSONModal.type="FeatureCollection";geoJSONModal.features=_merged;var _stops=module.handleCasualtiesRegion(_regions,startDate,endDate,null,"."+_parent);$.when(_regionFill).done(function(_fillData){var _fill=_fillData;if(typeof _fillData!="object"){_fill=JSON.parse(_fillData)}myGeoJSON.features.forEach(function(a){_fill.features.forEach(function(b){if(a.properties.name.toLowerCase()===b.properties.name_ua.toLowerCase()){a.geometry=b.geometry;a.properties.fill=b.properties.fill}})});var _mapLoaded=false;var _dataLoaded=false;_dataLoaded=_theMap.once("data",function(){return true});_mapLoaded=_theMap.once("load",function(){return true});if(_mapLoaded&&_dataLoaded){var _hoveredRegion=false;_theMap.addSource("_regionSource",{type:"geojson",data:myGeoJSON});_theMap.addSource("_regionCenter",{type:"geojson",data:myCenterJSON});var _opacityHover=1;var _opacityNormal=.75;var _visibilty="visible";if((_mapType==="connection"||_mapType==="hometown")&&_mapGroup==="city"){_opacityHover=0;_opacityNormal=0;_visibilty="none"}var preload_region_layer=setInterval(function(){if(_theMap.loaded()&&_stops.length!==0){_theMap.addLayer({id:"layerRegion",type:"fill",source:"_regionSource",layout:{visibility:_visibilty},paint:{"fill-color":{property:"count",type:"interval",stops:_stops},"fill-opacity":["case",["boolean",["feature-state","hover"],false],_opacityHover,_opacityNormal]},filter:["all",[">=","date",startDate],["<=","date",endDate]]});window.windowMap=_theMap;_theMap.addLayer({id:"layerRegionOutline",type:"line",source:"_regionSource",layout:{visibility:_visibilty},paint:{"line-color":"white","line-width":2}});var _showMarker=$(_parentSelector).data("markers");var _centerVisibility="none";if(_showMarker==="on"){_centerVisibility="visible"}_theMap.addLayer({id:"layerRegionCenter",type:"circle",source:"_regionCenter",layout:{visibility:_centerVisibility},paint:{"circle-color":"red","circle-radius":10,"circle-opacity":0}});if(_showMarker==="on"){module.handlePlotMarkers(_regionClone,_theMap,"initial",_mapGroup)}clearInterval(preload_region_layer)}$(".map--preloader").addClass("is--loaded")},100);var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerRegion",function(e){if(e.features.length>0){if(_hoveredRegion){_theMap.setFeatureState({source:"_regionSource",id:_hoveredRegion},{hover:false})}_hoveredRegion=e.features[0].id;_theMap.setFeatureState({source:"_regionSource",id:_hoveredRegion},{hover:true})}});_theMap.on("mouseleave","layerRegion",function(){if(_hoveredRegion){_theMap.setFeatureState({source:"_regionSource",id:_hoveredRegion},{hover:false})}_hoveredRegion=null});module.handleMapEvents("layerRegion",myGeoJSON,startDate,endDate,_theMap,_parent,_mergeClone,_isRTL)}})})};module.handleMapEvents=function(_type,_source,_min,_max,_theMap,_selector,_originalSource,_isRTL){var _parentSelector="."+_selector;var _event=module.isMobileSafari()?"touchstart":"click";_theMap.on(_event,_type,function(e){var filters=_theMap.getFilter(_type);var _startDate=_min;var _endDate=_max;var _sourceType="_regionBubbles";if(_type==="layerRegion"){_sourceType="_regionSource"}var _category=[];$("."+_selector).find(".option-trigger:checked").each(function(){_category.push($(this).attr("value"))});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){var _originalSourceFiltered=$.grep(_originalSource,function(a){return $.inArray(a.properties.category_name,_category)>=0})}else{var _originalSourceFiltered=_originalSource}var _originalSourceAddedMissingMonths=module.addMissingMonths(_originalSourceFiltered);var _mapSource=_theMap.getSource(_sourceType);var _mapType=$(_parentSelector).data("type");var _blockGroup=_type=="layerRegion"?"region":"city";var _blockType="destination";var _all_data_source={};_all_data_source.type="FeatureCollection";_all_data_source.features=_originalSourceFiltered;if(_blockGroup==="region"){}var _sourceArray=$.grep(_all_data_source.features,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.group===_blockGroup&&a.properties.type===_blockType});if(_slideTriggerred){_startDate=_global_startDate;_endDate=_global_endDate}var _count=0;var _city=$.grep(_sourceArray,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.date>=_startDate&&a.properties.date<=_endDate});var _cityData=$.grep(_sourceArray,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.date>=_startDate&&a.properties.date<=_endDate});_city.forEach(function(a){_count+=a.properties.count});var _series=[];var _allDatesx=$.unique($.map(_city,function(a){var _date=new Date(a.properties.date*1e3);if(a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()){return _date.getFullYear()}}).sort());var _allDates=[];_allDatesx.forEach(function(year){for(var i=0;i<12;i++){_allDates.push(year+"-"+i+"-"+1)}});var _addDatesLabel=$.map(_allDates,function(a){var _monthsName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var _str=a.split("-");return _monthsName[_str[1]]+"<span class='spacer [ u-fwn u-fsn u-franklin ]'><br></span>"+_str[0]});var _allCategories=$.unique($.map(_city,function(a){return a.properties.category_name}).sort());var _series=[];var _obj={};_allCategories.forEach(function(a){_obj={};var _dates=[];_cityData.forEach(function(b){var _date=[];if(a===b.properties.category_name){_obj.name=b.properties.category_name;_date.push(b.properties.date*1e3);_date.push(b.properties.count)}_dates.push(_date)});var _monthsName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var _dateSort=$.grep(_dates,function(n){return n.length!==0}).sort(function(a,b){if(new Date(a)>new Date(b)){return 1}else if(new Date(a)<new Date(b)){return-1}else{return 0}});var _years=$.unique($.map(_dates,function(a){if(a.length!==0){var _y=new Date(a[0]).getFullYear();var _d=new Date(a[0]).getMonth();return _y+"-"+_monthsName[_d]+"-1"}}).sort());var _arr=[];_allDates.forEach(function(year){var _c=0;var _ar=[];_dateSort.forEach(function(item){var _compare=new Date(item[0]).getFullYear()+"-"+new Date(item[0]).getMonth()+"-1";if(year===_compare){_c+=item[1]}});_arr.push([_c])});_obj.data=_arr;_series.push(_obj)});if(_mapType!=="hometown"){var _html="";_html='<div class="mapboxgl--graph__wrapper"><span class="mapboxgl--graph__visual-close">&times;</span>';_html+='<div class="mapboxgl--graph__visual" id="js-visual">';_html+="</div>";_html+='<div class="mapboxgl--graph__summary">';_html+='<p class="mapboxgl--graph__summary--highlight [ u-fwn u-fsn u-franklin ] ">'+_count+"</p>";_html+='<p class="[ u-fwn u-fsn u-franklin u-ttu ]">'+$(_parentSelector).data("total-deaths")+'</p><a href="https://www.highcharts.com/" class="highcharts-credits [ u-franklin ]">Highcharts.com</a>';_html+="</div>";_html+="</div>";clickPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap);Highcharts.chart("js-visual",{chart:{type:"column",height:400,style:{fontFamily:'"franklin-gothic-urw", Helvetica, Arial, sans-serif'}},title:{rtl:_isRTL,text:e.features[0].properties.name+'<br><span class="mapbox-graph__subtitle">'+$(_parentSelector).data("title")+"</span>",style:{color:"#14272b",fontSize:"23px",lineHeight:"25px",letterSpacing:"-.4px",marginBottom:"10px"}},credits:{enabled:false},xAxis:{categories:_addDatesLabel,labels:{style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"}}},yAxis:{min:0,title:{text:null},labels:{style:{color:"#05363e",fontSize:"13px",lineHeight:"15px",letterSpacing:"0.3px"}}},exporting:{enabled:false},tooltip:{shadow:false,rtl:_isRTL,useHTML:true,headerFormat:'<p class="tooltip-header [ u-fwn u-fsn u-franklin ]" style="margin: 0; font-size: 13px; text-align: center;">{point.key}</p>',pointFormat:'<p style="display: flex; justify-content: space-between; margin-top: 5px; margin-bottom: 0; font-size: 13px;">'+"<span>{series.name}</span>"+'<strong style="margin-left: 5px;">{point.y}</strong>'+"<p/>",footerFormat:'<p style="font-weight: 700; display: flex; justify-content: space-between" class="[ u-fwn u-fsn u-franklin ]"><span>'+dataTotal+"</span><span>{point.total}</span></p>",padding:15,backgroundColor:"#ffffff",borderColor:"#cecece",borderRadius:0,borderWidth:1,shared:true,formatter:function(){var s='<div class="highcharts-tooltip-table__elem">';s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col highcharts-tooltip-table__heading [ u-fwn u-fsn u-franklin ]" style="color: #05363e">'+this.x.replace("/<brs*/?>/gi"," ")+"</div></div>";$.each(this.points,function(index){s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col series--name [ u-fwn u-fsn u-franklin ]">'+this.series.name+"</div>";s+='<div class="highcharts-tooltip-table__col series--value [ u-fwn u-fsn u-franklin ]">'+this.y+"</div></div>"});s+='<div class="highcharts-tooltip-table__row"><div class="highcharts-tooltip-table__col  series--total [ u-fwn u-fsn u-franklin ]"><b style="text-transform:uppercase;">'+dataTotal+'</b></div> <div class="highcharts-tooltip-table__col series--total--value"><b>'+this.points[0].total+"</b></div></div>";s+="</div>";return s}},plotOptions:{column:{stacking:"normal"}},legend:{rtl:_isRTL,enabled:true,verticalAlign:"bottom",itemMarginBottom:8,itemStyle:{fontWeight:"normal",lineHeight:"15px",fontSize:"13px",color:"#555555",letterSpacing:"0.3px"}},series:_series});window.dispatchEvent(new Event("resize"))}$(".map--overlay").addClass("is-shown");$(".mapboxgl--graph__visual-close").click(function(){clickPop.remove();$(".map--overlay").removeClass("is-shown")});if(_mapType==="connection"||_mapType==="hometown"){var _origin={code:e.features[0].properties.code,date:e.features[0].properties.date,from:e.features[0].properties.origin_code};var _mapType={type:_blockType,group:_blockGroup,map:_mapType};var _overAllCount=_count;module.handleDrawConnection(e,_theMap,_sourceArray,_source,_origin,_cityData,_mapType,_overAllCount,_parentSelector)}});var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,_type,function(e){var _startDate=_min;var _endDate=_max;var _sourceType="_regionBubbles";if(_type==="layerRegion"){_sourceType="_regionSource"}var _mapSource=_theMap.getSource(_sourceType);var _category=[];$("."+_selector).find(".option-trigger:checked").each(function(){_category.push($(this).attr("value"))});if($.inArray("all",_category)>=0){_category=null}if(_category!==null){var _originalSourceFiltered=$.grep(_originalSource,function(a){return $.inArray(a.properties.category_name,_category)>=0})}else{var _originalSourceFiltered=_originalSource}var _sourceArray=_source.features;var _all_data_source={};_all_data_source.type="FeatureCollection";_all_data_source.features=_originalSourceFiltered;var _mapType=$(_parentSelector).data("type");var _blockGroup=_type=="layerRegion"?"region":"city";var _blockType="destination";var _sourceArray=$.grep(_all_data_source.features,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.group===_blockGroup&&a.properties.type===_blockType&&a.properties.date>=_startDate&&a.properties.date<=_endDate});if(_slideTriggerred){_startDate=_global_startDate;_endDate=_global_endDate}var _count=0;var _city=$.grep(_sourceArray,function(a){return a.properties.name.toLowerCase()===e.features[0].properties.name.toLowerCase()&&a.properties.date>=_startDate&&a.properties.date<=_endDate});_city.forEach(function(a){_count+=a.properties.count});var _html="";var _mapType=$(_parentSelector).data("type");_html+='<div class="mapboxgl--hover__data"><p class="[ u-franklin u-fsn u-fwn ]">';_html+="<b>"+_count+"</b>";_html+="<span>&nbsp;"+$(_parentSelector).data("casualty-in").toLowerCase()+"&nbsp;</span>";_html+="<b>"+e.features[0].properties.name+"</b>";_html+="</p></div>";markerPop.remove();if(_mapType!=="connection"){hoverPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}});var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerRegionCenter",function(e){var _html="";_html+='<div class="mapboxgl--hover__data"><p class="[ u-franklin u-fsn u-fwn ]">';_html+=e.features[0].properties.name;_html+="</p></div>";hoverPop.remove();var _mapType=$(_parentSelector).data("type");if(_mapType==="simple"){markerPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}});_theMap.on("mouseleave",_type,function(e){hoverPop.remove();markerPop.remove()});_theMap.on("layerRegionCenter",_type,function(e){hoverPop.remove();markerPop.remove()})};module.handleDrawConnection=function(_e,_theMap,_sourceArray,_sourceAll,_origin,_originalSource,_mapType,_overAll,_parentSelector){var mapLayer=_theMap.getLayer("layerPoints");var _isCenter="false";if(typeof mapLayer!=="undefined"){_theMap.removeLayer("layerPoints").removeSource("_pointsOrigin");_theMap.removeLayer("layerString").removeSource("_pointsString");try{$(_parentSelector+" .region-marker").remove()}catch(e){console.log(e);console.log("No marker was intantiated.")}}var _centerCode=_e.features[0].properties.code;var _centerName=_e.features[0].properties.name;var _center=eval(_e.features[0].properties.center);if(_mapType.map==="connection"){var _points=$.map(_sourceArray,function(a){var _groupClass=_mapType.group;_isCenter="false";if(_centerCode===a.properties.origin_code){_groupClass+=" region-marker-"+_groupClass+"-center center-center";_isCenter="true"}var el=document.createElement("div");var _class="region-marker region-marker-"+_groupClass;el.className=_class;if(a.properties.origin_center){new mapboxgl.Marker(el).setLngLat(a.properties.origin_center).addTo(_theMap);return{type:"Feature",properties:{name:a.properties.origin_name,is_center:_isCenter,origin_code:a.properties.origin_code,code:a.properties.code},geometry:{type:"Point",coordinates:a.properties.origin_center}}}});if(_centerName===_e.features[0].properties.name&&_centerCode!==_e.features[0].properties.origin_code){_isCenter="center-only";var el=document.createElement("div");el.className="region-marker region-marker-city-center-only";new mapboxgl.Marker(el).setLngLat(_center).addTo(_theMap)}var _centerObj={type:"Feature",properties:{name:_e.features[0].properties.name,is_center:_isCenter,origin_code:_e.features[0].properties.origin_code,code:_e.features[0].properties.code},geometry:{type:"Point",coordinates:eval(_center)}};_points.push(_centerObj);var _lineString=$.map(_sourceArray,function(a){if(a.properties.origin_name){var _ob={type:"Feature",properties:{name:a.properties.origin_name,category_color:a.properties.category_color,category_name:a.properties.category_name},geometry:{type:"LineString",coordinates:[eval(_center),a.properties.origin_center]}};return _ob}});var myGeoJSONString={};myGeoJSONString.type="FeatureCollection";myGeoJSONString.features=_lineString;_theMap.addSource("_pointsString",{type:"geojson",lineMetrics:true,data:myGeoJSONString});_theMap.addLayer({id:"layerString",type:"line",source:"_pointsString",paint:{"line-color":"black","line-opacity":1,"line-width":3,"line-gradient":["interpolate",["linear"],["line-progress"],0,"#1ca404",.5,"#56a0f9",1,"#1a3bc2"]},layout:{"line-cap":"round","line-join":"round"}});var myGeoJSON={};myGeoJSON.type="FeatureCollection";myGeoJSON.features=_points;_theMap.addSource("_pointsOrigin",{type:"geojson",data:myGeoJSON});_theMap.addLayer({id:"layerPoints",type:"circle",source:"_pointsOrigin",paint:{"circle-color":"#ffffff","circle-opacity":0,"circle-radius":5}});hoverPop.remove();_theMap.on("mouseenter","layerPoints",function(e){var _deathPlace=_origin.code;var _deathDate=_origin.date;var _deathOrigin=e.features[0].properties.origin_code;var _type=_mapType.group;var _count=0;var _newSource=$.grep(_originalSource,function(a){return a.properties.code===_deathPlace&&a.properties.origin_code===_deathOrigin&&a.properties.type==="destination"&&a.properties.group===_type});if(_newSource.length>0){_newSource.forEach(function(a){_count+=a.properties.count})}var _html="";var _context="";var _isOrigin=false;var _isSame=false;if(_mapType.group==="city"||_mapType.group==="region"&&_mapType){if(e.features[0].properties.is_center==="true"){_context="";_context+='<div class="casualty-count-to [ u-franklin u-fsn u-fwn ]">';_context+="<b>"+_overAll+"</b>";_context+=" "+dataCasualtyIn+" ";_context+="<b>"+e.features[0].properties.name+"</b>";_context+="</div>";_context+='<div class="casualty-count-from [ u-franklin u-fsn u-fwn ]">';_context+="<b>"+_count+"</b>";_context+=" "+dataCasualtySame+" ";_context+="<b>"+e.features[0].properties.name+"</b>";_context+="</div>";_isSame=true}else if(e.features[0].properties.is_center==="center-only"){_context="";_context+='<div class="casualty-count">';_context+="<p class='[ u-franklin u-fsn u-fwn ]'>";_context+=e.features[0].properties.name+"</p>";_context+="</div>";_isSame=false}else{_context="";_context+='<div class="casualty-count">';_context+="<p class='[ u-franklin u-fsn u-fwn ]'><b>"+_count+"</b>";_context+=" "+dataCasualtyFrom+" ";_context+="<b>"+e.features[0].properties.name+"</b></p>";_context+="</div>";_isOrigin=true;_isSame=false}}_html+='<div class="mapboxgl--hover__data">';_html+=_context;_html+="</div>";hoverPop.remove();markerPop.remove();if(_isOrigin){connectOrigin.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}else{if(_isSame){connectDestination.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}else{connectPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)}}});_theMap.on("mouseleave","layerPoints",function(e){connectPop.remove();connectOrigin.remove();connectDestination.remove();hoverPop.remove();markerPop.remove()});$(".region-marker").hover(function(){$(".map-route--same").removeClass("is-shown");if($(this).hasClass("center-center")){$(".map-route--same").addClass("is-shown")}},function(){$(".map-route--same").removeClass("is-shown")})}else{var _dateChanged=_global_startDate!==0||_global_endDate!==0?true:false;if(_dateChanged){_sourceArray=$.grep(_sourceArray,function(a){return a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate&&a.id!==0})}var _allCities=$.unique($.map(_sourceArray,function(a){return a.properties.origin_name}).sort());var _allLines=[];_allCities.forEach(function(a){var _rec=$.unique($.map(_sourceArray,function(b){if(a===b.properties.origin_name){return b.properties.category_name}})).sort();_allLines[a]=_rec});var _categoriesColor=$.unique($.map(_sourceArray,function(a){return a.properties.category_name+"|"+a.properties.category_color}).sort());var _hometownLegend=$(".hometown--legend",_parentSelector);var _html="";_categoriesColor.forEach(function(category){_html+='<p><span style="background-color: '+category.substring(category.indexOf("#"))+'"></span>'+category.substring(0,category.indexOf("|"))+"</p>"});_html+='<p><span style="background-color: #428cf4;"></span> '+dataDestination+"</p>";_hometownLegend.html(_html);$(".js-hometown-route",_parentSelector).addClass("is-shown");var _lineString=[];for(var key in _allLines){var _obj={};if(_allLines.hasOwnProperty(key)){var _color=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.category_color}).sort());_color=_color[0];var _category=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.category_name}).sort());_category=_category[0];if(_allLines[key].length>1){var _color=$.unique($.map(_sourceArray,function(a){return a.properties.category_color}).sort());var _category=$.unique($.map(_sourceArray,function(a){return a.properties.category_name}).sort())}var _origin_center=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.origin_center}).sort());var _origin_code=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.origin_code}).sort());var _code=$.unique($.map(_sourceArray,function(a){if(a.properties.origin_name===key)return a.properties.code}).sort());var _origin_center_array=eval("["+_origin_code[0]+"]").reverse();_obj={type:"Feature",properties:{name:key,category_color:_color,category_name:_category,origin_code:_origin_code[0],origin_center:_origin_code[0],code:_code[0]},geometry:{type:"LineString",coordinates:[eval(_center),_origin_center_array]}};_lineString.push(_obj)}}var _singleCategory=$.map(_lineString,function(_record){if(!Array.isArray(_record.properties.category_color)){return _record}});var _multipleCategory=$.map(_lineString,function(_record){if(Array.isArray(_record.properties.category_color)){return _record}});try{$(_parentSelector+" .region-marker").remove()}catch(e){console.log(e);console.log("No marker was intantiated.")}var _maxTotal=0;_sourceArray.forEach(function(a){_maxTotal+=a.properties.count});var _range1=_maxTotal/3;var _range2=_range1+1;var _range3=_range1*2+1;var _center={geometry:{type:"Point",coordinates:eval(_e.features[0].properties.center)},properties:{name:_centerName,code:_centerCode}};var _groupClass=_mapType.group;var el=document.createElement("div");var _class="region-marker region-marker-hometown hometown-center region-marker-"+_groupClass;el.className=_class;new mapboxgl.Marker(el).setLngLat(_center.geometry.coordinates).addTo(_theMap);if(_singleCategory.length>0){module.generateLineString(_theMap,_singleCategory,"single");_singleCategory.forEach(function(_category){var _deathCount=0;_sourceArray.forEach(function(rec){if(rec.properties.origin_code===_category.properties.origin_code){_deathCount+=rec.properties.count}});var _sizeClass="";if(_deathCount<_range1){_sizeClass=" size--small"}else if(_deathCount>=_range2&&_deathCount<_range3){_sizeClass=" size--medium"}else if(_deathCount>=_range3&&_deathCount<=_maxTotal){_sizeClass=" size--large"}var _groupClass=_mapType.group;var el=document.createElement("div");var _class="region-marker region-marker-hometown region-marker-"+_groupClass;el.className=_class;el.style.backgroundColor=_category.properties.category_color;var _origin_array=eval("["+_category.properties.origin_center+"]").reverse();new mapboxgl.Marker(el).setLngLat(_origin_array).addTo(_theMap)})}if(_multipleCategory.length>0){module.generateLineString(_theMap,_multipleCategory,"multiple");_multipleCategory.forEach(function(_category){var _deathCount=0;_sourceArray.forEach(function(rec){if(rec.properties.origin_code===_category.properties.origin_code){_deathCount+=rec.properties.count}});var _sizeClass="";if(_deathCount<_range1){_sizeClass=" size--small"}else if(_deathCount>=_range2&&_deathCount<_range3){_sizeClass=" size--medium"}else if(_deathCount>=_range3&&_deathCount<=_maxTotal){_sizeClass=" size--large"}var _groupClass=_mapType.group;var el=document.createElement("div");var _class="region-marker region-marker-hometown region-marker-"+_groupClass;el.className=_class;el.style.background="linear-gradient(to right, "+_multipleCategory[0].properties.category_color[1]+" 50%, "+_multipleCategory[0].properties.category_color[0]+" 50%)";var _origin_array=eval("["+_category.properties.origin_center+"]").reverse();new mapboxgl.Marker(el).setLngLat(_origin_array).addTo(_theMap)})}var _linePoints=$.map(_lineString,function(_line){var _object={geometry:{type:"Point",coordinates:_line.geometry.coordinates[1]},properties:{name:_line.properties.name,code:_line.properties.code,origin_code:_line.properties.origin_code,date:_line.properties.date}};return _object});_linePoints.push(_center);module.generateLineStringPoints(_theMap,_linePoints,_sourceArray)}};module.generateLineStringPoints=function(_theMap,_points,_sourceArray){$(".reset--connection","#"+_theMap._canvasContainer.offsetParent.id).addClass("is-shown");var mapHomeTownPoints=_theMap.getLayer("layerHometowns");if(typeof mapHomeTownPoints!=="undefined"){_theMap.removeLayer("layerHometowns").removeSource("_hometownsBubble")}var _hometowns={};_hometowns.type="FeatureCollection";_hometowns.features=_points;_theMap.addSource("_hometownsBubble",{type:"geojson",lineMetrics:true,data:_hometowns});_theMap.addLayer({id:"layerHometowns",type:"circle",source:"_hometownsBubble",paint:{"circle-color":"red","circle-radius":20,"circle-opacity":0}});var _event=module.isMobileSafari()?"touchmove":"mousemove";_theMap.on(_event,"layerHometowns",function(e){_theMap.moveLayer("layerBubble","layerHometowns");var _referencePoint=e.features[0].properties.origin_code?e.features[0].properties.origin_code:e.features[0].properties.code;var _name=$.unique($.map(_sourceArray,function(a){if(_referencePoint===a.properties.origin_code){return a.properties.origin_name}}).sort());var _allCategories=$.unique($.map(_sourceArray,function(a){if(_referencePoint===a.properties.origin_code){return a.properties.category_name}}).sort());var _html="";_html+='<div class="mapboxgl--hover__hometown  mapboxgl--hover__data">';_html+='<div class="hometown--details">';var _hasRecord=false;_allCategories.forEach(function(category){var _count=0;if(_global_startDate!==0){_sourceArray.forEach(function(a){if(_referencePoint===a.properties.origin_code&&category===a.properties.category_name&&a.properties.date>=_global_startDate&&a.properties.date<=_global_endDate){_count+=a.properties.count}})}else{_sourceArray.forEach(function(a){if(_referencePoint===a.properties.origin_code&&category===a.properties.category_name){_count+=a.properties.count}})}_html+="<div>"+_count+" "+category+"</div>";_hasRecord=true});if(_hasRecord){_html+="<div>"+dataFrom+" "+_name+"</div>"}else{_html+=e.features[0].properties.name}_html+="</div>";_html+="</div>";hoverPop.remove();hometownPop.setLngLat(e.lngLat).setHTML(_html).addTo(_theMap)});_theMap.on("mouseleave","layerHometowns",function(e){hoverPop.remove();hometownPop.remove()})};module.removeLineConnection=function(_theMap){$(".reset--connection","#"+_theMap._canvasContainer.offsetParent.id).removeClass("is-shown");var mapLayerSingleString=_theMap.getLayer("layerSingleString");var mapLayerMultipleString=_theMap.getLayer("layerMultipleString");if(typeof mapLayerSingleString!=="undefined"){_theMap.removeLayer("layerSingleString").removeSource("_singleStrings")}if(typeof mapLayerMultipleString!=="undefined"){_theMap.removeLayer("layerMultipleString").removeSource("_multipleStrings")}var mapLayerHome=_theMap.getLayer("layerHometowns");if(typeof mapLayerHome!=="undefined"){_theMap.removeLayer("layerHometowns").removeSource("_hometownsBubble")}};module.generateLineString=function(_theMap,_stringSource,_type){module.removeLineConnection(_theMap);var _singleCategoryString={};_singleCategoryString.type="FeatureCollection";_singleCategoryString.features=_stringSource;var _layerSource="_singleStrings";var _layerId="layerSingleString";if("multiple"===_type){_layerSource="_multipleStrings";_layerId="layerMultipleString"}_theMap.addSource(_layerSource,{type:"geojson",lineMetrics:true,data:_singleCategoryString});if("single"===_type){var preloadConnectionString=setInterval(function(){if(_theMap.loaded()){_theMap.addLayer({id:_layerId,type:"line",source:_layerSource,paint:{"line-color":["get","category_color"],"line-width":3},layout:{"line-cap":"round","line-join":"round"}});clearInterval(preloadConnectionString)}},300)}else{var preloadConnectionString=setInterval(function(){if(_theMap.loaded()){_theMap.addLayer({id:_layerId,type:"line",source:_layerSource,paint:{"line-color":"black","line-width":3,"line-gradient":["interpolate",["linear"],["line-progress"],0,_stringSource[0].properties.category_color[1],.5,_stringSource[0].properties.category_color[1],.51,_stringSource[0].properties.category_color[0],1,_stringSource[0].properties.category_color[0]]},layout:{"line-cap":"round","line-join":"round"}});clearInterval(preloadConnectionString)}},300)}};module.handleURLRequests=function(_url){var _request=$.ajax({url:_url,dataType:"Text",error:function(xhr){console.log("An error occured while retrieving GeoJson for Bubbles files")}});return _request};module.handleProcessRequest=function(_request,_type,_group){var processed_data=_request;if(typeof _request!="object"){processed_data=JSON.parse(_request)}var processed_clone=Object.assign(processed_data);var type=_type===null||_type===undefined?"destination":_type;var group=_group===null||_group===undefined?"city":_group;var arr=$.grep(processed_clone.features,function(a){return a.properties.type===type&&a.properties.group===group});return arr};module.handleMinDate=function(_request){var getMin=_request;if(typeof _request!="object"){getMin=JSON.parse(_request)}var _startDate=Math.min.apply(null,$.map(getMin.features,function(a){return a.properties.date}));return _startDate};module.handleMaxDate=function(_request){var getMin=_request;if(typeof _request!="object"){getMin=JSON.parse(_request)}var _endDate=Math.max.apply(null,$.map(getMin.features,function(a){return a.properties.date}));return _endDate};module.isMobileSafari=function(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)};handlers.push({name:"_handleMapInit",handle:function(){module.handleMap()}});module.init=function(){$.each(handlers,function(i,el){if(typeof el.handle=="function"){el.handle()}if(typeof el.attach=="function"){Drupal.behaviors[el.name]=el}})};return module}(window,jQuery,window.App));